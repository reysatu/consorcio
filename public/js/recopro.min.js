!function(){"use strict";function e(e,t,a,i){e.$on("$stateChangeStart",function(e,a,o,r,n){"home"!==a.name&&i.all("validate","url="+a.name,function(e){e.status||(t.go("home",{location:!0}),location.reload())},function(){t.go("home",{location:!0}),location.reload()})}),e.online=navigator.onLine,a.addEventListener("offline",function(){e.$apply(function(){e.online=!1})},!1),a.addEventListener("online",function(){e.$apply(function(){e.online=!0})},!1)}function t(e,t,a,i,o,r){e.startSymbol("[[").endSymbol("]]"),t.defaults.xsrfCookieName="csrftoken",t.defaults.xsrfHeaderName="X-CSRFToken",r.defaults.stripTrailingSlashes=!1,t.interceptors.push(["$q","$rootScope",function(e,t){var a=0;return{request:function(e){return a++,t.$broadcast("loader_show"),e},requestError:function(i){return--a||t.$broadcast("loader_hide"),e.reject(i)},response:function(e){return 0===--a&&t.$broadcast("loader_hide"),e},responseError:function(i){return--a||t.$broadcast("loader_hide"),e.reject(i)}}}]),o.otherwise("/home"),a.html5Mode(!0)}function a(e,t,a,i){e.$on("loader_show",function(){e.show_loading=!0}),e.$on("loader_hide",function(){e.show_loading=!1}),e.openDoc=function(e,t){angular.element("#show_loading").removeClass("ng-hide"),$.ajax({cache:!1,url:base_url+"/"+e,data:t,success:function(e){var t=document.createElement("a");t.href=e.file,t.download=e.name,document.body.appendChild(t),t.click(),t.remove(),angular.element("#show_loading").addClass("ng-hide")},error:function(e){angular.element("#show_loading").addClass("ng-hide"),a.showErrors({title:"Hubo un error",message:e.responseText})}})},e.loadPDF=function(e,i){angular.element("#show_loading").removeClass("ng-hide"),$.ajax({url:base_url+"/"+e,data:i,success:function(e){!t.isUndefined(e.status)&&e.status&&create_pdf(e),angular.element("#show_loading").addClass("ng-hide")},error:function(e){angular.element("#show_loading").addClass("ng-hide"),a.showErrors({title:"Hubo un error",message:"Intente nuevamente"})}})},e.loadVouchersPDF=function(e,i){angular.element("#show_loading").removeClass("ng-hide"),$.ajax({url:base_url+"/"+e,data:i,success:function(e){!t.isUndefined(e.status)&&e.status&&create_vouchers_pdf(e),angular.element("#show_loading").addClass("ng-hide")},error:function(e){angular.element("#show_loading").addClass("ng-hide"),a.showErrors({title:"Hubo un error",message:"Intente nuevamente"})}})},e.loadTransferPDF=function(e,i){angular.element("#show_loading").removeClass("ng-hide"),$.ajax({url:base_url+"/"+e,data:i,success:function(e){!t.isUndefined(e.status)&&e.status&&create_pdf_transfer(e),angular.element("#show_loading").addClass("ng-hide")},error:function(e){angular.element("#show_loading").addClass("ng-hide"),a.showErrors({title:"Hubo un error",message:"Intente nuevamente"})}})},e.loadMovimientoPDF=function(e,i){angular.element("#show_loading").removeClass("ng-hide"),$.ajax({url:base_url+"/"+e,data:i,success:function(e){!t.isUndefined(e.status)&&e.status&&create_pdf_movimiento(e),angular.element("#show_loading").addClass("ng-hide")},error:function(e){angular.element("#show_loading").addClass("ng-hide"),a.showErrors({title:"Hubo un error",message:"Intente nuevamente"})}})},e.showAlert=function(e,t,i){a.textType({title:e,message:t,type:i})},e.showConfirm=function(e,t,i){a.confirm({title:e,message:t,confirm:"Si",cancel:"No"},function(){i()})}}angular.module("sys",["ui.router","sys.utils.libraries","sys.utils.services","sys.utils.utils","angucomplete-alt","sys.utils.widgets","sys.utils.filters","sys.api","sys.app.extends","sys.app.home","sys.app.profiles","sys.app.modules","sys.app.users","sys.app.permissions","sys.app.configs","sys.app.params","sys.app.approvers_projects","sys.app.brands","sys.app.currencys","sys.app.measures","sys.app.entities","sys.app.products","sys.app.resources","sys.app.typechanges","sys.app.warehouses","sys.app.fronts","sys.app.buyers","sys.app.payment_condition","sys.app.categories","sys.app.operations","sys.app.head_accountans","sys.app.families","sys.app.subfamilies","sys.app.lots","sys.app.modelos","sys.app.accoudets","sys.app.shops","sys.app.series","sys.app.technicians","sys.app.advisers","sys.app.consecutives","sys.app.maintenances","sys.app.customers","sys.app.group_cas","sys.app.typeServicioMants","sys.app.vehiculos_terceros","sys.app.list_precios","sys.app.orden_servicios","sys.app.typeCustomers","sys.app.typeObjets","sys.app.objetivos","sys.app.proformas","sys.app.requirements","sys.app.requirements_contests","sys.app.approval_requirements","sys.app.assignment_requirements","sys.app.quotations","sys.app.approval_contests","sys.app.purchase_orders","sys.app.approval_purchase_orders","sys.app.approval_autonomy","sys.app.accounts_pay","sys.app.revision_cas","sys.app.receptions","sys.app.transfers","sys.app.receptiontransfers","sys.app.entrys","sys.app.consumptions","sys.app.referral_guides","sys.app.departures","sys.app.consumer_returns","sys.app.register_movements","sys.app.register_transfers","sys.app.generation_remisions","sys.app.query_stocks","sys.app.query_movements","sys.app.report_stocks","sys.app.report_movements","sys.app.projects","sys.app.direct_billing","sys.app.valorizations","sys.app.consolidated_projects","sys.app.project_approval","sys.app.cash_expense_girls","sys.app.replenishment_cashs","sys.app.sales_charges","sys.app.purchase_payments","sys.app.writing_checks","sys.app.petty_cash","sys.app.stocks"]).run(e).controller("OverloadCtrl",a).config(t),t.$inject=["$interpolateProvider","$httpProvider","$locationProvider","$stateProvider","$urlRouterProvider","$resourceProvider"],a.$inject=["$scope","_","AlertFactory","RESTService"],e.$inject=["$rootScope","$state","$window","RESTService"]}(),function(){"use strict";angular.module("sys.api",["ngResource"])}(),function(){"use strict";angular.module("sys.api").constant("REGEX",{DNI_OR_RUC:/^[0-9](?:.{7}|.{10})$/,RUC:/^[0-9]{11}$/,EMAIL:/^[a-zA-Z0-9.!#$%&\'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/i,EMAIL1:/^([a-z]+[a-z1-9._-]*)@{1}([a-z1-9\.]{2,})\.([a-z]{2,3})$/,"EMAIL-LONGITUD":/^.+@.+\.[a-z]{2,4}$/i,URL:/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \?=.-]*)*\/?$/,"PHONE-FIJO":/^(8|9)[0-9]{8}$/,CELLPHONE:/^(6|7)[0-9]{8}$/,"SOLO-LETRAS":/^[a-zA-ZñÑ]+$/,"SOLO-NUMBER_REQUIRED":/^[0-9]+$/,"SOLO-NUMBER":/^\d*$/}).constant("URL",{ROOT:"http://recopro.dev"}).constant("CAJA",{OPEN:!0}).constant("CLIENT",{TYPE:[{description:"Jurídico",id:1},{description:"Natural",id:2}],SEX:[{description:"Masculino",id:"M"},{description:"Femenino",id:"F"},{description:"Otros",id:"O"}],STATUS:[{description:"Soltero",id:1},{description:"Casado",id:2},{description:"Otros",id:3}]}).constant("NUMBER",{ZERO:0,ONE:1}).constant("VOUCHER",{BOLETA:1,FACTURA:2}).constant("EXTEND_CLIENT",{NATIONALITY:167,ORIGIN:0,ISO:"PE"}).constant("TYPE_RESERVATION",{ROOM:1,GROUP:2}).constant("KEY",{ENTER:13}).constant("DASHBOARDS",{SALES:{TODAY_YESTERDAY:"today-yesterday",THIS_LAST_WEEK:"this-last-week",THIS_YEAR:"this-year",CUSTOM:0}}).constant("LOCALE_D3",{es_ES:{decimal:".",thousands:",",grouping:[3],currency:["S/",""],dateTime:"%a %b %e %X %Y",date:"%d/%m/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],shortDays:["Dom","Lun","Mar","Mi","Jue","Vie","Sab"],months:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],shortMonths:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"]}}).constant("TYPE_DOCUMENT",{DNI:1,RUC:2})}(),function(){"use strict";function e(e,t,a){function i(a,i,o,r){var n=e.instance(c,a),s=n.query({action:i});s.$promise.then(function(e){"function"==typeof o&&o(e)})["catch"](function(e){"function"==typeof r?r(e):t.showErrors({title:"Hubo un error",message:e.data.message})})}function o(a,i,o,r,n){var s=e.instance(c,a),l=s.query({id:i},{action:r});l.$promise.then(function(e){"function"==typeof o&&o(e)})["catch"](function(e){t.showErrors({title:"Hubo un error",message:e.data.message},n)})}function r(a,i,o,r){var n=e.instance(c,a);n.update({id:i},o).$promise.then(function(e){"function"==typeof r&&r(e)})["catch"](function(e){t.showErrors({title:"Hubo un error",message:e.data.message})})}function n(a,i,o){var r=e.instance(c,a);r["delete"]({id:i}).$promise.then(function(e){"function"==typeof o&&o(e)})["catch"](function(e){t.showErrors({title:"Hubo un error",message:e.data.message})})}function s(a,i,o){var r=e.instance(c,a);r.save(i).$promise.then(function(e){"function"==typeof o&&o(e)},function(e){t.showErrors({title:"Hubo un error",message:e.data.message})})}var c="rest",l={all:i,get:o,updated:r,deleted:n,save:s};return l}angular.module("sys.api").factory("RESTService",e),e.$inject=["ApiService","AlertFactory","_"]}(),function(){"use strict";function e(e){function t(t){return e(t,null,{query:{method:"GET",isArray:!1},get:{method:"GET"},update:{method:"PUT"},save:{method:"POST"},remove:{method:"DELETE"},"delete":{method:"DELETE"}})}function a(t,a){function i(){return e(o,{id:"@id",action:"@action"},{query:{method:"GET",isArray:!1},get:{method:"GET"},update:{method:"PUT"},save:{method:"POST"},remove:{method:"DELETE"},"delete":{method:"DELETE"}})}var o=base_url+"/"+a+"/:id/?:action";return i()}var i={instance:a,query:t};return i}angular.module("sys.api").factory("ApiService",e),e.$inject=["$resource"]}(),function(){"use strict";function e(e,t,a,i){function o(){var a=t.defer(),i=a.promise;return e.all("caja_open",null,function(e){a.resolve(e)},function(e){a.reject(e)}),i}function r(a,i,o){o||(o="document="+a);var r=t.defer(),n=r.promise;return e.all(i,o,function(e){var t=!1;0==e.count&&(t=!0),r.resolve(t)},function(e){r.reject(e)}),n}function n(a,i,o){o||(o="email="+a);var r=t.defer(),n=r.promise;return e.all(i,o,function(e){var t=!1;0==e.count&&(t=!0),r.resolve(t)},function(e){r.reject(e)}),n}var s={findByDocument:r,findByEmail:n,cajaOpenToday:o};return s}angular.module("sys.api").factory("ValidateFactory",e),e.$inject=["RESTService","$q","NUMBER","HelperFactory"]}(),function(){"use strict";angular.module("sys.app.accoudets",[])}(),function(){"use strict";function e(e){var t=getFormSearch("frm-search-Accoudet","search_b","LoadRecordsButtonAccoudet"),a=$("#table_container_Accoudet");a.jtable({title:"Lista Contable Detalle",paging:!0,sorting:!0,actions:{listAction:base_url+"/accoudets/list",createAction:base_url+"/accoudets/create",updateAction:base_url+"/accoudets/update",deleteAction:base_url+"/accoudets/delete"},messages:{addNewRecord:"Nuevo Contable Detalle",editRecord:"Editar Contable Detalle"},toolbar:{items:[{cssClass:"buscador",text:t},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("accoudets/excel",{})}}]},fields:{Contabledet:{title:"Grupo Contable",options:base_url+"/accoudets/getGrupoContable",listClass:"text-center"},Operacion:{title:"Operación",options:base_url+"/accoudets/getTipoOperacion",listClass:"text-center"},cuenta:{title:"Cuenta",listClass:"text-center"},centrocosto:{title:"Centro Costo",listClass:"text-center"},idgrup:{title:"Cuenta",type:"hidden"},idoper:{title:"Cuenta",type:"hidden"},identificador:{key:!0,create:!1,edit:!1,list:!1}},formCreated:function(e,t){t.form.find('input[name="Moneda"]').attr("onkeypress","return soloLetras(event)");var a=t.form.find('select[name="Contabledet"]'),i=t.form.find('select[name="Operacion"]'),o=t.form.find('input[name="centrocosto"]');""!==o.val()&&(a.prop("disabled",!0),i.prop("disabled",!0))},formSubmitting:function(e,t){var a=!0;return a=a&&t.form.find('input[name="Contabledet"]').required(),a=a&&t.form.find('input[name="Operacion"]').required(),a=a&&t.form.find('input[name="cuenta"]').required(),a=a&&t.form.find('input[name="centrocosto"]').required()}}),generateSearchForm("frm-search-Accoudet","LoadRecordsButtonAccoudet",function(){a.jtable("load",{search:$("#search_b").val()})},!0)}function t(e,t){e.state("accoudets",{url:"/accoudets",templateUrl:base_url+"/templates/accoudets/base.html",controller:"AccoudetCtrl"}),t.otherwise("/")}angular.module("sys.app.accoudets").config(t).controller("AccoudetCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope"]}(),function(){"use strict";angular.module("sys.app.accounts_pay",[])}(),function(){"use strict";function e(e,t,a,i){function o(){y||(l=$("#modalAP"),u=$("#title-ap"),d=$("#modalUser"),b=$("#modalDetailDocument"),p=$("#code"),m=$("#description"),f=$("#state"),v=$("#state_text"),h=$("#user_id"),_=$("#username"),g=$("#AccountPay_id"),b.on("hidden.bs.modal",function(e){l.attr("style","display:block;")}),b.on("show.bs.modal",function(e){l.attr("style","display:block; z-index:2030 !important")}),d.on("hidden.bs.modal",function(e){l.attr("style","display:block;")}),d.on("show.bs.modal",function(e){l.attr("style","display:block; z-index:2030 !important")}),l.on("shown.bs.modal",function(e){p.focus()}),l.on("hidden.bs.modal",function(e){r()}),c(),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(t){$(t.target).click(),e.chkState()}))}function r(){cleanRequired(),u.html(""),g.val(""),h.val(""),p.val(""),f.prop("checked",!0).iCheck("update"),e.chkState(),m.val(""),_.val("")}function n(){o(),l.modal("show"),u.html("Nueva Cuenta por Pagar")}function s(){a.all("articles/data_form","",function(e){!t.isUndefined(e.status)&&e.status&&($("#p_retention_id").append('<option value="" selected>SIN RETENCIÓN</option>'),t.each(e.retentions,function(e){$("#p_retention_id").append('<option value="'+e.Value+'">'+e.DisplayText+"</option>")}))},function(){s()})}function c(){y=!0;var e=getFormSearch("frm-search-u","search_u","LoadRecordsButtonU"),t=$("#table_container_usuario");t.jtable({title:"Lista de Usuarios",paging:!0,sorting:!0,actions:{listAction:base_url+"/AccountPays/listUser"},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},username:{title:"Usuario"},name:{title:"Nombre"},select:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_u" data-code="'+e.record.id+'" data-title="'+e.record.name+'"><i class="fa fa-'+icon_select+' fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_u").click(function(e){var t=$(this).attr("data-code"),a=$(this).attr("data-title");h.val(t),_.val(a).removeClass("border-red"),d.modal("hide"),e.preventDefault()})}}),generateSearchForm("frm-search-u","LoadRecordsButtonU",function(){t.jtable("load",{search:$("#search_u").val()})},!1)}var l,d,u,p,m,f,v,h,_,g,b,y=!1;e.chkState=function(){var e=f.prop("checked")?"Activo":"Inactivo";v.html(e)},e.openDetalleDoc=function(){b.modal("show")},e.openUser=function(){$("#LoadRecordsButtonU").click(),d.modal("show")},s(),e.saveAccountPay=function(){var e=!0;if(e=e&&p.required(),e=e&&m.required(),e=e&&_.required()){var o={id:g.val(),code:p.val(),state:f.prop("checked")?1:0,description:m.val(),user_id:h.val()},r=""===g.val()?0:g.val();a.updated("AccountPays/saveAccountPay",r,o,function(e){!t.isUndefined(e.status)&&e.status?(i.textType({title:"",message:"La cuent por pagar se guardo correctamente.",type:"success"}),l.modal("hide"),$("#LoadRecordsButtonAccountPay").click()):i.textType({title:"",message:"Hubo un error al guardar la cuenta por pagar. Intente nuevamente.",type:"error"})})}};var C=getFormSearch("frm-search-AccountPay","search_AccountPay","LoadRecordsButtonAccountPay"),x=$("#table_container_account_pay");x.jtable({title:"Lista de Cuentas por Pagar",paging:!0,sorting:!0,actions:{listAction:function(e,t){return{Result:"OK",Records:[{provider:"PEREZ CASTRO",ruc:"100104545542",tipo_doc:"FACTURA",numero:"001-0001",monto:"345.00",fecha_registro:"01/01/2017",fecha_vencimiento:"04/04/2017"},{provider:"MELENDEZ SANCHEZ",ruc:"100104545545",tipo_doc:"BOLETA",numero:"001-0002",monto:"648.00",fecha_registro:"01/01/2017",fecha_vencimiento:"04/04/2017"},{provider:"VELASQUEZ GARCIA",ruc:"100104545544",tipo_doc:"FACTURA",numero:"001-0003",monto:"577.00",fecha_registro:"01/01/2017",fecha_vencimiento:"04/04/2017"}],TotalRecordCount:4}},deleteAction:base_url+"/AccountPays/delete"},toolbar:{items:[{cssClass:"buscador",text:C},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("AccountPays/excel",{})}},{cssClass:"btn-success",text:'<i class="fa fa-plus"></i> Nueva Cuenta por Pagar',click:function(){n()}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},provider:{title:"Proveedor"},ruc:{title:"Documento"},tipo_doc:{title:"Tipo Documento",sorting:!1},numero:{title:"Número"},monto:{title:"Monto",listClass:"text-right"},fecha_registro:{title:"Fecha Registro",listClass:"text-center"},fecha_vencimiento:{title:"Fecha Vencimento",listClass:"text-center"},edit:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Editar" class="edit_b" data-code="'+e.record.id+'"><i class="fa fa-pencil-square-o fa-1-5x fa-green"></i></a>'}}},recordsLoaded:function(e,t){$(".edit_b").click(function(e){$(this).attr("data-code");u.html("Editar Cuentas por Pagar"),l.modal("show"),e.preventDefault()})}}),generateSearchForm("frm-search-AccountPay","LoadRecordsButtonAccountPay",function(){x.jtable("load",{search:$("#search_AccountPay").val()})},!0)}function t(e,t){e.state("accounts_pay",{url:"/accounts_pay",templateUrl:base_url+"/templates/accounts_pay/base.html",controller:"AccountPayCtrl"}),t.otherwise("/")}angular.module("sys.app.accounts_pay").config(t).controller("AccountPayCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.advisers",[])}(),function(){"use strict";function e(e){e.chkState=function(){var e=w_state.prop("checked")?"Activo":"Inactivo";state_state.html(e)};var t=getFormSearch("frm-search-Adviser","search_b","LoadRecordsButtonAdviser"),a=$("#table_container_Adviser");a.jtable({title:"Lista de Asesores",paging:!0,sorting:!0,actions:{listAction:base_url+"/advisers/list",createAction:base_url+"/advisers/create",updateAction:base_url+"/advisers/update",deleteAction:base_url+"/advisers/delete"},messages:{addNewRecord:"Nuevo Asesor",editRecord:"Editar Asesor"},toolbar:{items:[{cssClass:"buscador",text:t},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("advisers/excel",{})}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},descripcion:{title:"Asesor"},estado:{title:"Estado",values:{I:"Inactivo",A:"Activo"},type:"checkbox",defaultValue:"A"}},formCreated:function(e,t){t.form.find('input[name="Categoria"]').attr("onkeypress","return soloLetras(event)"),$("#Edit-estado").parent().addClass("i-checks"),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click(),"A"==e.target.value?($("#Edit-estado").val("I"),$(".i-checks span").text("Inactivo")):($("#Edit-estado").val("A"),$(".i-checks span").text("Activo"))})},formSubmitting:function(e,t){var a=!0;return a=a&&t.form.find('input[name="descripcion"]').required()}}),generateSearchForm("frm-search-Adviser","LoadRecordsButtonAdviser",function(){a.jtable("load",{search:$("#search_b").val()})},!0)}function t(e,t){e.state("advisers",{url:"/advisers",templateUrl:base_url+"/templates/advisers/base.html",controller:"AdviserCtrl"}),t.otherwise("/")}angular.module("sys.app.advisers").config(t).controller("AdviserCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope"]}(),function(){"use strict";angular.module("sys.app.approval_autonomy",[])}(),function(){"use strict";function e(e,t,a,i){function o(){a.all("approval_autonomy/data_grid","",function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.data;t.each(a,function(e){r(e.id,e.user_id,e.name,e.username,e.from,e.to)})}else i.textType({title:"",message:"Hubo un error al obtener los datos . Intente nuevamente.",type:"error"})},function(){o()})}function r(e,t,a,o,r,s){var v=$('<tr id="tr_b_'+f+'"></tr>'),h=$("<td>"+a+"</td>"),_=$("<td>"+o+"</td>"),g=$('<td class="text-right" width="16%">'+r+"</td>"),b=$('<td class="text-right" width="16%">'+s+"</td>"),y=$('<input type="hidden" class="aa_user_id" value="'+t+'" />'),C=$('<input type="hidden" class="aa_from" value="'+r+'" />'),x=$('<input type="hidden" class="aa_to" value="'+s+'" />'),k=$('<input type="hidden" class="aa_id" value="'+e+'" />');h.append(y),h.append(C),h.append(x),h.append(k);var w=$('<td class="text-center"></td>'),A=$('<button class="btn btn-danger btn-xs delApprovalAutonomy"  data-id="'+f+'"  type="button"><span class="fa fa-trash"></span></button>');w.append(A),v.append(h).append(_).append(g).append(b).append(w),m.append(v),n.modal("hide"),$(".delApprovalAutonomy").click(function(e){var t=$(this).attr("data-id");i.confirm({title:"",message:"¿Está seguro que desea quitar la Autonomía de Aprobación?",confirm:"Si",cancel:"No"},function(){$("#tr_b_"+t).remove()}),e.preventDefault()}),f++,c.val(""),l.val(""),d.val(""),u.val("").focus(),p.val("")}var n=$("#modalU"),s=$("#approval_autonomy_id"),c=$("#user_id"),l=$("#user"),d=$("#username"),u=$("#from"),p=$("#to"),m=$("#approval_body");o(),e.saveApproval=function(){var e=!0;if(e&&""===m.html())return i.showWarning({title:"",message:"Debe registrar una autonomía de aprobación al menos."}),!1;if(e){var o=[],r=[],n=[],c=[];t.each($(".aa_user_id"),function(e){o.push($(e).val())}),$.each($(".aa_from"),function(e){r.push($(e).val())}),$.each($(".aa_to"),function(e){n.push($(e).val())}),$.each($(".aa_id"),function(e){c.push($(e).val())});var l={approval_id:c.join(","),user_id:o.join(","),from:r.join(","),to:n.join(",")},d=""===s.val()?0:s.val();a.updated("approval_autonomy/saveApproval_autonomy",d,l,function(e){!t.isUndefined(e.status)&&e.status?i.textType({title:"",message:"La autonomía de aprobación se guardó correctamente.",type:"success"}):i.textType({title:"",message:"Hubo un error al guardar la autonomía de aprovación. Intente nuevamente.",type:"error"})})}};var f=0;e.addApproval=function(){var e=!0;e=e&&u.required(),e=e&&p.required(),e=e&&d.required();var t=[];$.each($(".aa_user_id"),function(t,a){if($(a).val()===c.val())return e=!1,i.showWarning({title:"",message:"Este usuario ya está asignado a una autonomía de aprobación."}),!1}),$.each($(".aa_from"),function(e,a){t[e]=$(a).val()}),$.each($(".aa_to"),function(a,o){return parseFloat(t[a])<=parseFloat(u.val())&&parseFloat(u.val())<=parseFloat($(o).val())||parseFloat(t[a])<=parseFloat(p.val())&&parseFloat(p.val())<=parseFloat($(o).val())?(e=!1,i.showWarning({title:"",message:"El rango que desea agregar se traslapa con valores ya agregados."}),!1):parseFloat(u.val())<parseFloat(t[a])&&parseFloat(p.val())>parseFloat(t[a])?(e=!1,i.showWarning({title:"",message:"Este usuario ya está asignado a una autonomía de aprobación."}),!1):void 0}),e&&r(0,c.val(),l.val(),d.val(),u.val(),p.val())},e.openUser=function(){var e=$("#modalU"),t=getFormSearch("frm-search-u","search_u","LoadRecordsButtonU"),a=$("#table_container_u");a.jtable({title:"Lista de Usuarios",paging:!0,sorting:!0,actions:{listAction:base_url+"/approval_autonomy/listUser"},toolbar:{items:[{cssClass:"buscador",text:t}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},name:{title:"Nombre"},username:{title:"Usuario"},select:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_u" data-code="'+e.record.id+'" data-title="'+e.record.name+'" data-username="'+e.record.username+'"><i class="fa fa-'+icon_select+' fa-1-5x"></i></a>'}}},recordsLoaded:function(t,a){$(".select_u").click(function(t){var a=$(this).attr("data-code"),i=$(this).attr("data-title"),o=$(this).attr("data-username");c.val(a),l.val(i),d.val(o),e.modal("hide"),t.preventDefault()})}}),generateSearchForm("frm-search-u","LoadRecordsButtonU",function(){a.jtable("load",{search:$("#search_u").val()})},!0),e.modal("show")}}function t(e,t){e.state("approval_autonomy",{url:"/approval_autonomy",templateUrl:base_url+"/templates/approval_autonomy/base.html",controller:"ApprovalAutonomyCtrl"}),t.otherwise("/")}angular.module("sys.app.approval_autonomy").config(t).controller("ApprovalAutonomyCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.approval_purchase_orders",[])}(),function(){"use strict";function e(e,t){function a(){i=$("#modalPO")}moment.locale("es");var i,o=moment().startOf("month"),r=moment().endOf("month"),n=$("#reqDates"),s=function(e,t){n.find("span").html(e.format("MMM D, YYYY")+" - "+t.format("MMM D, YYYY"))};n.daterangepicker({startDate:o,endDate:r,opens:"left",showDropdowns:!0,alwaysShowCalendars:!0,showCustomRangeLabel:!1,ranges:{Hoy:[moment(),moment()],Ayer:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Últimos 7 días":[moment().subtract(6,"days"),moment()],"Últimos 30 días":[moment().subtract(29,"days"),moment()],"Este mes":[moment().startOf("month"),moment().endOf("month")],"Mes pasado":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")],"Este año":[moment().startOf("year"),moment().endOf("year")],"Año pasado":[moment().subtract(1,"year").startOf("year"),moment().subtract(1,"year").endOf("year")]},locale:{cancelLabel:"Cancelar",applyLabel:"Aplicar",daysOfWeek:["Do","Lu","Ma","Mi","Ju","Vi","Sá"],monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"]}},s),s(o,r);var c=getFormSearch("frm-search-po","search_po","LoadRecordsButtonPO"),l=$("#table_container_apo");l.jtable({title:"Lista de Ordenes de Compra por Aprobar",paging:!0,sorting:!0,actions:{listAction:function(e,t){return{Result:"OK",Records:[{oc:"20170518",proyecto:"CONEXIONES MASIVAS",proveedor:"CLAUDIO PIÑAN ROSARIO",estado:0,fecha_emision:"13/04/2017"}],TotalRecordCount:1}}},toolbar:{items:[{cssClass:"buscador",text:c},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){window.open(base_url+"/purchase_orders/excel")}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},oc:{title:"Nro. O/C"},proyecto:{title:"Proyecto"},proveedor:{title:"Proveedor"},estado:{title:"Estado",options:{1:"Aprobado",0:"Registrado"},list:show_list_},fecha_emision:{title:"Fecha Emisión",list:show_list_,listClass:"text-center"},edit:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return'<a href="javascript:void(0)" title="Ver" class="edit_po" data-code="'+e.record.id+'"><i class="fa fa-edit fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".edit_po").click(function(e){a(),i.modal("show"),e.preventDefault()})}}),generateSearchForm("frm-search-po","LoadRecordsButtonPO",function(){l.jtable("load",{search:$("#search_po").val()})},!0)}function t(e,t){e.state("approval_purchase_orders",{url:"/approval_purchase_orders",templateUrl:base_url+"/templates/approval_purchase_orders/base.html",controller:"ApprovalPurchaseOrderCtrl"}),t.otherwise("/")}angular.module("sys.app.approval_purchase_orders").config(t).controller("ApprovalPurchaseOrderCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.approval_contests",[])}(),function(){"use strict";function e(e,t){function a(){i=$("#modalC")}moment.locale("es");var i,o=moment().startOf("month"),r=moment().endOf("month"),n=$("#reqDates"),s=function(e,t){n.find("span").html(e.format("MMM D, YYYY")+" - "+t.format("MMM D, YYYY"))};n.daterangepicker({startDate:o,endDate:r,opens:"left",showDropdowns:!0,alwaysShowCalendars:!0,showCustomRangeLabel:!1,ranges:{Hoy:[moment(),moment()],Ayer:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Últimos 7 días":[moment().subtract(6,"days"),moment()],"Últimos 30 días":[moment().subtract(29,"days"),moment()],"Este mes":[moment().startOf("month"),moment().endOf("month")],"Mes pasado":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")],"Este año":[moment().startOf("year"),moment().endOf("year")],"Año pasado":[moment().subtract(1,"year").startOf("year"),moment().subtract(1,"year").endOf("year")]},locale:{cancelLabel:"Cancelar",applyLabel:"Aplicar",daysOfWeek:["Do","Lu","Ma","Mi","Ju","Vi","Sá"],monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"]}},s),s(o,r),e.reject=function(){var e=$("#modalComment");e.on("hidden.bs.modal",function(e){i.attr("style","display:block;")}),e.on("show.bs.modal",function(e){i.attr("style","display:block; z-index:2030 !important"),$("#comment_reject").focus()}),e.modal("show")};var c=getFormSearch("frm-search-q","search_q","LoadRecordsButtonQ"),l=$("#table_container_q");l.jtable({title:"Lista de Cotizaciones por Aprobar",paging:!0,sorting:!0,actions:{listAction:function(e,t){return{Result:"OK",Records:[{cotizacion:"20170158",fecha_emision:"01/04/2017",solictado_po:"JARRISON MORI",descripcion:"COTIZACION COMPRA MATERIALES"},{cotizacion:"20170159",fecha_emision:"02/04/2017",solictado_po:"JARRISON MORI",descripcion:"COTIZACION COMPRA MATERIALES CONTRUCCION"},{cotizacion:"20170160",fecha_emision:"02/04/2017",solictado_po:"JARRISON MORI",descripcion:"COTIZACION COMPRA MATERIALES CONTRUCCION VIVIENDA"}],TotalRecordCount:3}}},toolbar:{items:[{cssClass:"buscador",text:c}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},cotizacion:{title:"Cotización",width:"5%"},descripcion:{title:"Descripción",width:"30%"},solictado_po:{title:"Solicitado por",list:show_list_},fecha_emision:{title:"Fecha de Emisión",list:show_list_},cuadro:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return'<a href="javascript:void(0)" title="Cuadro Comparativo" class="edit_q" data-code="'+e.record.id+'"><i class="fa fa-list-alt fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".edit_q").click(function(e){a(),i.modal("show"),e.preventDefault()})}}),generateSearchForm("frm-search-q","LoadRecordsButtonQ",function(){l.jtable("load",{search:$("#search_q").val()})},!0)}function t(e,t){e.state("approval_contests",{url:"/approval_contests",templateUrl:base_url+"/templates/approval_quotations/base.html",controller:"ApprovalQuotationCtrl"}),t.otherwise("/")}angular.module("sys.app.approval_contests").config(t).controller("ApprovalQuotationCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.approval_requirements",[])}(),function(){"use strict";function e(e,t,a,i){function o(){cleanRequired(),A="",f.val(""),v.val(""),h.val(""),_.val(""),g.val(""),b.val(""),y.val(""),C.val(""),x.val(""),R=1,k.empty()}function r(){j||(u=$("#modalRApproval"),p=$("#btn_approve_req"),m=$("#btn_reject_req"),f=$("#r_code"),v=$("#r_date_register"),h=$("#r_date_required"),_=$("#r_project_code"),g=$("#r_project_description"),b=$("#r_state"),y=$("#r_requested_by"),C=$("#r_approved_by"),x=$("#r_observation"),k=$("#t_body_requirement"),u.on("hidden.bs.modal",function(e){o()}),j=!0)}function n(e){r(),a.get("approval_requirements/find",e,function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.data;A=a.id,f.val(a.code),v.val(a.date_register),h.val(a.date_required),_.val(a.project_code),g.val(a.project_description),b.val(a.state),y.val(a.requested_by),C.val(a.approved_by),x.val(a.observation),t.each(a.detail,function(e){s(e)}),u.modal("show")}else i.textType({title:"",message:"Hubo un error al obtener el requerimiento. Intente nuevamente.",type:"error"})})}function s(e){var a=$("<tr></tr>"),i=$('<td class="text-center">'+R+"</td>"),o=$('<td class="text-center">'+e.matrix+"</td>"),r=$("<td>"+e.product+"</td>"),n=$("<td>"+e.um+"</td>"),s=$('<td class="text-right">'+parseFloat(e.quantity_requested).toFixed(2)+"</td>"),c=$('<td class="text-right">'+e.quantity_served+"</td>"),l=t.isNull(e.price)?".00":e.price,d=$('<td class="text-right">'+l+"</td>"),u=t.isNull(e.project_balance)?"":e.project_balance,p=$('<td class="text-right">'+u+"</td>");
a.append(i).append(o).append(r).append(n).append(s).append(c).append(d).append(p),k.append(a),R++}moment.locale("es");var c=moment().startOf("month"),l=moment().endOf("month"),d=$("#chk_date_range");d.click(function(){$("#LoadRecordsButtonR").click()}),generateCheckBox(".i-checks");var u,p,m,f,v,h,_,g,b,y,C,x,k,w=$("#reqDates"),A="",R=1,S=function(e,t){c=e,l=t,w.find("span").html(e.format("MMM D, YYYY")+" - "+t.format("MMM D, YYYY")),d.prop("checked")&&$("#LoadRecordsButtonR").click()};generateDateRangePicker(w,c,l,S),S(c,l);var j=!1;e.approveRequirement=function(){i.confirm({title:"",message:"¿Está seguro que desea aprobar el requerimiento?",confirm:"Si",cancel:"No"},function(){a.updated("approval_requirements/approveRequirement",A,{},function(e){!t.isUndefined(e.status)&&e.status?(i.textType({title:"",message:"El requerimiento se aprobó correctamente.",type:"success"}),u.modal("hide"),$("#LoadRecordsButtonR").click()):i.textType({title:"",message:"Hubo un error al aprobar el requerimiento. Intente nuevamente.",type:"error"})})})},e.rejectRequirement=function(){i.confirm({title:"",message:"¿Está seguro que desea rechazar el requerimiento?",confirm:"Si",cancel:"No"},function(){a.updated("approval_requirements/rejectRequirement",A,{},function(e){!t.isUndefined(e.status)&&e.status?(i.textType({title:"",message:"El requerimiento se rechazó correctamente.",type:"success"}),u.modal("hide"),$("#LoadRecordsButtonR").click()):i.textType({title:"",message:"Hubo un error al rechazar el requerimiento. Intente nuevamente.",type:"error"})})})};var L=getFormSearch("frm-search-r","search_r","LoadRecordsButtonR"),E=$("#table_container_ar");E.jtable({title:"Lista de Requerimientos por Aprobar",paging:!0,sorting:!0,actions:{listAction:base_url+"/approval_requirements/list"},toolbar:{items:[{cssClass:"buscador",text:L},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){var t={search:$("#search_r").val(),check:d.prop("checked"),from:c.format("YYYY-MM-DD"),to:l.format("YYYY-MM-DD"),state:2,supervisor:!0};e.openDoc("approval_requirements/excel",t)}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},code:{title:"Requerimiento",listClass:"text-center",width:"5%"},date_registration:{title:"F.Registro",listClass:"text-center",width:"5%"},date_required:{title:"F.Requerida",list:show_list_,listClass:"text-center",width:"5%"},project_description:{title:"Proyecto",width:"30%"},requested_by:{title:"Solicitado por",list:show_list_},edit:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return'<a href="javascript:void(0)" title="Ver" class="edit_r" data-code="'+e.record.id+'"><i class="fa fa-edit fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".edit_r").click(function(e){var t=$(this).attr("data-code");n(t),e.preventDefault()})}}),generateSearchForm("frm-search-r","LoadRecordsButtonR",function(){E.jtable("load",{search:$("#search_r").val(),check:d.prop("checked"),from:c.format("YYYY-MM-DD"),to:l.format("YYYY-MM-DD"),state:2,supervisor:!0})},!0)}function t(e,t){e.state("approval_requirements",{url:"/approval_requirements",templateUrl:base_url+"/templates/approval_requirements/base.html",controller:"ApprovalRequirementCtrl"}),t.otherwise("/")}angular.module("sys.app.approval_requirements").config(t).controller("ApprovalRequirementCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.approvers_projects",[])}(),function(){"use strict";function e(e,t,a,i){function o(){g=$("#a_project_states"),g.empty().change(function(){$("#LoadRecordsButtonP").click()}),a.all("approvers_projects/getDataProject","",function(e){!t.isUndefined(e.status)&&e.status?(t.each(e.states,function(e){g.append('<option value="'+e.Value+'">'+e.DisplayText+"</option>")}),c()):o()},function(){o()})}function r(){b||(f=$("#modalAP"),v=$("#titleAP"),h=$("#modalUser"),_=$("#ap_user_body"),h.on("hidden.bs.modal",function(e){f.attr("style","display:block;"),$("#search_user").val(""),$("#LoadRecordsButtonUser").click()}),h.on("show.bs.modal",function(e){$("#LoadRecordsButtonUser").click(),f.attr("style","display:block; z-index:2030 !important")}),l())}function n(a,o,r,n){if($("#tr_ap_"+a).length>0)return e.showAlert("","Ya se asignó este usuario","warning"),!1;var s=$('<tr id="tr_ap_'+a+'" data-code="'+a+'"></tr>'),c=$("<td>"+o+"</td>"),l=$("<td>"+r+"</td>"),u=$('<select class="form-control input-sm"></select>');t.each(d,function(e){var t=n===e.id?"selected":"";u.append('<option value="'+e.id+'" '+t+">"+e.text+"</option>")});var p=$("<td></td>");p.append(u);var m=$('<td class="text-center"></td>'),f=$('<button class="btn btn-danger btn-xs delAP" type="button"><span class="fa fa-trash"></span></button>');m.append(f),s.append(c).append(l).append(p).append(m),_.append(s),h.modal("hide"),$(".delAP").click(function(e){var t=$(this).closest("tr");i.confirm({title:"",message:"¿Está seguro que desea quitar este usuario?",confirm:"Si",cancel:"No"},function(){t.remove()}),e.preventDefault()})}function s(i,o){r(),a.get("approvers_projects/project",i,function(a){if(!t.isUndefined(a.status)&&a.status){var i=a.data;v.html("Proyecto: "+o),_.empty(),t.each(i,function(e){n(e.code,e.user,e.name,parseInt(e.approve))}),f.modal("show")}else e.showAlert("",a.message,"error")})}function c(){generateSearchForm("frm-search-ap","LoadRecordsButtonAP",function(){A.jtable("load",{search:$("#search_ap").val(),check:m.prop("checked"),from:u.format("YYYY-MM-DD"),to:p.format("YYYY-MM-DD"),state:g.val(),sub_state:!0})},!0)}function l(){b=!0;var e=getFormSearch("frm-search-user","search_user","LoadRecordsButtonUser"),t=$("#table_container_user");t.jtable({title:"Lista de Usuarios",paging:!0,sorting:!0,actions:{listAction:base_url+"/warehouses/listUser"},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},username:{title:"Usuario"},name:{title:"Nombre"},select:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_u_ap" data-code="'+e.record.id+'" data-user="'+e.record.username+'"data-name="'+e.record.name+'" ><i class="fa fa-'+icon_select+' fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_u_ap").click(function(e){var t=$(this).attr("data-code"),a=$(this).attr("data-user"),i=$(this).attr("data-name");n(t,a,i,0),e.preventDefault()})}}),generateSearchForm("frm-search-user","LoadRecordsButtonUser",function(){t.jtable("load",{search:$("#search_user").val()})},!1)}moment.locale("es");var d=[{id:0,text:"TODOS"},{id:1,text:"LB"},{id:2,text:"PV"},{id:3,text:"META"}],u=moment().startOf("month"),p=moment().endOf("month"),m=$(".chk_date_range");m.click(function(){$("#LoadRecordsButtonAP").click()}),generateCheckBox(".i-checks");var f,v,h,_,g,b=!1,y=$("#reqDates"),C=0,x=function(e,t){u=e,p=t,y.find("span").html(e.format("MMM D, YYYY")+" - "+t.format("MMM D, YYYY")),m.prop("checked")&&$("#LoadRecordsButtonAP").click()};generateDateRangePicker(y,u,p,x),x(u,p),e.openUser=function(){h.modal("show")},e.saveAP=function(){var i=[],o=[];t.each(_.find("tr"),function(e){e=$(e),i.push(e.attr("data-code")),o.push(e.find("select").val())});var r={user:i,states:o};a.updated("approvers_projects/save",C,r,function(a){!t.isUndefined(a.status)&&a.status?(f.modal("hide"),e.showAlert("","Los aprobadores se guardaron correctamente","success")):e.showAlert("",a.message,"error")})};var k=getFormSearch("frm-search-ap","search_ap","LoadRecordsButtonAP"),w='<select id="a_project_states" class="search_input"></select>',A=$("#table_container_ap");A.jtable({title:"Lista de Proyectos",paging:!0,sorting:!0,actions:{listAction:base_url+"/approvers_projects/list"},toolbar:{items:[{cssClass:"buscador",text:w},{cssClass:"buscador",text:k}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},code:{title:"Código",listClass:"text-center",width:"2%"},description:{title:"Descripción"},state:{title:"Estado",sorting:!1,width:"3%",list:show_list_},sub_state:{title:"Progreso",sorting:!1,width:"3%",list:show_list_},client_desc:{title:"Cliente",sorting:!1,width:"7%",list:show_list_},created_date:{title:"F.Registro",listClass:"text-center",sorting:!1,width:"1%"},edit:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Editar" class="edit_p" data-code="'+e.record.id+'" data-title="'+e.record.description+'"><i class="fa fa-orange fa-users fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".edit_p").click(function(e){var t=$(this).attr("data-code"),a=$(this).attr("data-title");C=t,s(t,a),e.preventDefault()})}}),o()}function t(e,t){e.state("approvers_projects",{url:"/approvers_projects",templateUrl:base_url+"/templates/approvers_projects/base.html",controller:"ApproverProjectCtrl"}),t.otherwise("/")}angular.module("sys.app.approvers_projects").config(t).controller("ApproverProjectCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.assignment_requirements",[])}(),function(){"use strict";function e(e,t,a,i){function o(){m||(r(),d=$("#modalR"),d.on("show.bs.modal",function(e){$("#LoadRecordsButtonC").click()}),m=!0)}function r(){var e=getFormSearch("frm-search-c","search_c","LoadRecordsButtonC"),o=$("#table_container_c");o.jtable({title:"Lista de Compradores",paging:!0,sorting:!0,actions:{listAction:base_url+"/assignment_requirements/listBuyer"},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},code:{title:"Código",listClass:"text-center",width:"4%"},description:{title:"Descripción"},username:{title:"Usuario",width:"4%"},edit:{width:"1%",listClass:"text-center",sorting:!1,edit:!1,create:!1,display:function(e){return'<a href="javascript:void(0)" title="Asignar" class="select_c" data-code="'+e.record.id+'"><i class="fa fa-'+icon_select+' fa-1-5x"></i></a>'}}},recordsLoaded:function(e,o){$(".select_c").click(function(e){var o=$(this).attr("data-code");i.confirm({title:"",message:"¿Está seguro que desea asignar el comprador a los requerimientos seleccionados?",confirm:"Si",cancel:"No",closeOnConfirm:!1,showLoaderOnConfirm:!0},function(){var e={buyer:o,requirements:g};a.updated("assignment_requirements/assign",0,e,function(e){!t.isUndefined(e.status)&&e.status?(i.textType({title:"",message:"Se asignó el comprador.",type:"success"}),d.modal("hide"),n()):i.textType({title:"",message:"Hubo un error al asignar los requerimientos. Intente nuevamente.",type:"error"})})}),e.preventDefault()})}}),generateSearchForm("frm-search-c","LoadRecordsButtonC",function(){o.jtable("load",{search:$("#search_c").val()})},!1)}function n(){$(".jtable-column-header-selecting input").prop("checked",!1).iCheck("update"),$(".jtable-row-selected").removeClass("jtable-row-selected"),$("#LoadRecordsButtonR").click()}moment.locale("es");var s=moment().startOf("month"),c=moment().endOf("month"),l=$("#chk_date_range");l.click(function(){$("#LoadRecordsButtonR").click()}),generateCheckBox(".i-checks");var d,u=$("#reqDates"),p=function(e,t){s=e,c=t,u.find("span").html(e.format("MMM D, YYYY")+" - "+t.format("MMM D, YYYY")),l.prop("checked")&&$("#LoadRecordsButtonR").click()};generateDateRangePicker(u,s,c,p),p(s,c);var m=!1,f=getFormSearch("frm-search-r","search_r","LoadRecordsButtonR"),v='<select class="search_input" id="assignment_req_option"><option value="">Todos</option><option value="1">Asignados</option><option value="2">Sin Asignar</option></select>',h=$("#table_container_aa");h.jtable({title:"Lista de Requerimientos por Asignar",paging:!0,sorting:!0,selecting:!0,multiselect:!0,selectingCheckboxes:!0,selectOnRowClick:!1,actions:{listAction:base_url+"/assignment_requirements/list"},toolbar:{items:[{cssClass:"buscador",text:v},{cssClass:"buscador",text:f}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},code:{title:"Requerimiento",listClass:"text-center",width:"5%"},date_registration:{title:"F.Registro",list:show_list_,listClass:"text-center",width:"3%"},date_required:{title:"F.Requerida",list:show_list_,listClass:"text-center",width:"3%"},project_description:{title:"Proyecto",width:"24%",sorting:!1},requested_by:{title:"Solicitado por",list:show_list_},buyer_desc:{title:"Comprador",sorting:!1}},recordsLoaded:function(e,t){generateCheckBox(".jtable-selecting-column input")}});var _=$("#assignment_req_option");generateSearchForm("frm-search-r","LoadRecordsButtonR",function(){h.jtable("load",{search:$("#search_r").val(),check:l.prop("checked"),from:s.format("YYYY-MM-DD"),to:c.format("YYYY-MM-DD"),state:3,show_buyer:!0,assignment_req:_.val()})},!0),_.change(function(){$("#LoadRecordsButtonR").click()});var g;e.assignBuyer=function(){var e=h.jtable("selectedRows");return e.length>0?(g=[],e.each(function(){var e=$(this).data("record");g.push(e.id)}),console.log(g),o(),d.modal("show"),void 0):(i.textType({title:"",message:"Debe seleccionar los requerimientos a asignar.",type:"warning"}),!1)},e.rejectBuyer=function(){var e=h.jtable("selectedRows");return e.length>0?(g=[],e.each(function(){var e=$(this).data("record");g.push(e.id)}),console.log(g),i.confirm({title:"",message:"¿Está seguro que desea desasignar el comprador a los requerimientos seleccionados?",confirm:"Si",cancel:"No",closeOnConfirm:!1,showLoaderOnConfirm:!0},function(){var e={requirements:g};a.updated("assignment_requirements/reject",0,e,function(e){!t.isUndefined(e.status)&&e.status?(i.textType({title:"",message:"Se deasignó el comprador.",type:"success"}),n()):i.textType({title:"",message:"Hubo un error al desasignar los requerimientos. Intente nuevamente.",type:"error"})})}),void 0):(i.textType({title:"",message:"Debe seleccionar los requerimientos a desasignar.",type:"warning"}),!1)}}function t(e,t){e.state("assignment_requirements",{url:"/assignment_requirements",templateUrl:base_url+"/templates/assignment_requirements/base.html",controller:"AssignmentRequirementCtrl"}),t.otherwise("/")}angular.module("sys.app.assignment_requirements").config(t).controller("AssignmentRequirementCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.brands",[])}(),function(){"use strict";function e(e){var t=getFormSearch("frm-search-brand","search_b","LoadRecordsButtonBrand"),a=$("#table_container_brand");a.jtable({title:"Lista de Marcas",paging:!0,sorting:!0,actions:{listAction:base_url+"/brands/list",createAction:base_url+"/brands/create",updateAction:base_url+"/brands/update",deleteAction:base_url+"/brands/delete"},messages:{addNewRecord:"Nueva Marca",editRecord:"Editar Marca"},toolbar:{items:[{cssClass:"buscador",text:t},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("brands/excel",{})}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},marca:{title:"Marca"}},formCreated:function(e,t){t.form.find('input[name="marca"]').attr("onkeypress","return soloLetras(event)")},formSubmitting:function(e,t){var a=!0;return a=a&&t.form.find('input[name="marca"]').required()}}),generateSearchForm("frm-search-brand","LoadRecordsButtonBrand",function(){a.jtable("load",{search:$("#search_b").val()})},!0)}function t(e,t){e.state("brands",{url:"/brands",templateUrl:base_url+"/templates/brands/base.html",controller:"BrandCtrl"}),t.otherwise("/")}angular.module("sys.app.brands").config(t).controller("BrandCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope"]}(),function(){"use strict";angular.module("sys.app.buyers",[])}(),function(){"use strict";function e(e,t,a,i){function o(){b||(l=$("#modalB"),u=$("#title-buy"),d=$("#modalUser"),p=$("#code"),m=$("#description"),f=$("#state"),v=$("#state_text"),h=$("#user_id"),_=$("#username"),g=$("#buyer_id"),d.on("hidden.bs.modal",function(e){l.attr("style","display:block;")}),d.on("show.bs.modal",function(e){l.attr("style","display:block; z-index:2030 !important")}),l.on("shown.bs.modal",function(e){p.focus()}),l.on("hidden.bs.modal",function(e){r()}),c(),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(t){$(t.target).click(),e.chkState()}))}function r(){cleanRequired(),u.html(""),g.val(""),h.val(""),p.val(""),f.prop("checked",!0).iCheck("update"),e.chkState(),m.val(""),_.val("")}function n(){o(),l.modal("show"),u.html("Nuevo Comprador")}function s(r){o(),u.html("Editar Comprador"),a.get("buyers/find",r,function(a){if(!t.isUndefined(a.status)&&a.status){var o=a.data;p.val(o.code),g.val(o.id),m.val(o.description),f.prop("checked","1"===o.state).iCheck("update"),e.chkState(),h.val(o.user_id),_.val(o.user.name),l.modal("show")}else i.textType({title:"",message:"Hubo un error al obtener el Comprador. Intente nuevamente.",type:"error"})})}function c(){b=!0;var e=getFormSearch("frm-search-u","search_u","LoadRecordsButtonU"),t=$("#table_container_usuario");t.jtable({title:"Lista de Usuarios",paging:!0,sorting:!0,actions:{listAction:base_url+"/buyers/listUser"},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},username:{title:"Usuario"},name:{title:"Nombre"},select:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_u" data-code="'+e.record.id+'" data-title="'+e.record.name+'"><i class="fa fa-'+icon_select+' fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_u").click(function(e){var t=$(this).attr("data-code"),a=$(this).attr("data-title");h.val(t),_.val(a).removeClass("border-red"),d.modal("hide"),e.preventDefault()})}}),generateSearchForm("frm-search-u","LoadRecordsButtonU",function(){t.jtable("load",{search:$("#search_u").val()})},!1)}var l,d,u,p,m,f,v,h,_,g,b=!1;e.chkState=function(){var e=f.prop("checked")?"Activo":"Inactivo";v.html(e)},e.openUser=function(){$("#LoadRecordsButtonU").click(),d.modal("show")},e.saveBuyer=function(){var e=!0;if(e=e&&p.required(),e=e&&m.required(),e=e&&_.required()){var o={id:g.val(),code:p.val(),state:f.prop("checked")?1:0,description:m.val(),user_id:h.val()},r=""===g.val()?0:g.val();a.updated("buyers/saveBuyer",r,o,function(e){if(!t.isUndefined(e.status)&&e.status)i.textType({title:"",message:"El comprador se guardo correctamente.",type:"success"}),l.modal("hide"),$("#LoadRecordsButtonBuyer").click();else{var a=t.isUndefined(e.message)?"Hubo un error al guardar el comprador. Intente nuevamente.":e.message;i.textType({title:"",message:a,type:"error"})}})}};var y=getFormSearch("frm-search-buyer","search_buyer","LoadRecordsButtonBuyer"),C=$("#table_container_buyer");C.jtable({title:"Lista de Compradores",paging:!0,sorting:!0,actions:{listAction:base_url+"/buyers/list",deleteAction:base_url+"/buyers/delete"},toolbar:{items:[{cssClass:"buscador",text:y},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("buyers/excel",{})}},{cssClass:"btn-danger-admin",text:'<i class="fa fa-plus"></i> Nuevo Comprador',click:function(){n()}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},code:{title:"Código"},description:{title:"Descripción"},name:{title:"Usuario",sorting:!1},state:{title:"Estado",options:{1:"Activo",0:"Inactivo"},list:show_list_},edit:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Editar" class="edit_b" data-code="'+e.record.id+'"><i class="fa fa-pencil-square-o fa-1-5x fa-green"></i></a>'}}},recordsLoaded:function(e,t){$(".edit_b").click(function(e){var t=$(this).attr("data-code");s(t),e.preventDefault()})}}),generateSearchForm("frm-search-buyer","LoadRecordsButtonBuyer",function(){C.jtable("load",{search:$("#search_buyer").val()})},!0)}function t(e,t){e.state("buyers",{url:"/buyers",templateUrl:base_url+"/templates/buyers/base.html",controller:"BuyerCtrl"}),t.otherwise("/")}angular.module("sys.app.buyers").config(t).controller("BuyerCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.cash_expense_girls",[])}(),function(){"use strict";function e(e,t,a,i,o,r){function n(){m=$("#modalCEG"),v=$("#title-ceg"),f=$("#modalDocument"),w=$("#modalCash"),A=$("#modalProyect"),R=$("#modalProvider"),S=$("#modalMatriz"),j=$("#modalDetailDocument"),h=$("#w_user_body"),_=$("#Cashexpensegirl_id"),g=$("#w_description"),b=$("#w_code_internal"),y=$("#w_type_id"),C=$("#w_physical_location"),x=$("#w_address"),k=$("#w_state"),f.on("hidden.bs.modal",function(e){m.attr("style","display:block;")}),f.on("show.bs.modal",function(e){m.attr("style","display:block; z-index:2030 !important")}),j.on("hidden.bs.modal",function(e){f.attr("style","display:block;")}),j.on("show.bs.modal",function(e){f.attr("style","display:block; z-index:2030 !important")}),A.on("hidden.bs.modal",function(e){m.attr("style","display:block;")}),A.on("show.bs.modal",function(e){m.attr("style","display:block; z-index:2030 !important")}),w.on("hidden.bs.modal",function(e){m.attr("style","display:block;")}),w.on("show.bs.modal",function(e){m.attr("style","display:block; z-index:2030 !important")}),R.on("hidden.bs.modal",function(e){f.attr("style","display:block;")}),R.on("show.bs.modal",function(e){f.attr("style","display:block; z-index:2030 !important")}),S.on("hidden.bs.modal",function(e){f.attr("style","display:block;")}),S.on("show.bs.modal",function(e){f.attr("style","display:block; z-index:2030 !important")}),m.on("hidden.bs.modal",function(e){s()}),P||p()}function s(){v.html(""),_.val(""),g.val(""),x.val(""),b.val(""),k.prop("checked",!1),C.prop("checked",!1),h.html(""),activeTab("almacen")}function c(){n(),m.modal("show"),v.html("Nuevo Gasto de Caja Chica")}function l(){a.all("articles/data_form","",function(e){!t.isUndefined(e.status)&&e.status&&($("#p_retention_id").append('<option value="" selected>SIN RETENCIÓN</option>'),t.each(e.retentions,function(e){$("#p_retention_id").append('<option value="'+e.Value+'">'+e.DisplayText+"</option>")}))},function(){l()})}function d(e){n(),m.modal("show"),v.html("Editar Gastos de Caja Chica")}function u(e,t,a){if($("#tr_b_"+e).length>0)return o.showWarning({title:"",message:"Ya se asignó este Usuario"}),!1;var i=$('<tr id="tr_b_'+e+'"></tr>'),r=$("<td>"+t+"</td>"),n=$("<td>"+a+"</td>"),s=$('<input type="hidden" class="w_user" value="'+e+'" />');r.append(s);var c=$('<td class="text-center"></td>'),l=$('<button class="btn btn-danger btn-xs delCashexpensegirl" data-id="'+e+'" type="button"><span class="fa fa-trash"></span></button>');c.append(l),i.append(r).append(n).append(c),$("#w_user_body").append(i),$("#modalUsuario").modal("hide"),$(".delCashexpensegirl").click(function(e){var t=$(this).attr("data-id");o.confirm({title:"",message:"¿Está seguro que desea quitar este Almacén?",confirm:"Si",cancel:"No"},function(){$("#tr_b_"+t).remove()}),e.preventDefault()})}function p(){P=!0;var e=getFormSearch("frm-search-cash","search_cash","LoadRecordsButtonCash"),t=$("#table_container_cash");t.jtable({title:"Lista de Cajas Chicas",paging:!0,sorting:!0,actions:{listAction:function(e,t){return{Result:"OK",Records:[{description:"Caja chica morales"},{description:"Caja chica Tarapoto"},{description:"Caja chica Lima"},{description:"Caja chica Chiclayo"}],TotalRecordCount:4}}},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},description:{title:"Caja"},select:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_u" data-code="'+e.record.id+'" data-title="'+e.record.username+'"data-name="'+e.record.name+'" ><i class="fa fa-circle-o fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_u").click(function(e){var t=$(this).attr("data-code"),a=$(this).attr("data-title"),i=$(this).attr("data-name");u(t,a,i),e.preventDefault()})}}),generateSearchForm("frm-search-cash","LoadRecordsButtonCash",function(){t.jtable("load",{search:$("#search_cash").val()})},!1);var t=(getFormSearch("frm-search-proyect","search_proyect","LoadRecordsButtonProyect"),$("#table_container_proyect"));t.jtable({title:"Lista de Proyectos",paging:!0,sorting:!0,actions:{listAction:function(e,t){return{Result:"OK",Records:[{description:"Construción SA",code:"9875443"},{description:"Construccion de un puente",code:"6375471"},{description:"Enchapado de piso",code:"6375458"},{description:"Planos de puentes",code:"8375443"}],TotalRecordCount:4}}},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},description:{title:"Proyecto"},code:{title:"Código"},select:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_u" data-code="'+e.record.id+'" data-title="'+e.record.username+'"data-name="'+e.record.name+'" ><i class="fa fa-circle-o fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_u").click(function(e){var t=$(this).attr("data-code"),a=$(this).attr("data-title"),i=$(this).attr("data-name");u(t,a,i),e.preventDefault()})}}),generateSearchForm("frm-search-cash","LoadRecordsButtonCash",function(){t.jtable("load",{search:$("#search_cash").val()})},!1);var a=(getFormSearch("frm-search-provider","search_provider","LoadRecordsButtonProvider"),$("#table_container_provider"));a.jtable({title:"Lista de Proveedores",paging:!0,sorting:!0,actions:{listAction:function(e,t){return{Result:"OK",Records:[{razon_social:"Construción SA",ruc:"35946576892"},{razon_social:"Solución SA",ruc:"45946576891"},{razon_social:"Peralta S.R.L",ruc:"64946576865"}],TotalRecordCount:4}}},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},razon_social:{title:"Razón Social"},ruc:{title:"Ruc"},select:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_u" data-code="'+e.record.id+'" data-title="'+e.record.username+'"data-name="'+e.record.name+'" ><i class="fa fa-circle-o fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_u").click(function(e){var t=$(this).attr("data-code"),a=$(this).attr("data-title"),i=$(this).attr("data-name");u(t,a,i),e.preventDefault()})}}),generateSearchForm("frm-search-provider","LoadRecordsButtonProvider",function(){a.jtable("load",{search:$("#search_provider").val()})},!1);var i=getFormSearch("frm-search-matriz","search_matriz","LoadRecordsButtonMatriz"),o=$("#table_container_matriz");o.jtable({title:"Lista de Matriz",paging:!0,sorting:!0,actions:{listAction:function(e,t){return{Result:"OK",Records:[{razon_social:"10001",ruc:"EXCAVACIÓN DE HOYOS"},{razon_social:"10003",ruc:"OFICINA TEMPORAL DE OBRAS"},{razon_social:"10004",ruc:"ALIMENTACIÓN EN OBRAS"}],TotalRecordCount:4}}},toolbar:{items:[{cssClass:"buscador",text:i}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},razon_social:{title:"Código"},ruc:{title:"Descripción"},select:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_u" data-code="'+e.record.id+'" data-title="'+e.record.username+'"data-name="'+e.record.name+'" ><i class="fa fa-circle-o fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_u").click(function(e){var t=$(this).attr("data-code"),a=$(this).attr("data-title"),i=$(this).attr("data-name");u(t,a,i),e.preventDefault()})}}),generateSearchForm("frm-search-matriz","LoadRecordsButtonMatriz",function(){o.jtable("load",{search:$("#search_matriz").val()})},!1)}var m,f,v,h,_,g,b,y,C,x,k,w,A,R,S,j;l(),e.openDocument=function(){f.modal("show")},e.openCash=function(){w.modal("show")},e.openProyect=function(){A.modal("show")},e.openProvider=function(){R.modal("show")},e.openDetalleDoc=function(){j.modal("show")},e.openMatriz=function(){S.modal("show")},e.saveCashexpensegirl=function(){var e=!0;if(e=e&&g.required(),e=e&&y.required(),e=e&&x.required(),e=e&&b.required()){var i=[];$.each($(".w_user"),function(e,t){i[e]=$(t).val()}),i=i.join(",");var r={id:_.val(),code_internal:b.val(),description:g.val(),type_id:y.val(),address:x.val(),state:k.prop("checked")?1:0,physical_location:C.prop("checked")?1:0,users:i},n=""==_.val()?0:_.val();console.log(n),a.updated("Cashexpensegirls/saveCashexpensegirl",n,r,function(e){t.isUndefined(e.status)||1!=e.status?o.textType({title:"",message:"Hubo un error al guardar el Almacén. Intente nuevamente.",type:"error"}):(console.log(e),o.textType({title:"",message:"El Almacén se guardó correctamente.",type:"success"}),m.modal("hide"),LoadRecordsButtonCashexpensegirl.click())})}};var L=getFormSearch("frm-search-cashexpensegirl","search_cashexpensegirl","LoadRecordsButtonCashexpensegirl"),E=$("#table_container_ceg");E.jtable({title:"Lista de Gastos de Caja Chica",paging:!0,sorting:!0,actions:{listAction:function(e,t){return{Result:"OK",Records:[{description:"Caja chica morales",Responsable:"JUAN MESTANZA",proyecto:"6375471-PROYECTO PRUEBA",saldo:"456.00",Periodo_contable:"201702",fecha_emision:"12/02/2017"},{description:"Caja chica Tarapoto",Responsable:"PEDRO DE LA CRUZ",proyecto:"7375473-PROYECTO PRUEBA",saldo:"756.00",Periodo_contable:"201702",fecha_emision:"12/02/2017"},{description:"Caja chica Lima",Responsable:"FAUSTINO SANCHEXZ",proyecto:"8775473-PROYECTO PRUEBA",saldo:"656.00",Periodo_contable:"201702",fecha_emision:"12/03/2017"},{description:"Caja chica Chiclayo",Responsable:"FIORELA GARCIA",proyecto:"5475472-PROYECTO PRUEBA",saldo:"256.00",Periodo_contable:"201702",fecha_emision:"12/04/2017"}],TotalRecordCount:4}},deleteAction:base_url+"/receptions/delete"},toolbar:{items:[{cssClass:"buscador",text:L},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){window.open(base_url+"/chexpensegirls/excel")}},{cssClass:"btn-success",text:'<i class="fa fa-plus"></i> Nuevo Gastos de Caja Chica',click:function(){c()}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},description:{title:"Caja",width:"5%"},Responsable:{title:"Responsable",width:"4%"},proyecto:{title:"Proyecto"},saldo:{title:"Saldo",listClass:"text-right",width:"2%"},Periodo_contable:{title:"Periodo Contable",width:"2%"},fecha_emision:{title:"Fecha",listClass:"text-center",width:"3%"},edit:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return'<a href="javascript:void(0)" title="Editar" class="edit_w" data-code="'+e.record.id+'"><i class="fa fa-pencil-square-o fa-1-5x fa-green"></i></a>'}}},recordsLoaded:function(e,t){$(".edit_w").click(function(e){var t=$(this).attr("data-code");d(t),e.preventDefault()})}}),generateSearchForm("frm-search-cashexpensegirl","LoadRecordsButtonCashexpensegirl",function(){E.jtable("load",{search:$("#search_cashexpensegirl").val()})},!0);var P=!1}function t(e,t){e.state("cash_expense_girls",{url:"/cash_expense_girls",templateUrl:base_url+"/templates/cash_expense_girls/base.html",controller:"CashexpensegirlCtrl"}),t.otherwise("/")}angular.module("sys.app.cash_expense_girls").config(t).controller("CashexpensegirlCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","$rootScope","AlertFactory","Notify"]}(),function(){"use strict";angular.module("sys.app.categories",[])}(),function(){"use strict";function e(e){e.chkState=function(){var e=w_state.prop("checked")?"Activo":"Inactivo";state_state.html(e)};var t=getFormSearch("frm-search-Category","search_b","LoadRecordsButtonCategory"),a=$("#table_container_Category");a.jtable({title:"Lista de Categorías",paging:!0,sorting:!0,actions:{listAction:base_url+"/categories/list",createAction:base_url+"/categories/create",updateAction:base_url+"/categories/update",deleteAction:base_url+"/categories/delete"},messages:{addNewRecord:"Nueva Categoría",editRecord:"Editar Categoría"},toolbar:{items:[{cssClass:"buscador",text:t},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',
click:function(){e.openDoc("categories/excel",{})}}]},fields:{idCategoria:{key:!0,create:!1,edit:!1,list:!1},Categoria:{title:"Categoría"},estado:{title:"Estado",values:{I:"Inactivo",A:"Activo"},type:"checkbox",defaultValue:"A"}},formCreated:function(e,t){t.form.find('input[name="Categoria"]').attr("onkeypress","return soloLetras(event)"),$("#Edit-estado").parent().addClass("i-checks"),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click(),"A"==e.target.value?($("#Edit-estado").val("I"),$(".i-checks span").text("Inactivo")):($("#Edit-estado").val("A"),$(".i-checks span").text("Activo"))})},formSubmitting:function(e,t){var a=!0;return a=a&&t.form.find('input[name="Categoria"]').required()}}),generateSearchForm("frm-search-Category","LoadRecordsButtonCategory",function(){a.jtable("load",{search:$("#search_b").val()})},!0)}function t(e,t){e.state("categories",{url:"/categories",templateUrl:base_url+"/templates/categories/base.html",controller:"CategoryCtrl"}),t.otherwise("/")}angular.module("sys.app.categories").config(t).controller("CategoryCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope"]}(),function(){"use strict";angular.module("sys.app.configs",[])}(),function(){"use strict";function e(e,t,a,i){function o(e){e=e.substr(13);var t=$("#input_option_"+e),a=$("#check_option_"+e).prop("checked");t.prop("readonly",!a),a?t.focus():t.val("")}function r(e){e?($(".chk_main30").prop("checked",!1).iCheck("update"),setTimeout(function(){$(".chk_main3").prop("checked",!0).iCheck("update").parent().addClass("checked")})):$(".chk_main3").prop("checked",0==$(".chk_main30:checked").length).iCheck("update")}function n(){a.all("configs/all","",function(e){!t.isUndefined(e.status)&&e.status?t.each(e.Data,function(e){var a=e.id;if($("#config_"+a).val(e.description),$("#check_option_"+a).prop("checked","1"==e.check).iCheck("update"),3==a){var i=e.value.split("-");t.each(i,function(e,t){$("#check_option_3"+t).prop("checked","1"==e).iCheck("update")})}else $("#input_option_"+a).val(e.value).prop("readonly","1"!=e.check)}):n()})}$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click();var t=$(e.target).prop("id");$(e.target).hasClass("chk_option3")?r($(e.target).hasClass("chk_main3")):o(t)}),n(),e.saveConfig=function(){var e=[],o=[],r=[],n=!0;if(t.each($(".config_option"),function(a,i){var s=$(a).prop("id");if(s=s.substr(7),$("#check_option_"+s).length>0&&$("#check_option_"+s).prop("checked")&&(n=n&&$("#input_option_"+s).required()),e[i]=$(a).val(),r[i]=$("#check_option_"+s).prop("checked")?"1":"0",3==s){var c=[];t.each($(".chk_option3"),function(e,t){c[t]=$(e).prop("checked")?"1":"0"}),o[i]=c.join("-")}else o[i]=$("#input_option_"+s).val()}),console.log(r),n){var s={keys:e.join(","),values:o.join(","),checks:r.join(",")};a.updated("configs/saveConfig",0,s,function(e){!t.isUndefined(e.status)&&e.status?i.textType({title:"",message:"La configuración se guardó correctamente.",type:"success"}):i.textType({title:"",message:"Hubo un error al guardar la configuración. Intente nuevamente.",type:"error"})})}}}function t(e,t){e.state("configs",{url:"/configs",templateUrl:base_url+"/templates/configs/base.html",controller:"ConfigCtrl"}),t.otherwise("/")}angular.module("sys.app.configs").config(t).controller("ConfigCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.consecutives",[])}(),function(){"use strict";function e(e){e.chkState=function(){var e=w_state.prop("checked")?"Activo":"Inactivo";state_state.html(e)};var t=getFormSearch("frm-search-Consecutive","search_b","LoadRecordsButtonConsecutive"),a=$("#table_container_Consecutive");a.jtable({title:"Lista de Consecutivos",paging:!0,sorting:!0,actions:{listAction:base_url+"/consecutives/list",createAction:base_url+"/consecutives/create",updateAction:base_url+"/consecutives/update",deleteAction:base_url+"/consecutives/delete"},messages:{addNewRecord:"Nuevo Consecutivo",editRecord:"Editar Consecutivo"},toolbar:{items:[{cssClass:"buscador",text:t},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("consecutives/excel",{})}}]},fields:{cCodConsecutivo:{key:!0,title:"Código Consecutivo",create:!0,edit:!0,list:!0,input:function(e){return e.record?'<div class="jtable-input jtable-text-input col-md-9" ><input type="text" name="cCodConsecutivo" class="form-control input-sm " readonly value="'+e.record.cCodConsecutivo+'" /></div>':'<div class="jtable-input jtable-text-input col-md-9" > <input type="text" name="cCodConsecutivo" class="form-control input-sm " maxlength="10" /></div>'}},cCodTipoCons:{title:"Tipo Consecutivo",options:base_url+"/consecutives/getTipoConsecutivo"},cDetalle:{title:"Detalle"},nCodTienda:{title:"Tienda",options:base_url+"/consecutives/getTienda"},nConsecutivo:{title:"Consecutivo",input:function(e){return e.record?'<div class="jtable-input jtable-text-input col-md-9" ><input type="text" name="nConsecutivo" class="form-control input-sm "  value="'+e.record.nConsecutivo+'" /></div>':'<div class="jtable-input jtable-text-input col-md-9" > <input type="text" name="nConsecutivo" class="form-control input-sm " readonly value="0"  onkeypress="return soloNumeros(event)"" /></div>'}}},formCreated:function(e,t){t.form.find('input[name="Categoria"]').attr("onkeypress","return soloLetras(event)"),$("#Edit-estado").parent().addClass("i-checks"),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click(),"A"==e.target.value?($("#Edit-estado").val("I"),$(".i-checks span").text("Inactivo")):($("#Edit-estado").val("A"),$(".i-checks span").text("Activo"))})},formSubmitting:function(e,t){var a=!0;return a=a&&t.form.find('input[name="Categoria"]').required()}}),generateSearchForm("frm-search-Consecutive","LoadRecordsButtonConsecutive",function(){a.jtable("load",{search:$("#search_b").val()})},!0)}function t(e,t){e.state("consecutives",{url:"/consecutives",templateUrl:base_url+"/templates/consecutives/base.html",controller:"ConsecutiveCtrl"}),t.otherwise("/")}angular.module("sys.app.consecutives").config(t).controller("ConsecutiveCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope"]}(),function(){"use strict";angular.module("sys.app.consolidated_projects",[])}(),function(){"use strict";function e(e,t,a,i){var o=$("#search_project");o.select2({placeholder:"Buscar proyecto......"});var r=$("#option_consolidated"),n=$(".show_txt_project");e.generateConsolidated=function(){var e=!0;e=e&&o.required(),e&&($(".report_project").addClass("hide"),n.html(o.find("option:selected").html()),$(".report_"+r.val()).removeClass("hide"))},e.show=function(e){$("#show_"+e).addClass("hide"),$("#hide_"+e).removeClass("hide"),$(".table_"+e).removeClass("hide")},e.hide=function(e){$("#show_"+e).removeClass("hide"),$("#hide_"+e).addClass("hide"),$(".table_"+e).addClass("hide")}}function t(e,t){e.state("consolidated_projects",{url:"/consolidated_projects",templateUrl:base_url+"/templates/consolidated_projects/base.html",controller:"ConsolidatedProjectCtrl"}),t.otherwise("/")}angular.module("sys.app.consolidated_projects").config(t).controller("ConsolidatedProjectCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.consumer_returns",[])}(),function(){"use strict";function e(e,t,a,i){function o(){I||(f=$("#modalCR"),v=$("#title-cr"),h=$("#cr_date"),_=$("#cr_name"),g=$("#cr_warehouse_id"),b=$("#cr_observation"),y=$("#modalProject"),C=$("#cr_project_id"),x=$("#cr_project_code"),k=$("#cr_project_description"),w=$("#modalFront"),A=$("#cr_front_id"),R=$("#cr_front_description"),S=$("#modalArticles"),j=$("#cr_button_project"),L=$("#cr_button_front"),E=$("#cr_button_articles"),P=$("#cr_button_saveConsumerProcess"),q=$("#cr_button_saveConsumer"),D=$("#cr_detail_consumer_return"),N=$("#cr_consumer_return_id"),y.on("hidden.bs.modal",function(e){f.attr("style","display:block;")}),y.on("show.bs.modal",function(e){f.attr("style","display:block; z-index:2030 !important")}),w.on("hidden.bs.modal",function(e){f.attr("style","display:block;")}),w.on("show.bs.modal",function(e){f.attr("style","display:block; z-index:2030 !important")}),S.on("hidden.bs.modal",function(e){f.attr("style","display:block;")}),S.on("show.bs.modal",function(e){f.attr("style","display:block; z-index:2030 !important")}),f.on("hidden.bs.modal",function(e){r()}),h.datepicker({changeMonth:!0,changeYear:!0,dateFormat:"dd/mm/yy",beforeShow:function(){setTimeout(function(){$(".ui-datepicker").css("z-index",2052)})}}),p()),g.select2(),_.val(user_default)}function r(){cleanRequired(),h.val("").prop("disabled",!1),_.val(""),g.val(F).prop("disabled",!1),b.val(""),C.val(""),D.empty(),x.val(""),k.val(""),A.val(""),N.val(""),R.val(""),j.prop("disabled",!1),L.prop("disabled",!1),E.prop("disabled",!1),P.prop("disabled",!1),q.prop("disabled",!1),M=[]}function n(){a.all("consumer_returns/data_form","",function(e){!t.isUndefined(e.status)&&e.status&&t.each(e.warehouse,function(e){""===F&&(F=e.Value),$("#cr_warehouse_id").append('<option value="'+e.Value+'">'+e.DisplayText+"</option>")})},function(){n()})}function s(){cleanRequired(),o(),f.modal("show"),v.html("Nueva Devolución de Consumo")}function c(){var e=!0;if(e=e&&h.required(),e=e&&g.required(),e=e&&R.required(),e&&""===D.html())return i.showWarning({title:"",message:"Debe agregar mínimo 1 artículo"}),!1;if(e){var o=[],r=[],n=[];t.each($(".p_product"),function(e){o.push($(e).val())}),t.each($(".p_toConsumeReturn"),function(e){r.push($(e).val())}),t.each($(".p_available"),function(e){n.push($(e).val())});var s={id:N.val(),date:h.val(),warehouse_id:g.val(),observation:b.val(),project_id:C.val(),front_id:A.val(),product:o.join(","),toConsumeReturn:r.join(","),state_consumer_return:T};i.confirm({title:"",message:"¿Está seguro?",confirm:"Si",cancel:"No"},function(){var e=""===N.val()?0:N.val();a.updated("consumer_returns/saveConsumerReturn",e,s,function(e){var a=1===T?"procesó":"guardó";!t.isUndefined(e.status)&&e.status?(i.textType({title:"",message:"La devolución de consumo se "+a+" correctamente.",type:"success"}),f.modal("hide"),LoadRecordsButtonConsumerReturn.click()):i.textType({title:"",message:"Hubo un error al "+a+" la devolucion de consumo. Intente nuevamente.",type:"error"})})})}}function l(e){o(),v.html("Editar Devolución de Consumo"),a.get("consumer_returns/find",e,function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.data;N.val(a.id),h.val(a.date),g.val(a.warehouse_id).trigger("change"),b.val(a.observation),C.val(a.project_id),x.val(a.project_code),k.val(a.project_description),A.val(a.front_id),R.val(a.front_code),f.modal("show"),t.each(a.product,function(e){d(e)}),"PROCESADO"===a.state_description&&(h.prop("disabled",!0),g.prop("disabled",!0),P.prop("disabled",!0),q.prop("disabled",!0),j.prop("disabled",!0),L.prop("disabled",!0),E.prop("disabled",!0))}else i.textType({title:"",message:"Hubo un error al obtener  la devolución de consumo. Intente nuevamente.",type:"error"})})}function d(e){t.contains(M,e.id)||(u(e.id,e.code_article,e.description_detail,e.um_id,e.average_cost,e.stock_p,e.refund_amount,e.toReturn,e.state),M.push(e.id))}function u(e,a,o,r,n,s,c,l,d){var u;if($("#tr_c_"+e).length>0)return i.showWarning({title:"",message:"Ya se asigno este artículo"}),!1;u="PROCESADO"===d?"disabled":"";var p=$('<tr id="tr_c_'+e+'" data-id="'+e+'"></tr>'),m=$('<td class="rg_code">'+a+"</td>"),f=$('<td class="rg_description">'+o+"</td>"),v=t.isNull(r)?"":t.isUndefined(r)?"":r,h=$('<td class="p_unit">'+v+"</td>"),_=t.isNull(n)?"0":t.isUndefined(n)?"0":n,b=$('<td class="text-right p_productCost">'+_+"</td>"),y=t.isNull(c)?"0":t.isUndefined(c)?"0":c,C=t.isNull(s)?"0":t.isUndefined(s)?"0":s,x=$('<td class="text-right p_productCost">'+y+"</td>"),k="PROCESADO"===d?0:t.isNull(l)?"0":t.isUndefined(l)?"0":l,w=$('<td class="text-right"><input '+u+' type="text" value="'+k+'" id="inpRow'+e+'"   data-max="'+C+'"  class="form-control input-xs text-right p_toConsumeReturn" onkeypress="return soloNumeros(event)"></td>'),A=$('<td class="text-center"></td>'),R=$('<input type="hidden" class="p_available" value="'+C+'" >'),j=$('<input type="hidden" class="p_warehouse" value="'+g.val()+'" >'),L=$('<input type="hidden" class="p_product" value="'+e+'" />'),E=$("<button "+u+' class="btn btn-danger btn-xs delProduct"  data-id="'+e+'" readonly type="button"><span class="fa fa-trash"></span></button>');A.append(E).append(j).append(L).append(R),p.append(m).append(f).append(h).append(b).append(x).append(w).append(A),D.append(p),$(".delProduct").click(function(e){var a=$(this).closest("tr");i.confirm({title:"",message:"¿Está seguro que desea quitar esta artículo?",confirm:"Si",cancel:"No"},function(){var e=a.attr("data-id");a.remove(),console.log(e),M=t.reject(M,function(t){return t===parseInt(e)}),$("#LoadRecordsButtonArticle").click()}),e.preventDefault()}),S.modal("hide")}function p(){I=!0;var e=getFormSearch("frm-search-project","search_project","LoadRecordsButtonProject"),t=$("#table_container_project");t.jtable({title:"Lista de Proyectos",paging:!0,sorting:!0,actions:{listAction:base_url+"/consumer_returns/getProjects"},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},code:{title:"Código Proyecto",width:"5%",listClass:"text-center"},description:{title:"Proyecto"},select:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_p" data-id="'+e.record.id+'" data-code="'+e.record.code+'" data-description="'+e.record.description+'"><i class="fa fa-'+icon_select+' fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_p").click(function(e){var t=$(this).attr("data-id");C.val(t),x.val($(this).attr("data-code")),k.val($(this).attr("data-description")),y.modal("hide"),e.preventDefault()})}}),generateSearchForm("frm-search-project","LoadRecordsButtonProject",function(){t.jtable("load",{search:$("#search_project").val()})},!1);var a=getFormSearch("frm-search-article","search_article","LoadRecordsButtonArticle"),i=$("#table_container_product");i.jtable({title:"Lista de Artículos",paging:!0,sorting:!0,selecting:!0,multiselect:!0,selectingCheckboxes:!0,selectOnRowClick:!1,actions:{listAction:base_url+"/consumer_returns/getArticlesWithWithoutProject"},toolbar:{items:[{cssClass:"buscador",text:a}]},fields:{id:{key:!0,edit:!1,create:!1,list:!1},code_article:{title:"Código",width:"2%",listClass:"text-center"},description_detail:{title:"Descripción"},average_cost:{title:"Costo",width:"2%",listClass:"text-right"},stock_p:{title:"Stock",width:"2%",listClass:"text-right"},um_id:{title:"Unidad Medida",edit:!1,create:!1,list:!1}},recordsLoaded:function(e,t){$(".jtable-selecting-column input").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click()})}}),generateSearchForm("frm-search-article","LoadRecordsButtonArticle",function(){i.jtable("load",{search:$("#search_article").val(),warehouse_id:g.val(),items:M,project_id:C.val()})},!1);var o=getFormSearch("frm-search-front","search_front","LoadRecordsButtonFront"),r=$("#table_container_fronts");r.jtable({title:"Lista de Frentes",paging:!0,sorting:!0,actions:{listAction:base_url+"/consumer_returns/listFront"},toolbar:{items:[{cssClass:"buscador",text:o}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},code:{title:"Código",width:"5%"},description:{title:"Descripción",width:"20%"},NombreEntidad:{title:"Razón Social"},select:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_fr" data-id="'+e.record.id+'"  data-code="'+e.record.code+'" data-description="'+e.record.description+'"><i class="fa fa-circle-o fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_fr").click(function(e){var t=$(this).attr("data-id"),a=$(this).attr("data-description");A.val(t).removeClass("border-red"),R.val(a).removeClass("border-red"),w.modal("hide"),e.preventDefault()})}}),generateSearchForm("frm-search-front","LoadRecordsButtonFront",function(){r.jtable("load",{search:$("#search_front").val()})},!1)}function m(){$(".jtable-column-header-selecting input").prop("checked",!1).iCheck("update"),$(".jtable-row-selected").removeClass("jtable-row-selected")}moment.locale("es");var f,v,h,_,g,b,y,C,x,k,w,A,R,S,j,L,E,P,q,D,T,N,F="";n(),e.openProject=function(){$("#LoadRecordsButtonProject").click(),y.modal("show")},e.openFront=function(){$("#LoadRecordsButtonFront").click(),w.modal("show")},e.saveConsumerProcess=function(){T=1,c()},e.saveConsumer=function(){T=0,c()},e.openArticles=function(){return""===g.val()?(i.showWarning({title:"",message:"Debe seleccionar un almacén de origen"}),!1):void($(".p_warehouse").val()!==g.val()&&""!==D.html()?i.confirm({title:"",message:"¿Está seguro que desea cambiar de almacen?",confirm:"Si",cancel:"No"},function(){D.html(""),M=[]}):($("#LoadRecordsButtonArticle").click(),S.modal("show")))};var M=[];e.addDetail=function(){var e=$("#table_container_product").jtable("selectedRows");return e.length>0?(e.each(function(){var e=$(this).data("record");d(e)}),void m()):(i.textType({title:"",message:"Debe seleccionar al menos un artículo a asignar.",type:"warning"}),!1)};var U=getFormSearch("frm-search-consumerReturn","search_consumerReturn","LoadRecordsButtonConsumerReturn"),O=$("#table_container_consumer_return");O.jtable({title:"Lista de Devolución de Consumos",paging:!0,sorting:!0,actions:{listAction:base_url+"/consumer_returns/list"},toolbar:{items:[{cssClass:"buscador",text:U},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("consumer_returns/excel",{})}},{cssClass:"btn-success",text:'<i class="fa fa-plus"></i> Nueva Devolución de  Consumo',click:function(){s()}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},date:{title:show_list_?"Fecha Devolución":"Fecha",listClass:"text-center",width:"5%"},project_description:{title:"Proyecto"},name:{title:"Usuario",list:show_list_},warehouse_o:{title:"Almacén",width:"7%"},state_description:{title:"Estado",width:"3%"},edit:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return"GUARDADO"===e.record.state_description?'<a href="javascript:void(0)" title="Editar" class="edit_r" data-code="'+e.record.id+'"><i class="fa fa-pencil-square-o fa-1-5x fa-green"></i></a><a href="javascript:void(0)" title="Eliminar" class="delete_r" data-code="'+e.record.id+'"><i class="fa fa-trash fa-1-5x fa-red"></i></a>':'<a href="javascript:void(0)" title="Ver" class="edit_r" data-code="'+e.record.id+'"><i class="fa fa-eye fa-1-5x fa-green"></i></a>'}}},recordsLoaded:function(e,t){$(".edit_r").click(function(e){var t=$(this).attr("data-code");l(t),e.preventDefault()})}}),generateSearchForm("frm-search-consumerReturn","LoadRecordsButtonConsumerReturn",function(){O.jtable("load",{search:$("#search_consumerReturn").val()})},!0);var I=!1}function t(e,t){e.state("consumer_returns",{url:"/consumer_returns",templateUrl:base_url+"/templates/consumer_returns/base.html",controller:"ConsumeReturnCtrl"}),t.otherwise("/")}angular.module("sys.app.consumer_returns").config(t).controller("ConsumeReturnCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.consumptions",[])}(),function(){"use strict";function e(e,t,a,i){function o(){G||(m=$("#modalCON"),f=$("#modalProject"),v=$("#title-con"),h=$("#btn_action_req"),_=$("#modalArticles"),g=$("#modalRequirements"),b=$("#modalFront"),y=$("#c_consumption_date"),C=$("#c_front_id"),R=$("#c_front_code"),x=$("#c_project_id"),k=$("#c_project_description"),w=$("#c_project_code"),A=$("#c_front_description"),S=$("#c_requirement_id"),j=$("#c_requirement_code"),E=$("#c_name"),P=$("#c_observation"),L=$("#c_warehouse_id"),q=$("#c_detail_consumption"),N=$("#c_consumption_id"),M=$("#c_button_saveConsumption"),F=$("#c_button_saveConsumptionProcess"),O=$("#c_button_project"),I=$("#c_button_requirement"),B=$("#c_button_front"),U=$("#c_button_articles"),b.on("hidden.bs.modal",function(e){m.attr("style","display:block;")}),b.on("show.bs.modal",function(e){m.attr("style","display:block; z-index:2030 !important")}),g.on("hidden.bs.modal",function(e){m.attr("style","display:block;")}),g.on("show.bs.modal",function(e){m.attr("style","display:block; z-index:2030 !important")}),_.on("hidden.bs.modal",function(e){m.attr("style","display:block;")}),_.on("show.bs.modal",function(e){m.attr("style","display:block; z-index:2030 !important")}),f.on("hidden.bs.modal",function(e){m.attr("style","display:block;")}),f.on("show.bs.modal",function(e){m.attr("style","display:block; z-index:2030 !important")}),m.on("hidden.bs.modal",function(e){r()}),y.datepicker({changeMonth:!0,changeYear:!0,dateFormat:"dd/mm/yy",beforeShow:function(){setTimeout(function(){$(".ui-datepicker").css("z-index",2052)})}}),p()),L.select2(),E.val(user_default),L.change(function(){D=L.val()})}function r(){cleanRequired(),v.html(""),N.val(""),x.val(""),w.val(""),k.val(""),S.val(""),j.val(""),C.val(""),R.val(""),A.val(""),y.val("").prop("disabled",!1),L.val(Y).prop("disabled",!1),P.val(""),q.html(""),z=[],F.prop("disabled",!1),M.prop("disabled",!1),O.prop("disabled",!1),I.prop("disabled",!1),B.prop("disabled",!1),U.prop("disabled",!1)}function n(e){o(),v.html("Editar Consumo"),a.get("consumptions/find",e,function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.data;N.val(a.id),y.val(a.date),L.val(a.warehouse_id),P.val(a.observation),x.val(a.project_id),w.val(a.project_code),k.val(a.project_description),S.val(a.requirement_id),j.val(a.requirement_code),C.val(a.front_id),R.val(a.front_code),A.val(a.front_description),m.modal("show"),t.each(a.product,function(e){s(e)}),"PROCESADO"===a.state_description&&(y.prop("disabled",!0),L.prop("disabled",!0),F.prop("disabled",!0),M.prop("disabled",!0),O.prop("disabled",!0),I.prop("disabled",!0),B.prop("disabled",!0),U.prop("disabled",!0))}else i.textType({title:"",message:"Hubo un error al obtener  el consumo. Intente nuevamente.",type:"error"})})}function s(e){t.contains(z,e.id)||(c(e.id,e.code_article,e.description_detail,e.um_id,e.average_cost,e.stock_p,e.consumption,e.toConsume,e.state),z.push(e.id))}function c(e,a,o,r,n,s,c,l,d){var u;if($("#tr_c_"+e).length>0)return i.showWarning({title:"",message:"Ya se asigno este artículo"}),!1;u="PROCESADO"===d?"disabled":"";var p=$('<tr id="tr_c_'+e+'" data-id="'+e+'"></tr>'),m=$('<td class="rg_code">'+a+"</td>"),f=$('<td class="rg_description">'+o+"</td>"),v=t.isNull(r)?"":t.isUndefined(r)?"":r,h=$('<td class="p_unit">'+v+"</td>"),g=t.isNull(n)?"0":t.isUndefined(n)?"0":n,b=$('<td class="text-right p_productCost">'+g+"</td>"),y=t.isNull(s)?"0":t.isUndefined(s)?"0":s,C=$('<td class="text-right p_available" style="display: none;">'+y+"</td>"),x=t.isNull(c)?"0":t.isUndefined(c)?"0":c,k=$('<td class="text-right p_productCost">'+x+"</td>"),w="PROCESADO"===d?0:t.isNull(l)?"0":t.isUndefined(l)?"0":l,A=$('<td class="text-right"><input '+u+' type="text" value="'+w+'" id="inpRow'+e+'"  data-max="'+s+'" onclick="this.select()"   class="form-control input-xs text-right p_toConsume"  onkeypress="return soloNumeros(event)"></td>'),R=$('<td class="text-center"></td>'),S=$('<input type="hidden" class="p_warehouse" value="'+L.val()+'" >'),j=$('<input type="hidden" class="p_product" value="'+e+'" />'),E=$("<button "+u+' class="btn btn-danger btn-xs delProduct"  data-id="'+e+'" readonly type="button"><span class="fa fa-trash"></span></button>');R.append(E).append(S).append(j),p.append(m).append(f).append(h).append(b).append(C).append(k).append(A).append(R),q.append(p),$(".p_toConsume").blur(function(){var e=$(this),t=e.attr("data-max");(e.val()>parseFloat(t)||""===e.val())&&i.showWarning({title:"Debe ingresar una cantidad menor o igual a la cantidad disponible",message:""},function(){e.select()})}),$(".delProduct").click(function(e){var a=$(this).closest("tr");i.confirm({title:"",message:"¿Está seguro que desea quitar esta artículo?",confirm:"Si",cancel:"No"},function(){var e=a.attr("data-id");a.remove(),console.log(e),z=t.reject(z,function(t){return t===parseInt(e)}),$("#LoadRecordsButtonArticle").click()}),e.preventDefault()}),_.modal("hide")}function l(){o(),m.modal("show"),v.html("Nuevo Consumo"),h.addClass("hide")}function d(){a.all("consumptions/data_form","",function(e){!t.isUndefined(e.status)&&e.status&&($("#c_warehouse_id").append('<option value="">SELECCIONE</option>'),t.each(e.warehouse,function(e){""===Y&&(Y=e.Value),$("#c_warehouse_id").append('<option value="'+e.Value+'">'+e.DisplayText+"</option>")}))},function(){d()})}function u(){var e=!0,o=[],r=[],n=!1,s=[];if(e=e&&y.required(),e=e&&E.required(),e=e&&L.required(),e=e&&w.required(),e=e&&R.required(),e&&""===q.html())return i.showWarning({title:"",message:"Debe agregar mínimo 1 artículo"}),!1;if(e){if(t.each($(".p_product"),function(e){o.push($(e).val())}),t.each($(".p_toConsume"),function(e){r.push($(e).val())}),t.each($(".p_available"),function(e){s.push($(e).html())}),$.each(s,function(e,t){parseFloat(s[e])<parseFloat(r[e])&&(n=!0),console.log(s[e]+"-"+r[e]+"\n")}),n===!0)return i.textType({title:"",message:"La cantidad ingresada debe ser menor que la cantidad disponible"}),n=!1,!1;var c={id:N.val(),date:y.val(),warehouse_id:L.val(),observation:P.val(),project_id:x.val(),requirement_id:S.val(),state_consumption:T,front_id:C.val(),product:o.join(","),toConsume:r.join(",")};i.confirm({title:"",message:"¿Estas seguro?",confirm:"Si",cancel:"No"},function(){var e=""===N.val()?0:N.val();a.updated("consumptions/saveConsumption",e,c,function(e){var a=1===T?"procesó":"guardó";!t.isUndefined(e.status)&&e.status?(i.textType({title:"",message:"El consumo  se "+a+" correctamente.",type:"success"}),m.modal("hide"),$("#LoadRecordsButtonConsumption").click()):i.textType({title:"",message:"Hubo un error al "+a+"  el consumo. Intente nuevamente.",type:"error"})})})}}function p(){G=!0;var e=getFormSearch("frm-search-project","search_project","LoadRecordsButtonProject"),t=$("#table_container_project");t.jtable({title:"Lista de Proyectos",paging:!0,sorting:!0,actions:{listAction:base_url+"/consumptions/getProjects"},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},code:{title:"Código Proyecto",width:"5%",listClass:"text-center"},description:{title:"Proyecto"},select:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_p" data-id="'+e.record.id+'" data-code="'+e.record.code+'" data-description="'+e.record.description+'"><i class="fa fa-'+icon_select+' fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_p").click(function(e){var t=$(this).attr("data-id");x.val(t),w.val($(this).attr("data-code")),k.val($(this).attr("data-description")),f.modal("hide"),S.val(""),j.val(""),e.preventDefault()})}}),generateSearchForm("frm-search-project","LoadRecordsButtonProject",function(){t.jtable("load",{search:$("#search_project").val()})},!1);var a=getFormSearch("frm-search-article","search_article","LoadRecordsButtonArticle"),i=$("#table_container_articles");i.jtable({title:"Lista de Artículos",paging:!0,sorting:!0,selecting:!0,multiselect:!0,selectingCheckboxes:!0,selectOnRowClick:!1,actions:{listAction:base_url+"/transfers/getArticlesWithWithoutProject"},toolbar:{items:[{cssClass:"buscador",text:a}]},fields:{id:{key:!0,edit:!1,create:!1,list:!1},code_article:{title:"Código",width:"2%",listClass:"text-center"},description_detail:{title:"Descripción"},average_cost:{title:"Costo",width:"2%",listClass:"text-right"},stock_p:{title:"Stock",width:"2%",listClass:"text-right"},um_id:{title:"Unidad Medida",edit:!1,create:!1,list:!1}},recordsLoaded:function(e,t){$(".jtable-selecting-column input").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click()})}}),generateSearchForm("frm-search-article","LoadRecordsButtonArticle",function(){i.jtable("load",{search:$("#search_article").val(),warehouse_id:L.val(),items:z,project_id:x.val()})},!1);var o=getFormSearch("frm-search-requirement","search_requirement","LoadRecordsButtonRequirement"),r=$("#table_container_requirements");r.jtable({title:"Lista de Requerimientos",paging:!0,sorting:!0,actions:{listAction:base_url+"/consumptions/getRequirement"},toolbar:{items:[{cssClass:"buscador",text:o}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},code:{title:"Code",width:"5%"},project_description:{title:"Proyecto",width:"30%"},requested_by:{title:"Solicitado por",list:show_list_},select:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_req" data-id="'+e.record.id+'"data-code-req="'+e.record.code+'"><i class="fa fa-circle-o fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_req").click(function(e){var t=$(this).attr("data-id"),a=$(this).attr("data-code-req");console.log(x.val()),S.val(t).removeClass("border-red"),j.val(a).removeClass("border-red"),g.modal("hide"),e.preventDefault()})}}),generateSearchForm("frm-search-requirement","LoadRecordsButtonRequirement",function(){r.jtable("load",{search:$("#search_requirement").val(),project_id:x.val()})},!1);var n=getFormSearch("frm-search-front","search_front","LoadRecordsButtonFront"),s=$("#table_container_fronts");s.jtable({title:"Lista de Frentes",paging:!0,sorting:!0,actions:{listAction:base_url+"/consumptions/listFront"},toolbar:{items:[{cssClass:"buscador",text:n}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},code:{title:"Código",width:"5%"},description:{title:"Descripción",width:"20%"},NombreEntidad:{title:"Razón Social"},select:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_fr" data-id="'+e.record.id+'"  data-code="'+e.record.code+'" data-description="'+e.record.description+'"><i class="fa fa-circle-o fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_fr").click(function(e){var t=$(this).attr("data-id"),a=$(this).attr("data-description"),i=$(this).attr("data-code");C.val(t).removeClass("border-red"),R.val(i).removeClass("border-red"),A.val(a).removeClass("border-red"),b.modal("hide"),e.preventDefault()})}}),generateSearchForm("frm-search-front","LoadRecordsButtonFront",function(){s.jtable("load",{search:$("#search_front").val()})},!1)}moment.locale("es");var m,f,v,h,_,g,b,y,C,x,k,w,A,R,S,j,L,E,P,q,D,T,N,F,M,U,O,I,B,Y=($("#reqDates"),"");e.addDetail=function(){var e=$("#table_container_articles").jtable("selectedRows");return e.length>0?void e.each(function(){var e=$(this).data("record");return parseFloat(e.stock_p)<=0||""===parseFloat(e.stock_p)||0===parseFloat(e.stock_p)||null===parseFloat(e.stock_p)||""===parseFloat(e.stock_p)?(i.showWarning({title:"",message:"El stock debe ser mayor que 0"}),!1):void s(e)}):(i.textType({title:"",message:"Debe seleccionar al menos un artículo a asignar.",type:"warning"}),!1)};var z=[];d(),e.openProject=function(){$("#LoadRecordsButtonProject").click(),f.modal("show")},e.openArticles=function(){return""===L.val()?(i.showWarning({title:"",message:"Debe seleccionar un almacén de origen"}),!1):void($(".p_warehouse").val()!==L.val()&&""!==q.html()?i.confirm({title:"",message:"¿Está seguro que desea cambiar de almacen origen?",confirm:"Si",cancel:"No"},function(){q.html(""),z=[]}):($("#LoadRecordsButtonArticle").click(),_.modal("show")))},e.openRequirements=function(){return""===x.val()?(i.textType({title:"",message:"Debe busca proyecto antes de buscar requerimiento.",type:"warning"}),!1):($("#LoadRecordsButtonRequirement").click(),
void g.modal("show"))},e.openFront=function(){$("#LoadRecordsButtonFront").click(),b.modal("show")},e.saveConsumptionProcess=function(){T=1,u()},e.saveConsumption=function(){T=0,u()};var V=getFormSearch("frm-search-consumption","search_consumption","LoadRecordsButtonConsumption"),H=$("#table_container_consumption");H.jtable({title:"Lista de Consumos",paging:!0,sorting:!0,actions:{listAction:base_url+"/consumptions/list"},toolbar:{items:[{cssClass:"buscador",text:V},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("consumptions/excel",{})}},{cssClass:"btn-success",text:'<i class="fa fa-plus"></i> Nuevo Consumo',click:function(){l()}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},date:{title:show_list_?"Fecha Consumo":"Fecha",listClass:"text-center",width:"5%"},name:{title:"Usuario",list:show_list_,width:"7%"},description_project:{title:"Proyecto"},warehouse_o:{title:"Almacén",width:"7%"},state_description:{title:"Estado",width:"3%"},edit:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return"GUARDADO"===e.record.state_description?'<a href="javascript:void(0)" title="Editar" class="edit_r" data-code="'+e.record.id+'"><i class="fa fa-pencil-square-o fa-1-5x fa-green"></i></a><a href="javascript:void(0)" title="Eliminar" class="delete_r" data-code="'+e.record.id+'"><i class="fa fa-trash fa-1-5x fa-red"></i></a>':'<a href="javascript:void(0)" title="Ver" class="edit_r" data-code="'+e.record.id+'"><i class="fa fa-eye fa-1-5x fa-green"></i></a>'}}},recordsLoaded:function(e,t){$(".edit_r").click(function(e){var t=$(this).attr("data-code");n(t),e.preventDefault()})}}),generateSearchForm("frm-search-consumption","LoadRecordsButtonConsumption",function(){H.jtable("load",{search:$("#search_consumption").val()})},!0);var G=!1}function t(e,t){e.state("consumptions",{url:"/consumptions",templateUrl:base_url+"/templates/consumptions/base.html",controller:"ConsumptionCtrl"}),t.otherwise("/")}angular.module("sys.app.consumptions").config(t).controller("ConsumptionCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.currencys",[])}(),function(){"use strict";function e(e){var t=getFormSearch("frm-search-Currency","search_b","LoadRecordsButtonCurrency"),a=$("#table_container_currency");a.jtable({title:"Lista de Monedas",paging:!0,sorting:!0,actions:{listAction:base_url+"/currencys/list",createAction:base_url+"/currencys/create",updateAction:base_url+"/currencys/update",deleteAction:base_url+"/currencys/delete"},messages:{addNewRecord:"Nueva Moneda",editRecord:"Editar Moneda"},toolbar:{items:[{cssClass:"buscador",text:t},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("currencys/excel",{})}}]},fields:{IdMoneda:{key:!0,create:!1,edit:!1,list:!1},Moneda:{title:"Moneda"},Simbolo:{title:"Simbolo"},Equivalencia:{title:"Equivalencia"},Abreviatura:{title:"Abreviatura"},Estado:{title:"Estado",values:{I:"Inactivo",A:"Activo"},type:"checkbox",listClass:"text-center",defaultValue:"A"}},formCreated:function(e,t){t.form.find('input[name="Moneda"]').attr("onkeypress","return soloLetras(event)")},formSubmitting:function(e,t){var a=!0;return a=a&&t.form.find('input[name="Moneda"]').required()}}),generateSearchForm("frm-search-Currency","LoadRecordsButtonCurrency",function(){a.jtable("load",{search:$("#search_b").val()})},!0)}function t(e,t){e.state("currencys",{url:"/currencys",templateUrl:base_url+"/templates/currencys/base.html",controller:"CurrencyCtrl"}),t.otherwise("/")}angular.module("sys.app.currencys").config(t).controller("CurrencyCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope"]}(),function(){"use strict";angular.module("sys.app.customers",[])}(),function(){"use strict";function e(e,t,a,i){function o(){p.html("Nuevo Cliente"),u.modal("show");var e="xxxxx";n(e)}function r(e){p.html("Editar Cliente"),a.get("customers/find",e,function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.data;_.val(a[0].tipodoc).trigger("change"),g.val(a[0].razonsocial_cliente),b.val(a[0].documento),y.val(a[0].contacto),C.val(a[0].direccion),x.val(a[0].correo_electronico),k.val(a[0].celular),w.val(a[0].telefono),A.val(a[0].id),h.val(a[0].id_tipocli).trigger("change"),n(a[0].cDepartamento),s(a[0].cProvincia,a[0].cDepartamento),c(a[0].cCodUbigeo,a[0].cProvincia),u.modal("show"),console.log(a)}else i.textType({title:"",message:"Hubo un error al obtener el Cliente. Intente nuevamente.",type:"error"})})}function n(e){var o="0";a.get("shops/TraerDepartamentos",o,function(a){if(!t.isUndefined(a.status)&&a.status){a.data;m.html(""),m.append('<option value="" >Seleccione</option>'),t.each(a.data,function(t){t.cDepartamento==e?m.append('<option value="'+t.cDepartamento+'" selected >'+t.cDepartamento+"</option>"):m.append('<option value="'+t.cDepartamento+'" >'+t.cDepartamento+"</option>")})}else i.textType({title:"",message:"Hubo un error al obtener el Artículo. Intente nuevamente.",type:"error"})})}function s(e,o){a.get("shops/TraerProvincias",o,function(a){if(!t.isUndefined(a.status)&&a.status){var o=a.data;console.log(o),f.html(""),f.append('<option value="" >Seleccione</option>'),t.each(a.data,function(t){t.cProvincia==e?f.append('<option value="'+t.cProvincia+'" selected>'+t.cProvincia+"</option>"):f.append('<option value="'+t.cProvincia+'">'+t.cProvincia+"</option>")})}else i.textType({title:"",message:"Hubo un error . Intente nuevamente.",type:"error"})})}function c(e,o){a.get("shops/TraerDistritos",o,function(a){if(!t.isUndefined(a.status)&&a.status){var o=a.data;console.log(o),v.html(""),v.append('<option value="" >Seleccione</option>'),t.each(a.data,function(t){t.cCodUbigeo==e?v.append('<option value="'+t.cCodUbigeo+'" selected>'+t.cDistrito+"</option>"):v.append('<option value="'+t.cCodUbigeo+'">'+t.cDistrito+"</option>")})}else i.textType({title:"",message:"Hubo un error al obtener el Artículo. Intente nuevamente.",type:"error"})})}function l(){cleanRequired(),p.html(""),_.val("01").trigger("change"),h.val("").trigger("change"),g.val(""),b.val(""),y.val(""),C.val(""),x.val(""),k.val(""),w.val(""),A.val(""),m.val(""),f.val(""),v.val(""),f.html(""),v.html("")}function d(){a.all("customers/data_form","",function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.tipoc_doc,i=e.tipo_clie;a.map(function(e){_.append('<option value="'+e.Codigo+'">'+e.TipoDocumento+"</option>")}),h.append('<option value="">Seleccionar</option>'),i.map(function(e){h.append('<option value="'+e.id+'">'+e.descripcion+"</option>")})}},function(){d()})}var u=$("#modaClientes"),p=$("#titleModalClientes"),m=$("#departamento"),f=$("#provincia"),v=$("#distrito"),h=$("#id_tipocli"),_=$("#tipodoc"),g=$("#razonsocial_cliente"),b=$("#documento"),y=$("#contacto"),C=$("#direccion"),x=$("#correo_electronico"),k=$("#celular"),w=$("#telefono"),A=$("#cliente_id");e.chkState=function(){var e=w_state.prop("checked")?"Activo":"Inactivo";state_state.html(e)};var R=getFormSearch("frm-search-Customer","search_b","LoadRecordsButtonCustomer"),S=$("#table_container_Customer");m.change(function(){var e="xxxxxx",t=m.val();s(e,t)}),f.change(function(){var e="xxxxxx",t=f.val();c(e,t)}),u.on("hidden.bs.modal",function(e){l()}),e.saveCliente=function(){var e=!0;if(e=e&&_.required(),e=e&&h.required(),e=e&&g.required(),e=e&&b.required(),e=e&&k.required(),e=e&&v.required(),"01"==_.val()&&8!=b.val().length&&(i.textType({title:"",message:"Longitud de LE/DNI INCORRECTA",type:"info"}),e=!1),"06"==_.val()&&11!=b.val().length&&(i.textType({title:"",message:"Longitud de RUC INCORRECTA",type:"info"}),e=!1),e){var o={tipodoc:_.val(),razonsocial_cliente:g.val(),documento:b.val(),contacto:y.val(),direccion:C.val(),correo_electronico:x.val(),celular:k.val(),telefono:w.val(),distrito:v.val(),id_tipocli:h.val()},r=""===A.val()?0:A.val();a.updated("customers/createCliente",r,o,function(e){if(!t.isUndefined(e.status)&&e.status)u.modal("hide"),LoadRecordsButtonCustomer.click();else{var a=t.isUndefined(e.message)?"No se pudo guardar el Cliente. Intente nuevamente.":e.message;i.textType({title:"",message:a,type:"info"})}})}},d(),S.jtable({title:"Lista de Clientes",paging:!0,sorting:!0,actions:{listAction:base_url+"/customers/list",deleteAction:base_url+"/customers/delete"},messages:{addNewRecord:"Nuevo Cliente",editRecord:"Editar Cliente"},toolbar:{items:[{cssClass:"buscador",text:R},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("customers/excel",{})}},{cssClass:"btn-danger-admin",text:'<i class="fa fa-plus"></i> Nuevo Cliente',click:function(){o()}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},tipodoc:{title:"Tipo Documento",options:base_url+"/customers/getTipoDocumento"},id_tipocli:{title:"Tipo Cliente",options:base_url+"/customers/getTipoCliente"},documento:{title:"Documento"},razonsocial_cliente:{title:"Razon Social"},contacto:{title:"Contacto"},direccion:{title:"Dirección"},correo_electronico:{title:"Correo"},celular:{title:"Celular"},ubigeo:{title:"Distrito",options:base_url+"/shops/getDistrito"},edit:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" class="edit-Cliente" data-id="'+e.record.id+'" title="Editar"><i class="fa fa-edit fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".edit-Cliente").click(function(e){var t=$(this).attr("data-id");r(t),e.preventDefault()})},formCreated:function(e,t){t.form.find('input[name="Categoria"]').attr("onkeypress","return soloLetras(event)"),$("#Edit-estado").parent().addClass("i-checks"),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click(),"A"==e.target.value?($("#Edit-estado").val("I"),$(".i-checks span").text("Inactivo")):($("#Edit-estado").val("A"),$(".i-checks span").text("Activo"))})},formSubmitting:function(e,t){var a=!0;return a=a&&t.form.find('input[name="Categoria"]').required(),a=a&&t.form.find('input[name="tipodoc"]').required(),a=a&&t.form.find('input[name="documento"]').required(),a=a&&t.form.find('input[name="razonsocial_cliente"]').required()}}),generateSearchForm("frm-search-Customer","LoadRecordsButtonCustomer",function(){S.jtable("load",{search:$("#search_b").val()})},!0)}function t(e,t){e.state("customers",{url:"/customers",templateUrl:base_url+"/templates/customers/base.html",controller:"CustomerCtrl"}),t.otherwise("/")}angular.module("sys.app.customers").config(t).controller("CustomerCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.departures",[])}(),function(){"use strict";function e(e,t,a,i){function o(){q||(f=$("#modalD"),v=$("#modalProduct"),h=$("#title-dep"),k=$("#product_detail"),_=$("#d_departure_id"),g=$("#d_departure_date"),b=$("#d_user_id"),y=$("#d_name"),C=$("#d_warehouse_id"),x=$("#d_observation"),w=0,R=$("#d_button_saveProcess"),S=$("#d_button_save"),A=$("#d_button_article"),g.datepicker({changeMonth:!0,changeYear:!0,dateFormat:"dd/mm/yy",beforeShow:function(){setTimeout(function(){$(".ui-datepicker").css("z-index",2052)})}}),v.on("hidden.bs.modal",function(e){f.attr("style","display:block;")}),v.on("show.bs.modal",function(e){f.attr("style","display:block; z-index:2030 !important")}),f.on("hidden.bs.modal",function(e){r()}),p()),C.select2(),y.val(user_default)}function r(){cleanRequired(),h.html(""),_.val(""),g.val("").prop("disabled",!1),C.val(j).prop("disabled",!1),x.val(""),k.html(""),L=[],R.prop("disabled",!1),S.prop("disabled",!1),A.prop("disabled",!1)}function n(){a.all("departures/data_form","",function(e){!t.isUndefined(e.status)&&e.status&&t.each(e.warehouse,function(e){""===j&&(j=e.Value),$("#d_warehouse_id").append('<option value="'+e.Value+'">'+e.DisplayText+"</option>")})},function(){n()})}function s(){o(),f.modal("show"),h.html("Nueva Salida")}function c(e){o(),h.html("Editar Salida"),a.get("departures/find",e,function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.data;_.val(a.id),g.val(a.departure_date),C.val(a.warehouse_id).trigger("change"),x.val(a.observation),f.modal("show"),t.each(a.product,function(e){l(e)}),"1"===a.state_departure&&(g.prop("disabled",!0),C.prop("disabled",!0),S.prop("disabled",!0),R.prop("disabled",!0),A.prop("disabled",!0))}else i.textType({title:"",message:"Hubo un error al obtener  el ingreso. Intente nuevamente.",type:"error"})})}function l(e){t.contains(L,e.id)||(u(e.id,e.code_article,e.description_detail,e.price,e.quantity,e.stock_p,e.state_departure),L.push(e.id))}function d(){var e=!0;if(e=e&&g.required(),e=e&&C.required(),e&&""===k.html())return i.showWarning({title:"",message:"Debe agregar mínimo 1 artículo"}),!1;if(e){var o=[],r=[],n=[],s=[],c=!1;if(t.each($(".p_product"),function(e){o.push($(e).val())}),t.each($(".p_price"),function(e){r.push($(e).val())}),t.each($(".p_departures"),function(e){n.push($(e).val())}),t.each($(".p_available"),function(e){s.push($(e).val())}),$.each(s,function(e,t){parseFloat(s[e])<parseFloat(n[e])&&(c=!0),console.log(s[e]+"-"+n[e]+"\n")}),c===!0)return i.textType({title:"",message:"La cantidad ingresada debe ser menor que la cantidad disponible"}),c=!1,!1;var l={id:_.val(),departure_date:g.val(),warehouse_id:C.val(),observation:x.val(),product:o.join(","),price:r.join(","),departures:n.join(","),state_departure:w};i.confirm({title:"",message:"¿Estas seguro?",confirm:"Si",cancel:"No"},function(){var e=""===_.val()?0:_.val();a.updated("departures/saveDeparture",e,l,function(e){var a=1===w?"procesó":"guardó";!t.isUndefined(e.status)&&e.status?(i.textType({title:"",message:"La salida se "+a+" correctamente.",type:"success"}),f.modal("hide"),LoadRecordsButtonDeparture.click()):i.textType({title:"",message:"Hubo un error al "+a+" la salida. Intente nuevamente.",type:"error"})})})}}function u(e,a,o,r,n,s,c){if($("#tr_p_"+e).length>0)return i.showWarning({title:"",message:"Ya se asigno este artículo"}),!1;var l,d,u=$('<tr data-id="'+e+'"></tr>'),p=$("<td>"+a+"</td>"),m=$("<td>"+o+"</td>"),f=$('<td  class="p_available" style="display: none">'+s+"</td>"),h=t.isNull(r)?".00":t.isUndefined(r)?"0.0000":r,_=t.isNull(n)?"0":t.isUndefined(n)?"0":n;"1"!==c?(l=$('<td class="text-right"><input type="text" value="'+h+'" class="form-control input-xs text-right p_price" onkeypress="return validDecimals(event, this, 5)" onblur="return roundDecimals(this, 4)"></td>'),d=$('<td class="text-right"><input type="text" value="'+_+'" id="inpRow'+e+'" data-max="'+s+'" onclick="this.select()"  class="form-control input-xs text-right p_departures" onkeypress="return validDecimals(event, this, 3)" onblur="return roundDecimals(this, 2)"></td>')):(l=$('<td class="text-right"><input readonly type="text" value="'+h+'" class="form-control input-xs text-right p_price" onkeypress="return validDecimals(event, this, 5)" onblur="return roundDecimals(this, 4)"></td>'),d=$('<td class="text-right"><input readonly type="text" value="'+_+'" id="inpRow'+e+'" data-max="'+s+'" onclick="this.select()"  class="form-control input-xs text-right p_departures" onkeypress="return validDecimals(event, this, 3)" onblur="return roundDecimals(this, 2)"></td>'));var g=$('<input type="hidden" class="p_product" value="'+e+'" />');m.append(g);var b,y=$('<td class="text-center"></td>');b="1"!==c?$('<button class="btn btn-danger btn-xs delProduct" data-id="'+e+'" type="button"><span class="fa fa-trash"></span></button>'):$('<button class="btn btn-danger btn-xs delProduct" disabled data-id="'+e+'" type="button"><span class="fa fa-trash"></span></button>'),y.append(b),u.append(p).append(m).append(l).append(d).append(f).append(y),k.append(u),$(".p_departures").blur(function(){var e=$(this),t=e.attr("data-max");(e.val()>parseFloat(t)||""===e.val())&&i.showWarning({title:"Debe ingresar una cantidad menor o igual a la cantidad pedida",message:""},function(){e.select()})}),$(".delProduct").click(function(e){var a=$(this).closest("tr");i.confirm({title:"",message:"¿Está seguro que desea quitar esta artículo?",confirm:"Si",cancel:"No"},function(){var e=a.attr("data-id");console.log(e),a.remove(),L=t.reject(L,function(t){return t===parseInt(e)}),$("#LoadRecordsButtonProduct").click()}),e.preventDefault()}),v.modal("hide")}function p(){q=!0;var e=getFormSearch("frm-search-product","search_product","LoadRecordsButtonProduct"),t=$("#table_container_pr");t.jtable({title:"Lista de Artículos Disponibles",paging:!0,sorting:!0,selecting:!0,multiselect:!0,selectingCheckboxes:!0,selectOnRowClick:!1,actions:{listAction:base_url+"/departures/getArticles"},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{id:{key:!0,edit:!1,create:!1,list:!1},code_article:{title:"Código",width:"4%"},description_detail:{title:"Descripción"},average_cost:{title:"Costo",width:"2%",listClass:"text-right"},stock_p:{title:"Stock",width:"2%",listClass:"text-right"}},recordsLoaded:function(e,t){$(".jtable-selecting-column input").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click()})}}),generateSearchForm("frm-search-product","LoadRecordsButtonProduct",function(){t.jtable("load",{search:$("#search_product").val(),items:L,warehouse_id:C.val()})},!1)}function m(){$(".jtable-column-header-selecting input").prop("checked",!1).iCheck("update"),$(".jtable-row-selected").removeClass("jtable-row-selected")}moment.locale("es");var f,v,h,_,g,b,y,C,x,k,w,A,R,S,j="";e.addDetail=function(){var e=$("#table_container_pr").jtable("selectedRows"),t=0;return e.length>0?(e.each(function(){var e=$(this).data("record");return t++,parseFloat(e.stock_p)<=0||""===parseFloat(e.stock_p)||0===parseFloat(e.stock_p)||null===parseFloat(e.stock_p)||""===parseFloat(e.stock_p)?(i.showWarning({title:"",message:" El stock debe ser mayor que 0"}),!1):void l(e)}),void m()):(i.textType({title:"",message:"Debe seleccionar al menos un artículo a asignar.",type:"warning"}),!1)},n();var L=[];e.saveDepartureProcess=function(){w=1,d()},e.saveDeparture=function(){w=0,d()},e.openProducts=function(){$("#LoadRecordsButtonProduct").click(),v.modal("show")};var E=getFormSearch("frm-search-departure","search_departure","LoadRecordsButtonDeparture"),P=$("#table_container_departure");P.jtable({title:"Lista de Salidas",paging:!0,sorting:!0,actions:{listAction:base_url+"/departures/list"},toolbar:{items:[{cssClass:"buscador",text:E},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("departures/excel",{})}},{cssClass:"btn-success",text:'<i class="fa fa-plus"></i> Nuevo Ingreso',click:function(){s()}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},departure_date:{title:show_list_?"Fecha Salida":"Fech Salida",listClass:"text-center",width:"4%",sorting:!0},warehouse_d:{title:"Almacén",sorting:!0},name:{title:"Usuario",list:show_list_,width:"5%",sorting:!0},state_description:{title:"Estado",width:"2%",sorting:!0},edit:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return"GUARDADO"===e.record.state_description?'<a href="javascript:void(0)" title="Editar" class="edit_r" data-code="'+e.record.id+'"><i class="fa fa-pencil-square-o fa-1-5x fa-green"></i></a><a href="javascript:void(0)" title="Eliminar" class="delete_r" data-code="'+e.record.id+'"><i class="fa fa-trash fa-1-5x fa-red"></i></a>':'<a href="javascript:void(0)" title="Ver" class="edit_r" data-code="'+e.record.id+'"><i class="fa fa-eye fa-1-5x fa-green"></i></a>'}}},recordsLoaded:function(e,t){$(".edit_r").click(function(e){var t=$(this).attr("data-code");c(t),e.preventDefault()})}}),generateSearchForm("frm-search-departure","LoadRecordsButtonDeparture",function(){P.jtable("load",{search:$("#search_departure").val()})},!0);var q=!1}function t(e,t){e.state("departures",{url:"/departures",templateUrl:base_url+"/templates/departures/base.html",controller:"DepartureCtrl"}),t.otherwise("/")}angular.module("sys.app.departures").config(t).controller("DepartureCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.direct_billing",[])}(),function(){"use strict";function e(e,t){function a(){i=$("#modalDB"),o=$("#titleDB")}moment.locale("es");var i,o,r=moment().startOf("month"),n=moment().endOf("month"),s=$("#reqDates"),c=function(e,t){s.find("span").html(e.format("MMM D, YYYY")+" - "+t.format("MMM D, YYYY"))};s.daterangepicker({startDate:r,endDate:n,opens:"left",showDropdowns:!0,alwaysShowCalendars:!0,showCustomRangeLabel:!1,ranges:{Hoy:[moment(),moment()],Ayer:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Últimos 7 días":[moment().subtract(6,"days"),moment()],"Últimos 30 días":[moment().subtract(29,"days"),moment()],"Este mes":[moment().startOf("month"),moment().endOf("month")],"Mes pasado":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")],"Este año":[moment().startOf("year"),moment().endOf("year")],"Año pasado":[moment().subtract(1,"year").startOf("year"),moment().subtract(1,"year").endOf("year")]},locale:{cancelLabel:"Cancelar",applyLabel:"Aplicar",daysOfWeek:["Do","Lu","Ma","Mi","Ju","Vi","Sá"],monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"]}},c),c(r,n);var l='<select id="states" class="search_input"><option value="">Todos</option><option value="">Pendiente</option><option value="">Anulado</option></select>',d='<form class="form-search" id="frm-search-db"><input type="text" id="search_db" class="input-sm search_input" name="search" autocomplete="off" placeholder="Buscar..." /><button type="button" id="LoadRecordsButtonDB" class="btn btn-success btn-sm btn-search"><i class="fa fa-search"></i></button></form>',u=$("#table_container_db");u.jtable({title:"Lista de Facturaciones Directas",paging:!0,sorting:!0,actions:{listAction:function(e,t){return{Result:"OK",Records:[{code:"00228",comprobante:"Factura",serie:"0001",numero:"0000000471",ruc:"20102708394",descripcion:"ELECTRONOROESTE SA",emision:"20/02/2017",estado:"Pendiente"},{code:"00227",comprobante:"Factura",serie:"0001",numero:"0000000470",ruc:"",descripcion:"",emision:"20/02/2017",estado:"Anulado"},{code:"00226",comprobante:"Factura",serie:"0001",numero:"0000000469",ruc:"",descripcion:"",emision:"21/02/2017",estado:"Pendiente"},{code:"00225",comprobante:"Factura",serie:"0001",numero:"0000000468",ruc:"20206018411",descripcion:"TECSUR SA",emision:"17/02/2017",estado:"Pendiente"}],TotalRecordCount:4}},deleteAction:base_url+"/direct_billing/delete"},toolbar:{items:[{cssClass:"buscador",text:l},{cssClass:"buscador",text:d},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){window.open(base_url+"/direct_billing/excel")}},{cssClass:"btn-success",text:'<i class="fa fa-plus"></i> Nueva Facturación Directa',click:function(){a(),o.html("Nueva Facturación Directa"),i.modal("show")}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},code:{title:"ID",width:"4%"},comprobante:{title:"Comprobante"},serie:{title:"Serie"},numero:{title:"Número"},ruc:{title:"Ruc",list:show_list_},descripcion:{title:"Descripción",list:show_list_},emision:{title:"Fecha Emisión",list:show_list_,listClass:"text-center"},estado:{title:"Estado",list:show_list_},edit:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return'<a href="javascript:void(0)" title="Editar" class="edit_db" data-code="'+e.record.id+'"><i class="fa fa-edit fa-1-5x fa-green"></i></a>'}}},recordsLoaded:function(e,t){$(".edit_db").click(function(e){a(),o.html("Editar Facturación Directa"),i.modal("show"),e.preventDefault()})}});var p=$("#LoadRecordsButtonDB");p.click(function(e){e.preventDefault(),u.jtable("load",{search:$("#search_db").val()})}),p.click(),$("#frm-search-db").submit(function(e){e.preventDefault(),p.click()})}function t(e,t){e.state("direct_billing",{url:"/direct_billing",templateUrl:base_url+"/templates/direct_billing/base.html",controller:"DirectBillingCtrl"}),t.otherwise("/")}angular.module("sys.app.direct_billing").config(t).controller("DirectBillingCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.entities",[])}(),function(){"use strict";function e(e){function t(){var e=$("#Edit-is_provider").prop("checked"),t=$("#Edit-contact"),a=$("#Edit-contact_phone");t.parent().parent().removeClass("hide"),a.parent().parent().removeClass("hide"),e||(t.val("").parent().parent().addClass("hide"),a.val("").parent().parent().addClass("hide"))}function a(){var e=$("#Edit-tipo_persona"),t=$("#Edit-RazonSocial"),a=$("#Edit-Nombres"),i=$("#Edit-apellido_paterno"),o=$("#Edit-apellido_materno"),r=$("#Edit-Documento"),n=e.val();1==n?(t.parent().parent().hide(),a.parent().parent().show(),i.parent().parent().show(),o.parent().parent().show(),r.attr("maxlength","8")):(t.parent().parent().show(),a.parent().parent().hide(),i.parent().parent().hide(),o.parent().parent().hide(),r.attr("maxlength","11"))}function i(){var e=$("#Edit-tipo_persona"),t=$("#Edit-RazonSocial"),a=$("#Edit-Nombres");""==t.val()&&""==a.val()||e.prop("readonly",!0)}var o=getFormSearch("frm-search-entity","search_e","LoadRecordsButtonEntity"),r=$("#table_container_entity");r.jtable({title:"Lista de Entidades",paging:!0,sorting:!0,actions:{listAction:base_url+"/entities/list",createAction:base_url+"/entities/create",updateAction:base_url+"/entities/update",deleteAction:base_url+"/entities/delete"},messages:{addNewRecord:"Nueva Entidad",editRecord:"Editar Entidad"},toolbar:{items:[{cssClass:"buscador",text:o},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("entities/excel",{})}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},Documento:{title:"Documento",width:"2%",listClass:"text-center"},nombre_entidad:{title:"Nombre/Razón Social",create:!1,edit:!1},apellido_paterno:{title:"Apellido Paterno",list:!1},apellido_materno:{title:"Apellido Materno",list:!1},Nombres:{title:"Nombre",list:!1},RazonSocial:{title:"Razón Social",list:!1},direccion_legal:{title:"Dirección Legal",list:show_list_},tipo_documento_identidad:{title:"Tipo Doc. Ident.",options:base_url+"/entities/getTypeDocumentIdentity",list:show_list_},tipo_persona:{title:"Tipo Persona",options:base_url+"/entities/getTypePerson",width:"5%",list:show_list_},is_client:{title:"Cliente",type:"checkbox",values:{0:"",1:""},defaultValue:1,list:!1},is_provider:{title:"Proveedor",type:"checkbox",values:{0:"",1:""},defaultValue:1,list:!1},contact:{title:"Contacto",list:!1},contact_phone:{title:"Teléfono de Contacto",list:!1}},recordUpdated:function(e,t){LoadRecordsButtonEntity.click()},formCreated:function(e,o){$("#div_tipo_persona").remove(),$("#div_tipo_documento_identidad").remove(),$(".jtable-dialog-form").find(".mensajes_validador").addClass("messages_validator"),$("#Edit-tipo_documento_identidad").parent().parent().attr("id","div_tipo_documento_identidad").insertAfter(".messages_validator"),$("#Edit-tipo_persona").parent().parent().attr("id","div_tipo_persona").insertAfter(".messages_validator"),o.form.find('select[name="tipo_persona"]').change(function(){a()}),$("#Edit-is_client").parent().addClass("i-checks"),$("#Edit-is_provider").parent().addClass("i-checks"),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click(),t()}),o.form.find('input[name="Nombres"]').attr("onkeypress","return soloLetras(event)"),o.form.find('input[name="apellido_paterno"]').attr("onkeypress","return soloLetras(event)"),o.form.find('input[name="apellido_materno"]').attr("onkeypress","return soloLetras(event)"),o.form.find('input[name="RazonSocial"]').attr("onkeypress","return soloLetras(event)"),o.form.find('input[name="Documento"]').attr("onkeypress","return soloNumeros(event)"),a(),i(),t()},formClosed:function(){setTimeout(function(){$("#div_tipo_persona").remove(),$("#div_tipo_documento_identidad").remove()})},formSubmitting:function(e,t){var a=$("#Edit-tipo_persona").val(),i=!0;return 1==a?i=i&&t.form.find('input[name="Nombres"]').required():(i=i&&t.form.find('input[name="Documento"]').required(),i=i&&t.form.find('input[name="RazonSocial"]').required(),i=i&&t.form.find('input[name="direccion_legal"]').required()),i}}),generateSearchForm("frm-search-entity","LoadRecordsButtonEntity",function(){r.jtable("load",{search:$("#search_e").val()})},!0)}function t(e,t){e.state("entities",{url:"/entities",templateUrl:base_url+"/templates/entities/base.html",controller:"EntityCtrl"}),t.otherwise("/")}angular.module("sys.app.entities").config(t).controller("EntityCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope"]}(),function(){"use strict";angular.module("sys.app.entrys",[])}(),function(){"use strict";function e(e,t,a,i){function o(){q||(f=$("#modalE"),v=$("#modalProduct"),h=$("#title-ent"),_=$("#product_detail"),g=$("#e_entry_id"),b=$("#e_entry_date"),y=$("#e_user_id"),C=$("#e_name"),k=$("#e_observation"),x=$("#e_warehouse_id"),w=0,A=$("#button_saveProcess"),R=$("#button_save"),S=$("#button_article"),b.datepicker({changeMonth:!0,changeYear:!0,dateFormat:"dd/mm/yy",beforeShow:function(){setTimeout(function(){$(".ui-datepicker").css("z-index",2052)})}}),v.on("hidden.bs.modal",function(e){f.attr("style","display:block;")}),v.on("show.bs.modal",function(e){f.attr("style","display:block; z-index:2030 !important")}),f.on("hidden.bs.modal",function(e){r()}),p()),x.select2(),C.val(user_default)}function r(){cleanRequired(),h.html(""),g.val(""),b.val("").prop("disabled",!1),x.val(j).trigger("change").prop("disabled",!1),k.val(""),_.html(""),L=[],S.prop("disabled",!1),A.prop("disabled",!1),R.prop("disabled",!1)}function n(){a.all("entrys/data_form","",function(e){!t.isUndefined(e.status)&&e.status&&t.each(e.warehouse,function(e){""===j&&(j=e.Value),$("#e_warehouse_id").append('<option value="'+e.Value+'">'+e.DisplayText+"</option>")})},function(){n()})}function s(){o(),f.modal("show"),h.html("Nuevo Ingreso")}function c(e){o(),h.html("Editar Ingreso"),a.get("entrys/find",e,function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.data;g.val(a.id),b.val(a.entry_date),x.val(a.warehouse_id).trigger("change"),k.val(a.observation),f.modal("show"),t.each(a.product,function(e){l(e)}),"1"===a.state_entry&&(x.prop("disabled",!0),b.prop("disabled",!0),R.prop("disabled",!0),A.prop("disabled",!0),S.prop("disabled",!0))}else i.textType({title:"",message:"Hubo un error al obtener  el ingreso. Intente nuevamente.",type:"error"})})}function l(e){t.contains(L,e.id)||(u(e.id,e.code_article,e.description_detail,e.price,e.quantity,e.state_entry),L.push(e.id))}function d(){var e=!0;if(e=e&&b.required(),e=e&&x.required(),e&&""===_.html())return i.showWarning({title:"",message:"Debe agregar mínimo 1 artículo"}),!1;if(e){var o=[],r=[],n=[],s=[];t.each($(".p_product"),function(e){o.push($(e).val())}),t.each($(".p_price"),function(e){r.push($(e).val())}),t.each($(".p_entries"),function(e){n.push($(e).val())}),t.each($(".p_entries_before"),function(e){s.push($(e).val())});var c={id:g.val(),entry_date:b.val(),warehouse_id:x.val(),observation:k.val(),product:o.join(","),price:r.join(","),entries:n.join(","),entries_before:s.join(","),state_entry:w},l=""===g.val()?0:g.val();a.updated("entrys/saveEntry",l,c,function(e){var a=1===w?"procesó":"guardó";!t.isUndefined(e.status)&&e.status?(i.textType({title:"",message:"El Ingreso se "+a+" correctamente.",type:"success"}),f.modal("hide"),LoadRecordsButtonEntry.click()):i.textType({title:"",message:"Hubo un error al "+a+" el ingreso. Intente nuevamente.",type:"error"})})}}function u(e,a,o,r,n,s){if($("#tr_p_"+e).length>0)return i.showWarning({title:"",message:"Ya se asigno este artículo"}),!1;console.log(s);var c=$('<tr  data-id="'+e+'"></tr>'),l=$("<td>"+a+"</td>"),d=$("<td>"+o+"</td>"),u=t.isNull(r)?".00":t.isUndefined(r)?"0.0000":r,p=t.isNull(n)?"0":t.isUndefined(n)?"0":n;
if("1"!==s)var m=$('<td class="text-right"><input type="text" value="'+u+'" class="form-control input-xs text-right p_price" onkeypress="return validDecimals(event, this, 5)" onblur="return roundDecimals(this, 4)"></td>'),f=$('<td class="text-right"><input type="text" value="'+p+'" class="form-control input-xs text-right p_entries" onkeypress="return validDecimals(event, this, 3)" onblur="return roundDecimals(this, 2)"></td>');else var m=$('<td class="text-right"><input type="text" readonly  value="'+u+'" class="form-control input-xs text-right p_price" onkeypress="return validDecimals(event, this, 5)" onblur="return roundDecimals(this, 4)"></td>'),f=$('<td class="text-right"><input type="text" readonly value="'+p+'" class="form-control input-xs text-right p_entries" onkeypress="return validDecimals(event, this, 3)" onblur="return roundDecimals(this, 2)"></td>');var h=$('<input type="hidden" class="p_product" value="'+e+'" />'),g=$('<input type="hidden" class="p_entries_before" value="'+p+'" />');d.append(h).append(g);var b=$('<td class="text-center"></td>');if("1"!==s)var y=$('<button class="btn btn-danger btn-xs delProduct" data-id="'+e+'" type="button"><span class="fa fa-trash"></span></button>');else var y=$('<button disabled class="btn btn-danger btn-xs delProduct" data-id="'+e+'" type="button"><span class="fa fa-trash"></span></button>');b.append(y),c.append(l).append(d).append(m).append(f).append(b),_.append(c),$(".delProduct").click(function(e){var a=$(this).closest("tr");i.confirm({title:"",message:"¿Está seguro que desea quitar esta artículo?",confirm:"Si",cancel:"No"},function(){var e=a.attr("data-id");a.remove(),L=t.reject(L,function(t){return t===parseInt(e)}),$("#LoadRecordsButtonProduct").click()}),e.preventDefault()}),v.modal("hide")}function p(){q=!0;var e=getFormSearch("frm-search-product","search_product","LoadRecordsButtonProduct"),t=$("#table_container_pr");t.jtable({title:"Artículos Disponibles",paging:!0,sorting:!0,selecting:!0,multiselect:!0,selectingCheckboxes:!0,selectOnRowClick:!1,actions:{listAction:base_url+"/entrys/getArticles"},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{id:{key:!0,edit:!1,create:!1,list:!1},code_article:{title:"Código",width:"4%",listClass:"text-center"},description_detail:{title:"Descripción"}},recordsLoaded:function(e,t){$(".jtable-selecting-column input").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click()})}}),generateSearchForm("frm-search-product","LoadRecordsButtonProduct",function(){t.jtable("load",{search:$("#search_product").val(),items:L})},!1)}function m(){$(".jtable-column-header-selecting input").prop("checked",!1).iCheck("update"),$(".jtable-row-selected").removeClass("jtable-row-selected")}moment.locale("es");var f,v,h,_,g,b,y,C,x,k,w,A,R,S,j="";e.addDetail=function(){var e=$("#table_container_pr").jtable("selectedRows");return e.length>0?(e.each(function(){var e=$(this).data("record");l(e)}),void m()):(i.textType({title:"",message:"Debe seleccionar al menos un artículo a asignar.",type:"warning"}),!1)},n();var L=[];e.saveEntryProcess=function(){w=1,d()},e.saveEntry=function(){w=0,d()},e.openProducts=function(){$("#LoadRecordsButtonProduct").click(),v.modal("show")};var E=getFormSearch("frm-search-entry","search_entry","LoadRecordsButtonEntry"),P=$("#table_container_entry");P.jtable({title:"Lista de Ingresos",paging:!0,sorting:!0,actions:{listAction:base_url+"/entrys/list"},toolbar:{items:[{cssClass:"buscador",text:E},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("entrys/excel",{})}},{cssClass:"btn-success",text:'<i class="fa fa-plus"></i> Nuevo Ingreso',click:function(){s()}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},entry_date:{title:show_list_?"Fecha Ingreso":"Fech Ingreso",listClass:"text-center",width:"4%",sorting:!0},warehouse_e:{title:"Almacén",sorting:!0},name:{title:"Usuario",width:"5%",sorting:!0},state_description:{title:"Estado",width:"2%",sorting:!0},edit:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return"0"===e.record.state_entry?'<a href="javascript:void(0)" title="Editar" class="edit_r" data-code="'+e.record.id+'"><i class="fa fa-pencil-square-o fa-1-5x fa-green"></i></a><a href="javascript:void(0)" title="Eliminar" class="delete_r" data-code="'+e.record.id+'"><i class="fa fa-trash fa-1-5x fa-red"></i></a>':'<a href="javascript:void(0)" title="Ver" class="edit_r" data-code="'+e.record.id+'"><i class="fa fa-eye fa-1-5x fa-green"></i></a>'}}},recordsLoaded:function(e,t){$(".edit_r").click(function(e){var t=$(this).attr("data-code");c(t),e.preventDefault()})}}),generateSearchForm("frm-search-entry","LoadRecordsButtonEntry",function(){P.jtable("load",{search:$("#search_entry").val()})},!0);var q=!1}function t(e,t){e.state("entrys",{url:"/entrys",templateUrl:base_url+"/templates/entrys/base.html",controller:"EntryCtrl"}),t.otherwise("/")}angular.module("sys.app.entrys").config(t).controller("EntryCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.extends",["angular.panels"])}(),function(){"use strict";function e(e){e.add({id:"new_client",position:"right",size:"30%",templateUrl:"../../static/templates/reception/partial/extends_client.html",controller:"uiClientCtrl"})}function t(e,t){function a(){e.open("new_client","first_name"),t.CLIENT=e}function i(){e.close()}var o={show:a,close:i};return o}function a(e,t,a,i,o,r,n,s,c){function l(){t.CLIENT.close(),n.pushBroadcast("updateTemplate")}function d(){e.panelEdit=!1,e.client={},e.distrito={},e.departaments=[],e.provinces=[],e.distrits=[],e.show_ubigeo=!1}function u(t){e.client.first_name=t.first_name,e.client.last_name=t.last_name,e.client.document=t.document,e.client.phone=t.phone,e.client.email=t.email,e.client.id=t.id,e.client.observations=t.observations,s(function(){e.nationality=t.nationality,e.type_document=t.type_document,e.countrySelected=t.client_reservation.country,e.country=t.client_reservation.country;var a=t.client_reservation.ubigeo.length;a>0&&(e.departament=t.client_reservation.ubigeo[0].id),e.onChangeOrigin(e.countrySelected)},100)}d(),e.$on("onDataNewClient",function(t,a){e.result=a,s(function(){e.type_document=a.type_documents[0].id,e.nationality=a.countries[i.NATIONALITY].id,e.countrySelected=e.country=a.countries[i.NATIONALITY].id,e.show_ubigeo=!1,e.departament=void 0,0!=e.countrySelected&&e.onChangeOrigin(e.countrySelected)},100),r.isUndefined(a.current_client)||u(a.current_client),e.panelEdit=!r.isUndefined(e.client.id)}),e.onChangeOrigin=function(t){if(!r.isUndefined(t)){var a=e.result.countries.filter(function(e){return e.id==t})[0];if(!r.isUndefined(a))if(a.iso==i.ISO){var n="query=departament";o.all("ubigeos",n,function(t){e.show_ubigeo=!0,e.departaments=t.results,r.isUndefined(e.result.current_client)||s(function(){e.result.current_client.client_reservation.ubigeo.length>0&&(e.departamentSelected=e.result.current_client.client_reservation.ubigeo[0].departamento,e.onDepartamentChange(e.departamentSelected))},100)})}else e.show_ubigeo=!1,e.departament=void 0}},e.onDepartamentChange=function(t){e.districts=[],e.provinces=[];var a="query=province&departament="+t;o.all("ubigeos",a,function(t){e.provinces=t.results,r.isUndefined(e.result.current_client)||s(function(){e.result.current_client.client_reservation.ubigeo.length>0&&(e.provinceSelected=e.result.current_client.client_reservation.ubigeo[0].provincia)},100)})},e.onProvinceChange=function(t){if(!r.isNull(t)){var a="query=district&province="+t;o.all("ubigeos",a,function(t){e.districts=t.results,r.isUndefined(e.result.current_client)||s(function(){e.result.current_client.client_reservation.ubigeo.length>0&&(e.districtSelected=e.result.current_client.client_reservation.ubigeo[0].distrito)},100)})}},e.close=function(){l()},e.save=function(){e.client.nationality=e.nationality,e.client.type_document=e.type_document,e.client.country=e.country,r.isUndefined(e.client.country)&&(e.client.country=i.NATIONALITY),r.isUndefined(e.departament)?e.client.ubigeo=0:e.client.ubigeo=e.departament,console.log(e.client),o.save("clients",e.client,function(e){if(r.isUndefined(e.status)||"Error"!=e.status)n.pushBroadcast("onNewClientDetailReception",e),l();else{var t=e.message,a=t.split("['");r.isUndefined(a[1])||(t=a[1].split("']")[0]),c.showWarning({title:"",message:t})}})},e.edit=function(){e.client.nationality=e.nationality,e.client.type_document=e.type_document,e.client.country=e.country,r.isUndefined(e.departament)?e.client.ubigeo=0:e.client.ubigeo=e.departament,o.updated("clients",e.client.id,e.client,function(e){if(r.isUndefined(e.status)||"Error"!=e.status)n.pushBroadcast("onNewClientDetailReception",e),l();else{var t=e.message,a=t.split("['");r.isUndefined(a[1])||(t=a[1].split("']")[0]),c.showWarning({title:"",message:t})}})}}angular.module("sys.app.extends").config(e).constant("PANEL",{CLIENT:{}}).factory("uiClient",t).controller("uiClientCtrl",a),e.$inject=["panelsProvider"],t.$inject=["panels","PANEL"],a.$inject=["$scope","PANEL","CLIENT","EXTEND_CLIENT","RESTService","_","EventsFactory","$timeout","AlertFactory"]}(),function(){"use strict";function e(e,t,a,i){var o=(angular.element("#document_pay"),angular.element("#address_pay"),angular.element("#myModal")),r=function(){e.data_pay={vouchers:[],concepts:[],payment_methods:[],correlative:"",voucher_id:1,voucher_name:"",methods:[],price_sale:0,detail_sale:"Por consumo",check_custom:!1,is_pay_all:!0}};r(),e.showModalPay=function(){r(),n(),o.modal({backdrop:"static",keyboard:!1}),e.is_pay_all=!0,console.log(e.data_ticket),e.data_ticket.client_pay.type_document=_.isUndefined(e.data_ticket.client_pay.type_document)?1:e.data_ticket.client_pay.type_document,e.data_ticket.client_pay.document=_.isUndefined(e.data_ticket.client_pay.document)?"":e.data_ticket.client_pay.document,e.data_ticket.client_pay.address=_.isUndefined(e.data_ticket.client_pay.address)?"":e.data_ticket.client_pay.address,e.data_pay.is_pay_all=!!_.isUndefined(e.data_ticket.is_pay_all)||e.data_ticket.is_pay_all,e.data_pay.voucher_id=_.isUndefined(e.data_ticket.client_pay.type_document)||e.data_ticket.client_pay.type_document>2?0:e.data_ticket.client_pay.type_document,e.data_pay.price_sale=e.data_ticket.total,angular.element("#payClient_value").val(e.data_ticket.client_pay.label)},e.changeTypeDocument=function(){_.isNull(e.data_pay.voucher_id)&&(e.data_pay.voucher_id=1),s(),t.get("serie",e.data_pay.voucher_id,function(t){_.isUndefined(t.status)||(e.data_pay.correlative=t.correlative)})},e.changePaymentMethod=function(){1==e.data_pay.method_id?(e.data_pay.show_glosa=!1,e.data_pay.glosa=""):e.data_pay.show_glosa=!0},e.actionPay=function(){if(""==angular.element("#payClient_value").val())return a.warning("Debe ingresar el cliente que realizará el pago"),!1;if(2==e.data_pay.voucher_id){if(_.isNull(e.data_ticket.client_pay.document)||""==e.data_ticket.client_pay.document||e.data_ticket.client_pay.document.length<11)return a.warning("Debe ingresar un número de RUC válido"),!1;if(""==e.data_ticket.client_pay.address||_.isNull(e.data_ticket.client_pay.address))return a.warning("Debe ingresar la direccion del cliente"),!1}if(e.data_pay.check_custom){if(""==e.data_pay.detail_sale)return a.warning("Si va a realizar un pago personalizado debe ingresar el texto a mostrar en el comprobante"),!1;if(parseFloat(e.data_pay.price_sale)<parseFloat(e.data_ticket.total))return a.warning("Si va a realizar un pago personalizado el monto a mostrar no puede ser menor que el que debe pagar"),!1}e.data_ticket.client_pay.label=angular.element("#payClient_value").val(),(0==e.data_ticket.client_pay.is_client||_.isUndefined(e.data_ticket.client_pay.type_document_name))&&(e.data_ticket.client_pay.type_document_name="DNI");var r=0,n=!0;if(_.each(e.data_pay.methods,function(e){return _.isNull(e.amount)?(a.warning("Por favor ingrese el monto a pagar correctamente"),n=!1,!1):e.amount<=0?(a.warning("Por favor ingrese un monto que no sea menor o igual a S/ 0.00"),n=!1,!1):void(r+=e.amount)}),0==n)return!1;if(1==e.data_pay.is_pay_all&&r!=e.data_ticket.total)return a.warning("El monto a pagar no puede ser diferente al de el total"),!1;if(0==r)return a.warning("El monto a pagar no puede tener un total de S/ 0.00"),!1;if(r>e.data_ticket.total)return a.warning("El monto a pagar no puede ser mayor al monto total"),!1;var s={data_sale:e.data_ticket,voucher_id:e.data_pay.voucher_id,methods:e.data_pay.methods};e.data_ticket.subtotal=r;var c={message:"¿Está seguro que desea realizar el pago?",confirm:"Si",cancel:"No"};i.confirm(c,function(a){var r=e.data_pay.is_pay_all?"pay":"pay_reception";t.updated(r,e.data_ticket.order_id,s,function(t){_.isUndefined(t.status)||1!=t.status?i.textType({title:"",message:t.message,type:"warning"}):(o.modal("hide"),e.printTicketPay(t))})})},e.clientSelectedPay=function(t){if(!_.isUndefined(t)){var a=t.originalObject;e.$broadcast("angucomplete-alt:changeInput","payClient",a.label),e.data_ticket.client_pay=a,e.data_ticket.client_pay.is_client=!0}},e.isEmpty=function(t){""==t&&1==e.data_ticket.client_pay.is_client&&(e.data_ticket.client_pay.is_client=!1,e.data_ticket.client_pay.document="",e.data_ticket.client_pay.address="")},e.addToMethod=function(t){_.isUndefined(e.data_pay.concepts[0])||_.isUndefined(e.data_pay.payment_methods[0])||e.data_pay.methods.push({method_id:e.data_pay.payment_methods[0].id,concept_id:e.data_pay.concepts[0].id,amount:t,glosa:""})},e.removeMethod=function(t){e.data_pay.methods.splice(t,1)};var n=function(){var a=_.isUndefined(e.data_ticket.concept)?1:e.data_ticket.concept,i="concept="+a;t.all("data_payment",i,function(t){_.isUndefined(t.status)||(e.data_pay.vouchers=t.vouchers,e.data_pay.concepts=t.concepts,e.data_pay.payment_methods=t.payment_methods,e.data_pay.correlative=t.correlative,e.addToMethod(e.data_ticket.total),s())})},s=function(){var t=_.find(e.data_pay.vouchers,function(t){return t.id===e.data_pay.voucher_id});t&&(e.data_pay.voucher_name=t.description)}}function t(){return{restrict:"EA",require:"^ngModel",templateUrl:"../../static/templates/partials/modal_pay.html",controller:"ModalPayCtrl"}}angular.module("sys.app.extends").controller("ModalPayCtrl",e).directive("modalPay",t),e.$inject=["$scope","RESTService","Notify","AlertFactory"]}(),function(){"use strict";function e(e){var t=angular.element("#modalPayment");e.data_payment=[],e.showModalPayment=function(a){console.log(a),e.showTab("tab1"),e.data_payment=a,e.total_detail=0,e.total_payment=0,_.each(e.data_payment.detail,function(t){e.total_detail+=t.nights*t.price*t.quantity}),_.each(e.data_payment.payments,function(t){t.edit=!1,e.total_payment+=parseFloat(t.amount)}),t.modal({backdrop:"static",keyboard:!1})}}function t(){return{restrict:"EA",require:"^ngModel",templateUrl:"../../static/templates/partials/modal_payment.html",controller:"ModalPaymentCtrl"}}angular.module("sys.app.extends").controller("ModalPaymentCtrl",e).directive("modalPayment",t),e.$inject=["$scope"]}(),function(){"use strict";function e(e,t,a){e.list_stores=[],e.list_products=[],e.store_selected="",e.search_product="";var i=angular.element("#myModalService");e.showModalService=function(){e.list_stores=[],e.list_products=[],i.modal("show"),o()},e.changeStore=function(){r()},e.checkProduct=function(e){angular.element("#chk_product"+e.id).prop("checked")?(e.checked=!0,e.quantity=1,e.stock=e.stock-1):(e.checked=!1,e.quantity="",e.stock=e.stock_original)},e.changeQuantityProduct=function(e){if(e.is_control){var t=""==e.quantity?0:e.quantity;t>e.stock_original?(e.stock=0,e.quantity=e.stock_original):e.stock=e.stock_original-t}},e.verifyQuantityProduct=function(e){angular.element("#chk_product"+e.id).prop("checked")&&""==e.quantity&&(e.quantity=1,e.is_control&&(e.stock=e.stock_original-1))},e.addToDetailReception=function(){i.modal("hide"),a.each(e.list_products,function(t){if(t.checked&&""!=t.quantity){var a={id:t.id,description:t.description,type_expense:3,nights:1,quantity:t.quantity,quantity_orig:t.quantity,stock:t.stock_original,is_control:t.is_control,price:t.price};e.reservation.push(a)}}),e.calculateTotal()};var o=function(){t.all("stores","",function(t){a.isUndefined(t.results)||(e.list_stores=t.results,a.isUndefined(e.list_stores[0])||(e.store_selected=e.list_stores[0].id,r()))})},r=function(){if(!a.isNull(e.store_selected)){var i="store="+e.store_selected;t.all("products_store",i,function(t){a.isUndefined(t.status)||1!=t.status||(e.list_products=[],a.each(t.products,function(t){var i=a.find(e.reservation,function(e){if(e.id==t.id&&3==e.type_expense)return t.id});i||(t.checked=!1,t.quantity="",e.list_products.push(t))}))})}};e.formatNumber=function(e,t){return e=parseFloat(e),e.toFixed(t)}}function t(){return{restrict:"EA",require:"^ngModel",templateUrl:"../../static/templates/partials/modal_services.html",controller:"ModalServiceCtrl"}}angular.module("sys.app.extends").controller("ModalServiceCtrl",e).directive("modalService",t),e.$inject=["$scope","RESTService","_"]}(),function(){"use strict";function e(e,t,a){var i=angular.element("#myModalTicket");e.showModalTicket=function(t){e.modal_ticket=t,e.modal_ticket.change_prices=!!a.isUndefined(t.change_prices)||t.change_prices,i.modal({backdrop:"static",keyboard:!1})},e.removeItemModal=function(t){e.modal_ticket.data.data.splice(t,1)},e.addToModal=function(){e.modal_ticket.data.data.push({description:"",price:0})},e.print_now=function(){e.printTicketNow(),i.modal("hide")}}function t(){return{restrict:"EA",require:"^ngModel",templateUrl:"../../static/templates/partials/modal_ticket.html",controller:"ModalTicketCtrl"}}angular.module("sys.app.extends").controller("ModalTicketCtrl",e).directive("modalTicket",t),e.$inject=["$scope","RESTService","_"]}(),function(){"use strict";function e(e){e.add({id:"add_service",position:"right",size:"30%",templateUrl:"../../static/templates/reception/partial/extends_service.html",controller:"uiServiceCtrl"})}function t(e,t){function a(){e.open("add_service","first_name"),t.SERVICE=e}function i(){e.close()}var o={show:a,close:i};return o}function a(e,t,a,i,o){function r(){e.client={},e.distrito={},e.departaments=[],e.provinces=[],e.distrits=[],e.show_ubigeo=!1}r(),e.$on("onDataNewClient",function(e,t){})}angular.module("sys.app.extends").config(e).constant("PANEL",{SERVICE:{}}).factory("uiService",t).controller("uiServiceCtrl",a),e.$inject=["panelsProvider"],t.$inject=["panels","PANEL"],a.$inject=["$scope","EXTEND_CLIENT","RESTService","_","EventsFactory"]}(),function(){"use strict";angular.module("sys.app.families",[])}(),function(){"use strict";function e(e){e.chkState=function(){var e=w_state.prop("checked")?"Activo":"Inactivo";state_state.html(e)};var t=getFormSearch("frm-search-Family","search_b","LoadRecordsButtonFamily"),a=$("#table_container_Family");a.jtable({title:"Lista de Familias",paging:!0,sorting:!0,actions:{listAction:base_url+"/families/list",createAction:base_url+"/families/create",updateAction:base_url+"/families/update",deleteAction:base_url+"/families/delete"},messages:{addNewRecord:"Nueva Familia",editRecord:"Editar Familia"},toolbar:{items:[{cssClass:"buscador",text:t},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("families/excel",{})}}]},fields:{idFamilia:{key:!0,create:!1,edit:!1,list:!1},Familia:{title:"Familia"},estado:{title:"Estado",values:{I:"Inactivo",A:"Activo"},type:"checkbox",defaultValue:"A"}},formCreated:function(e,t){t.form.find('input[name="Familia"]').attr("onkeypress","return soloLetras(event)"),$("#Edit-estado").parent().addClass("i-checks"),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click(),"A"==e.target.value?($("#Edit-estado").val("I"),$(".i-checks span").text("Inactivo")):($("#Edit-estado").val("A"),$(".i-checks span").text("Activo"))})},formSubmitting:function(e,t){var a=!0;return a=a&&t.form.find('input[name="Familia"]').required()}}),generateSearchForm("frm-search-Family","LoadRecordsButtonFamily",function(){a.jtable("load",{search:$("#search_b").val()})},!0)}function t(e,t){e.state("families",{url:"/families",templateUrl:base_url+"/templates/families/base.html",controller:"FamilyCtrl"}),t.otherwise("/")}angular.module("sys.app.families").config(t).controller("FamilyCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope"]}(),function(){"use strict";angular.module("sys.app.fronts",[])}(),function(){"use strict";function e(e,t,a,i){function o(){k||(l=$("#modalFR"),u=$("#title-fre"),d=$("#modalCliente"),p=$("#code"),m=$("#description"),f=$("#detail"),v=$("#client_id"),h=$("#ruc"),_=$("#front_id"),g=$("#business_name"),b=$("#state"),y=$("#state_text"),d.on("hidden.bs.modal",function(e){l.attr("style","display:block;")}),d.on("show.bs.modal",function(e){l.attr("style","display:block; z-index:2030 !important")}),l.on("shown.bs.modal",function(e){p.focus()}),l.on("hidden.bs.modal",function(e){r()}),c(),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(t){$(t.target).click(),e.chkState()}))}function r(){cleanRequired(),u.html(""),_.val(""),v.val(""),p.val(""),m.val(""),f.val(""),g.val(""),h.val(""),b.prop("checked",!0).iCheck("update"),e.chkState()}function n(){o(),u.html("Nuevo Frente"),l.modal("show")}function s(r){o(),u.html("Editar Frente"),a.get("fronts/find",r,function(a){if(!t.isUndefined(a.status)&&a.status){var o=a.data;p.val(o.code),_.val(o.id),m.val(o.description),f.val(o.detail),b.prop("checked","1"===o.state).iCheck("update"),e.chkState(),null!==o.entity&&(v.val(o.entity_id),h.val(o.entity.Documento),g.val(o.entity.NombreEntidad)),l.modal("show")}else i.textType({title:"",message:"Hubo un error al obtener  frente. Intente nuevamente.",type:"error"})})}function c(){k=!0;var e=getFormSearch("frm-search-u","search_u","LoadRecordsButtonU"),t=$("#table_container_cliente");t.jtable({title:"Lista de Clientes",paging:!0,sorting:!0,actions:{listAction:base_url+"/fronts/listClient"},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},Documento:{title:"Documento",width:"2%"},nombre_entidad:{title:show_list_?"Razón Social/Nombres":"R.S/ Nombres"},select:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_u" data-code="'+e.record.id+'" data-doc="'+e.record.Documento+'" data-name="'+e.record.nombre_entidad+'"><i class="checks'+e.record.id+" fa fa-"+icon_select+' fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_u").click(function(e){var t=$(this).attr("data-code"),a=$(this).attr("data-doc"),i=$(this).attr("data-name");v.val(t),h.val(a),g.val(i),d.modal("hide"),e.preventDefault()})}}),generateSearchForm("frm-search-u","LoadRecordsButtonU",function(){t.jtable("load",{search:$("#search_u").val()})},!1)}var l,d,u,p,m,f,v,h,_,g,b,y;e.chkState=function(){var e=b.prop("checked")?"Activo":"Inactivo";y.html(e)},e.openClient=function(){$("#LoadRecordsButtonU").click(),d.modal("show")},e.saveFront=function(){var e=!0;if(e=e&&p.required(),e=e&&m.required(),e=e&&f.required()){var o={id:_.val(),code:p.val(),description:m.val(),detail:f.val(),entity_id:""!=v.val()?v.val():null,state:b.prop("checked")?1:0},r=""==_.val()?0:_.val();a.updated("fronts/saveFront",r,o,function(e){if(t.isUndefined(e.status)||1!=e.status){var a=t.isUndefined(e.message)?"Hubo un error al guardar frente. Intente nuevamente.":e.message;i.textType({title:"",message:a,type:"error"})}else i.textType({title:"",message:"El registro se guardó correctamente.",type:"success"}),l.modal("hide"),$("#LoadRecordsButtonFront").click()})}};var C=getFormSearch("frm-search-front","search_front","LoadRecordsButtonFront"),x=$("#table_container_front");x.jtable({title:"Lista de Frentes",paging:!0,sorting:!0,actions:{listAction:base_url+"/fronts/list",deleteAction:base_url+"/fronts/delete"},toolbar:{items:[{cssClass:"buscador",text:C},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("fronts/excel",{})}},{cssClass:"btn-success",text:'<i class="fa fa-plus"></i> Nuevo Frente',click:function(){n()}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},code:{title:"Código",width:"3%"},description:{title:"Descripción"},NombreEntidad:{title:show_list_?"Razón Social/Nombres":"R.S/ Nombres",sorting:!1},edit:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Editar" class="edit_f" data-code="'+e.record.id+'"><i class="fa fa-pencil-square-o fa-1-5x fa-green"></i></a>'}}},recordsLoaded:function(e,t){$(".edit_f").click(function(e){var t=$(this).attr("data-code");s(t),e.preventDefault()})}}),generateSearchForm("frm-search-front","LoadRecordsButtonFront",function(){x.jtable("load",{search:$("#search_front").val()})},!0);var k=!1}function t(e,t){e.state("fronts",{url:"/fronts",templateUrl:base_url+"/templates/fronts/base.html",controller:"FrontCtrl"}),t.otherwise("/")}angular.module("sys.app.fronts").config(t).controller("FrontCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.generate_purchase_orders",[])}(),function(){"use strict";function e(){}function t(e,t){e.state("generate_purchase_orders",{url:"/generate_purchase_orders",templateUrl:base_url+"/templates/generate_purchase_orders/base.html",controller:"GeneratePurchaseOrderCtrl"}),t.otherwise("/")}angular.module("sys.app.generate_purchase_orders").config(t).controller("GeneratePurchaseOrderCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=[]}(),function(){"use strict";angular.module("sys.app.generation_remisions",[])}(),function(){"use strict";function e(e){function t(){a.html("Nueva Remision"),i.modal("show")}var a=$("#titlemodalRemision"),i=$("#modalRemision");e.chkState=function(){var e=w_state.prop("checked")?"Activo":"Inactivo";state_state.html(e)};var o=getFormSearch("frm-search-Generation_Remision","search_b","LoadRecordsButtonGeneration_Remision"),r=$("#table_container_Generation_Remision");r.jtable({title:"Lista de Categorías",paging:!0,sorting:!0,actions:{listAction:base_url+"/categories/list"},messages:{addNewRecord:"Nueva Categoría",editRecord:"Editar Categoría"},toolbar:{items:[{cssClass:"buscador",text:o},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("generation_remisions/excel",{})}},{cssClass:"btn-danger-admin",text:'<i class="fa fa-plus"></i> Nueva generación remisión',click:function(){t()}}]},fields:{idCategoria:{key:!0,create:!1,edit:!1,list:!1},Categoria:{title:"Categoría"},estado:{title:"Estado",values:{I:"Inactivo",A:"Activo"},type:"checkbox",defaultValue:"A"}},formCreated:function(e,t){t.form.find('input[name="Categoria"]').attr("onkeypress","return soloLetras(event)"),$("#Edit-estado").parent().addClass("i-checks"),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click(),"A"==e.target.value?($("#Edit-estado").val("I"),$(".i-checks span").text("Inactivo")):($("#Edit-estado").val("A"),$(".i-checks span").text("Activo"))})},formSubmitting:function(e,t){var a=!0;return a=a&&t.form.find('input[name="Categoria"]').required()}}),generateSearchForm("frm-search-Generation_Remision","LoadRecordsButtonGeneration_Remision",function(){r.jtable("load",{search:$("#search_b").val()})},!0)}function t(e,t){e.state("generation_remisions",{url:"/generation_remisions",templateUrl:base_url+"/templates/generation_remisions/base.html",controller:"Generation_RemisionCtrl"}),t.otherwise("/")}angular.module("sys.app.generation_remisions").config(t).controller("Generation_RemisionCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope"]}(),function(){"use strict";angular.module("sys.app.group_cas",[])}(),function(){"use strict";function e(e){e.chkState=function(){var e=w_state.prop("checked")?"Activo":"Inactivo";state_state.html(e)};var t=getFormSearch("frm-search-Group_ca","search_b","LoadRecordsButtonGroup_ca"),a=$("#table_container_Group_ca");a.jtable({title:"Lista de Grupos",paging:!0,sorting:!0,actions:{listAction:base_url+"/group_cas/list",createAction:base_url+"/group_cas/create",updateAction:base_url+"/group_cas/update",deleteAction:base_url+"/group_cas/delete"},messages:{addNewRecord:"Nuevo Grupo",editRecord:"Editar Grupo"},toolbar:{items:[{cssClass:"buscador",text:t},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("group_cas/excel",{})}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},nombre:{title:"Grupo"},estado:{title:"Estado",values:{I:"Inactivo",A:"Activo"},type:"checkbox",defaultValue:"A"}},formCreated:function(e,t){t.form.find('input[name="Categoria"]').attr("onkeypress","return soloLetras(event)"),$("#Edit-estado").parent().addClass("i-checks"),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click(),"A"==e.target.value?($("#Edit-estado").val("I"),$(".i-checks span").text("Inactivo")):($("#Edit-estado").val("A"),$(".i-checks span").text("Activo"))})},formSubmitting:function(e,t){var a=!0;return a=a&&t.form.find('input[name="Categoria"]').required()}}),generateSearchForm("frm-search-Group_ca","LoadRecordsButtonGroup_ca",function(){a.jtable("load",{search:$("#search_b").val()})},!0)}function t(e,t){e.state("group_cas",{url:"/group_cas",templateUrl:base_url+"/templates/group_cas/base.html",controller:"Group_caCtrl"}),t.otherwise("/")}angular.module("sys.app.group_cas").config(t).controller("Group_caCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope"]}(),function(){"use strict";angular.module("sys.app.head_accountans",[])}(),function(){"use strict";function e(e,t,a,i){function o(){cleanRequired(),u.html(""),p.prop("checked",!0).iCheck("update"),m.html("Activo"),_.html(""),f.val(""),C.val(""),y.val(""),x=[]}function r(){cleanRequired(),g.val(""),b.val(""),h.val("").trigger("change")}function n(){u.html("Nuevo Grupo Contable"),d.modal("show")}function s(e,t,a,o,r){var n=$('<tr id="tr_contDetalle_'+e+'"></tr>'),s=$('<td id="tr_identO_'+r+'">'+t+"</td>"),c=$("<td>"+a+"</td>"),l=$("<td>"+o+"</td>"),d=$('<input type="hidden" class="w_idOperacion" value="'+r+'" />'),u=$('<input type="hidden" class="w_cuenta" value="'+a+'" />'),p=$('<input type="hidden" class="w_centrocosto" value="'+o+'" />');s.append(d),c.append(u),l.append(p);var m=$('<td class="text-center"></td>'),f=$('<button class="btn btn-danger btn-xs delAccoun" data-id="'+e+'" type="button"><span class="fa fa-trash"></span></button>');m.append(f),n.append(s).append(c).append(l).append(m),_.append(n),v.modal("hide"),$(".delAccoun").click(function(e){var t=$(this).attr("data-id");i.confirm({title:"",message:"¿Está seguro que desea quitar estos datos?",confirm:"Si",cancel:"No"},function(){$("#tr_contDetalle_"+t).remove(),x.push(t)}),e.preventDefault()})}function c(o){u.html("Editar Grupo Contable"),a.get("head_accountans/find",o,function(a){if(!t.isUndefined(a.status)&&a.status){var o=a.data;console.log(o),y.val(o.idGrupoContableCabecera),f.val(o.descripcion);var r="A"==o.estado;p.prop("checked",r).iCheck("update"),e.chkState(),d.modal("show"),o.GrupoDetalle!=[]&&t.each(o.GrupoDetalle,function(e){var t=String(e.idGrupoContableCabecera)+"_"+String(e.idTipoOperacion);s(t,e.operacion,e.cuenta,e.centrocosto,e.idTipoOperacion)})}else i.textType({title:"",message:"Hubo un error al obtener el Grupo Contable. Intente nuevamente.",type:"error"})})}function l(){a.all("head_accountans/data_form","",function(e){!t.isUndefined(e.status)&&e.status&&(h.append('<option value="" selected>Seleccionar</option>'),t.each(e.operacion,function(e){h.append('<option value="'+e.Value+'">'+e.DisplayText+"</option>");
}))},function(){l()})}var d=$("#modalGrupoContable"),u=$("#titleModalGrupoContable"),p=$("#p_state"),m=$("#state_text"),f=$("#grupoContable"),v=$("#modalDetalle"),h=$("#id_operacion"),_=$("#w_contable_detalle"),f=$("#grupoContable"),g=($("#grupoContableDeta"),$("#centrocosto")),b=$("#cuenta"),h=$("#id_operacion"),y=$("#grupoContable_id"),C=$("#identDetalle"),x=[];$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(t){$(t.target).click(),e.chkState()}),e.chkState=function(){var e=p.prop("checked")?"Activo":"Inactivo";m.html(e)},d.on("hidden.bs.modal",function(e){o()}),v.on("hidden.bs.modal",function(e){r()}),e.addDetalle=function(){var e=!0;e=e&&f.required(),e&&v.modal("show")},e.saveGrupoContable=function(){var e=!0;if(e=e&&f.required()){if(""===_.html())var o={idGrupoContableCabecera:y.val(),descripcion:f.val(),estado:p.prop("checked")?"A":"I",idDetalle_Delete:x};else{var r=[];$.each($(".w_idOperacion"),function(e,t){r[e]=$(t).val()}),r=r.join(",");var n=[];$.each($(".w_cuenta"),function(e,t){n[e]=$(t).val()}),n=n.join(",");var s=[];$.each($(".w_centrocosto"),function(e,t){s[e]=$(t).val()}),s=s.join(",");var o={idGrupoContableCabecera:y.val(),descripcion:f.val(),estado:p.prop("checked")?"A":"I",contable_idoperacion:r,contable_cuenta:n,contable_centrocosto:s,idDetalle_Delete:x}}var c=""===y.val()?0:y.val();a.updated("head_accountans/saveGrupoContable",c,o,function(e){if(!t.isUndefined(e.status)&&e.status)i.textType({title:"",message:"El Grupo Contable se guardó correctamente.",type:"success"}),d.modal("hide"),LoadRecordsButtonHead_Accountan.click();else{var a=t.isUndefined(e.message)?"Hubo un error al guardar el Grupo Contable. Intente nuevamente.":e.message;i.textType({title:"",message:a,type:"error"})}})}},e.AgregarTable=function(){var e=!0;if(e=e&&h.required(),e=e&&b.required(),e=e&&g.required()){var t=h.val(),a=b.val(),o=g.val(),r=$('select[name="nOperacion"] option:selected').text(),n=Math.random().toString(36).substr(2,18);if($("#tr_identO_"+t).length>0)return i.showWarning({title:"",message:"Ya se asignó esta Operación"}),!1;s(n,r,a,o,t)}},l();var k=getFormSearch("frm-search-Head_Accountan","search_b","LoadRecordsButtonHead_Accountan"),w=$("#table_container_Head_Accountan");w.jtable({title:"Lista de Grupos Contables ",paging:!0,sorting:!0,actions:{listAction:base_url+"/head_accountans/list",deleteAction:base_url+"/head_accountans/delete"},messages:{addNewRecord:"Nuevo Grupo Contable",editRecord:"Editar Grupo Contable"},toolbar:{items:[{cssClass:"buscador",text:k},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("head_accountans/excel",{})}},{cssClass:"btn-danger-admin",text:'<i class="fa fa-plus"></i> Nuevo Grupo Contable',click:function(){n()}}]},fields:{idGrupoContableCabecera:{key:!0,create:!1,edit:!1,list:!1},grupocontcab:{title:"Grupo Contable ",listClass:"text-center"},estado:{title:"Estado",values:{I:"Inactivo",A:"Activo"},type:"checkbox",listClass:"text-center",defaultValue:"A"},edit:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Editar" class="edit_cont" data-code="'+e.record.idGrupoContableCabecera+'"><i class="fa fa-pencil-square-o fa-1-5x fa-green"></i></a>'}}},recordsLoaded:function(e,t){$(".edit_cont").click(function(e){var t=$(this).attr("data-code");c(t),e.preventDefault()})}}),generateSearchForm("frm-search-Head_Accountan","LoadRecordsButtonHead_Accountan",function(){w.jtable("load",{search:$("#search_b").val()})},!0)}function t(e,t){e.state("head_accountans",{url:"/head_accountans",templateUrl:base_url+"/templates/head_accountans/base.html",controller:"Head_AccountanCtrl"}),t.otherwise("/")}angular.module("sys.app.head_accountans").config(t).controller("Head_AccountanCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.home",[])}(),function(){"use strict";function e(){}function t(e,t){e.state("home",{url:"/home",templateUrl:base_url+"/templates/home/base.html",controller:"HomeCtrl"}),t.otherwise("/")}angular.module("sys.app.home").config(t).controller("HomeCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=[]}(),function(){"use strict";angular.module("sys.app.list_precios",[])}(),function(){"use strict";function e(e,t,a,i){function o(){cleanRequired(),x.html(""),p.val(""),m.val("").trigger("change"),f.val("").trigger("change"),v.val(""),h.val(""),_.val(""),b.html(""),v.val(""),g.val("").trigger("change"),w.prop("disabled",!0),R.prop("disabled",!1),k=[]}function r(){C.modal("show"),x.html("Nuevo Lista de Precios")}function n(e){x.html("Editar Lista de Precios"),a.get("list_precios/find",e,function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.data;g.val(a.iEstado),p.val(a.descripcion),m.val(a.id_tpocli).trigger("change"),f.val(a.moneda).trigger("change"),v.val(a.id),h.val(a.dFecVigIni),_.val(a.dFecVigFin),t.each(a.productos,function(e){var t=Number(e.nPrecio);l(e.idProducto,e.descripcion,t.toFixed(2),e.idProducto)}),0==a.iEstado?(R.prop("disabled",!1),w.prop("disabled",!1),g.val(a.iEstado).trigger("change")):R.prop("disabled",!0),C.modal("show")}else i.textType({title:"",message:"Hubo un error al obtener la lista. Intente nuevamente.",type:"error"})})}function s(){a.all("customers/data_form","",function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.tipo_clie;m.append('<option value="">Seleccionar</option>'),a.map(function(e){m.append('<option value="'+e.id+'">'+e.descripcion+"</option>")})}},function(){s()})}function c(){a.all("orden_servicios/data_form","",function(e){!t.isUndefined(e.status)&&e.status&&(f.append('<option value="">Seleccionar</option>'),t.each(e.moneda,function(e){f.append('<option value="'+e.IdMoneda+'">'+e.Descripcion+"</option>")}))},function(){c()})}function l(e,t,a,o){if($("#tr_b_"+e).length>0)return i.showWarning({title:"",message:"Ya se asignó este Producto"}),!1;var r=$('<tr id="tr_b_'+e+'"></tr>'),n=$("<td>"+t+"</td>"),s=$("<td></td>"),c=$('<input type="hidden" class="w_idProducto" value="'+o+'" />'),l=$('<input type="number"  class="form-control input-sm w_precio" value="'+a+'"/>');n.append(c),s.append(l);var d=$('<td class="text-center"></td>'),u=$('<button class="btn btn-danger btn-xs delProducto" data-id="'+e+'" type="button"><span class="fa fa-trash"></span></button>');d.append(u),r.append(n).append(s).append(d),b.append(r),y.modal("hide"),$(".delProducto").click(function(e){var t=$(this).attr("data-id");i.confirm({title:"",message:"¿Está seguro que desea quitar este Producto?",confirm:"Si",cancel:"No"},function(){$("#tr_b_"+t).remove(),k.push(t)}),e.preventDefault()})}function d(){var e=getFormSearch("frm-search-producto","search_producto","LoadRecordsButtonProducto"),t=$("#table_container_p");t.jtable({title:"Lista de Productos",paging:!0,sorting:!0,actions:{listAction:base_url+"/articles/getProductosServicio"},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{id:{title:"Código",width:"5%",key:!0,create:!1,edit:!1,list:!1},code_article:{title:"Código"},description:{title:"Producto"},select:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_p"  data-name="'+e.record.description+'" data-code="'+e.record.id+'" ><i class="fa fa-'+icon_select+' fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_p").click(function(e){var t=$(this).attr("data-code"),a=$(this).attr("data-name"),i=0;l(t,a,i,t),e.preventDefault()})}}),generateSearchForm("frm-search-producto","LoadRecordsButtonProducto",function(){t.jtable("load",{search:$("#search_producto").val()})},!1)}var u=$("#modalDeleteListaPrecio"),p=$("#descripcion"),m=$("#id_tipocli"),f=$("#IdMoneda"),v=$("#lista_id"),h=$("#dFecVigIni"),_=$("#dFecVigFin"),g=$("#iEstado"),b=$("#p_table_productos"),y=$("#modalProducto"),C=$("#modalPrecios"),x=$("#titlemodalPrecios"),k=[],w=$("#btn_aprobar"),A=$("#idPrecioDelete"),R=$("#btn_guardar_precios");C.on("hidden.bs.modal",function(e){o()}),e.chkState=function(){var e=w_state.prop("checked")?"Activo":"Inactivo";state_state.html(e)},e.openProducto=function(){$("#LoadRecordsButtonProducto").click(),y.modal("show")},e.Aprobar_precios=function(){var e=v.val();a.get("list_precios/aprobarPrecio",e,function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.data;1==a.iEstado&&(w.prop("disabled",!0),R.prop("disabled",!0),g.val(1).trigger("change")),LoadRecordsButtonList_precio.click()}else i.textType({title:"",message:"Hubo un error al obtener la lista. Intente nuevamente.",type:"error"})})},e.savePrecios=function(){var e=!0;if(e=e&&p.required(),e=e&&m.required(),e=e&&f.required(),e=e&&h.required(),e=e&&_.required(),e&&""===b.html())return i.showWarning({title:"",message:"Debe agregar mínimo 1 producto para la lista"}),!1;var o=[];$.each($(".w_idProducto"),function(e,t){o[e]=$(t).val()}),o=o.join(",");var r=[],n="I";if($.each($(".w_precio"),function(e,t){r[e]=$(t).val(),0!=$(t).val()&&""!=$(t).val()||(i.showWarning({title:"",message:"El precio no puede ser 0"}),n="A")}),r=r.join(","),"A"==n&&(e=!1),e){var s={descripcion:p.val(),id_tpocli:m.val(),IdMoneda:f.val(),dFecVigIni:h.val(),dFecVigFin:_.val(),idProducto:o,nPrecio:r,idDetalle_Delete:k},c=""===v.val()?0:v.val();a.updated("list_precios/savePrecios",c,s,function(e){if(!t.isUndefined(e.status)&&e.status)console.log(e.data),i.textType({title:"",message:"La lista se guardó correctamente.",type:"success"}),g.val(0).trigger("change"),v.val(e.id),w.prop("disabled",!1),LoadRecordsButtonList_precio.click();else{var a=t.isUndefined(e.message)?"No se pudo guardar la lista. Intente nuevamente.":e.message;i.textType({title:"",message:a,type:"info"})}})}},s(),c(),d(),e.eliminarPrecios=function(){var e=A.val();console.log(e),a.get("list_precios/delete",e,function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.elim;console.log(a),"A"==a?(i.textType({title:"",message:"Solo se puede eliminar Listas en estado Registrado",type:"info"}),u.modal("hide")):(i.textType({title:"",message:"El registro se eliminó correctamente",type:"success"}),u.modal("hide"),LoadRecordsButtonList_precio.click())}})};var S=getFormSearch("frm-search-List_precio","search_b","LoadRecordsButtonList_precio"),j=$("#table_container_List_precio");j.jtable({title:"Lista de Precios",paging:!0,sorting:!0,actions:{listAction:base_url+"/list_precios/list"},messages:{addNewRecord:"Nueva Categoría",editRecord:"Editar Categoría"},toolbar:{items:[{cssClass:"buscador",text:S},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("list_precios/excel",{})}},{cssClass:"btn-danger-admin",text:'<i class="fa fa-plus"></i> Nueva Lista',click:function(){r()}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},descripcion:{title:"Descripcion"},id_tpocli:{title:"Tipo Cliente",options:base_url+"/customers/getTipoCliente"},IdMoneda:{title:"Moneda",options:base_url+"/type_change/getMonedas"},dFecVigIni:{title:"Fecha Inicio ",width:"20%",sorting:!1,display:function(e){return moment(e.record.dFecVigIni).format("DD/MM/YYYY")}},dFecVigFin:{title:"Fecha Fin",width:"20%",sorting:!1,display:function(e){return moment(e.record.dFecVigFin).format("DD/MM/YYYY")}},iEstado:{title:"Estado",values:{0:"Registrado",1:"Aprobado",2:"Vencido"},type:"checkbox",defaultValue:"0"},edit:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Editar" class="edit_w" data-code="'+e.record.id+'"><i class="fa fa-pencil-square-o fa-1-5x fa-green"></i></a>'}},Eliminar:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a data-target="#"  data-ide="'+e.record.id+'"   title="Eliminar" class="jtable-command-button eliminar-precio"><i class="fa fa-trash fa-1-5x fa-red"><span>Eliminar</span></i></a>'}}},recordsLoaded:function(e,t){$(".edit_w").click(function(e){var t=$(this).attr("data-code");n(t),e.preventDefault()}),$(".eliminar-precio").click(function(e){var t=$(this).attr("data-ide");A.val(t),u.modal("show"),e.preventDefault()})},formCreated:function(e,t){t.form.find('input[name="Categoria"]').attr("onkeypress","return soloLetras(event)"),$("#Edit-estado").parent().addClass("i-checks"),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click(),"A"==e.target.value?($("#Edit-estado").val("I"),$(".i-checks span").text("Inactivo")):($("#Edit-estado").val("A"),$(".i-checks span").text("Activo"))})},formSubmitting:function(e,t){var a=!0;return a=a&&t.form.find('input[name="Categoria"]').required()}}),generateSearchForm("frm-search-List_precio","LoadRecordsButtonList_precio",function(){j.jtable("load",{search:$("#search_b").val()})},!0)}function t(e,t){e.state("list_precios",{url:"/list_precios",templateUrl:base_url+"/templates/list_precios/base.html",controller:"List_precioCtrl"}),t.otherwise("/")}angular.module("sys.app.list_precios").config(t).controller("List_precioCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.lots",[])}(),function(){"use strict";function e(e,t,a,i){function o(){cleanRequired(),m.html(""),c.val(""),l.val(""),d.val(""),u.val(""),p.val(""),v.val(""),_.val(""),h.addClass("hide")}function r(){m.html("Nuevo Lote"),$("#cantidad").attr("onkeypress","return soloNumeros(event)"),s.modal("show")}function n(e){m.html("Editar Lote"),a.get("lots/find",e,function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.data;c.val(a[0].idArticulo),l.val(a[0].Lote),d.val(a[0].fechaIngreso),u.val(a[0].cantidad),p.val(a[0].fechaVencimiento),v.val(a[0].description),_.val(a[0].idLote),s.modal("show")}else i.textType({title:"",message:"Hubo un error al obtener el Lote. Intente nuevamente.",type:"error"})})}var s=$("#modalLote"),c=$("#p_product_id"),l=$("#lote"),d=$("#fech_ingreso"),u=$("#cantidad"),p=$("#fecha_vencimiento"),m=$("#titleModalLote"),f=$("#modalArticulo"),v=$("#p_product_name"),h=$("#msg_cont"),_=$("#lote_id");s.on("hidden.bs.modal",function(e){o()}),e.type_cc="",e.openCC=function(t){e.type_cc=t,f.modal("show"),$("#search_cc2").val(""),$("#LoadRecordsButtonCC2").click()},e.clearCC=function(e){c.val(""),v.val("")},e.saveLote=function(){h.addClass("hide");var e=!0;if(e=e&&c.required(),!e)return h.removeClass("hide"),!1;if(e=e&&l.required(),e=e&&u.required(),e=e&&d.required(),e=e&&p.required()){var o={producto:c.val(),lote:l.val(),cantidad:u.val(),fech_ingreso:d.val(),fecha_vencimiento:p.val()},r=""===_.val()?0:_.val();a.updated("lots/createLote",r,o,function(e){!t.isUndefined(e.status)&&e.status?(s.modal("hide"),LoadRecordsButtonLot.click()):i.textType({title:"",message:"Hubo un error al guardar el Lote. Intente nuevamente.",type:"error"})})}};var g=getFormSearch("frm-search-Lot","search_lot","LoadRecordsButtonLot"),b=$("#table_container_Lot");b.jtable({title:"Lista de Lotes",paging:!0,sorting:!0,actions:{listAction:base_url+"/lots/list",deleteAction:base_url+"/lots/delete"},toolbar:{items:[{cssClass:"buscador",text:g},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("lots/excel",{})}},{cssClass:"btn-danger-admin",text:'<i class="fa fa-plus"></i> Nuevo Lote',click:function(){r()}}]},fields:{idLote:{key:!0,create:!1,edit:!1,list:!1},idArticulo:{title:"Artículo",options:base_url+"/lots/getArticulos"},Lote:{title:"Lote"},cantidad:{title:"Cantidad"},fechaIngreso:{title:"Fecha de Ingreso",type:"date",displayFormat:"dd/mm/yy"},FechaVencimiento:{title:"Fecha de Vencimiento",type:"date",displayFormat:"dd/mm/yy"},edit:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" class="edit-lote" data-id="'+e.record.idLote+'" title="Editar"><i class="fa fa-edit fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".edit-lote").click(function(e){var t=$(this).attr("data-id");n(t),e.preventDefault()})}}),generateSearchForm("frm-search-Lot","LoadRecordsButtonLot",function(){b.jtable("load",{search:$("#search_lot").val()})},!0),f.on("hidden.bs.modal",function(e){s.attr("style","display:block;")}),f.on("show.bs.modal",function(e){s.attr("style","display:block; z-index:2030 !important")});var y=getFormSearch("frm-search-cc2","search_cc2","LoadRecordsButtonCC2"),C=$("#table_container_cc2");C.jtable({title:"Lista de Articulos",paging:!0,sorting:!0,actions:{listAction:base_url+"/lots/getArticulosLote"},toolbar:{items:[{cssClass:"buscador",text:y}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},description:{title:"Articulos"},select:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_cc" data-name="'+e.record.description+'" data-code="'+e.record.id+'"><i class="fa fa-'+icon_select+' fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_cc").click(function(e){var t=$(this).attr("data-code"),a=$(this).attr("data-name");c.val(t),v.val(a),f.modal("hide"),e.preventDefault()})}}),generateSearchForm("frm-search-cc2","LoadRecordsButtonCC2",function(){C.jtable("load",{search:$("#search_cc2").val()})},!1)}function t(e,t){e.state("lots",{url:"/lots",templateUrl:base_url+"/templates/lots/base.html",controller:"LotCtrl"}),t.otherwise("/")}angular.module("sys.app.lots").config(t).controller("LotCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.maintenances",[])}(),function(){"use strict";function e(e){e.chkState=function(){var e=w_state.prop("checked")?"Activo":"Inactivo";state_state.html(e)};var t=getFormSearch("frm-search-Maintenance","search_b","LoadRecordsButtonMaintenance"),a=$("#table_container_Maintenance");a.jtable({title:"Lista de Mantenimientos",paging:!0,sorting:!0,actions:{listAction:base_url+"/maintenances/list",createAction:base_url+"/maintenances/create",updateAction:base_url+"/maintenances/update",deleteAction:base_url+"/maintenances/delete"},messages:{addNewRecord:"Nuevo Mantenimiento",editRecord:"Editar Mantenimiento"},toolbar:{items:[{cssClass:"buscador",text:t},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("maintenances/excel",{})}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},nombre:{title:"Revisión"},estado:{title:"Estado",values:{I:"Inactivo",A:"Activo"},type:"checkbox",defaultValue:"A"}},formCreated:function(e,t){function a(){var e=Number($('input[name="mo_revision"]').val()),t=Number($('input[name="mo_mecanica"]').val()),a=Number($('input[name="terceros"]').val()),i=Number($('input[name="otros_mo"]').val()),o=Number($('input[name="repuestos"]').val()),r=Number($('input[name="accesorios"]').val()),n=Number($('input[name="lubricantes"]').val()),s=Number($('input[name="otros_rep"]').val()),c=e+t+a+i+o+r+n+s;$('input[name="total"]').val(c)}$('input[name="nombre"]').attr("maxlength",50),$('input[name="mo_revision"]').keyup(function(e){a()}),$('input[name="mo_mecanica"]').keyup(function(e){a()}),$('input[name="terceros"]').keyup(function(e){a()}),$('input[name="otros_mo"]').keyup(function(e){a()}),$('input[name="repuestos"]').keyup(function(e){a()}),$('input[name="accesorios"]').keyup(function(e){a()}),$('input[name="lubricantes"]').keyup(function(e){a()}),$('input[name="otros_rep"]').keyup(function(e){a()}),$("#Edit-estado").parent().addClass("i-checks"),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click(),"A"==e.target.value?($("#Edit-estado").val("I"),$(".i-checks span").text("Inactivo")):($("#Edit-estado").val("A"),$(".i-checks span").text("Activo"))})},formSubmitting:function(e,t){var a=!0;return a=a&&t.form.find('input[name="nombre"]').required()}}),generateSearchForm("frm-search-Maintenance","LoadRecordsButtonMaintenance",function(){a.jtable("load",{search:$("#search_b").val()})},!0)}function t(e,t){e.state("maintenances",{url:"/maintenances",templateUrl:base_url+"/templates/maintenances/base.html",controller:"MaintenanceCtrl"}),t.otherwise("/")}angular.module("sys.app.maintenances").config(t).controller("MaintenanceCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope"]}(),function(){"use strict";angular.module("sys.app.measures",[])}(),function(){"use strict";function e(e){var t=getFormSearch("frm-search-Measure","search_b","LoadRecordsButtonMeasure"),a=$("#table_container_measure");a.jtable({title:"Lista de Unidades de Medidas",paging:!0,sorting:!0,actions:{listAction:base_url+"/measures/list",createAction:base_url+"/measures/create",updateAction:base_url+"/measures/update",deleteAction:base_url+"/measures/delete"},messages:{addNewRecord:"Nueva Unidad de Medidad",editRecord:"Editar Unidad de Medidad"},toolbar:{items:[{cssClass:"buscador",text:t},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("measures/excel",{})}}]},fields:{IdUnidadMedida:{key:!0,create:!1,edit:!1,list:!1},Medida:{title:"Medida"},Equivalencia:{title:"Equivalencia Sunat"},Abreviatura:{title:"Abreviatura"}},formCreated:function(e,t){t.form.find('input[name="Medida"]').attr("onkeypress","return soloLetras(event)"),t.form.find('input[name="Equivalencia"]').attr("onkeypress","return soloNumeros(event)"),t.form.find('input[name="Abreviatura"]').attr("maxlength","3")},formSubmitting:function(e,t){var a=!0;return a=a&&t.form.find('input[name="Medida"]').required(),a=a&&t.form.find('input[name="Equivalencia"]').required()}}),generateSearchForm("frm-search-Measure","LoadRecordsButtonMeasure",function(){a.jtable("load",{search:$("#search_b").val()})},!0)}function t(e,t){e.state("measures",{url:"/measures",templateUrl:base_url+"/templates/measures/base.html",controller:"MeasureCtrl"}),t.otherwise("/")}angular.module("sys.app.measures").config(t).controller("MeasureCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope"]}(),function(){"use strict";angular.module("sys.app.modelos",[])}(),function(){"use strict";function e(e){e.chkState=function(){var e=w_state.prop("checked")?"Activo":"Inactivo";state_state.html(e)};var t=getFormSearch("frm-search-Modelo","search_b","LoadRecordsButtonModelo"),a=$("#table_container_Modelo");a.jtable({title:"Lista de Modelos",paging:!0,sorting:!0,actions:{listAction:base_url+"/modelos/list",createAction:base_url+"/modelos/create",updateAction:base_url+"/modelos/update",deleteAction:base_url+"/modelos/delete"},messages:{addNewRecord:"Nuevo Modelo",editRecord:"Editar Modelo"},toolbar:{items:[{cssClass:"buscador",text:t},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("modelos/excel",{})}}]},fields:{idModelo:{key:!0,create:!1,edit:!1,list:!1},idMarca:{title:"Marca",options:base_url+"/modelos/getMarca",listClass:"text-center"},Modelo:{title:"Modelo",listClass:"text-center"},estado:{title:"Estado",values:{I:"Inactivo",A:"Activo"},type:"checkbox",listClass:"text-center",defaultValue:"A"}},formCreated:function(e,t){$("#Edit-estado").parent().addClass("i-checks"),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click(),"A"==e.target.value?($("#Edit-estado").val("I"),$(".i-checks span").text("Inactivo")):($("#Edit-estado").val("A"),$(".i-checks span").text("Activo"))})},formSubmitting:function(e,t){var a=!0;return a=a&&t.form.find('input[name="Modelo"]').required()}}),generateSearchForm("frm-search-Modelo","LoadRecordsButtonModelo",function(){a.jtable("load",{search:$("#search_b").val()})},!0)}function t(e,t){e.state("modelos",{url:"/modelos",templateUrl:base_url+"/templates/modelos/base.html",controller:"ModeloCtrl"}),t.otherwise("/")}angular.module("sys.app.modelos").config(t).controller("ModeloCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope"]}(),function(){"use strict";angular.module("sys.app.modules",[])}(),function(){"use strict";function e(){var e=getFormSearch("frm-search-m","search_m","LoadRecordsButtonModule"),t=$("#table_container_module");t.jtable({title:"Lista de Modulos",paging:!0,sorting:!0,actions:{listAction:base_url+"/modules/list",createAction:base_url+"/modules/create",updateAction:base_url+"/modules/update",deleteAction:base_url+"/modules/delete"},messages:{addNewRecord:"Nuevo Módulo",editRecord:"Editar Módulo"},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},modulo:{title:"Modulo"},url:{title:"Url",list:show_list_},icon:{title:"Icono",list:show_list_},order:{title:"Orden",list:show_list_},modulo_padre:{title:"Modulo Padre",options:function(e){return"list"==e.source?base_url+"/modules/parents":(e.clearCache(),base_url+"/modules/parents")}}},formCreated:function(e,t){t.form.find('input[name="modulo"]').attr("onkeypress","return soloLetras(event)"),t.form.find('input[name="order"]').attr("onkeypress","return soloNumeros(event)")},formSubmitting:function(e,t){var a=!0;return a=a&&t.form.find('input[name="modulo"]').required(),a=a&&t.form.find('input[name="url"]').required(),a=a&&t.form.find('input[name="order"]').required(),a=a&&t.form.find('input[name="modulo_padre"]').required()}}),generateSearchForm("frm-search-module","LoadRecordsButtonModule",function(){t.jtable("load",{search:$("#search_m").val()})},!0)}function t(e,t){e.state("modules",{url:"/modules",templateUrl:base_url+"/templates/modules/base.html",controller:"ModuleCtrl"}),t.otherwise("/")}angular.module("sys.app.modules").config(t).controller("ModuleCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=[]}(),function(){"use strict";angular.module("sys.app.objetivos",[])}(),function(){"use strict";function e(e,t,a,i){function o(){cleanRequired(),p.html(""),A.html(""),f.val(""),v.val("").trigger("change"),h.val("").trigger("change"),_.val("").trigger("change"),g.val(""),R=[],b.val("")}function r(){cleanRequired(),y.val("").trigger("change"),C.val("").trigger("change"),x.val("").trigger("change"),k.val(""),w.val("")}function n(e){p.html("Editar Objetivo"),a.get("objetivos/find",e,function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.data;f.val(a.descripcion),v.val(a.id_tipoobj).trigger("change"),h.val(a.iEstado).trigger("change"),_.val(a.IdMoneda).trigger("change"),g.val(a.nAno),b.val(a.id),console.log(a.detalle),t.each(a.detalle,function(e){var t="";1==e.nPeriodo?t="Enero":2==e.nPeriodo?t="Febrero":3==e.nPeriodo?t="Marzo":4==e.nPeriodo?t="Abril":5==e.nPeriodo?t="Mayo":6==e.nPeriodo?t="Junio":7==e.nPeriodo?t="Julio":8==e.nPeriodo?t="Agosto":9==e.nPeriodo?t="Septiembre":10==e.nPeriodo?t="Obtubre":11==e.nPeriodo?t="Noviembre":12==e.nPeriodo&&(t="Diciembre"),d(e.id_obj,e.nPeriodo,t,e.id_TipoPers,e.tipo_persona,e.id_Persona,e.persona,e.nCant,e.nMonto)}),u.modal("show")}else i.textType({title:"",message:"Hubo un error al obtener el modalObjetivos. Intente nuevamente.",type:"error"})})}function s(){a.all("objetivos/data_form","",function(e){!t.isUndefined(e.status)&&e.status&&(v.append('<option value="" selected>Seleccionar</option>'),t.each(e.objetivo,function(e){v.append('<option value="'+e.id+'">'+e.descripcion+"</option>")}),C.append('<option value="" selected>Seleccionar</option>'),t.each(e.tipoPersona,function(e){C.append('<option value="'+e.id+'">'+e.descripcion+"</option>")}))},function(){s()})}function c(){a.all("register_movements/data_form","",function(e){!t.isUndefined(e.status)&&e.status&&(_.append('<option value="" selected>Seleccionar</option>'),t.each(e.moneda,function(e){_.append('<option  value="'+e.Value+'">'+e.DisplayText+"</option>")}))},function(){c()})}function l(){u.modal("show"),p.html("Nuevo Objetivo")}function d(e,t,a,o,r,n,s,c,l){var d=e+"_"+t+"_"+o+"_"+n;if(console.log(d),$("#tr_loca_"+d).length>0)return i.showWarning({title:"",message:"Ya se asignó esta persona en este mismo periodo"}),!1;var u=$('<tr id="tr_loca_'+d+'"></tr>'),p=$("<td>"+a+"</td>"),f=$("<td>"+r+"</td>"),v=$("<td>"+s+"</td>"),h=$("<td></td>"),_=$("<td></td>"),g=$('<input type="hidden" class="id_periodo_a" value="'+t+'" />'),b=$('<input type="hidden" class="id_tipo_persona_a" value="'+o+'" />'),y=$('<input type="hidden" class="id_persona_a" value="'+n+'" />'),C=$('<input type="number" class="cantidad_a form-control input-sm" value="'+c+'" />'),x=$('<input type="number" class="monto_a form-control input-sm" min="1" value="'+l+'" />');p.append(g),f.append(b),v.append(y),h.append(C),_.append(x);var k=$('<td class="text-center"></td>'),w=$('<button class="btn btn-danger btn-xs delWarehouseLoca" data-id="'+d+'" type="button"><span class="fa fa-trash"></span></button>');k.append(w),u.append(p).append(f).append(v).append(h).append(_).append(k),A.append(u),$(".delWarehouseLoca").click(function(e){var t=$(this).attr("data-id");i.confirm({title:"",message:"¿Está seguro que desea quitar esta información?",confirm:"Si",cancel:"No"},function(){$("#tr_loca_"+t).remove(),R.push(t)}),e.preventDefault()}),m.modal("hide")}var u=$("#modalObjetivos"),p=$("#titlemodalObjetivos"),m=$("#modalDetalle"),f=$("#descripcion"),v=$("#id_tipoobj"),h=$("#iEstado"),_=$("#IdMoneda"),g=$("#nAno"),b=$("#id_objetivo"),y=$("#nPeriodo"),C=$("#id_TipoPers"),x=$("#id_Persona"),k=$("#nCant"),w=$("#nMonto"),A=$("#w_objetivo_detalle"),R=[];u.on("hidden.bs.modal",function(e){o()}),m.on("hidden.bs.modal",function(e){r()}),e.chkState=function(){var e=w_state.prop("checked")?"Activo":"Inactivo";state_state.html(e)},e.AgregarTable=function(){var e=!0;if(e=e&&y.required(),e=e&&C.required(),e=e&&x.required(),e=e&&k.required(),e=e&&w.required()){var t=$("#id_TipoPers option:selected").text(),a=$("#id_Persona option:selected").text(),i=$("#nPeriodo option:selected").text();if(""==b.val())var o=0;else var o=b.val();d(o,y.val(),i,C.val(),t,x.val(),a,k.val(),w.val())}},x.select2(),C.change(function(){var e=C.val();""!=e?a.get("objetivos/get_personas",e,function(e){!t.isUndefined(e.status)&&e.status?(x.html(""),x.append('<option value="" selected>Seleccionar</option>'),t.each(e.personas,function(e){x.append('<option value="'+e.id+'" >'+e.descripcion+"</option>")})):i.textType({title:"",message:"No se pudo. Intente nuevamente.",type:"info"})}):x.html("")}),s(),c();var S=getFormSearch("frm-search-objetivo","search_b","LoadRecordsButtonobjetivo"),j=$("#table_container_objetivo");e.addDetalle_objetivo=function(){var e=!0;e=e&&f.required(),e=e&&v.required(),e=e&&_.required(),e=e&&g.required(),e&&m.modal("show")},e.saveObjetivo=function(){var e=!0;if(e=e&&f.required(),e=e&&v.required(),e=e&&_.required(),e=e&&g.required(),e&&""===A.html())return i.showWarning({title:"",message:"Debe agregar mínimo 1 persona para el objetivo"}),!1;if(e){var o=[];$.each($(".id_periodo_a"),function(e,t){o[e]=$(t).val()}),o=o.join(",");var r=[];$.each($(".id_tipo_persona_a"),function(e,t){r[e]=$(t).val()}),r=r.join(",");var n=[];$.each($(".id_persona_a"),function(e,t){n[e]=$(t).val()}),n=n.join(",");var s=[];$.each($(".cantidad_a"),function(e,t){s[e]=$(t).val()}),s=s.join(",");var c=[];$.each($(".monto_a"),function(e,t){c[e]=$(t).val()}),c=c.join(",");var l={descripcion:f.val(),id_tipoobj:v.val(),IdMoneda:_.val(),nAno:g.val(),nPeriodo:o,id_TipoPers:r,id_Persona:n,nCant:s,nMonto:c,id_delete:R},d=""===b.val()?0:b.val();a.updated("objetivos/saveObjetivos",d,l,function(e){if(!t.isUndefined(e.status)&&e.status)i.textType({title:"",message:"El objetivo se guardó correctamente.",type:"success"}),u.modal("hide"),LoadRecordsButtonobjetivo.click();else{var a=t.isUndefined(e.message)?"No se pudo guardar el objetivo. Intente nuevamente.":e.message;i.textType({title:"",message:a,type:"error"})}})}},j.jtable({title:"Lista de Objetivos",paging:!0,sorting:!0,actions:{listAction:base_url+"/objetivos/list",deleteAction:base_url+"/objetivos/delete"
},messages:{addNewRecord:"Nuevo objetivo",editRecord:"Editar objetivo"},toolbar:{items:[{cssClass:"buscador",text:S},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("objetivos/excel",{})}},{cssClass:"btn-danger-admin",text:'<i class="fa fa-plus"></i> Nuevo Objetivo',click:function(){l()}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},descripcion:{title:"Objetivo"},id_tipoobj:{title:"Tipo de Objetivo",options:base_url+"/typeObjets/getTipoObjetivo"},IdMoneda:{title:"Moneda",options:base_url+"/type_change/getMonedas"},nAno:{title:"Año"},iEstado:{title:"Estado",values:{0:"Registrado",1:"Aprobado"},type:"checkbox",defaultValue:"A"},edit:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Editar" class="edit_w" data-code="'+e.record.id+'"><i class="fa fa-pencil-square-o fa-1-5x fa-green"></i></a>'}}},recordsLoaded:function(e,t){$(".edit_w").click(function(e){var t=$(this).attr("data-code");n(t),e.preventDefault()})},formCreated:function(e,t){t.form.find('input[name="Categoria"]').attr("onkeypress","return soloLetras(event)"),$("#Edit-estado").parent().addClass("i-checks"),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click(),"A"==e.target.value?($("#Edit-estado").val("I"),$(".i-checks span").text("Inactivo")):($("#Edit-estado").val("A"),$(".i-checks span").text("Activo"))})},formSubmitting:function(e,t){var a=!0;return a=a&&t.form.find('input[name="Categoria"]').required()}}),generateSearchForm("frm-search-objetivo","LoadRecordsButtonobjetivo",function(){j.jtable("load",{search:$("#search_b").val()})},!0)}function t(e,t){e.state("objetivos",{url:"/objetivos",templateUrl:base_url+"/templates/objetivos/base.html",controller:"objetivoCtrl"}),t.otherwise("/")}angular.module("sys.app.objetivos").config(t).controller("objetivoCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.operations",[])}(),function(){"use strict";function e(e,t,a,i){function o(){cleanRequired(),l.html(""),p.prop("checked",!0).iCheck("update"),u.html("Activo"),h.html(""),f.val(""),v.val("").trigger("change"),d.val(""),m.val("")}function r(){l.html("Nuevo Tipo de Operación"),d.modal("show")}function n(e,t,a){if($("#tr_b_"+e).length>0)return i.showWarning({title:"",message:"Ya se asignó este Usuario"}),!1;var o=$('<tr id="tr_b_'+e+'"></tr>'),r=$("<td>"+t+"</td>"),n=$("<td>"+a+"</td>"),s=$('<input type="hidden" class="w_user" value="'+e+'" />');r.append(s);var c=$('<td class="text-center"></td>'),l=$('<button class="btn btn-danger btn-xs delOperation" data-id="'+e+'" type="button"><span class="fa fa-trash"></span></button>');c.append(l),o.append(r).append(n).append(c),h.append(o),_.modal("hide"),$(".delOperation").click(function(e){var t=$(this).attr("data-id");i.confirm({title:"",message:"¿Está seguro que desea quitar este usuario?",confirm:"Si",cancel:"No"},function(){$("#tr_b_"+t).remove()}),e.preventDefault()})}function s(o){l.html("Editar Tipo Operacion"),a.get("operations/find",o,function(a){if(!t.isUndefined(a.status)&&a.status){var o=a.data;console.log(o),m.val(o.idTipoOperacion),f.val(o.descripcion),v.val(o.idNaturaleza).trigger("change");var r="A"==o.estado;p.prop("checked",r).iCheck("update"),e.chkState(),o.users!=[]&&t.each(o.users,function(e){n(e.id,e.username,e.name)}),d.modal("show")}else i.textType({title:"",message:"Hubo un error al obtener el Grupo Contable. Intente nuevamente.",type:"error"})})}function c(){a.all("operations/data_form","",function(e){!t.isUndefined(e.status)&&e.status&&(v.append('<option value="" selected>Seleccionar</option>'),t.each(e.datos,function(e){v.append('<option value="'+e.Value+'">'+e.DisplayText+"</option>")}))},function(){c()})}var l=$("#titleModalOperacion"),d=$("#modaOperacion"),u=$("#state_text"),p=$("#p_state"),m=$("#idTipoOperacion"),f=$("#descripcion"),v=$("#idNaturaleza"),h=$("#w_usuario_detalle"),_=$("#modalUsuario");$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(t){$(t.target).click(),e.chkState()}),e.saveOperacion=function(){var e=!0;if(e=e&&f.required(),e=e&&v.required()){if(""===h.html())var o={idTipoOperacion:m.val(),descripcion:f.val(),estado:p.prop("checked")?"A":"I",idNaturaleza:v.val()};else{var r=[];$.each($(".w_user"),function(e,t){r[e]=$(t).val()}),r=r.join(",");var o={idTipoOperacion:m.val(),descripcion:f.val(),estado:p.prop("checked")?"A":"I",idNaturaleza:v.val(),users:r}}var n=""===m.val()?0:m.val();a.updated("operations/saveOperacion",n,o,function(e){if(!t.isUndefined(e.status)&&e.status)i.textType({title:"",message:"La Operación se guardó correctamente.",type:"success"}),d.modal("hide"),LoadRecordsButtonOperation.click();else{var a=t.isUndefined(e.message)?"Hubo un error al guardar La Operación. Intente nuevamente.":e.message;i.textType({title:"",message:a,type:"error"})}})}},e.addDetalleUsuario=function(){var e=!0;e=e&&f.required(),e=e&&v.required(),e&&(_.modal("show"),$("#search_cc2").val(""),$("#LoadRecordsButtonCC2").click())},e.chkState=function(){var e=p.prop("checked")?"Activo":"Inactivo";u.html(e)},d.on("hidden.bs.modal",function(e){o()});var g=getFormSearch("frm-search-Operation","search_b","LoadRecordsButtonOperation"),b=$("#table_container_Operation");b.jtable({title:"Lista de Tipos de Operaciones",paging:!0,sorting:!0,actions:{listAction:base_url+"/operations/list",deleteAction:base_url+"/operations/delete"},toolbar:{items:[{cssClass:"buscador",text:g},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("operations/excel",{})}},{cssClass:"btn-danger-admin",text:'<i class="fa fa-plus"></i> Nuevo Tipo de Operación',click:function(){r()}}]},fields:{idTipoOperacion:{key:!0,create:!1,edit:!1,list:!1},Operacion:{title:"Tipo de Operación"},idNaturaleza:{title:"Naturaleza",options:base_url+"/operations/getNaturaleza"},estado:{title:"Estado",values:{I:"Inactivo",A:"Activo"},type:"checkbox",defaultValue:"A"},edit:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Editar" class="edit_Opera" data-code="'+e.record.idTipoOperacion+'"><i class="fa fa-pencil-square-o fa-1-5x fa-green"></i></a>'}}},recordsLoaded:function(e,t){$(".edit_Opera").click(function(e){var t=$(this).attr("data-code");s(t),e.preventDefault()})}}),generateSearchForm("frm-search-Operation","LoadRecordsButtonOperation",function(){b.jtable("load",{search:$("#search_b").val()})},!0);var y=getFormSearch("frm-search-cc2","search_cc2","LoadRecordsButtonCC2"),C=$("#table_container_ccUsuarios");C.jtable({title:"Lista de Usuarios",paging:!0,sorting:!0,actions:{listAction:base_url+"/operations/listUser"},toolbar:{items:[{cssClass:"buscador",text:y}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},username:{title:"Usuario"},name:{title:"Nombre"},select:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_u" data-code="'+e.record.id+'" data-title="'+e.record.username+'"data-name="'+e.record.name+'" ><i class="fa fa-'+icon_select+' fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_u").click(function(e){var t=$(this).attr("data-code"),a=$(this).attr("data-title"),i=$(this).attr("data-name");n(t,a,i),e.preventDefault()})}}),generateSearchForm("frm-search-cc2","LoadRecordsButtonCC2",function(){C.jtable("load",{search:$("#search_cc2").val()})},!1),c()}function t(e,t){e.state("operations",{url:"/operations",templateUrl:base_url+"/templates/operations/base.html",controller:"OperationCtrl"}),t.otherwise("/")}angular.module("sys.app.categories").config(t).controller("OperationCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.orden_servicios",[])}(),function(){"use strict";function e(e,t,a,i){function o(e){a.get("orden_servicios/find",e,function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.data;te.prop("disabled",!0),te.val(a[0].cCodConsecutivo).trigger("change"),Se.prop("disabled",!0),Se.val(a[0].nConsecutivo),D.val(a[0].IdMoneda).trigger("change"),ae.val(a[0].idcCondicionPago).trigger("change"),Ge.val(a[0].idCliente),de.val(a.dFecRec2),ce.val(a[0].horaEnt),ue.val(a[0].horaRec),pe.val(a.dFecEntrega2),ne.val(a[0].idTecnico).trigger("change"),se.val(a[0].idAsesor).trigger("change"),ie.val(a[0].id_tipo).trigger("change"),j.val(a[0].id_tipomant).trigger("change"),F.val(a[0].id_tipoveh).trigger("change"),_e.val(a[0].tipodoc).trigger("change"),G.val(a[0].iEstado).trigger("change");var o=e.data_cliente;Ge.val(o[0].id),Oe.val(o[0].documento),l(),ee.val(a[0].cObservaciones),le.val(a[0].nKilometraje),at.val(a[0].cPlacaVeh),d();var r=e.data_matenimiento;t.each(r,function(e){var t=e.idMantenimiento+"*"+e.nombre,a=1;m(t,a)});var n=e.data_detalle;t.each(n,function(e){var t=e.idProducto+"*"+e.description+"*"+e.nTotal,a=e.id_tipototal,i=e.descripcion,o=1,r=e.idDetalleSer;p(t,a,i,o,r)}),U.data("prev",E.val()),D.data("prev",D.val()),fe.modal("show")}else i.textType({title:"",message:"Hubo un error al obtener el Artículo. Intente nuevamente.",type:"error"})})}function r(){var e=new Date,t=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate(),a=e.getHours()+":"+e.getMinutes();de.val(t),ue.val(a),fe.modal("show"),ve.html("Nuevo Orden de Servicio")}function n(e){var o="0";a.get("shops/TraerDepartamentos",o,function(a){if(!t.isUndefined(a.status)&&a.status){a.data;Z.html(""),Z.append('<option value="" selected >Seleccione</option>'),t.each(a.data,function(t){t.cDepartamento==e?Z.append('<option value="'+t.cDepartamento+'"  >'+t.cDepartamento+"</option>"):Z.append('<option value="'+t.cDepartamento+'" >'+t.cDepartamento+"</option>")})}else i.textType({title:"",message:"Hubo un error al obtener el Artículo. Intente nuevamente.",type:"error"})})}function s(e,o){a.get("shops/TraerProvincias",o,function(a){if(!t.isUndefined(a.status)&&a.status){a.data;J.html(""),J.append('<option value="" >Seleccione</option>'),t.each(a.data,function(t){t.cProvincia==e?J.append('<option value="'+t.cProvincia+'" selected>'+t.cProvincia+"</option>"):J.append('<option value="'+t.cProvincia+'">'+t.cProvincia+"</option>")})}else i.textType({title:"",message:"Hubo un error . Intente nuevamente.",type:"error"})})}function c(e,o){a.get("shops/TraerDistritos",o,function(a){if(!t.isUndefined(a.status)&&a.status){a.data;X.html(""),X.append('<option value="" >Seleccione</option>'),t.each(a.data,function(t){t.cCodUbigeo==e?X.append('<option value="'+t.cCodUbigeo+'" selected>'+t.cDistrito+"</option>"):X.append('<option value="'+t.cCodUbigeo+'">'+t.cDistrito+"</option>")})}else i.textType({title:"",message:"Hubo un error al obtener el Artículo. Intente nuevamente.",type:"error"})})}function l(){var e=!0;if(e=e&&Oe.required()){var o=Oe.val();a.get("orden_servicios/get_cliente",o,function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.data;if(0==a.length){Y.html("Nuevo Cliente"),B.modal("show");var o="xxxxx";n(o),Re.val(""),We.val(""),oe.val(""),Ie.val(""),Oe.val(""),Be.val(""),Ye.val(""),ze.val(""),Ve.val(""),He.val(""),Ge.val(""),M.val(""),U.data("prev",E.val()),U.val(E.val()),u()}else Re.val(a[0].cDistrito),We.val(a[0].ubigeo),oe.val(a[0].tipodoc).trigger("change"),Ie.val(a[0].razonsocial_cliente),Oe.val(a[0].documento),Be.val(a[0].contacto),Ye.val(a[0].direccion),ze.val(a[0].correo_electronico),Ve.val(a[0].celular),He.val(a[0].telefono),Ge.val(a[0].id),M.val(a[0].tipo_cliente_descr).trigger("change"),E.val(a[0].id_tipocli),U.data("prev",E.val()),u()}else i.textType({title:"",message:"Hubo un error . Intente nuevamente.",type:"info"})})}}function d(){var e=!0;if(e=e&&at.required()){var o=at.val();a.get("orden_servicios/get_Placa",o,function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.data;Qe.html(""),Qe.append('<option value="" selected>Seleccionar</option>'),t.each(e.marca,function(e){Qe.append('<option value="'+e.id+'" >'+e.description+"</option>")}),0==a.length?(H.html("Nuevo Vehiculo"),V.modal("show"),at.val(""),it.val(""),ot.val(""),rt.val(""),nt.val(""),st.val(""),W.val(""),N.val("")):(at.val(a[0].placa),it.val(a[0].description),ot.val(a[0].descripcion),rt.val(a[0].n_chasis),nt.val(a[0].anio_fabricacion),st.val(a[0].color),W.val(a[0].motor),N.val(a[0].tipo_vehiculo))}else i.textType({title:"",message:"Hubo un error . Intente nuevamente.",type:"info"})})}}function u(){var e=D.val(),a=E.val();q.html(""),q.append('<option value="" selected>Seleccionar </option>'),t.each(A,function(t){e==t.idMoneda&&a==t.tipo_cliente&&q.append('<option value="'+t.idProducto+"*"+t.producto+"*"+t.precio+'">'+t.codigo_articulo+" "+t.producto+"</option>")})}function p(e,o,r,n,s){var c=e.split("*"),l=c[0],d=c[1],u=c[2],p=Number(u).toFixed(2);if($("#tr_b_"+l).length>0)return i.showWarning({title:"",message:"Ya se asignó este servicio"}),!1;var m=$('<tr id="tr_b_'+l+'"></tr>'),f=$("<td>"+d+"</td>"),h=$("<td></td>"),_=$("<td></td>"),g=$('<td class="text-center"></td>'),b=$('<input type="hidden" class="idRevision_select form-control input-sm"  value="'+l+'" />'),y=$('<input type="hidden" class="idTipo_select form-control input-sm"  value="'+o+'" />'),C=$('<input type="hidden" class="idDetalleGrup form-control input-sm"  value="'+s+'" />'),x=$('<input type="hidden" class="modo_serDet form-control input-sm"  value="'+n+'" />'),k=$('<input class="total_revision form-control input-sm" data-idTipo="'+o+'" data-idS="'+l+'" id="tr_pre'+l+'"  value="'+r+'" readonly/>'),u=$('<input type="number" class="precio_m form-control input-sm"  data_idTipoPres="'+o+'" id="tr_prec_'+l+'" data-precio="'+p+'" value="'+p+'"  />'),w=$('<button class="btn btn-danger btn-xs deltotal" data-idedet="'+s+'" data_idTipoDel="'+o+'" data-id="'+l+'" type="button"><span class="fa fa-trash"></span></button>');h.append(u),_.append(k),g.append(w).append(b).append(y).append(x).append(C),m.append(f).append(h).append(_).append(g),P.append(m),D.data("prev",D.val()),U.data("prev",E.val());var u=c[2];if("1"==o){var A=je.val(),R=Number(A)+Number(u);je.val(R.toFixed(2))}else if("2"==o){var S=Le.val(),j=Number(S)+Number(u);Le.val(j.toFixed(2))}else if("3"==o){var T=Ee.val(),N=Number(T)+Number(u);Ee.val(N.toFixed(2))}else if("4"==o){var F=Pe.val(),M=Number(F)+Number(u);Pe.val(M.toFixed(2))}else if("5"==o){var O=De.val(),I=Number(O)+Number(u);De.val(I.toFixed(2))}else if("6"==o){var B=Te.val(),Y=Number(B)+Number(u);Te.val(Y.toFixed(2))}else if("7"==o){var z=Ne.val(),V=Number(z)+Number(u);Ne.val(V.toFixed(2))}else if("8"==o){var H=Fe.val(),G=Number(H)+Number(u);Fe.val(G.toFixed(2))}v(),q.val("").trigger("change"),L.val("").trigger("change"),$("#tr_prec_"+l).keypress(function(e){var t=e.keyCode?e.keyCode:e.which;if(13==t){var a=$(this).attr("data_idTipoPres"),i=$(this).attr("data-precio"),o=$(this).val();if("1"==a){var r=je.val(),n=Number(r)-Number(i),s=Number(n)+Number(o);$(this).attr("data-precio",s.toFixed(2)),je.val(s.toFixed(2))}else if("2"==a){var r=Le.val(),n=Number(r)-Number(i),s=Number(n)+Number(o);$(this).attr("data-precio",s.toFixed(2)),Le.val(s.toFixed(2))}else if("3"==a){var r=Ee.val(),n=Number(r)-Number(i),s=Number(n)+Number(o);$(this).attr("data-precio",s.toFixed(2)),Ee.val(s.toFixed(2))}else if("4"==a){var r=Pe.val(),n=Number(r)-Number(i),s=Number(n)+Number(o);$(this).attr("data-precio",s.toFixed(2)),Pe.val(s.toFixed(2))}else if("5"==a){var r=De.val(),n=Number(r)-Number(i),s=Number(n)+Number(o);$(this).attr("data-precio",s.toFixed(2)),De.val(s.toFixed(2))}else if("6"==a){var r=Te.val(),n=Number(r)-Number(i),s=Number(n)+Number(o);$(this).attr("data-precio",s.toFixed(2)),Te.val(s.toFixed(2))}else if("7"==a){var r=Ne.val(),n=Number(r)-Number(i),s=Number(n)+Number(o);$(this).attr("data-precio",s.toFixed(2)),Ne.val(s.toFixed(2))}else if("8"==a){var r=Fe.val(),n=Number(r)-Number(i),s=Number(n)+Number(o);$(this).attr("data-precio",s.toFixed(2)),Fe.val(G.toFixed(2))}v()}}),$(".deltotal").click(function(e){var o=$(this).attr("data-id"),r=$(this).attr("data_idTipoDel"),n=$(this).attr("data-idedet");i.confirm({title:"",message:"¿Está seguro que desea quitar este servicio ?",confirm:"Si",cancel:"No"},function(){if(""!=Se.val()&&n){var e=te.val()+"_"+Se.val()+"_"+n;a.get("orden_servicios/deleteDetalle",e,function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.data;console.log(a),""!=a[0].Mensaje?i.textType({title:"",message:a[0].Mensaje,type:"info"}):(i.textType({title:"",message:"El servicio se eliminó correctamente",type:"success"}),$("#tr_b_"+o).remove())}else{var r=t.isUndefined(e.message)?"No se pudo eliminar. Intente nuevamente.":e.message;i.textType({title:"",message:r,type:"error"})}})}else{var s=$("#tr_prec_"+o).val();if("1"==r){var c=je.val(),l=Number(c)-Number(s);je.val(l.toFixed(2))}else if("2"==r){var d=Le.val(),u=Number(d)-Number(s);Le.val(u.toFixed(2))}else if("3"==r){var p=Ee.val(),m=Number(p)-Number(s);Ee.val(m.toFixed(2))}else if("4"==r){var f=Pe.val(),h=Number(f)-Number(s);Pe.val(h.toFixed(2))}else if("5"==r){var _=De.val(),g=Number(_)-Number(s);De.val(g.toFixed(2))}else if("6"==r){var b=Te.val(),y=Number(b)-Number(s);Te.val(y.toFixed(2))}else if("7"==r){var C=Ne.val(),x=Number(C)-Number(s);Ne.val(x.toFixed(2))}else if("8"==r){var k=Fe.val(),w=Number(k)-Number(s);Fe.val(w.toFixed(2))}v(),$("#tr_b_"+o).remove()}}),e.preventDefault()})}function m(e,o){var r=e.split("*"),n=r[0],s=r[1];if($("#tr_b_"+n).length>0)return i.showWarning({title:"",message:"Ya se asignó este mantenimiento"}),!1;var c=$('<tr id="tr_b_'+n+'"></tr>'),l=$("<td>"+s+"</td>"),d=$('<td class="text-center"></td>'),u=$('<input type="hidden" class="total_revision" id="tr_'+n+'" value="'+e+'" />'),p=$('<input type="hidden" class="modo_mant" id="tr_'+n+'" value="'+o+'" />'),m=$('<input type="hidden" class="id_mantenimiento_group"  value="'+n+'"  />'),f=$('<button class="btn btn-danger btn-xs delRevi" data-id="'+n+'" type="button"><span class="fa fa-trash"></span></button>');d.append(f).append(m).append(p),c.append(l).append(d).append(u),he.append(c),$(".delRevi").click(function(e){var o=$(this).attr("data-id");i.confirm({title:"",message:"¿Está seguro que desea quitar este mantenimiento?",confirm:"Si",cancel:"No"},function(){if(""!=Se.val()){var e=te.val()+"_"+Se.val()+"_"+o;a.get("orden_servicios/deleteMovimiento",e,function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.data;console.log(a),""!=a[0].Mensaje?i.textType({title:"",message:a[0].Mensaje,type:"info"}):(i.textType({title:"",message:"El mantenimiento se eliminó correctamente",type:"success"}),$("#tr_b_"+o).remove())}else{var r=t.isUndefined(e.message)?"No se pudo eliminar. Intente nuevamente.":e.message;i.textType({title:"",message:r,type:"error"})}})}else $("#tr_b_"+o).remove()}),e.preventDefault()})}function f(){je.val(0),Le.val(0),Ee.val(0),Pe.val(0),De.val(0),Te.val(0),Ne.val(0),Fe.val(0)}function v(){qe.val(Number(je.val())+Number(Le.val())+Number(Ee.val())+Number(Pe.val())),Me.val(Number(De.val())+Number(Te.val())+Number(Ne.val())+Number(Fe.val()));var e=Number(qe.val())+Number(Me.val());Ue.val(e.toFixed(2))}function h(){P.html(""),te.val(""),ae.val(""),Se.val(""),ne.val(""),se.val(""),z.prop("disabled",!1),F.val("").trigger("change"),D.val("1").trigger("change"),M.val(""),E.val(""),de.val(""),ue.val(""),L.val(""),te.prop("disabled",!1),pe.val(""),ce.val(""),q.html(""),q.append('<option value="" selected>Seleccionar </option>'),G.val(""),ae.val("1").trigger("change"),Oe.val(""),Re.val(""),We.val(""),oe.val("01").trigger("change"),Ie.val(""),Oe.val(""),Be.val(""),Ye.val(""),ze.val(""),Ve.val(""),He.val(""),Ge.val(""),at.val(""),it.val(""),ot.val(""),rt.val(""),nt.val(""),st.val(""),D.val("").trigger("change"),ne.val("").trigger("change"),j.val("").trigger("change"),se.val("").trigger("change"),oe.val("").trigger("change"),re.val("").trigger("change"),me.html(""),le.val(""),ee.val(""),je.val(""),Le.val(""),Ee.val(""),Pe.val(""),qe.val(""),De.val(""),Te.val(""),Ne.val(""),Fe.val(""),Me.val(""),Ue.val(""),Q.val(""),W.val("")}function _(){cleanRequired(),Y.html(""),_e.val("01").trigger("change"),U.val("").trigger("change"),ge.val(""),be.val(""),ye.val(""),Ce.val(""),xe.val(""),ke.val(""),we.val(""),Ae.val(""),Z.val(""),J.val(""),X.val(""),J.html(""),X.html("")}function g(){if(""!=Se.val()){var e=te.val()+"_"+Se.val(),o=[];$.each($(".idDetalleGrup"),function(e,t){o[e]=$(t).val()}),o=o.join(",");var r={id_revision_array:o};a.updated("orden_servicios/deleteDetalle",e,r,function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.dato;console.log(a),""!=a[0].Mensaje?(i.textType({title:"",message:a[0].Mensaje,type:"info"}),D.val(D.data("prev")).trigger("change"),U.val(U.data("prev")).trigger("change"),S.modal("hide")):(console.log(e.data),console.log(e.datad),P.html(""),D.data("prev",D.val()),U.data("prev",U.val()),""!=U.val()&&E.val(U.val()).trigger("change"),S.modal("hide"),f(),v())}else{var o=t.isUndefined(e.message)?"No se pudo eliminar. Intente nuevamente.":e.message;i.textType({title:"",message:o,type:"error"}),E.val(U.val()).trigger("change"),D.data("prev",D.val()),U.data("prev",U.val()),I.modal("hide")}})}else S.modal("hide"),P.html(""),f(),v()}function b(){cleanRequired(),H.html(""),Qe.html(""),Ze.val(""),Ke.val(""),Je.val(""),Xe.val(""),et.val(""),tt.val("")}function y(){var e=!0;if(e=e&&_e.required(),e=e&&be.required(),e=e&&U.required(),e=e&&ge.required(),e=e&&ke.required(),e=e&&X.required(),"01"==_e.val()&&8!=be.val().length&&(i.textType({title:"",message:"Longitud de LE/DNI INCORRECTA",type:"info"}),e=!1),"06"==_e.val()&&11!=be.val().length&&(i.textType({title:"",message:"Longitud de RUC INCORRECTA",type:"info"}),e=!1),e){var o={tipodoc:_e.val(),razonsocial_cliente:ge.val(),documento:be.val(),contacto:ye.val(),direccion:Ce.val(),correo_electronico:xe.val(),celular:ke.val(),telefono:we.val(),distrito:X.val(),id_tipocli:U.val()},r=""===Ae.val()?0:Ae.val();a.updated("customers/createCliente",r,o,function(e){if(!t.isUndefined(e.status)&&e.status)Oe.val(be.val()),l(),B.modal("hide");else{var a=t.isUndefined(e.message)?"No se pudo guardar el Cliente. Intente nuevamente.":e.message;i.textType({title:"",message:a,type:"info"})}})}}function C(){a.all("customers/data_form","",function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.tipoc_doc,i=e.tipo_clie;a.map(function(e){_e.append('<option value="'+e.Codigo+'">'+e.TipoDocumento+"</option>")}),U.append('<option value="">Seleccionar</option>'),i.map(function(e){U.append('<option value="'+e.id+'">'+e.descripcion+"</option>")}),E.append('<option value="">Seleccionar</option>'),i.map(function(e){E.append('<option value="'+e.id+'">'+e.descripcion+"</option>")})}},function(){C()})}function x(){var e=0;a.get("orden_servicios/get_Placa",e,function(e){!t.isUndefined(e.status)&&e.status?(F.append('<option value="" selected>Seleccionar</option>'),t.each(e.tipo_ve,function(e){F.append('<option value="'+e.id+'" >'+e.descripcion+"</option>")})):i.textType({title:"",message:"Hubo un error . Intente nuevamente.",type:"info"})})}function k(){a.all("orden_servicios/data_form","",function(e){!t.isUndefined(e.status)&&e.status&&(te.append('<option value="">Seleccionar</option>'),t.each(e.codigo,function(e){te.append('<option value="'+e.cCodConsecutivo+'">'+e.cCodConsecutivo+"</option>")}),ae.append('<option value="">Seleccionar</option>'),t.each(e.condicion_pago,function(e){ae.append('<option value="'+e.id+'">'+e.description+"</option>")}),t.each(e.tipo_servicio,function(e){ie.append('<option value="'+e.id+'">'+e.descripcion+"</option>")}),oe.append('<option value="">Seleccionar</option>'),t.each(e.tipo_document,function(e){oe.append('<option value="'+e.Codigo+'">'+e.TipoDocumento+"</option>")}),re.append('<option value="" selected>Seleccionar </option>'),t.each(e.revisiones,function(e){re.append('<option value="'+e.id+"*"+e.nombre+"*"+e.mo_revision+"*"+e.mo_mecanica+"*"+e.terceros+"*"+e.otros_mo+"*"+e.repuestos+"*"+e.accesorios+"*"+e.lubricantes+"*"+e.otros_rep+'">'+e.nombre+"</option>")}),ne.append('<option value="">Seleccionar</option>'),t.each(e.tecnico,function(e){ne.append('<option value="'+e.id+'">'+e.descripcion+"</option>")}),se.append('<option value="">Seleccionar</option>'),t.each(e.asesor,function(e){se.append('<option value="'+e.id+'">'+e.descripcion+"</option>")}),j.append('<option value="">Seleccionar</option>'),t.each(e.tipoMantenimiento,function(e){j.append('<option value="'+e.id+'">'+e.descripcion+"</option>")}),A=e.servicios,D.append('<option value="">Seleccionar</option>'),t.each(e.moneda,function(e){D.append('<option value="'+e.IdMoneda+'">'+e.Descripcion+"</option>")}),w=e.totales,L.append('<option value="">Tipo</option>'),t.each(e.totales,function(e){L.append('<option value="'+e.id+'">'+e.descripcion+"</option>")}))},function(){k()})}var w,A,R=$("#btn_save_cliente"),S=$("#modalDeleteDetalle"),j=$("#id_tipomant"),L=$("#tipo_totales_slec"),E=$("#id_cliente_tipo_or"),P=$("#table_servicios"),q=$("#servicios_select"),D=$("#IdMoneda"),T=$("#btn_cancelar_servicio"),N=$("#tipo_vehi"),F=$("#idTipoVehi_add"),M=$("#tipoCliente_or"),U=$("#id_tipocli"),O=$("#idOrdenDelete"),I=$("#modalDeleteOrden"),B=$("#modaClientes"),Y=$("#titleModalClientes"),z=$("#btn_guardarOrden"),V=$("#modaVehiculosTerceros"),H=$("#titleModalVehiculosTerceros"),G=$("#estado"),W=$("#motor"),K=$("#idOrden"),Q=$("#motor_add"),Z=$("#departamento"),J=$("#provincia"),X=$("#distrito"),ee=$("#observaciones"),te=$("#cCodConsecutivo"),ae=$("#idcCondicionPago"),ie=$("#id_tipo"),oe=$("#idDocumentoCli"),re=$("#gru_revisiones"),ne=$("#idTecnico"),se=$("#idAsesor"),ce=$("#horaEnt"),le=$("#nKilometraje"),de=$("#dFecRec"),ue=$("#horaRec"),pe=$("#dFecEntrega"),me=$("#articulo_dd_det"),fe=$("#modalOrdenServivio"),ve=$("#titlemodalOrdenServivio"),he=$("#articulo_dd_det"),_e=$("#tipodoc"),ge=$("#razonsocial_cliente"),$e=$("#btn_cerrar"),be=$("#documento"),ye=$("#contacto"),Ce=$("#direccion"),xe=$("#correo_electronico"),ke=$("#celular"),we=$("#telefono"),Ae=$("#cliente_id"),X=$("#distrito"),Re=$("#distrito_ver"),Se=$("#nConsecutivo"),je=$("#mo_revision"),Le=$("#mo_mecanica"),Ee=$("#terceros"),Pe=$("#otros_mo"),qe=$("#subtotal_moa"),De=$("#repuestos"),Te=$("#accesorios"),Ne=$("#lubricantes"),Fe=$("#otros_rep"),Me=$("#subtotal_mob"),Ue=$("#total"),oe=$("#idDocumentoCli"),Oe=$("#documento_or"),Ie=$("#razonsocial_cliente_or"),Be=$("#contacto_or"),Ye=$("#direccion_or"),ze=$("#correo_electronico_or"),Ve=$("#celular_or"),He=$("#telefono_or"),Ge=$("#cliente_id_or"),We=$("#distrito_or"),Ke=$("#idVehiculo_add"),Qe=$("#idMarca_add"),Ze=$("#idModelo_add"),Je=$("#n_chasis_add"),Xe=$("#anio_fabricacion_add"),et=$("#color_add"),tt=$("#placa_add"),at=$("#placa"),it=$("#marca"),ot=$("#modelo"),rt=$("#chasis"),nt=$("#anio_fabricacion"),st=$("#color");ne.select2(),q.select2(),$.fn.modal.Constructor.prototype.enforceFocus=function(){},se.select2(),Oe.keypress(function(e){var t=e.keyCode?e.keyCode:e.which;13==t&&l()}),at.keypress(function(e){var t=e.keyCode?e.keyCode:e.which;13==t&&d()}),e.chkState=function(){var e=w_state.prop("checked")?"Activo":"Inactivo";state_state.html(e)},Z.change(function(){var e="xxxxxx",t=Z.val();s(e,t)}),D.change(function(){""!=P.html()&&S.modal("show"),u()}),E.change(function(){u()}),U.change(function(){console.log("entro1"),""!=E.val()&&(console.log("entro2"),U.val()!=E.val()&&""!=U.val()&&""!=P.html()&&(console.log("entro3"),S.modal("show")))}),T.click(function(){D.val(D.data("prev")).trigger("change"),U.val(U.data("prev")).trigger("change")}),$e.click(function(){D.val(D.data("prev")).trigger("change"),U.val(U.data("prev")).trigger("change")}),Qe.change(function(){var e=Qe.val();a.get("orden_servicios/get_Modelo",e,function(e){!t.isUndefined(e.status)&&e.status?(Ze.html(""),t.each(e.modelo,function(e){Ze.append('<option value="'+e.idModelo+'" selected>'+e.descripcion+"</option>")})):i.textType({title:"",message:"No se pudo obtner los modelos . Intente nuevamente.",type:"info"})})}),J.change(function(){var e="xxxxxx",t=J.val();c(e,t)}),re.change(function(){var e=re.val();if(""!=e){var t=0;m(e,t)}}),L.change(function(){var e=L.val(),t=$("#tipo_totales_slec option:selected").text(),a=q.val();if(""!=a&&""!=e){var i=0,o=0;p(a,e,t,i,o)}}),$("#mo_revision").keyup(function(){v()}),$("#mo_mecanica").keyup(function(){v()}),$("#terceros").keyup(function(){v()}),$("#otros_mo").keyup(function(){v()}),$("#repuestos").keyup(function(){v()}),$("#accesorios").keyup(function(){v()}),$("#lubricantes").keyup(function(){v()}),$("#otros_rep").keyup(function(){v()}),$("#mo_revision").change(function(){v()}),$("#mo_mecanica").change(function(){v()}),$("#terceros").change(function(){v()}),$("#otros_mo").change(function(){v()}),$("#repuestos").change(function(){v()}),$("#accesorios").change(function(){v()}),$("#lubricantes").change(function(){v()}),$("#otros_rep").change(function(){v()}),B.on("hidden.bs.modal",function(e){_()}),V.on("hidden.bs.modal",function(e){b()}),fe.on("hidden.bs.modal",function(e){h()}),$("#btn_cambio_delete").click(function(e){g()}),e.saveOrdenServicio=function(){var e=!0;if(e=e&&te.required(),e=e&&ae.required(),e=e&&D.required(),e=e&&de.required(),e=e&&ue.required(),e=e&&pe.required(),e=e&&ce.required(),e=e&&ie.required(),e=e&&j.required(),e=e&&F.required(),e=e&&Oe.required(),e=e&&at.required(),e=e&&Oe.required(),e=e&&oe.required(),e=e&&Re.required(),e=e&&le.required(),e=e&&at.required(),""==$("#articulo_dd_det").html())return i.showWarning({title:"",message:"Debe agregar un mínimo de 1 en mantenimientos"}),activeTab("trbajoES"),!1;if(0==$("#total").val())return i.showWarning({title:"",message:"El total no puede ser 0"}),!1;if(e){var o=[];$.each($(".id_mantenimiento_group"),function(e,t){o[e]=$(t).val()}),o=o.join(",");var r=[];$.each($(".idRevision_select"),function(e,t){r[e]=$(t).val()}),r=r.join(",");var n=[];$.each($(".idTipo_select"),function(e,t){n[e]=$(t).val()}),n=n.join(",");var s=[];$.each($(".precio_m"),function(e,t){s[e]=$(t).val()}),s=s.join(",");var c=[];$.each($(".modo_mant"),function(e,t){c[e]=$(t).val()}),c=c.join(",");var l=[];$.each($(".modo_serDet"),function(e,t){l[e]=$(t).val()}),l=l.join(",");var d=te.val(),u=d.split("*"),p=$("#nConsecutivo").val();""==$("#nConsecutivo").val()&&(p=0);var m={cCodConsecutivo:u[0],nConsecutivo:p,id_tipo:ie.val(),id_tipomant:j.val(),IdMoneda:D.val(),dFecRec:de.val(),horaRec:ue.val(),dFecEntrega:pe.val(),horaEnt:ce.val(),id_tipoveh:F.val(),cPlacaVeh:at.val(),cMotor:W.val(),cChasis:rt.val(),iAnioFab:nt.val(),cColor:st.val(),nKilometraje:le.val(),idCliente:Ge.val(),idTecnico:ne.val(),idAsesor:se.val(),idcCondicionPago:ae.val(),cObservaciones:ee.val(),mo_revision:je.val(),mo_mecanica:Le.val(),terceros:Ee.val(),otros_mo:Pe.val(),respuestos:De.val(),accesorios:Te.val(),lubricantes:Ne.val(),otros_rep:Fe.val(),total:Ue.val(),id_mantenimiento_array:o,id_revision_array:r,id_tipo_array:n,precio_array:s,modo_array_mant:c,modo_array_serv:l},f=""===K.val()?0:K.val();a.updated("orden_servicios/createOrden",f,m,function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.res;console.log(a[0].Mensaje),Number(a[0].Mensaje)?($("#nConsecutivo").val(a[0].Mensaje),G.val("0"),z.prop("disabled",!0),te.prop("disabled",!0),i.textType({title:"",message:"La orden se registró correctamente.",type:"success"}),LoadRecordsButtonOrden_Servicio.click()):i.textType({title:"",message:a[0].Mensaje,type:"info"})}else{var o=t.isUndefined(e.message)?"No se pudo guardar el Vehiculo. Intente nuevamente.":e.message;i.textType({title:"",message:o,type:"info"})}})}},e.saveVehiculos=function(){var e=!0;if(e=e&&Qe.required(),e=e&&Ze.required(),e=e&&Je.required(),e=e&&Xe.required(),e=e&&et.required(),e=e&&tt.required(),e=e&&Q.required()){var o={idMarca:Qe.val(),idModelo:Ze.val(),motor:Q.val(),n_chasis:Je.val(),anio_fabricacion:Xe.val(),color:et.val(),placa:tt.val()},r=0;a.updated("vehiculos_terceros/createVehi",r,o,function(e){
if(!t.isUndefined(e.status)&&e.status)at.val(tt.val()),d(),V.modal("hide");else{var a=t.isUndefined(e.message)?"No se pudo guardar el Vehiculo. Intente nuevamente.":e.message;i.textType({title:"",message:a,type:"info"})}})}},R.click(function(e){y()}),C(),x(),k();var ct=getFormSearch("frm-search-Orden_Servicio","search_b","LoadRecordsButtonOrden_Servicio"),lt=$("#table_container_Orden_Servicio");lt.jtable({title:"Lista de Ordenes de Servicios",paging:!0,sorting:!0,actions:{listAction:base_url+"/orden_servicios/list"},messages:{addNewRecord:"Nuevo Orden de Servicio",editRecord:"Editar Orden de Servicio"},toolbar:{items:[{cssClass:"buscador",text:ct},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("orden_servicios/excel",{})}},{cssClass:"btn-danger-admin",text:'<i class="fa fa-plus"></i> Nuevo Orden de Servicio',click:function(){r()}}]},fields:{cCodConsecutivo:{key:!0,create:!1,edit:!1,list:!0},nConsecutivo:{title:"Consecutivo"},dFecRec:{title:"Fecha Registro",width:"20%",sorting:!1,display:function(e){return moment(e.record.dFecRec).format("DD/MM/YYYY")}},idCliente:{title:"Cliente",options:base_url+"/orden_servicios/getCliente"},iEstado:{title:"Estado",options:{0:"Registrado",1:"Con Proforma",2:"En ejecución",3:"Terminada",4:"Cancelada"}},cPlacaVeh:{title:"Placa",values:{I:"Inactivo",A:"Activo"}},edit:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" class="edit-orden" data-id="'+e.record.cCodConsecutivo+"_"+e.record.nConsecutivo+'" title="Editar"><i class="fa fa-edit fa-1-5x"></i></a>'}},Eliminar:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a data-target="#"  data-ide="'+e.record.cCodConsecutivo+"_"+e.record.nConsecutivo+'"   title="Eliminar" class="jtable-command-button eliminar-Orden"><i class="fa fa-trash fa-1-5x fa-red"><span>Eliminar</span></i></a>'}}},recordsLoaded:function(e,t){$(".edit-orden").click(function(e){var t=$(this).attr("data-id");o(t),e.preventDefault()}),$(".eliminar-Orden").click(function(e){var t=$(this).attr("data-ide");O.val(t),I.modal("show"),e.preventDefault()})},formCreated:function(e,t){t.form.find('input[name="Categoria"]').attr("onkeypress","return soloLetras(event)"),$("#Edit-estado").parent().addClass("i-checks"),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click(),"A"==e.target.value?($("#Edit-estado").val("I"),$(".i-checks span").text("Inactivo")):($("#Edit-estado").val("A"),$(".i-checks span").text("Activo"))})},formSubmitting:function(e,t){var a=!0;return a=a&&t.form.find('input[name="Categoria"]').required()}}),generateSearchForm("frm-search-Orden_Servicio","LoadRecordsButtonOrden_Servicio",function(){lt.jtable("load",{search:$("#search_b").val()})},!0)}function t(e,t){e.state("orden_servicios",{url:"/orden_servicios",templateUrl:base_url+"/templates/orden_servicios/base.html",controller:"Orden_ServicioCtrl"}),t.otherwise("/")}angular.module("sys.app.orden_servicios").config(t).controller("Orden_ServicioCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.params",[])}(),function(){"use strict";function e(){var e=getFormSearch("frm-search-param","search_p","LoadRecordsButtonP"),t=$("#table_container_param");t.jtable({title:"Lista de Parámetros",paging:!0,sorting:!0,actions:{listAction:base_url+"/params/list",updateAction:base_url+"/params/update"},messages:{addNewRecord:"Nuevo parámetro",editRecord:"Editar parámetro"},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},description:{title:"Descripción"},value:{title:"Valor"}},formSubmitting:function(e,t){var a=!0;return a=a&&t.form.find('input[name="description"]').required(),a=a&&t.form.find('input[name="value"]').required()}}),generateSearchForm("frm-search-param","LoadRecordsButtonP",function(){t.jtable("load",{search:$("#search_p").val()})},!0)}function t(e,t){e.state("params",{url:"/params",templateUrl:base_url+"/templates/params/base.html",controller:"ParamCtrl"}),t.otherwise("/")}angular.module("sys.app.params").config(t).controller("ParamCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=[]}(),function(){"use strict";angular.module("sys.app.payment_condition",[])}(),function(){"use strict";function e(e){var t=getFormSearch("frm-search-PaymentCondition","search_c","LoadRecordsButtonPaymentCondition"),a=$("#table_container_payment_condition");a.jtable({title:"Lista de Condiciones de Pago",paging:!0,sorting:!0,actions:{listAction:base_url+"/payment_condition/list",createAction:base_url+"/payment_condition/create",updateAction:base_url+"/payment_condition/update",deleteAction:base_url+"/payment_condition/delete"},messages:{addNewRecord:"Nueva Condición de Pago",editRecord:"Editar Condición de Pago"},toolbar:{items:[{cssClass:"buscador",text:t},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("payment_condition/excel",{})}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},code:{title:"Código",width:"3%"},description:{title:"Descripción"},days:{title:"Días",width:"1%",listClass:"text-right"}},formCreated:function(e,t){t.form.find('input[name="days"]').attr("onkeypress","return soloNumeros(event)")},formSubmitting:function(e,t){var a=!0;return a=a&&t.form.find('input[name="code"]').required(),a=a&&t.form.find('input[name="days"]').required(),a=a&&t.form.find('input[name="description"]').required()}}),generateSearchForm("frm-search-PaymentCondition","LoadRecordsButtonPaymentCondition",function(){a.jtable("load",{search:$("#search_c").val()})},!0)}function t(e,t){e.state("payment_condition",{url:"/payment_condition",templateUrl:base_url+"/templates/payment_condition/base.html",controller:"PaymentConditionCtrl"}),t.otherwise("/")}angular.module("sys.app.payment_condition").config(t).controller("PaymentConditionCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope"]}(),function(){"use strict";angular.module("sys.app.permissions",[])}(),function(){"use strict";function e(e,t,a,i){function o(){var e=s.val();e=null==e?1:e,n.html(""),t.all("permissions/getPermissions","id="+e,function(e){a.each(e.Records,function(e){n.append("<option value='"+e.id+"'>"+e.modulo+"</option>")})})}var r=$("#listPermissions"),n=$("#permissions"),s=$("#profile");t.all("permissions/getProfiles","",function(e){a.each(e.Options,function(e,t){var a=0==t?"selected":"";s.append("<option value='"+e.Value+"' "+a+">"+e.DisplayText+"</option>")}),o()}),t.all("permissions/list","",function(e){a.each(e.Records,function(e){r.append("<option value='"+e.id+"'>"+e.modulo+"</option>")})}),e.changeProfile=function(){o()},e.add=function(){var e={id:r.val().join(),profile_id:s.val()};t.updated("permissions/add",0,e,function(e){0==parseInt(e.validation_failed)?o():i.textType({title:"",message:e.errors,type:"error"})})},e.del=function(){var e={id:n.val().join()};t.updated("permissions/del",0,e,function(e){0==parseInt(e.validation_failed)?o():1==parseInt(e.validation_failed)?i.textType({title:"",message:"Hubo un error al eliminar el permiso. Actualice su navegador porfavor",type:"error"}):i.textType({title:"",message:"Debe escoger un permiso para eliminar",type:"error"})})},e.reload=function(){location.reload()}}function t(e,t){e.state("permissions",{url:"/permissions",templateUrl:base_url+"/templates/permissions/base.html",controller:"PermissionCtrl"}),t.otherwise("/")}angular.module("sys.app.permissions").config(t).controller("PermissionCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","RESTService","_","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.petty_cash",[])}(),function(){"use strict";function e(e,t,a,i){function o(){k||(d=$("#modalPC"),p=$("#title-pc"),u=$("#modalUser"),m=$("#pc_user_body"),f=$("#pc_id"),v=$("#pc_code"),h=$("#pc_description"),_=$("#pc_liable_id"),g=$("#pc_liable_name"),b=$("#pc_liable_username"),u.on("hidden.bs.modal",function(e){d.attr("style","display:block;")}),u.on("show.bs.modal",function(e){d.attr("style","display:block; z-index:2030 !important")}),d.on("hidden.bs.modal",function(e){r()}),l())}function r(){cleanRequired(),p.html(""),f.val(""),h.val(""),v.val(""),_.val(""),g.val(""),b.val(""),m.html(""),activeTab("general")}function n(){o(),d.modal("show"),p.html("Nueva Caja Chica")}function s(e){o(),p.html("Editar Caja Chica"),a.get("petty_cash/find",e,function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.data;f.val(a.id),h.val(a.description),v.val(a.code),_.val(a.liable_id),b.val(a.liable_username),g.val(a.liable_name),d.modal("show"),t.each(a.users,function(e){c(e.id,e.username,e.name)})}else i.textType({title:"",message:"Hubo un error al obtener una caja chica. Intente nuevamente.",type:"error"})})}function c(e,t,a){if($("#tr_b_"+e).length>0)return i.showWarning({title:"",message:"Ya se asignó este Usuario"}),!1;var o=$('<tr id="tr_b_'+e+'"></tr>'),r=$("<td>"+t+"</td>"),n=$("<td>"+a+"</td>"),s=$('<input type="hidden" class="pc_user" value="'+e+'" />');r.append(s);var c=$('<td class="text-center"></td>'),l=$('<button class="btn btn-danger btn-xs delPettyCash" data-id="'+e+'" type="button"><span class="fa fa-trash"></span></button>');c.append(l),o.append(r).append(n).append(c),m.append(o),u.modal("hide"),$(".delPettyCash").click(function(e){var t=$(this).attr("data-id");i.confirm({title:"",message:"¿Está seguro que desea quitar este usuario?",confirm:"Si",cancel:"No"},function(){$("#tr_b_"+t).remove()}),e.preventDefault()})}function l(){k=!0;var e=getFormSearch("frm-search-user","search_user","LoadRecordsButtonUser"),t=$("#table_container_usuario");t.jtable({title:"Lista de Usuarios",paging:!0,sorting:!0,actions:{listAction:base_url+"/petty_cash/listUser"},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},username:{title:"Usuario"},name:{title:"Nombre"},select:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_u" data-code="'+e.record.id+'" data-title="'+e.record.username+'"data-name="'+e.record.name+'" ><i class="fa fa-'+icon_select+' fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_u").click(function(e){var t=$(this).attr("data-code"),a=$(this).attr("data-title"),i=$(this).attr("data-name");0===y?(_.val(t),b.val(a),g.val(i),u.modal("hide")):c(t,a,i),e.preventDefault()})}}),generateSearchForm("frm-search-user","LoadRecordsButtonUser",function(){t.jtable("load",{search:$("#search_user").val()})},!1)}var d,u,p,m,f,v,h,_,g,b,y=0;e.openUser=function(){$("#LoadRecordsButtonUser").click(),u.modal("show"),y=1},e.openLiable=function(){$("#LoadRecordsButtonUser").click(),u.modal("show"),y=0},e.savePettyCash=function(){var e=!0;if(e=e&&v.required(),e=e&&h.required(),e=e&&b.required(),e=e&&g.required(),e&&""===m.html())return i.showWarning({title:"",message:"Debe agregar mínimo 1 usuario a la caja chica"}),activeTab("user"),!1;if(e){var o=[];$.each($(".pc_user"),function(e,t){o[e]=$(t).val()}),o=o.join(",");var r={id:f.val(),code:v.val(),liable_id:_.val(),description:h.val(),users:o},n=""===f.val()?0:f.val();a.updated("petty_cash/savePettyCash",n,r,function(e){if(!t.isUndefined(e.status)&&e.status)i.textType({title:"",message:"La caja Chica  se guardó correctamente.",type:"success"}),d.modal("hide"),LoadRecordsButtonPettyCash.click();else{var a=t.isUndefined(e.message)?"Hubo un error al guardar la caja chica. Intente nuevamente.":e.message;i.textType({title:"",message:a,type:"error"})}})}};var C=getFormSearch("frm-search-PettyCash","search_PettyCash","LoadRecordsButtonPettyCash"),x=$("#table_container_petty_cash");x.jtable({title:"Lista de Caja Chica",paging:!0,sorting:!0,actions:{listAction:base_url+"/petty_cash/list",deleteAction:base_url+"/petty_cash/delete"},toolbar:{items:[{cssClass:"buscador",text:C},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("petty_cash/excel",{})}},{cssClass:"btn-success",text:'<i class="fa fa-plus"></i> Nueva Caja Chica',click:function(){n()}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},description:{title:"Descripción"},code:{title:"Código"},liable_name:{title:"Responsable"},edit:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Editar" class="edit_pc" data-code="'+e.record.id+'"><i class="fa fa-pencil-square-o fa-1-5x fa-green"></i></a>'}}},recordsLoaded:function(e,t){$(".edit_pc").click(function(e){var t=$(this).attr("data-code");s(t),e.preventDefault()})}}),generateSearchForm("frm-search-PettyCash","LoadRecordsButtonPettyCash",function(){x.jtable("load",{search:$("#search_PettyCash").val()})},!0);var k=!1}function t(e,t){e.state("petty_cash",{url:"/petty_cash",templateUrl:base_url+"/templates/petty_cash/base.html",controller:"PettyCashCtrl"}),t.otherwise("/")}angular.module("sys.app.petty_cash").config(t).controller("PettyCashCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.products",[])}(),function(){"use strict";function e(e,t,a,i,o){function r(){cleanRequired(),_.html(""),g.val(""),k.val(""),$(".imgMinPhoto").html(""),w.prop("checked",!0).iCheck("update"),A.html("Activo"),R.val(""),S.val(""),b.prop("checked",!1).iCheck("update"),y.prop("checked",!1).iCheck("update"),C.prop("checked",!0).iCheck("update"),x.prop("checked",!0).iCheck("update"),K.html(""),E.val(""),j.val(""),P.val(""),D.val(""),T.val(""),N.val(""),F.val(""),M.val(""),I.html(""),I.append('<option value="" selected>Seleccione</option>'),B.val("").trigger("change"),Y.val("").trigger("change"),z.val("").trigger("change"),H.html(""),H.append('<option value="" selected>Seleccione</option>'),G.val("").trigger("change"),V.val("").trigger("change"),O.val("").trigger("change"),U.val(""),Q.addClass("hide"),activeTab("general")}function n(){r(),_.html("Nuevo Artículo"),u(),f.modal("show")}function s(e,o){a.get("articles/TraerSubFamilia",o,function(a){if(!t.isUndefined(a.status)&&a.status){a.data;H.html(""),H.append('<option value="" selected>Seleccione</option>'),t.each(a.data,function(t){t.idSubFamilia==e?H.append('<option value="'+t.idSubFamilia+'" selected >'+t.descripcion+"</option>"):H.append('<option value="'+t.idSubFamilia+'" >'+t.descripcion+"</option>")})}else i.textType({title:"",message:"Hubo un error al obtener la Sub Familia. Intente nuevamente.",type:"error"})})}function c(e,o){a.get("articles/TraerModelos",o,function(a){if(!t.isUndefined(a.status)&&a.status){a.data;I.html(""),I.append('<option value="" selected>Seleccione</option>'),t.each(a.data,function(t){t.idModelo==e?I.append('<option value="'+t.idModelo+'" selected >'+t.descripcion+"</option>"):I.append('<option value="'+t.idModelo+'" >'+t.descripcion+"</option>")})}else i.textType({title:"",message:"Hubo un error al obtener el Modelo. Intente nuevamente.",type:"error"})})}function l(o){_.html("Editar Artículo"),a.get("articles/find",o,function(a){if(!t.isUndefined(a.status)&&a.status){var o=a.data;U.val(Number(o.costo)),g.val(o.id);var r="1"===o.state;w.prop("checked",r).iCheck("update"),e.chkState(),""!=o.image&&(k.val(o.image),uploadMorePicture()),E.val(o.code_article),P.val(o.code_matrix),R.val(o.description),S.val(o.description_detail);var n="1"===o.serie;b.prop("checked",n).iCheck("update");var l="1"===o.lote;y.prop("checked",l).iCheck("update");var d="1"===o.disponible_venta;x.prop("checked",d).iCheck("update");var u="1"===o.impuesto;C.prop("checked",u).iCheck("update"),D.val(o.motor),T.val(o.chasis),N.val(o.anio_modelo),F.val(o.anio_fabricacion),M.val(o.color),O.val(o.um_id).trigger("change"),B.val(o.idCategoria).trigger("change"),Y.val(o.idMarca).trigger("change"),z.val(o.idFamilia).trigger("change"),H.val(o.idSubFamilia).trigger("change"),I.val(o.idModelo).trigger("change"),V.val(o.type_id).trigger("change"),G.val(o.idGrupoContableCabecera).trigger("change"),s(o.idSubFamilia,o.idFamilia),c(o.idModelo,o.idMarca),""!=o.cantidad&&(j.val(o.idKit),t.each(o.GrupoKit,function(e){p(e.idArticulo_kit,e.code_kit,e.idArticulo_kit_description,Math.trunc(e.cantidadkit))})),f.modal("show")}else i.textType({title:"",message:"Hubo un error al obtener el Artículo. Intente nuevamente.",type:"error"})})}function d(){a.all("articles/data_form","",function(e){!t.isUndefined(e.status)&&e.status&&(V.append('<option value="" selected>Seleccionar</option>'),t.each(e.types,function(e){V.append('<option value="'+e.Value+'">'+e.DisplayText+"</option>")}),O.append('<option value="" selected>Seleccionar</option>'),t.each(e.unidadMedida,function(e){O.append('<option value="'+e.Value+'">'+e.DisplayText+"</option>")}),B.append('<option value="" selected>Seleccionar</option>'),t.each(e.categoria,function(e){B.append('<option value="'+e.Value+'">'+e.DisplayText+"</option>")}),z.append('<option value="" selected>Seleccionar</option>'),t.each(e.familia,function(e){z.append('<option value="'+e.Value+'">'+e.DisplayText+"</option>")}),Y.append('<option value="" selected>Seleccionar</option>'),t.each(e.marca,function(e){Y.append('<option value="'+e.Value+'">'+e.DisplayText+"</option>")}),G.append('<option value="" selected>Seleccionar</option>'),t.each(e.grupocontable,function(e){G.append('<option value="'+e.Value+'">'+e.DisplayText+"</option>")}))},function(){d()})}function u(){var e=getFormSearch("frm-search-cc22","search_cc22","LoadRecordsButtonCC22");q=$("#table_container_Register_Articulo"),q.jtable({title:"Lista de Articulos",paging:!0,sorting:!0,cache:!1,actions:{listAction:base_url+"/articles/get_articles_precios"},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{idProducto:{key:!0,create:!1,edit:!1,list:!1},Codigo_Articulo:{title:"Código Articulo"},Producto:{title:"Producto"},Precio:{title:"Precio",display:function(e){var t=Number(e.record.Precio);return t.toFixed(2)}},Cliente:{title:"Tipo Cliente"},Moneda:{title:"Moneda"}},recordsLoaded:function(e,t){$(".select_cc").click(function(e){var t=$(this).attr("data-code"),a=$(this).attr("data-name"),i=$(this).attr("data-type"),o=$(this).attr("data-serie"),r=$(this).attr("data-lote"),n=$(this).attr("data-costo");seleccionarModal(t,a,i,o,r,n),e.preventDefault()})}}),generateSearchForm("frm-search-cc22","LoadRecordsButtonCC22",function(){q.jtable("load",{search:$("#search_cc22").val()})},!0)}function p(e,t,a,o){if($("#tr_b_"+e).length>0)return i.showWarning({title:"",message:"Ya se asignó este Producto"}),!1;if(e==g.val())return i.showWarning({title:"",message:"Este Producto está en uso"}),!1;var r=$('<tr id="tr_b_'+e+'"></tr>'),n=$("<td>"+t+"</td>"),s=$("<td>"+a+"</td>"),c=$("<td></td>"),l=$('<input type="hidden" class="id_p_kit" value="'+e+'" />'),d=$('<input type="number" class="id_p_cantidad form-control input-sm" min="1"  value="'+o+'" />');n.append(l),c.append(d);var u=$('<td class="text-center"></td>'),p=$('<button class="btn btn-danger btn-xs delkit" data-id="'+e+'" type="button"><span class="fa fa-trash"></span></button>');u.append(p),r.append(n).append(s).append(c).append(u),K.append(r),L.modal("hide"),$(".delkit").click(function(e){var t=$(this).attr("data-id");i.confirm({title:"",message:"¿Está seguro que desea quitar este Articulo?",confirm:"Si",cancel:"No"},function(){$("#tr_b_"+t).remove()}),e.preventDefault()})}function m(e,t){if($("#tr_b_"+e).length>0)return i.showWarning({title:"",message:"Ya se asignó esta marca al artículo"}),!1;var a=$('<tr id="tr_b_'+e+'"></tr>'),o=$("<td>"+t+"</td>"),r=$('<input type="hidden" class="p_brand" value="'+e+'" />');o.append(r);var n=$('<td class="text-center"></td>'),s=$('<button class="btn btn-danger btn-xs delBrand" data-id="'+e+'" type="button"><span class="fa fa-trash"></span></button>');n.append(s),a.append(o).append(n),p_brand_body.append(a),h.modal("hide"),$(".delBrand").click(function(e){var t=$(this).attr("data-id");i.confirm({title:"",message:"¿Está seguro que desea quitar esta marca?",confirm:"Si",cancel:"No"},function(){$("#tr_b_"+t).remove()}),e.preventDefault()})}var f=$("#modalProduct"),v=$("#modalCC"),h=$("#modalBrand"),_=$("#titleModalProduct"),g=$("#p_id"),b=$("#p_serie"),y=$("#p_lote"),C=$("#p_impuesto"),x=$("#p_disponible_venta"),k=$("#p_image"),w=$("#p_state"),A=$("#state_text"),R=$("#p_description"),S=$("#p_description_detail"),j=$("#idKit"),L=$("#modalArticulo"),E=$("#code_article"),P=$("#code_matrix"),q=$("#table_container_cc2"),D=$("#motor"),T=$("#chasis"),N=$("#anio_modelo"),F=$("#anio_fabricacion"),M=$("#color"),U=$("#p_costo"),O=$("#p_id_unidad_medidad"),I=$("#p_id_modelo"),B=$("#p_id_categoria"),Y=$("#p_id_marca"),z=$("#p_id_familia"),V=$("#p_id_tipo"),H=$("#p_id_subfamilia"),G=$("#p_id_grupocontable"),W=$("#btn-kit"),K=$("#articulo_kit_det"),Q=$("#msg_cont");$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(t){$(t.target).click(),e.chkState()}),e.chkState=function(){var e=w.prop("checked")?"Activo":"Inactivo";A.html(e)},b.on("ifChanged",function(e){b.prop("checked")&&y.prop("checked",!1).iCheck("update")}),y.on("ifChanged",function(e){y.prop("checked")&&b.prop("checked",!1).iCheck("update")}),V.select2(),I.select2(),B.select2(),Y.select2(),z.select2(),H.select2(),G.select2(),f.on("hidden.bs.modal",function(e){r()}),V.change(function(){var e=V.val();3==e?W.prop("disabled",!1):(W.prop("disabled",!0),K.html(""))}),Y.change(function(){var e="xxxxxx",t=Y.val();""!=t&&c(e,t)}),z.change(function(){var e="xxxxxx",t=z.val();""!=t&&s(e,t)}),e.addAritculoKit=function(){L.modal("show"),$("#search_cc2").val(""),$("#LoadRecordsButtonCC2").click(),$("#table_container_cc2 .jtable-main-container .jtable-bottom-panel .jtable-left-area .jtable-goto-page select ").val("1").trigger("change")},e.saveProduct=function(){var e=!0;if(e=e&&E.required(),e=e&&P.required(),e=e&&R.required(),e=e&&O.required(),e=e&&V.required(),e=e&&Y.required(),e=e&&B.required(),e=e&&z.required(),e=e&&G.required(),3==V.val()&&e&&""===K.html())return i.showWarning({title:"",message:"Debe agregar mínimo 1 Artículo Kit"}),activeTab("kit"),!1;if(e||activeTab("general"),b.prop("checked")&&3==V.val())return i.showWarning({title:"",message:"EL Artículo Kit no puede ser serie"}),activeTab("general"),!1;if(y.prop("checked")&&3==V.val())return i.showWarning({title:"",message:"EL Artículo Kit no puede ser Lote"}),activeTab("general"),!1;if(e){var o=""===j.val()?0:j.val();if(""!=K.html()){var r=[];$.each($(".id_p_kit"),function(e,t){r[e]=$(t).val()}),r=r.join(",");var n=[];$.each($(".id_p_cantidad"),function(e,t){n[e]=$(t).val()}),n=n.join(",")}else r="N",n="N";var s={id:g.val(),state:w.prop("checked")?1:0,description:R.val(),description_detail:S.val(),serie:b.prop("checked")?1:0,lote:y.prop("checked")?1:0,disponible_venta:x.prop("checked")?1:0,impuesto:C.prop("checked")?1:0,code_article:E.val(),code_matrix:P.val(),motor:D.val(),chasis:T.val(),anio_modelo:N.val(),anio_fabricacion:F.val(),color:M.val(),idModelo:I.val(),type_id:V.val(),idCategoria:B.val(),idFamilia:z.val(),idSubFamilia:H.val(),idMarca:Y.val(),idGrupoContableCabecera:G.val(),image:k.val(),idArticuloKit:r,cantidadKit:n,idKit:o,um_id:O.val()},c=""===g.val()?0:g.val();a.updated("articles/saveProduct",c,s,function(e){if(!t.isUndefined(e.status)&&e.status)i.textType({title:"",message:"El registro se guardó correctamente con el código "+e.code,type:"success"}),f.modal("hide"),LoadRecordsButtonProduct.click();else{var a=t.isUndefined(e.message)?"Hubo un error al guardar el artículo.":e.message;i.textType({title:"",message:a,type:"info"})}})}},d(),e.type_cc="",e.openCC=function(t){e.type_cc=t,v.modal("show"),$("#search_cc").val(""),$("#LoadRecordsButtonCC").click()},e.clearCC=function(e){1===e?(p_cc_debe.val(""),p_cc_debe_txt.val("")):(p_cc_haber.val(""),p_cc_haber_txt.val(""))};var Z=getFormSearch("frm-search-product","search_p","LoadRecordsButtonProduct"),J=$("#table_container_product");J.jtable({title:"Lista de Artículos",paging:!0,sorting:!0,actions:{listAction:base_url+"/articles/list",deleteAction:base_url+"/articles/delete"},toolbar:{items:[{cssClass:"buscador",text:Z},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("articles/excel",{})}},{cssClass:"btn-danger-admin",text:'<i class="fa fa-plus"></i> Nuevo Artículo',click:function(){n()}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},code_article:{title:"Código Artículo",listClass:"text-center",width:"2%"},description:{title:"Descripción"},code_matrix:{title:"Matriz del Artículo",listClass:"text-center",width:"3%"},state:{title:"Estado",values:{0:"Inactivo",1:"Activo"},type:"checkbox",listClass:"text-center",width:"3%"},edit:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" class="edit-prod" data-id="'+e.record.id+'" title="Editar"><i class="fa fa-edit fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".edit-prod").click(function(e){var t=$(this).attr("data-id");l(t),e.preventDefault()})}}),generateSearchForm("frm-search-product","LoadRecordsButtonProduct",function(){J.jtable("load",{search:$("#search_p").val()})},!0),v.on("hidden.bs.modal",function(e){f.attr("style","display:block;")}),v.on("show.bs.modal",function(e){f.attr("style","display:block; z-index:2030 !important")});var X=getFormSearch("frm-search-cc","search_cc","LoadRecordsButtonCC"),ee=$("#table_container_cc");ee.jtable({title:"Lista de Cuentas Contables",paging:!0,sorting:!0,actions:{listAction:base_url+"/articles/getCC"},toolbar:{items:[{cssClass:"buscador",text:X}]},fields:{IdCuenta:{title:"ID Cuenta",width:"4%"},NombreCuenta:{title:"Cuenta"},select:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_cc" data-name="'+e.record.NombreCuenta+'" data-code="'+e.record.IdCuenta+'"><i class="fa fa-'+icon_select+' fa-1-5x"></i></a>'}}},recordsLoaded:function(t,a){$(".select_cc").click(function(t){var a=$(this).attr("data-code"),i=$(this).attr("data-name");1===e.type_cc?(p_cc_debe.val(a),p_cc_debe_txt.val(i)):(p_cc_haber.val(a),p_cc_haber_txt.val(i)),v.modal("hide"),t.preventDefault()})}}),generateSearchForm("frm-search-cc","LoadRecordsButtonCC",function(){ee.jtable("load",{search:$("#search_cc").val()})},!1);var te=getFormSearch("frm-search-cc2","search_cc2","LoadRecordsButtonCC2"),q=$("#table_container_cc2");q.jtable({title:"Lista de Articulos",paging:!0,sorting:!0,actions:{listAction:base_url+"/articles/getArticulosSelect"},toolbar:{items:[{cssClass:"buscador",text:te}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},code_article:{create:!1,edit:!1,list:!1},description:{title:"Articulos"},select:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_cc" data-name="'+e.record.description+'" data-code="'+e.record.code_article+'" data-id="'+e.record.id+'"><i class="fa fa-'+icon_select+' fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_cc").click(function(e){var t=$(this).attr("data-code"),a=$(this).attr("data-name"),i=$(this).attr("data-id"),o=1;p(i,t,a,o),v.modal("hide"),e.preventDefault()})}}),generateSearchForm("frm-search-cc2","LoadRecordsButtonCC2",function(){q.jtable("load",{search:$("#search_cc2").val()})},!1),e.openBrand=function(){h.modal("show"),$("#search_brand").val(""),$("#LoadRecordsButtonBrand").click()},h.on("hidden.bs.modal",function(e){f.attr("style","display:block;")}),h.on("show.bs.modal",function(e){f.attr("style","display:block; z-index:2030 !important")});var ae=getFormSearch("frm-search-brand","search_brand","LoadRecordsButtonBrand"),ie=$("#table_container_brand");ie.jtable({title:"Lista de Marcas",paging:!0,sorting:!0,actions:{listAction:base_url+"/articles/getBrands"},toolbar:{items:[{cssClass:"buscador",text:ae}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},marca:{title:"Marca"},select:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_brand" data-code="'+e.record.id+'" data-title="'+e.record.marca+'"><i class="fa fa-'+icon_select+' fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_brand").click(function(e){var t=$(this).attr("data-code"),a=$(this).attr("data-title");m(t,a),e.preventDefault()})}}),generateSearchForm("frm-search-brand","LoadRecordsButtonBrand",function(){ie.jtable("load",{search:$("#search_brand").val()})},!1),$("#modalCrop").on("show.bs.modal",function(e){f.attr("style","display:block; z-index:2030 !important")});var oe="/articles/upload",re="/img/products/",ne=200,se=150,ce=4/3,le=setInterval(function(){$("#modalCrop").length>0&&(generateCrop(oe,re,ne,se,ce,"p_image"),clearInterval(le))},1e3)}function t(e,t){e.state("articles",{url:"/articles",templateUrl:base_url+"/templates/products/base.html",controller:"ProductCtrl"}),t.otherwise("/")}angular.module("sys.app.products").config(t).controller("ProductCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory","Notify"]}(),function(){"use strict";angular.module("sys.app.profiles",[])}(),function(){"use strict";function e(){var e=getFormSearch("frm-search-profile","search_p","LoadRecordsButtonProfile"),t=$("#table_container_profile");t.jtable({title:"Lista de Perfiles",paging:!0,sorting:!0,actions:{listAction:base_url+"/profiles/list",createAction:base_url+"/profiles/create",updateAction:base_url+"/profiles/update",deleteAction:base_url+"/profiles/delete"},messages:{addNewRecord:"Nuevo Perfil",editRecord:"Editar Perfil"},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},perfil:{title:"Perfil"}},formCreated:function(e,t){t.form.find('input[name="perfil"]').attr("onkeypress","return soloLetras(event)")},formSubmitting:function(e,t){var a=!0;return a=a&&t.form.find('input[name="perfil"]').required()}}),generateSearchForm("frm-search-profile","LoadRecordsButtonProfile",function(){t.jtable("load",{search:$("#search_p").val()})},!0)}function t(e,t){e.state("profiles",{url:"/profiles",templateUrl:base_url+"/templates/profiles/base.html",controller:"ProfileCtrl"}),t.otherwise("/")}angular.module("sys.app.profiles").config(t).controller("ProfileCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=[]}(),function(){"use strict";angular.module("sys.app.proformas",[])}(),function(){"use strict";function e(e,t,a,i){function o(){r.modal("show"),n.html("Nueva Proforma")}var r=$("#modalProforma"),n=$("#titlemodalProforma");e.chkState=function(){var e=w_state.prop("checked")?"Activo":"Inactivo";state_state.html(e)};var s=getFormSearch("frm-search-Proforma","search_b","LoadRecordsButtonProforma"),c=$("#table_container_Proforma");c.jtable({title:"Lista de Proformas",paging:!0,sorting:!0,actions:{listAction:base_url+"/proformas/list"},messages:{addNewRecord:"Nueva Categoría",editRecord:"Editar Categoría"},toolbar:{items:[{cssClass:"buscador",text:s},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("proformas/excel",{})}},{cssClass:"btn-danger-admin",text:'<i class="fa fa-plus"></i> Nueva Proforma',click:function(){o()}}]},fields:{cCodConsecutivo:{key:!0,create:!1,edit:!1,list:!0,title:"Cod"},nConsecutivo:{title:"Consecutivo"},cCodConsecutivoOS:{title:"Consecutivo Os"},edit:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" class="edit-orden" data-id="'+e.record.cCodConsecutivo+"_"+e.record.nConsecutivo+'" title="Editar"><i class="fa fa-edit fa-1-5x"></i></a>'}},Eliminar:{width:"1%",sorting:!1,edit:!1,
create:!1,listClass:"text-center",display:function(e){return'<a data-target="#"  data-ide="'+e.record.cCodConsecutivo+"_"+e.record.nConsecutivo+'"   title="Eliminar" class="jtable-command-button eliminar-Orden"><i class="fa fa-trash fa-1-5x fa-red"><span>Eliminar</span></i></a>'}}},recordsLoaded:function(e,t){$(".edit-orden").click(function(e){var t=$(this).attr("data-id");findRegister_Orden(t),e.preventDefault()}),$(".eliminar-Orden").click(function(e){var t=$(this).attr("data-ide");idOrdenDelete.val(t),modalDeleteOrden.modal("show"),e.preventDefault()})},formCreated:function(e,t){t.form.find('input[name="Categoria"]').attr("onkeypress","return soloLetras(event)"),$("#Edit-estado").parent().addClass("i-checks"),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click(),"A"==e.target.value?($("#Edit-estado").val("I"),$(".i-checks span").text("Inactivo")):($("#Edit-estado").val("A"),$(".i-checks span").text("Activo"))})},formSubmitting:function(e,t){var a=!0;return a=a&&t.form.find('input[name="Categoria"]').required()}}),generateSearchForm("frm-search-Proforma","LoadRecordsButtonProforma",function(){c.jtable("load",{search:$("#search_b").val()})},!0)}function t(e,t){e.state("proformas",{url:"/proformas",templateUrl:base_url+"/templates/proformas/base.html",controller:"ProformaCtrl"}),t.otherwise("/")}angular.module("sys.app.proformas").config(t).controller("ProformaCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.projects",[])}(),function(){"use strict";function e(e,t,a,i){function o(){cleanRequired(),J.empty(),ne.prop("disabled",!1),gt=0,se.find("input, textarea").val(""),le.val(1),$t=0,de.val("Registrado"),activeTab("home"),$(".tab_4, .tab5").addClass("hide"),xe.empty(),Te.val("").trigger("change"),Te.find("option:gt(0)").remove(),bt=!1,r(),$(".send_approval").addClass("hide")}function r(){se.find("input, textarea, select").prop("disabled",bt),$(".p_inc_frm_apu .form-control").prop("disabled",bt),$(".inp_show_approval").prop("disabled",bt);var e=$(".show_not_approval");e.removeClass("hide"),bt&&e.addClass("hide")}function n(){cleanBorderRequired(),yt=0,we.val(""),Ae.empty().trigger("change"),$(".chk_sp").prop("checked",!1).iCheck("update"),Re.empty(),qe.empty(),activeTab("levels")}function s(){cleanBorderRequired(),Ct=0,je.val(""),Le.val(""),Ee.val(""),Pe.val("")}function c(){Ct=0,De.empty().trigger("change"),$("#tvLevels").find("input[name=chk_level_sp]").filter(":checked").prop("checked",!1).iCheck("update"),closeTreed("tvLevels")}function l(){Ne.addClass("hide"),Fe.empty(),d()}function d(){Ue.addClass("hide"),Oe.addClass("hide"),Me.empty(),Ie.empty(),Be.empty(),$(".p_inc_table_activity .form-control").val(""),$("#p_inc_show_totals_apu").find("tr").empty(),ze.empty(),We.empty(),At=0}function u(){Je.empty(),Xe.empty(),tt.empty(),et.empty(),nt.empty(),$(".p_inc_frm_apu .form-control").val(""),rt.val("0.00"),lt.empty(),ut.empty(),ft.empty(),ht.empty(),$(".p_inc_apu_tot").html("0.00")}function p(){Ze.empty().trigger("change"),$("#tvLevelsIncome").find("input[name=chk_level_inc]").filter(":checked").prop("checked",!1).iCheck("update"),closeTreed("tvLevelsIncome")}function m(){X=$("#project_states"),X.empty().change(function(){$("#LoadRecordsButtonP").click()}),a.all("projects/getDataProject","",function(e){!t.isUndefined(e.status)&&e.status?(ee=e.levels,te=e.apu,t.each(e.states,function(e){X.append('<option value="'+e.Value+'">'+e.DisplayText+"</option>")}),oe=e.unity,g()):m()},function(){m()})}function f(){ae||(se=$("#frm_tab_general"),ce=$("#p_code"),le=$("#p_cost_load"),de=$("#p_state"),de.val("Registrado"),ue=$("#p_description"),pe=$("#p_client_id"),me=$("#p_client_code"),fe=$("#p_client_description"),ve=$("#p_gg_direct"),he=$("#p_gg_indirect"),_e=$("#p_transport"),ge=$("#p_utils"),$e=$("#p_date_start"),generateDatePicker($e),be=$("#p_date_end"),generateDatePicker(be),ye=$("#p_days"),Ce=$("#p_total"),xe=$("#t_body_list_sub_projects"),ke=$("#p_title_modal_sp"),we=$("#p_sp_description"),Ae=$("#p_search_front"),generateSelect2Ajax(Ae,"Buscar frente...",base_url+"/projects/searchFront"),Re=$("#t_body_list_fronts"),Se=$("#p_title_modal_level"),je=$("#p_sp_id_level"),Le=$("#p_sp_prev_level"),Ee=$("#p_sp_code_level"),Pe=$("#p_sp_name_level"),qe=$("#t_body_list_levels"),De=$("#p_search_matrix_level"),generateSelect2Ajax(De,"Buscar...",base_url+"/projects/searchMatrix"),De.change(function(){""!==$(this).val()&&$("#tvLevels").find("input[name=chk_level_sp]").filter(":checked").prop("checked",!1).iCheck("update")}),Ze=$("#p_search_matrix_income"),generateSelect2Ajax(Ze,"Buscar...",base_url+"/projects/searchAPU"),Ze.change(function(){""!==$(this).val()&&$("#tvLevelsIncome").find("input[name=chk_apu_inc]").filter(":checked").prop("checked",!1).iCheck("update")}),Ne=$("#p_table_structure_level"),Te=$("#p_inc_sub_projects"),Te.change(function(){var e=$(this).val();l(),""!==e&&j(e)}),Fe=$("#t_body_income_levels"),Me=$("#p_inc_list_activity"),Ue=$(".info_income_1"),Oe=$(".info_income_2"),Ie=$("#p_income_list_materials"),Be=$("#p_income_total_materials"),Ye=$("#p_inc_q_lb_activity"),Ye.keyup(function(){q()}),ze=$("#p_inc_u_lb_activity"),Ve=$("#p_inc_p_lb_activity"),He=$("#p_inc_t_lb_activity"),Ge=$("#p_inc_q_pv_activity"),We=$("#p_inc_u_pv_activity"),Ke=$("#p_inc_p_pv_activity"),Qe=$("#p_inc_t_pv_activity"),Xe=$("#p_inc_code_apu"),Je=$("#p_inc_level_apu"),tt=$("#p_inc_matrix_apu"),et=$("#p_inc_description_apu"),at=$("#p_inc_hours_apu"),at.keyup(function(){O()}),it=$("#p_inc_mo_apu"),it.keyup(function(){O()}),ot=$("#p_inc_eq_apu"),ot.keyup(function(){O()}),rt=$("#p_inc_total_apu"),nt=$(".p_inc_und_apu"),st=$("#p_inc_apu_q_mo"),ct=$("#p_inc_apu_t_mo"),lt=$("#p_inc_apu_t_body_mo"),dt=$("#p_inc_apu_t_mat"),ut=$("#p_inc_apu_t_body_mat"),pt=$("#p_inc_apu_q_eq"),mt=$("#p_inc_apu_t_eq"),ft=$("#p_inc_apu_t_body_eq"),vt=$("#p_inc_apu_t_sc"),ht=$("#p_inc_apu_t_body_sc"),_t=$("#p_inc_apu_table"),e.showMat_(3),e.showMat__(3),V=$("#modalP"),H=$("#modalSP"),G=$("#modalClientProject"),W=$("#modalLevel"),K=$("#modalStructureLevel"),Q=$("#modalAnalysisIncome"),Z=$("#modalStructureIncome"),J=$("#titleP"),ne=$("#btn_return"),V.on("hidden.bs.modal",function(e){o()}),H.on("show.bs.modal",function(e){V.attr("style","display:block; z-index:2030 !important")}),H.on("hidden.bs.modal",function(e){n(),V.attr("style","display:block; overflow-y: auto;")}),G.on("hidden.bs.modal",function(e){$("#search_client_p").val(""),$("#LoadRecordsButtonClientP").click(),V.attr("style","display:block; overflow-y: auto;")}),G.on("show.bs.modal",function(e){$("#LoadRecordsButtonClientP").click(),V.attr("style","display:block; z-index:2030 !important")}),W.on("hidden.bs.modal",function(e){s(),H.attr("style","display:block; overflow-y: auto;")}),W.on("show.bs.modal",function(e){H.attr("style","display:block; z-index:2030 !important")}),W.on("shown.bs.modal",function(e){Ee.focus()}),K.on("hidden.bs.modal",function(e){c(),H.attr("style","display:block; overflow-y: auto;")}),K.on("show.bs.modal",function(e){H.attr("style","display:block; z-index:2030 !important")}),Q.on("hidden.bs.modal",function(e){u(),V.attr("style","display:block; overflow-y: auto;")}),Q.on("show.bs.modal",function(e){V.attr("style","display:block; z-index:2030 !important")}),Z.on("hidden.bs.modal",function(e){p(),Q.attr("style","display:block; overflow-y: auto;")}),Z.on("show.bs.modal",function(e){Q.attr("style","display:block; z-index:2030 !important")}),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifClicked",function(t){$(t.target).click();var a;$(t.target).hasClass("mat_")?(a=$(t.target).attr("data-code"),e.showMat_(a)):$(t.target).hasClass("mat__")&&(a=$(t.target).attr("data-code"),e.showMat__(a))}),$('a[data-toggle="tab"]').on("shown.bs.tab",function(e){var t=$(e.target).attr("data-target"),a=$(".send_approval");a.addClass("hide"),"#income"!==t||bt||a.removeClass("hide")}),generateListMatrix("table_gg",ee),b())}function v(){f(),J.html("Registrar Proyecto"),V.modal("show")}function h(t){var a=$(t).val();return!(""!==a&&parseFloat(a)>100)||(e.showAlert("","El porcentage ingresado no debe ser mayor de 100","warning"),$(t).focus(),!1)}function _(i){f(),a.get("projects/find",i,function(a){if(!t.isUndefined(a.status)&&a.status){var i=a.data;gt=i.id,$t=parseInt(i.sub_state_id),2===$t&&(bt=!0,r()),ce.val(i.code),le.val(i.cost_load),de.val(i.state),ue.val(i.description),pe.val(i.client_id),me.val(i.client_document),fe.val(i.client_description),ve.val(i.gg_direct),$(".p_inc_percentage").html(parseFloat(i.gg_direct)),he.val(i.gg_indirect_),_e.val(i.transport),ge.val(i.utils),$e.val(i.date_start),be.val(i.date_end),ye.val(i.days),Ce.val(i.total),J.html(i.description+" - "+i.state),R(i.sp),V.modal("show")}else e.showAlert("","Hubo un error al obtener el proyecto. Intente nuevamente.","error")})}function g(){generateSearchForm("frm-search-p","LoadRecordsButtonP",function(){wt.jtable("load",{search:$("#search_p").val(),check:z.prop("checked"),from:B.format("YYYY-MM-DD"),to:Y.format("YYYY-MM-DD"),state:X.val(),sub_state:!0})},!0),createTreeSelect(ee,"table_sp","tvLevels","showLevels","chk_radio","chk_level_sp",function(){$("#tvLevels").find("input[name=chk_level_sp]").click(function(){De.empty().trigger("change")})}),createTreeSelect(te,"table_level_income","tvLevelsIncome","showLIncome","chk_radio_inc","chk_apu_inc",function(){$("#tvLevelsIncome").find("input[name=chk_apu_inc]").click(function(){Ze.empty().trigger("change")})})}function b(){ae=!0;var e=getFormSearch("frm-search-client-p","search_client_p","LoadRecordsButtonClientP"),a=$("#table_container_client_project");a.jtable({title:"Lista de Clientes",paging:!0,sorting:!1,actions:{listAction:base_url+"/projects/clientsList"},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},Documento:{title:"Documento",width:"2%",listClass:"text-center"},NombreEntidad:{title:"Cliente"},DireccionLegal:{title:"Dirección Legal",list:show_list_},select:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_client_p" data-id="'+e.record.id+'"><i class="fa fa-'+icon_select+' fa-1-5x"></i></a>'}}},recordsLoaded:function(e,a){$(".select_client_p").click(function(e){var i=$(this).attr("data-id"),o=t.find(a.records,function(e){return e.id===i});o&&(pe.val(o.id),me.val(o.Documento),fe.val(o.NombreEntidad)),G.modal("hide"),e.preventDefault()})}}),generateSearchForm("frm-search-client-p","LoadRecordsButtonClientP",function(){a.jtable("load",{search:$("#search_client_p").val()})},!1)}function y(e,t,a){qe.find('tr[data-level="'+e+'"]').attr("data-level",t),$('input[id="sp_level_id'+e+'"]').attr("id","sp_level_id"+t),$('input[id="sp_level_name'+e+'"]').attr("id","sp_level_name"+t).val(a),$('span[id="sp_level_txt_code'+e+'"]').attr("id","sp_level_txt_code"+t).html(t),$('span[id="sp_level_txt_matrix'+e+'"]').attr("id","sp_level_txt_matrix"+t),$('span[id="sp_level_txt_name'+e+'"]').attr("id","sp_level_txt_name"+t).html(a),qe.find('tr[data-parent="'+e+'"]').attr("data-parent",t)}function C(a,i,o,r,n,s){var c=0;if(0!==a){var l=qe.find('tr[data-level="'+a+'"]').attr("data-padding");c=parseInt(l)+20}var d=$('<tr data-level="'+o+'" data-padding="'+c+'" data-parent="'+a+'" data-type="'+s+'"></tr>'),u=$('<input type="hidden" id="sp_level_id'+o+'" value="'+i+'" />'),p=$('<input type="hidden" id="sp_level_name'+o+'" value="'+r+'" />'),m=$('<input type="hidden" id="sp_level_matrix'+o+'" value="'+n+'" />'),f=$('<div style="padding-left: '+c+'px"><b><span id="sp_level_txt_code'+o+'">'+o+'</span></b> <b><span class="fa-red" id="sp_level_txt_matrix'+o+'">'+n+'</span></b> <span id="sp_level_txt_name'+o+'">'+r+"</span></div>"),v=$("<td></td>");v.append(f).append(u).append(p).append(m);var h=$('<td width="75px"></td>'),_=$('<div class="btn-group btn-group-xs"></div>'),g=$('<button class="btn btn-xs btn-purple sp-level-edit" title="Editar Nivel"><span class="fa fa-edit"></span></button>'),b=$('<button class="btn btn-xs btn-success sp-level-add" title="Agregar SubNivel"><span class="fa fa-plus"></span></button>'),y=$('<button class="btn btn-xs btn-primary sp-level-add-str" title="Anexar Estructura"><span class="fa fa-link"></span></button>'),C=$('<button class="btn btn-xs btn-warning hide sp-level-remove-str" title="Remover Estructura"><span class="fa fa-chain-broken"></span></button>'),A=$('<button class="btn btn-xs btn-danger sp-level-del" title="Eliminar Nivel"><span class="fa fa-close"></span></button>');_.append(g),c<40&&_.append(b),40===c&&_.append(y).append(C),_.append(A),h.append(_),d.append(v),bt||d.append(h);var R=0===a?a:qe.find('tr[data-level="'+a+'"]').attr("data-parent"),S=!1,j=qe.find('tr[data-parent="'+R+'"]');if($.each(j,function(e,i){return S?(d.insertBefore($(i)),!1):$(i).attr("data-level")===a&&(S=!0,t.isUndefined(j[e+1]))?(projectInsertBeforeTr(d,$(i),qe),!1):void 0}),S||qe.append(d),k(o),0!==a){var L=qe.find('tr[data-level="'+a+'"]');L.find(".sp-level-add-str").addClass("hide")}$(".sp-level-edit").click(function(e){Se.html("Editar Nivel"),Ct=$(this).closest("tr").attr("data-level"),je.val($('input[id="sp_level_id'+Ct+'"]').val()),Le.val(Ct),Ee.val(Ct),Pe.val($('input[id="sp_level_name'+Ct+'"]').val()),W.modal("show"),e.preventDefault()}),$(".sp-level-add").click(function(e){Se.html("Agregar Nivel"),Ct=$(this).closest("tr").attr("data-level"),W.modal("show"),e.preventDefault()}),$(".sp-level-add-str").click(function(e){Ct=$(this).closest("tr").attr("data-level"),x(),e.preventDefault()}),$(".sp-level-remove-str").click(function(t){Ct=$(this).closest("tr").attr("data-level"),e.showConfirm("","¿Está seguro que desea desasociar del nivel?",function(){$('input[id="sp_level_matrix'+Ct+'"]').val(""),$('span[id="sp_level_txt_matrix'+Ct+'"]').html(""),qe.find('tr[data-level="'+Ct+'"]').attr("data-type","0"),k(Ct)}),t.preventDefault()}),$(".sp-level-del").click(function(t){var a=$(this).closest("tr");e.showConfirm("","¿Está seguro que desea eliminar el nivel?",function(){var e=a.attr("data-level"),t=a.attr("data-parent");if(a.remove(),w(e),"0"!==t){var i=qe.find('tr[data-parent="'+t+'"]');if(0===i.length){var o=qe.find('tr[data-level="'+t+'"]');o.find(".sp-level-add-str").removeClass("hide")}}}),t.preventDefault()})}function x(){K.modal("show")}function k(e){var t=qe.find('tr[data-level="'+e+'"]');t.find(".sp-level-add").removeClass("hide"),t.find(".sp-level-add-str").removeClass("hide"),t.find(".sp-level-remove-str").addClass("hide"),""!==$('input[id="sp_level_matrix'+e+'"]').val()&&(t.find(".sp-level-add").addClass("hide"),t.find(".sp-level-add-str").addClass("hide"),t.find(".sp-level-remove-str").removeClass("hide"))}function w(e){var a=qe.find('tr[data-parent="'+e+'"]');a.length>0&&t.each(a,function(e){var t=$(e).attr("data-level");$(e).remove(),w(t)})}function A(i){a.get("projects/subProjects",i,function(a){if(!t.isUndefined(a.status)&&a.status){var i=a.data;R(i)}else e.showAlert("","Hubo un error al obtener los subproyectos. Intente nuevamente.","error")})}function R(i){xe.empty(),Te.val("").trigger("change"),Te.find("option:gt(0)").remove(),t.each(i,function(e){var t=$('<tr data-id="'+e.id+'"></tr>'),a=$("<td>"+e.description+"</td>"),i=$('<a data-target="#" title="Editar" class="edit_sp_"><i class="fa fa-edit fa-1-5x"></i></a>'),o=$('<td class="text-center"></td>');o.append(i);var r=$('<a data-target="#" title="Eliminar" class="del_sp_"><i class="fa fa-red fa-trash fa-1-5x"></i></a>'),n=$('<td class="text-center"></td>');n.append(r),t.append(a).append(o),bt||t.append(n),xe.append(t),Te.append('<option value="'+e.id+'">'+e.description+"</option>")}),$(".edit_sp_").click(function(i){var o=$(this).closest("tr"),r=o.attr("data-id");a.get("projects/getSubProject",r,function(a){if(!t.isUndefined(a.status)&&a.status){var i=a.data;yt=i.id,we.val(i.description),ke.html("Editar - "+i.description),t.each(i.fronts,function(e){S(e)}),t.each(i.levels,function(e){C(e.parent,e.id,e.code,e.description,e.matrix,e.type)}),H.modal("show")}else e.showAlert("","Hubo un error al obtener el subproyecto. Intente nuevamente.","error")}),i.preventDefault()}),$(".del_sp_").click(function(i){var o=$(this).closest("tr");e.showConfirm("","¿Está seguro que desea eliminar el subproyecto?",function(){var i=o.attr("data-id");a.deleted("projects/deleteSubProject",i,function(a){!t.isUndefined(a.status)&&a.status?(Te.val("").trigger("change"),Te.find('option[value="'+i+'"]').remove(),o.remove()):e.showAlert("","Hubo un error al eliminar el subproyecto. Intente nuevamente.","error")})}),i.preventDefault()})}function S(a){var i=$('<tr class="tr_front_sp_ tr_front_sp_'+a.id+'" data-id="'+a.id+'"></tr>'),o=$('<td class="text-center">'+a.code+"</td>"),r=$("<td>"+a.description+"</td>"),n="";t.isNull(a.entity)||(n=t.isNull(a.entity.NombreEntidad)?a.entity.RazonSocial:a.entity.NombreEntidad);var s=$("<td>"+n+"</td>"),c=$('<a data-target="#" title="Eliminar" class="del_front_sp_"><i class="fa fa-red fa-trash fa-1-5x"></i></a>'),l=$('<td class="text-center"></td>');l.append(c),i.append(o).append(r).append(s),bt||l.append(l),Re.append(i),$(".del_front_sp_").click(function(t){var a=$(this).closest("tr");e.showConfirm("","¿Está seguro que desea eliminar el frente del subproyecto?",function(){a.remove()}),t.preventDefault()})}function j(i){Ne.removeClass("hide"),Fe.empty(),a.get("projects/getLevelsSubProject",i,function(a){!t.isUndefined(a.status)&&a.status?createTreeSelect(a.data,"t_body_income_levels","incLevels","levelsInc","inc_level_radio","chk_level_inc",function(){Fe.find("input[name=chk_level_inc]").click(function(){var e=$(this).val(),t=parseInt($(this).attr("data-type"));L(i,e,t)})}):e.showAlert("","Hubo un error al obtener los niveles. Intente nuevamente.","error")})}function L(i,o,r){var n="sub_project_id="+i+"&level_id="+o+"&type="+r;d(),a.all("projects/getActivityMaterialSubProject",n,function(a){!t.isUndefined(a.status)&&a.status?1===r?E(a.data):D(a.data):e.showAlert("",a.message,"error")})}function E(e){Ue.removeClass("hide");var a=0;t.each(e,function(e){var t=$('<tr class="p_tr_income_materials" data-id="'+e.id+'"></tr>'),i=$('<td class="text-center">'+e.code+"</td>"),o=$('<td class="text-center">'+e.level+"</td>"),r=$("<td>"+e.text+"</td>"),n=$('<td class="text-center">'+e.und+"</td>"),s=$('<td><input id="p_inc_lb_price'+e.id+'" type="text" value="'+e.lb.price+'" class="text-right form-control input-sm p_inc_edit_lb inp_show_approval" onblur="roundDecimals(this, 2)" onkeypress="return validDecimals(event, this, 3)" onclick="this.select()"></td>'),c=$('<td><input id="p_inc_lb_quantity'+e.id+'" type="text" value="'+e.lb.quantity+'" class="text-right form-control input-sm p_inc_edit_lb inp_show_approval" onblur="roundDecimals(this, 2)" onkeypress="return validDecimals(event, this, 3)" onclick="this.select()"></td>'),l=$('<td class="text-right p_inc_total_lb" id="p_inc_lb_total'+e.id+'">'+e.lb.total+"</td>");a=""!==e.lb.total?parseFloat(e.lb.total)+a:a,t.append(i).append(o).append(r).append(n).append(s).append(c).append(l),Ie.append(t)}),r(),Be.html(a.toFixed(2)),$(".p_inc_edit_lb").keyup(function(e){var t=$(this).closest("tr").attr("data-id"),a=""===$("#p_inc_lb_price"+t).val()?0:$("#p_inc_lb_price"+t).val(),i=""===$("#p_inc_lb_quantity"+t).val()?0:$("#p_inc_lb_quantity"+t).val();$("#p_inc_lb_total"+t).html((a*i).toFixed(2)),P(),e.preventDefault()})}function P(){var e=0;t.each($(".p_inc_total_lb"),function(t){e=""!==$(t).html()?parseFloat($(t).html())+e:e}),Be.html(e.toFixed(2))}function q(){var e=""===Ye.val()?0:parseFloat(Ye.val())*parseFloat(Ve.val());He.val(roundValue(e,2))}function D(a){t.each(a,function(e){var t=$("<span></span>"),a=$('<a data-target="#" data-id="'+e.id+'" data-type="'+e.type+'" class="list-group-item show_act_mat_inc_"></a>'),i=$('<span class="badge show_edit_level hide"></span>'),o=$('<i class="fa fa-edit"></i>'),r=$("<span>"+e.code+" "+e.level+" "+e.text+"</span>");i.append(o),a.append(i).append(r),t.append(a),Me.append(t)}),$(".show_act_mat_inc_").click(function(t){$(".show_act_mat_inc_").removeClass("active"),$(this).addClass("active");var a=$(this).attr("data-id"),i=$(this).attr("data-type");2===parseInt(i)?T(a):e.showAlert("","Este nivel no está asociado a ningún elemento de la matriz","warning"),t.preventDefault()})}function T(i){At=i,Oe.removeClass("hide"),ze.empty(),a.get("projects/getInfoActivity",i,function(a){if(!t.isUndefined(a.status)&&a.status){var i=a.data;t.each(oe,function(e){ze.append('<option value="'+e.Value+'">'+e.DisplayText+"</option>")}),t.each(oe,function(e){We.append('<option value="'+e.Value+'">'+e.DisplayText+"</option>")}),ze.val(i.um),Ye.val(i.lb.quantity),Ve.val(roundValue(i.lb.price,2)),He.val(roundValue(i.lb.total,2)),$("#p_inc_p_rend").html(roundValue(i.apu.rend,2)),$("#p_inc_p_hh").html(roundValue(i.apu.hh,2)),$("#p_inc_p_hm").html(roundValue(i.apu.hm,2)),$("#p_inc_p_mo").html(roundValue(i.apu.mo,2)),$("#p_inc_p_mat").html(roundValue(i.apu.mat,2)),$("#p_inc_p_eq").html(roundValue(i.apu.eq,2)),$("#p_inc_p_sc").html(roundValue(i.apu.sc,2))}else e.showAlert("",a.message,"error")})}function N(t,a){if($("#p_inc_apu_tr_"+t.matrix+"_"+t.type).length>0)return e.showAlert("","Ya se agregó este recurso. Por favor seleccione otro","warning"),"function"==typeof a&&a(!1),!1;var i=parseInt(t.type),o=$('<tr class="p_inc_apu_tr_" id="p_inc_apu_tr_'+t.matrix+"_"+t.type+'" data-code="'+t.matrix+'" data-type="'+i+'"></tr>'),n=$('<a href="#" title="Eliminar" class="p_inc_apu_del_"><i class="fa fa-trash fa-1-5x fa-red"></i></a>'),s=$('<td class="text-center"></td>');bt||s.append(n);var c,l,d=$('<td class="text-center">'+t.matrix+"</td>"),u=$("<td>"+t.description+"</td>"),p=$('<td class="text-center">'+t.um+"</td>");2===i||4===i?(c=$("<td></td>"),l=$('<td><input type="text" class="text-right p_inc_apu_inp_ p_inc_apu_inp_q inp_show_approval" value="'+t.quantity+'" style="width:75px;" onclick="this.select()" onkeypress="return validDecimals(event, this, 3)" onblur="return roundDecimals(this, 2)"  /></td>')):(c=$('<td><input type="text" class="text-right p_inc_apu_inp_ p_inc_apu_inp_q inp_show_approval" value="'+t.quantity+'" style="width:75px;" onclick="this.select()" onkeypress="return validDecimals(event, this, 3)" onblur="return roundDecimals(this, 2)"  /></td>'),l=$('<td class="text-right p_inc_apu_inp_qu">'+t.q_unity+"</td>"));var m=$('<td><input type="text" class="text-right p_inc_apu_inp_ p_inc_apu_inp_p inp_show_approval" value="'+t.price+'" style="width:75px;" onclick="this.select()" onkeypress="return validDecimals(event, this, 3)" onblur="return roundDecimals(this, 2)" /></td>'),f=$('<td class="text-right p_inc_apu_inp_tot">'+t.partial+"</td>");o.append(s).append(d).append(u).append(p).append(c).append(l).append(m).append(f),1===i?lt.append(o):2===i?ut.append(o):3===i?ft.append(o):4===i&&ht.append(o),r(),$(".p_inc_apu_del_").click(function(t){var a=$(this).closest("tr");e.showConfirm("","¿Está seguro que desea eliminar el recurso del Análisis de Precios Unitarios?",function(){var e=a.attr("data-type");a.remove(),M(parseInt(e),!0)}),t.preventDefault()}),$(".p_inc_apu_inp_").keyup(function(e){F(i,t.matrix,!0),e.preventDefault()}),"function"==typeof a&&a(!0)}function F(e,t,a){var i=_t.find("tr[id=p_inc_apu_tr_"+t+"_"+e+"]"),o=i.find("input.p_inc_apu_inp_q").val();o=""===o?0:parseFloat(o);var r=i.find("input.p_inc_apu_inp_p").val();r=""===r?0:parseFloat(r);var n;if(1===e||3===e){var s,c=""===at.val()?0:parseFloat(at.val()),l=""===it.val()?0:parseFloat(it.val()),d=""===ot.val()?0:parseFloat(ot.val());s=1===e?0===l?0:o/l*c:0===d?0:o/d*c,i.find(".p_inc_apu_inp_qu").html(s.toFixed(2)),n=s*r}else n=o*r;i.find(".p_inc_apu_inp_tot").html(roundMath(n).toFixed(2)),a&&M(e,a)}function M(e,a){var i=0,o=0;if(t.each(_t.find("tr[data-type="+e+"]"),function(e){i+=$(e).find(".p_inc_apu_inp_qu").length>0?parseFloat($(e).find(".p_inc_apu_inp_qu").html()):0,o+=parseFloat($(e).find(".p_inc_apu_inp_tot").html())}),1===e){st.html(i.toFixed(2)),ct.html(o.toFixed(2)),$(".p_inc_apu_total_mo").html(o.toFixed(2));var r=$(".p_inc_percentage").first().html(),n=parseFloat(r)*o/100;$(".p_inc_apu_total_per").html(roundMath(n).toFixed(2)),a&&(M(2,!1),M(3,!1))}else 2===e?dt.html(o.toFixed(2)):3===e?(pt.html(i.toFixed(2)),mt.html(o.toFixed(2))):4===e&&vt.html(o.toFixed(2));U()}function U(){var e=parseFloat(ct.html()),t=parseFloat(dt.html()),a=parseFloat(mt.html()),i=parseFloat(vt.html());rt.val((e+t+a+i).toFixed(2))}function O(){t.each(_t.find("tr"),function(e){var t=parseInt($(e).attr("data-type")),a=$(e).attr("data-code");F(t,a,!1)}),M(1,!0),U()}function I(e){t.each(e,function(e){N(e,"")}),M(1,!0),U()}moment.locale("es");var B=moment().startOf("month"),Y=moment().endOf("month"),z=$(".chk_date_range");z.click(function(){$("#LoadRecordsButtonP").click()}),generateCheckBox(".chk_date_range_div");var V,H,G,W,K,Q,Z,J,X,ee=[],te=[],ae=!1,ie=$("#reqDates"),oe=[],re=function(e,t){B=e,Y=t,ie.find("span").html(e.format("MMM D, YYYY")+" - "+t.format("MMM D, YYYY")),z.prop("checked")&&$("#LoadRecordsButtonP").click()};generateDateRangePicker(ie,B,Y,re),re(B,Y);var ne,se,ce,le,de,ue,pe,me,fe,ve,he,_e,ge,$e,be,ye,Ce,xe,ke,we,Ae,Re,Se,je,Le,Ee,Pe,qe,De,Te,Ne,Fe,Me,Ue,Oe,Ie,Be,Ye,ze,Ve,He,Ge,We,Ke,Qe,Ze,Je,Xe,et,tt,at,it,ot,rt,nt,st,ct,lt,dt,ut,pt,mt,ft,vt,ht,_t,gt=0,$t=0,bt=!1,yt=0,Ct=0;e.addSubProjects=function(){return 0===gt?(e.showAlert("","Para agregar subproyectos debe guardar el proyecto","warning"),!1):(ke.html("Agregar Subproyecto"),void H.modal("show"))},e.saveProject=function(){var i=!0;if(i=i&&ue.required(),i=i&&ve.required(),i=i&&h(ve),i=i&&h(he),i=i&&h(_e),i=i&&h(ge),i||activeTab("tab1"),i&&""===pe.val())return e.showAlert("","Para poder guardar el proyecto debe seleccionar el cliente","warning"),activeTab("tab1"),!1;if(i){var o=[];t.each($(".p_tr_income_materials"),function(e){var t=$(e).attr("data-id");o.push({id:t,price:$("#p_inc_lb_price"+t).val(),quantity:$("#p_inc_lb_quantity"+t).val()})});var r=[];0!==At&&r.push({code:At,lb_q:Ye.val(),um:ze.val()});var n={description:ue.val(),client_id:pe.val(),date_start:$e.val(),date_end:be.val(),cost_load:le.val(),gg_direct:ve.val(),gg_indirect:he.val(),transport:_e.val(),utils:ge.val(),days:ye.val(),income_mat:o,activity:r};a.updated("projects/saveProject",gt,n,function(a){if(!t.isUndefined(a.status)&&a.status){e.showAlert("","El proyecto se guardó correctamente.","success");var i=a.info;gt=i.id,J.html(ue.val()+" - "+i.state),de.val(i.state),ce.val(i.code),Ce.val(roundValue(i.total,2)),$(".p_inc_percentage").html(parseFloat(i.gg)),$("#LoadRecordsButtonP").click()}else e.showAlert("",a.message,"error")})}},e.saveSubProject=function(){var i=!0;if(i=i&&we.required()){var o=[];t.each($(".tr_front_sp_"),function(e){var t=$(e).attr("data-id");o.push(t)});var r=[],n=[],s=[],c=[],l=[],d=[];t.each(qe.find("tr"),function(e){var t=$(e).attr("data-level");r.push($('input[id="sp_level_id'+t+'"]').val()),s.push(t),n.push($(e).attr("data-parent")),c.push($('input[id="sp_level_name'+t+'"]').val()),l.push($('input[id="sp_level_matrix'+t+'"]').val()),d.push(parseInt($(e).attr("data-type")))});var u={project_id:gt,description:we.val(),fronts:o,level_id:r,level_parent:n,level_code:s,level_name:c,level_matrix:l,level_type:d};a.updated("projects/saveSubProject",yt,u,function(a){!t.isUndefined(a.status)&&a.status?(e.showAlert("","El subproyecto se guardó correctamente.","success"),H.modal("hide"),A(gt)):e.showAlert("","Hubo un error al guardar el subproyecto. Intente nuevamente.","error")})}},e.openClientProject=function(){G.modal("show")},e.cleanClientProject=function(){pe.val(""),me.val(""),fe.val("")};var xt=getFormSearch("frm-search-p","search_p","LoadRecordsButtonP"),kt='<select id="project_states" class="search_input"></select>',wt=$("#table_container_p");wt.jtable({title:"Lista de Proyectos",paging:!0,sorting:!0,actions:{listAction:base_url+"/projects/list",deleteAction:base_url+"/projects/delete"},toolbar:{items:[{cssClass:"buscador",text:kt},{cssClass:"buscador",text:xt},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){var t={search:$("#search_p").val(),check:z.prop("checked"),from:B.format("YYYY-MM-DD"),to:Y.format("YYYY-MM-DD"),state:X.val()};e.openDoc("projects/excel",t)}},{cssClass:"btn-success",text:'<i class="fa fa-plus"></i> Nuevo Proyecto',click:function(){v()}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},code:{title:"Código",listClass:"text-center",width:"2%"},description:{title:"Descripción"},state:{title:"Estado",sorting:!1,width:"3%",list:show_list_},sub_state:{title:"Progreso",sorting:!1,width:"3%",list:show_list_},client_desc:{title:"Cliente",sorting:!1,width:"7%",list:show_list_},total:{title:"Total",listClass:"text-right",width:"2%"},created_date:{title:"F.Registro",listClass:"text-center",sorting:!1,width:"1%"},edit:{width:"1%",listClass:"text-center",sorting:!1,edit:!1,create:!1,display:function(e){return'<a href="javascript:void(0)" title="Editar" class="edit_p" data-code="'+e.record.id+'"><i class="fa fa-edit fa-1-5x fa-green"></i></a>'}}},recordsLoaded:function(e,t){$(".edit_p").click(function(e){var t=$(this).attr("data-code");_(t),e.preventDefault()})}}),m(),e.showMat_=function(e){$(".mat_").prop("checked",!1).iCheck("update"),$("#mat_"+e).prop("checked",!0).iCheck("update"),$(".show_list_mat_").addClass("hide"),$(".show_list_"+e).removeClass("hide"),1==e||2==e?($(".show_1_").addClass("hide"),$(".show_2_").removeClass("hide")):($(".show_1_").removeClass("hide"),$(".show_2_").addClass("hide"))},e.showMat__=function(e){$(".mat__").prop("checked",!1).iCheck("update"),$("#mat__"+e).prop("checked",!0).iCheck("update"),$(".show_list_mat__").addClass("hide"),$(".show_list__"+e).removeClass("hide"),1==e||2==e?($(".show_1__").addClass("hide"),$(".show_2__").removeClass("hide")):($(".show_1__").removeClass("hide"),$(".show_2__").addClass("hide"))},e.showAnalysisPro=function(){var e=$("#modalAnalysisPro");e.on("hidden.bs.modal",function(e){V.attr("style","display:block; overflow-y: auto;")}),e.on("show.bs.modal",function(e){V.attr("style","display:block; z-index:2030 !important")}),e.modal("show")},e.showAnalysisFro=function(){var e=$("#modalAnalysisFro");e.on("hidden.bs.modal",function(e){V.attr("style","display:block; overflow-y: auto;")}),e.on("show.bs.modal",function(e){V.attr("style","display:block; z-index:2030 !important")}),e.modal("show")},e.addGG=function(){var e=$("#modalGG");e.on("hidden.bs.modal",function(e){V.attr("style","display:block; overflow-y: auto;")}),e.on("show.bs.modal",function(e){V.attr("style","display:block; z-index:2030 !important")}),e.modal("show")},e.addLevel=function(){Se.html("Agregar Nivel"),Ct=0,W.modal("show")},e.saveLevelSP=function(){var t=!0;if(t=t&&Ee.required(),t=t&&Pe.required()){var a=Ee.val();if(a=a.trim(),""!==Le.val()){if(a!==Le.val()){var i=qe.find('tr[data-level="'+a+'"]');if(i.length>0)return e.showAlert("","Ya existe un nivel con este código.","warning"),!1}y(Le.val(),a,Pe.val())}else{var o=qe.find('tr[data-level="'+a+'"]');if(o.length>0||"0"===a)return e.showAlert("","Ya se agregó un nivel con este código. Por favor ingrese otro codigo.","warning"),!1;C(Ct,je.val(),a,Pe.val(),"",0)}W.modal("hide")}},e.selectStructureLevel=function(){var a=De.val(),i=$("input[name=chk_level_sp]").filter(":checked"),o=0,r=0;if(i.length>0&&(o=i.val(),r=i.attr("data-type")),0!==o||t.isNull(a)||""===a||(o=a,r=De.select2("data")[0].type),0===o)return e.showAlert("","Por favor seleccione el nivel. Puede hacerlo mediante la búsqueda o seleccionandolo en la estructura","warning"),!1;var n=qe.find('tr[data-level="'+Ct+'"]'),s=!0;$.each(qe.find('tr[data-parent="'+n.attr("data-parent")+'"]'),function(t,a){var i=parseInt($(a).attr("data-type"));if(0!==i&&i!==parseInt(r)){var o=1===i?"material":"actividad";return e.showAlert("","Debe seleccionar un elemento de la matriz que sea tipo: "+o,"warning"),
s=!1,!1}}),setTimeout(function(){s&&($('input[id="sp_level_matrix'+Ct+'"]').val(o),$('span[id="sp_level_txt_matrix'+Ct+'"]').html(o),n.attr("data-type",r),k(Ct),K.modal("hide"))},200)},e.addFrontSP=function(){var i=Ae.val();return t.isNull(i)||""===i?(e.showAlert("","Debe seleccionar el frente para agregarlo.","warning"),!1):$(".tr_front_sp_"+i).length>0?(e.showAlert("","Ya se agregó este frente. Por favor seleccione otro.","warning"),!1):void a.get("projects/getFront",i,function(a){!t.isUndefined(a.status)&&a.status?S(a.data):e.showAlert("","Hubo un error al obtener el frente. Intente nuevamente.","error")})};var At=0;e.showAnalysisIncome=function(){0!==At&&a.get("projects/getActivity",At,function(a){if(!t.isUndefined(a.status)&&a.status){var i=a.data;Je.html(i.level),Xe.html(i.code),tt.html(i.matrix),et.html(i.description),nt.html(i.um),at.val(i.hours),it.val(i.mo),ot.val(i.eq),I(i.detail),Q.modal("show")}else e.showAlert("",a.message,"error")})},e.addStructureIncome=function(){Z.modal("show")},e.selectStructureIncome=function(){var a=Ze.val(),i=$("input[name=chk_apu_inc]").filter(":checked"),o=0,r=0,n="",s="";return i.length>0&&(o=i.val(),r=i.attr("data-type"),n=i.attr("data-text"),s=i.attr("data-um")),0!==o||t.isNull(a)||""===a||(o=a,r=Ze.select2("data")[0].type,n=Ze.select2("data")[0].description,s=Ze.select2("data")[0].um),0===o?(e.showAlert("","Por favor seleccione el recurso. Puede hacerlo mediante la búsqueda o seleccionandolo de la estructura","warning"),!1):void N({matrix:o,description:n,type:r,um:s,quantity:"",q_unity:"0.00",price:"",partial:"0.00"},function(e){e&&Z.modal("hide")})},e.saveAnalysisPriceUnitary=function(){var i=!0;if(i=i&&at.required(),i=i&&it.required(),i=i&&ot.required(),i&&$.each($(".p_inc_apu_inp_"),function(e,t){if(""===$(t).val())return i=!1,$(t).focus(),!1}),i){var o=[],r=[],n=[],s=[];t.each($(".p_inc_apu_tr_"),function(e){e=$(e);var t=parseInt(e.attr("data-type"));o.push(t),r.push(e.attr("data-code")),n.push(e.find("input.p_inc_apu_inp_q").val()),s.push(e.find("input.p_inc_apu_inp_p").val())});var c={apu_hours_day:at.val(),apu_mo:it.val(),apu_eq:ot.val(),type:o,matrix:r,quantity:n,price:s};a.updated("projects/saveAnalysisPriceUnitary",At,c,function(a){!t.isUndefined(a.status)&&a.status?(e.showAlert("","El Análisis de Precios Unitarios se guardó correctamente.","success"),Q.modal("hide"),T(At),Ce.val(roundValue(a.total,2)),$("#LoadRecordsButtonP").click()):e.showAlert("",a.message,"error")})}},e.sendToApproval=function(){e.showConfirm("","¿Está seguro que desea envíar a aprobación?",function(){a.updated("projects/sendApproval",gt,{},function(a){!t.isUndefined(a.status)&&a.status?(e.showAlert("","El proyecto se envío a aprobación","warning"),V.modal("hide"),$("#LoadRecordsButtonP").click()):e.showAlert("",a.message,"warning")})})}}function t(e,t){e.state("projects",{url:"/projects",templateUrl:base_url+"/templates/projects/base.html",controller:"ProjectCtrl"}),t.otherwise("/")}angular.module("sys.app.projects").config(t).controller("ProjectCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.project_approval",[])}(),function(){"use strict";function e(e,t,a,i){function o(){M.find("input, textarea").val(""),activeTab("home"),Oe=0,X.empty(),oe.val("").trigger("change"),oe.find("option:gt(0)").remove(),r()}function r(){M.find("input, textarea, select").prop("disabled",Ie),$(".p_inc_frm_apu .form-control").prop("disabled",Ie),$(".inp_show_approval").prop("disabled",Ie);var e=$(".show_not_approval");e.removeClass("hide"),Ie&&e.addClass("hide")}function n(){ae.empty(),ie.empty(),activeTab("levels")}function s(){re.addClass("hide"),ne.empty(),c()}function c(){ce.addClass("hide"),le.addClass("hide"),se.empty(),de.empty(),ue.empty(),$(".p_inc_table_activity .form-control").val(""),$("#p_inc_show_totals_apu").find("tr").empty(),me.empty(),_e.empty(),Ye=0}function l(){be.empty(),ye.empty(),xe.empty(),Ce.empty(),Se.empty(),$(".p_inc_frm_apu .form-control").val(""),Re.val("0.00"),Ee.empty(),qe.empty(),Ne.empty(),Me.empty(),$(".p_inc_apu_tot").html("0.00")}function d(){D=$("#approval_states"),D.empty().change(function(){$("#LoadRecordsButtonPA").click()}),a.all("project_approval/getDataProject","",function(e){!t.isUndefined(e.status)&&e.status?(t.each(e.states,function(e){D.append('<option value="'+e.Value+'">'+e.DisplayText+"</option>")}),m()):d()},function(){d()})}function u(){T||(M=$("#frm_tab_general"),U=$("#p_code"),O=$("#p_cost_load"),I=$("#p_state"),B=$("#p_description"),Y=$("#p_client_code"),z=$("#p_client_description"),V=$("#p_gg_direct"),H=$("#p_gg_indirect"),G=$("#p_transport"),W=$("#p_utils"),K=$("#p_date_start"),Q=$("#p_date_end"),Z=$("#p_days"),J=$("#p_total"),X=$("#t_body_list_sub_projects"),ee=$("#p_title_modal_sp"),te=$("#p_sp_description"),ae=$("#t_body_list_fronts"),ie=$("#t_body_list_levels"),re=$("#p_table_structure_level"),oe=$("#p_inc_sub_projects"),oe.change(function(){var e=$(this).val();s(),""!==e&&_(e)}),ne=$("#t_body_income_levels"),se=$("#p_inc_list_activity"),ce=$(".info_income_1"),le=$(".info_income_2"),de=$("#p_income_list_materials"),ue=$("#p_income_total_materials"),pe=$("#p_inc_q_lb_activity"),me=$("#p_inc_u_lb_activity"),fe=$("#p_inc_p_lb_activity"),ve=$("#p_inc_t_lb_activity"),he=$("#p_inc_q_pv_activity"),_e=$("#p_inc_u_pv_activity"),ge=$("#p_inc_p_pv_activity"),$e=$("#p_inc_t_pv_activity"),ye=$("#p_inc_code_apu"),be=$("#p_inc_level_apu"),xe=$("#p_inc_matrix_apu"),Ce=$("#p_inc_description_apu"),ke=$("#p_inc_hours_apu"),we=$("#p_inc_mo_apu"),Ae=$("#p_inc_eq_apu"),Re=$("#p_inc_total_apu"),Se=$(".p_inc_und_apu"),je=$("#p_inc_apu_q_mo"),Le=$("#p_inc_apu_t_mo"),Ee=$("#p_inc_apu_t_body_mo"),Pe=$("#p_inc_apu_t_mat"),qe=$("#p_inc_apu_t_body_mat"),De=$("#p_inc_apu_q_eq"),Te=$("#p_inc_apu_t_eq"),Ne=$("#p_inc_apu_t_body_eq"),Fe=$("#p_inc_apu_t_sc"),Me=$("#p_inc_apu_t_body_sc"),Ue=$("#p_inc_apu_table"),L=$("#modalP"),E=$("#modalSP"),P=$("#modalAnalysisIncome"),q=$("#titleP"),L.on("hidden.bs.modal",function(e){o()}),E.on("show.bs.modal",function(e){L.attr("style","display:block; z-index:2030 !important")}),E.on("hidden.bs.modal",function(e){n(),L.attr("style","display:block; overflow-y: auto;")}),P.on("hidden.bs.modal",function(e){l(),L.attr("style","display:block; overflow-y: auto;")}),P.on("show.bs.modal",function(e){L.attr("style","display:block; z-index:2030 !important")}),T=!0)}function p(i){u(),a.get("project_approval/find",i,function(a){if(!t.isUndefined(a.status)&&a.status){var i=a.data;Oe=i.id,r(),U.val(i.code),O.val(i.cost_load),I.val(i.state),B.val(i.description),Y.val(i.client_document),z.val(i.client_description),V.val(i.gg_direct),$(".p_inc_percentage").html(parseFloat(i.gg_direct)),H.val(i.gg_indirect_),G.val(i.transport),W.val(i.utils),K.val(i.date_start),Q.val(i.date_end),Z.val(i.days),J.val(i.total),q.html(i.description+" - "+i.state),v(i.sp),L.modal("show")}else e.showAlert("","Hubo un error al obtener el proyecto. Intente nuevamente.","error")})}function m(){generateSearchForm("frm-search-pa","LoadRecordsButtonPA",function(){He.jtable("load",{search:$("#search_pa").val(),check:j.prop("checked"),from:R.format("YYYY-MM-DD"),to:S.format("YYYY-MM-DD"),sub_state:D.val()})},!0)}function f(e,a,i,o,r,n){var s=0;if(0!==e){var c=ie.find('tr[data-level="'+e+'"]').attr("data-padding");s=parseInt(c)+20}var l=$('<tr data-level="'+i+'" data-padding="'+s+'" data-parent="'+e+'" data-type="'+n+'"></tr>'),d=$('<div style="padding-left: '+s+'px"><b><span>'+i+'</span></b> <b><span class="fa-red">'+r+"</span></b> <span>"+o+"</span></div>"),u=$("<td></td>");u.append(d),l.append(u);var p=0===e?e:ie.find('tr[data-level="'+e+'"]').attr("data-parent"),m=!1,f=ie.find('tr[data-parent="'+p+'"]');$.each(f,function(a,i){return m?(l.insertBefore($(i)),!1):$(i).attr("data-level")===e&&(m=!0,t.isUndefined(f[a+1]))?(projectInsertBeforeTr(l,$(i),ie),!1):void 0}),m||ie.append(l)}function v(i){X.empty(),oe.val("").trigger("change"),oe.find("option:gt(0)").remove(),t.each(i,function(e){var t=$('<tr data-id="'+e.id+'"></tr>'),a=$("<td>"+e.description+"</td>"),i=$('<a data-target="#" title="Ver" class="edit_sp_"><i class="fa fa-edit fa-1-5x"></i></a>'),o=$('<td class="text-center"></td>');o.append(i),t.append(a).append(o),X.append(t),oe.append('<option value="'+e.id+'">'+e.description+"</option>")}),$(".edit_sp_").click(function(i){var o=$(this).closest("tr"),r=o.attr("data-id");a.get("project_approval/getSubProject",r,function(a){if(!t.isUndefined(a.status)&&a.status){var i=a.data;Be=i.id,te.val(i.description),ee.html("Ver - "+i.description),t.each(i.fronts,function(e){h(e)}),t.each(i.levels,function(e){f(e.parent,e.id,e.code,e.description,e.matrix,e.type)}),E.modal("show")}else e.showAlert("","Hubo un error al obtener el subproyecto. Intente nuevamente.","error")}),i.preventDefault()})}function h(e){var a=$("<tr></tr>"),i=$('<td class="text-center">'+e.code+"</td>"),o=$("<td>"+e.description+"</td>"),r="";t.isNull(e.entity)||(r=t.isNull(e.entity.NombreEntidad)?e.entity.RazonSocial:e.entity.NombreEntidad);var n=$("<td>"+r+"</td>");a.append(i).append(o).append(n),ae.append(a)}function _(i){re.removeClass("hide"),ne.empty(),a.get("project_approval/getLevelsSubProject",i,function(a){!t.isUndefined(a.status)&&a.status?createTreeSelect(a.data,"t_body_income_levels","incLevels","levelsInc","inc_level_radio","chk_level_inc",function(){ne.find("input[name=chk_level_inc]").click(function(){var e=$(this).val(),t=parseInt($(this).attr("data-type"));g(i,e,t)})}):e.showAlert("","Hubo un error al obtener los niveles. Intente nuevamente.","error")})}function g(i,o,r){var n="sub_project_id="+i+"&level_id="+o+"&type="+r;c(),a.all("project_approval/getActivityMaterialSubProject",n,function(a){!t.isUndefined(a.status)&&a.status?1===r?b(a.data):y(a.data):e.showAlert("",a.message,"error")})}function b(e){ce.removeClass("hide");var a=0;t.each(e,function(e){var t=$('<tr data-id="'+e.id+'"></tr>'),i=$('<td class="text-center">'+e.code+"</td>"),o=$('<td class="text-center">'+e.level+"</td>"),r=$("<td>"+e.text+"</td>"),n=$('<td class="text-center">'+e.und+"</td>"),s=$('<td class="text-right">'+e.lb.price+"</td>"),c=$('<td class="text-right">'+e.lb.quantity+"</td>"),l=$('<td class="text-right">'+e.lb.total+"</td>");a=""!==e.lb.total?parseFloat(e.lb.total)+a:a,t.append(i).append(o).append(r).append(n).append(s).append(c).append(l),de.append(t)}),r(),ue.html(a.toFixed(2))}function y(e){t.each(e,function(e){var t=$("<span></span>"),a=$('<a data-target="#" data-id="'+e.id+'" data-type="'+e.type+'" class="list-group-item show_act_mat_inc_"></a>'),i=$("<span>"+e.code+" "+e.level+" "+e.text+"</span>");a.append(i),t.append(a),se.append(t)}),$(".show_act_mat_inc_").click(function(e){$(".show_act_mat_inc_").removeClass("active"),$(this).addClass("active");var t=$(this).attr("data-id"),a=$(this).attr("data-type");2===parseInt(a)&&C(t),e.preventDefault()})}function C(i){Ye=i,le.removeClass("hide"),me.empty(),a.get("project_approval/getInfoActivity",i,function(a){if(!t.isUndefined(a.status)&&a.status){var i=a.data;me.append('<option value="'+i.um+'">'+i.um_text+"</option>"),me.val(i.um),pe.val(i.lb.quantity),fe.val(roundValue(i.lb.price,2)),ve.val(roundValue(i.lb.total,2)),$("#p_inc_p_rend").html(roundValue(i.apu.rend,2)),$("#p_inc_p_hh").html(roundValue(i.apu.hh,2)),$("#p_inc_p_hm").html(roundValue(i.apu.hm,2)),$("#p_inc_p_mo").html(roundValue(i.apu.mo,2)),$("#p_inc_p_mat").html(roundValue(i.apu.mat,2)),$("#p_inc_p_eq").html(roundValue(i.apu.eq,2)),$("#p_inc_p_sc").html(roundValue(i.apu.sc,2))}else e.showAlert("",a.message,"error")})}function x(e,t){var a,i,o=parseInt(e.type),n=$('<tr id="p_inc_apu_tr_'+e.matrix+"_"+e.type+'" data-code="'+e.matrix+'" data-type="'+o+'"></tr>'),s=$('<td class="text-center"></td>'),c=$('<td class="text-center">'+e.matrix+"</td>"),l=$("<td>"+e.description+"</td>"),d=$('<td class="text-center">'+e.um+"</td>");2===o||4===o?(a=$("<td></td>"),i=$('<td><input type="text" class="text-right p_inc_apu_inp_ p_inc_apu_inp_q inp_show_approval" value="'+e.quantity+'" style="width:75px;" /></td>')):(a=$('<td><input type="text" class="text-right p_inc_apu_inp_ p_inc_apu_inp_q inp_show_approval" value="'+e.quantity+'" style="width:75px;" /></td>'),i=$('<td class="text-right p_inc_apu_inp_qu">'+e.q_unity+"</td>"));var u=$('<td><input type="text" class="text-right p_inc_apu_inp_ p_inc_apu_inp_p inp_show_approval" value="'+e.price+'" style="width:75px;" /></td>'),p=$('<td class="text-right p_inc_apu_inp_tot">'+e.partial+"</td>");n.append(s).append(c).append(l).append(d).append(a).append(i).append(u).append(p),1===o?Ee.append(n):2===o?qe.append(n):3===o?Ne.append(n):4===o&&Me.append(n),r(),"function"==typeof t&&t(!0)}function k(e,a){var i=0,o=0;if(t.each(Ue.find("tr[data-type="+e+"]"),function(e){i+=$(e).find(".p_inc_apu_inp_qu").length>0?parseFloat($(e).find(".p_inc_apu_inp_qu").html()):0,o+=parseFloat($(e).find(".p_inc_apu_inp_tot").html())}),1===e){je.html(i.toFixed(2)),Le.html(o.toFixed(2)),$(".p_inc_apu_total_mo").html(o.toFixed(2));var r=$(".p_inc_percentage").first().html(),n=parseFloat(r)*o/100;$(".p_inc_apu_total_per").html(roundMath(n).toFixed(2)),a&&(k(2,!1),k(3,!1))}else 2===e?Pe.html(o.toFixed(2)):3===e?(De.html(i.toFixed(2)),Te.html(o.toFixed(2))):4===e&&Fe.html(o.toFixed(2));w()}function w(){var e=parseFloat(Le.html()),t=parseFloat(Pe.html()),a=parseFloat(Te.html()),i=parseFloat(Fe.html());Re.val((e+t+a+i).toFixed(2))}function A(e){t.each(e,function(e){x(e,"")}),k(1,!0),w()}moment.locale("es");var R=moment().startOf("month"),S=moment().endOf("month"),j=$(".chk_date_range");j.click(function(){$("#LoadRecordsButtonPA").click()}),generateCheckBox(".i-checks");var L,E,P,q,D,T=!1,N=$("#reqDates"),F=function(e,t){R=e,S=t,N.find("span").html(e.format("MMM D, YYYY")+" - "+t.format("MMM D, YYYY")),j.prop("checked")&&$("#LoadRecordsButtonPA").click()};generateDateRangePicker(N,R,S,F),F(R,S);var M,U,O,I,B,Y,z,V,H,G,W,K,Q,Z,J,X,ee,te,ae,ie,oe,re,ne,se,ce,le,de,ue,pe,me,fe,ve,he,_e,ge,$e,be,ye,Ce,xe,ke,we,Ae,Re,Se,je,Le,Ee,Pe,qe,De,Te,Ne,Fe,Me,Ue,Oe=0,Ie=!0,Be=0,Ye=0;e.approveProject=function(){i.confirm({title:"",message:"¿Está seguro que desea aprobar el proyecto?",confirm:"Si",cancel:"No"},function(){a.updated("project_approval/approval",Oe,{},function(a){!t.isUndefined(a.status)&&a.status?(L.modal("hide"),$("#LoadRecordsButtonPA").click(),e.showAlert("","Le proyecto se aprobó correctamente","success")):e.showAlert("",a.message,"warning")})})},e.rejectProject=function(){i.confirm({title:"",message:"¿Está seguro que desea rechazar el proyecto?",confirm:"Si",cancel:"No"},function(){a.updated("project_approval/reject",Oe,{},function(a){!t.isUndefined(a.status)&&a.status?(L.modal("hide"),$("#LoadRecordsButtonPA").click(),e.showAlert("","Le proyecto se rechazó correctamente","success")):e.showAlert("",a.message,"warning")})})};var ze=getFormSearch("frm-search-pa","search_pa","LoadRecordsButtonPA"),Ve='<select id="approval_states" class="search_input"></select>',He=$("#table_container_pa");He.jtable({title:"Lista de Proyectos por Aprobar",paging:!0,sorting:!0,actions:{listAction:base_url+"/project_approval/list"},toolbar:{items:[{cssClass:"buscador",text:Ve},{cssClass:"buscador",text:ze}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},code:{title:"Código",listClass:"text-center",width:"2%"},description:{title:"Descripción"},sub_state:{title:"Estado",sorting:!1,width:"3%",list:show_list_},client_desc:{title:"Cliente",sorting:!1,width:"7%",list:show_list_},total:{title:"Total",listClass:"text-right",width:"2%"},created_date:{title:"F.Registro",listClass:"text-center",sorting:!1,width:"1%"},view:{width:"1%",listClass:"text-center",sorting:!1,edit:!1,create:!1,display:function(e){return'<a href="javascript:void(0)" title="Ver Proyecto" class="view_ap" data-code="'+e.record.id+'"><i class="fa fa-edit fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".view_ap").click(function(e){var t=$(this).attr("data-code");p(t),e.preventDefault()})}}),d(),e.showAnalysisIncome=function(){0!==Ye&&a.get("project_approval/getActivity",Ye,function(a){if(!t.isUndefined(a.status)&&a.status){var i=a.data;be.html(i.level),ye.html(i.code),xe.html(i.matrix),Ce.html(i.description),Se.html(i.um),ke.val(i.hours),we.val(i.mo),Ae.val(i.eq),A(i.detail),P.modal("show")}else e.showAlert("",a.message,"error")})}}function t(e,t){e.state("project_approval",{url:"/project_approval",templateUrl:base_url+"/templates/project_approval/base.html",controller:"ProjectApprovalCtrl"}),t.otherwise("/")}angular.module("sys.app.project_approval").config(t).controller("ProjectApprovalCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.purchase_orders",[])}(),function(){"use strict";function e(e,t){function a(){o=$("#modalPO"),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click()})}function i(){a(),o.modal("show"),$(".show_new").removeClass("hide"),$(".show_edit").addClass("hide")}moment.locale("es");var o,r=moment().startOf("month"),n=moment().endOf("month"),s=$("#reqDates");$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click()});var c=function(e,t){s.find("span").html(e.format("MMM D, YYYY")+" - "+t.format("MMM D, YYYY"))};generateDateRangePicker(s,r,n,c),c(r,n);var l='<select id="states" class="search_input"><option value="">Todos</option><option value="">Registrado</option><option value="">Aprobado</option><option value="">Recibido</option><option value="">Recibido Parcial</option><option value="">Cancelado</option><option value="">Cerrado</option></select>',d=getFormSearch("frm-search-po","search_po","LoadRecordsButtonPO"),u=$("#table_container_po");u.jtable({title:"Lista de Ordenes de Compra",paging:!0,sorting:!0,actions:{listAction:function(e,t){return{Result:"OK",Records:[{oc:"20170504",proyecto:"INVERSIONES-TALLER",proveedor:"IMPORTACIONES GELCO",estado:1,fecha_emision:"02/04/2017"},{oc:"20170518",proyecto:"CONEXIONES MASIVAS",proveedor:"CLAUDIO PIÑAN ROSARIO",estado:0,fecha_emision:"13/04/2017"}],TotalRecordCount:2}},deleteAction:base_url+"/purchase_orders/delete"},toolbar:{items:[{cssClass:"buscador",text:l},{cssClass:"buscador",text:d},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){window.open(base_url+"/purchase_orders/excel")}},{cssClass:"btn-success",text:'<i class="fa fa-plus"></i> Nueva Orden de Compra',click:function(){i()}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},oc:{title:"Nro. O/C",listClass:"text-center"},proyecto:{title:show_list_?"Descrip, Proyecto":"Proyecto"},proveedor:{title:"Proveedor"},estado:{title:"Estado",options:{1:"Aprobado",0:"Registrado"},list:show_list_},fecha_emision:{title:"Fecha Emisión",list:show_list_,listClass:"text-center"},editar:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return'<a href="javascript:void(0)" title="Editar" class="edit_po" data-code="'+e.record.id+'"><i class="fa fa-check-circle-o fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".edit_po").click(function(e){$(".show_new").addClass("hide"),$(".show_edit").removeClass("hide"),a(),o.modal("show"),e.preventDefault()})}}),generateSearchForm("frm-search-po","LoadRecordsButtonPO",function(){u.jtable("load",{search:$("#search_po").val()})},!0),e.closePO=function(){var e=$("#modalClose");e.on("hidden.bs.modal",function(e){o.attr("style","display:block;")}),e.on("show.bs.modal",function(e){o.attr("style","display:block; z-index:2030 !important")}),e.modal("show")}}function t(e,t){e.state("purchase_orders",{url:"/purchase_orders",templateUrl:base_url+"/templates/purchase_orders/base.html",controller:"PurchaseOrderCtrl"}),t.otherwise("/")}angular.module("sys.app.purchase_orders").config(t).controller("PurchaseOrderCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.purchase_payments",[])}(),function(){"use strict";function e(e,t,a,i){function o(){u=$("#modalPP"),m=$("#title-sc"),p=$("#modalProvider"),x=$("#modalPurchaseBilling"),f=$("#w_user_body"),v=$("#PurchasePayments_id"),h=$("#w_description"),_=$("#w_code_internal"),g=$("#w_type_id"),b=$("#w_physical_location"),y=$("#w_address"),C=$("#w_state"),k=$("#modalControlSaldo"),w=$("#titleControlSaldo"),p.on("hidden.bs.modal",function(e){u.attr("style","display:block;")}),p.on("show.bs.modal",function(e){u.attr("style","display:block; z-index:2030 !important")}),x.on("hidden.bs.modal",function(e){u.attr("style","display:block;")}),x.on("show.bs.modal",function(e){u.attr("style","display:block; z-index:2030 !important")}),u.on("hidden.bs.modal",function(e){r()}),k.on("hidden.bs.modal",function(e){x.attr("style","display:block;")}),k.on("show.bs.modal",function(e){x.attr("style","display:block; z-index:2030 !important")}),S||d()}function r(){m.html(""),v.val(""),h.val(""),y.val(""),_.val(""),C.prop("checked",!1),b.prop("checked",!1),f.html(""),activeTab("almacen")}function n(){o(),u.modal("show"),m.html("Nuevo Pagos de Compras y Gastos")}function s(e){o(),m.html("Editar Pagos de Compras y Gastos"),u.modal("show")}function c(){o(),$("#modalControlSaldo").modal("show"),w.html("Monto a Pagar")}function l(e,t,a){if($("#tr_b_"+e).length>0)return i.showWarning({title:"",message:"Ya se asignó este Pago"}),!1;var o=$('<tr id="tr_b_'+e+'"></tr>'),r=$("<td>"+t+"</td>"),n=$("<td>"+a+"</td>"),s=$('<input type="hidden" class="w_user" value="'+e+'" />');r.append(s);var c=$('<td class="text-center"></td>'),l=$('<button class="btn btn-danger btn-xs delPurchasePayments" data-id="'+e+'" type="button"><span class="fa fa-trash"></span></button>');c.append(l),o.append(r).append(n).append(c),$("#w_user_body").append(o),$("#modalUsuario").modal("hide"),$(".delPurchasePayments").click(function(e){var t=$(this).attr("data-id");i.confirm({title:"",message:"¿Está seguro que desea quitar este Almacén?",confirm:"Si",cancel:"No"},function(){$("#tr_b_"+t).remove()}),e.preventDefault()})}function d(){S=!0;var e=getFormSearch("frm-search-user","search_user","LoadRecordsButtonUser"),t=$("#table_container_provider");t.jtable({title:"Lista de Proveedores",paging:!0,sorting:!0,actions:{listAction:base_url+"/fronts/listClient"},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},Documento:{title:"Ruc"},RazonSocial:{title:"Razón Social"},select:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_u" data-code="'+e.record.id+'" data-doc="'+e.record.Documento+'" data-name="'+e.record.RazonSocial+'"><i class="fa fa-circle-o fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_u").click(function(e){var t=$(this).attr("data-code"),a=$(this).attr("data-title"),i=$(this).attr("data-name");l(t,a,i),e.preventDefault()})}}),generateSearchForm("frm-search-user","LoadRecordsButtonUser",function(){t.jtable("load",{search:$("#search_user").val()})},!1);var e=getFormSearch("frm-search-purchasebilling","search_purchasebilling","LoadRecordsButtonPurchaseBilling"),t=$("#table_container_purchasebilling");t.jtable({title:"Lista de Documentos",paging:!0,sorting:!0,actions:{listAction:function(e,t){return{Result:"OK",Records:[{Comprobante:"FACTURA",numero:"001-0002",monto:"5000.00",fecha:"12/01/2017"},{Comprobante:"FACTURA",numero:"001-0003",monto:"4000.00",fecha:"13/01/2017"},{Comprobante:"FACTURA",numero:"001-0004",monto:"3000.00",fecha:"12/10/2017"}],TotalRecordCount:4}}},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},Comprobante:{title:show_list_?"Tipo Comprobante":"Tipo Comp"},numero:{title:show_list_?"N° Comprobante":"N° Comp."},monto:{title:show_list_?"Monto Total":"Total",listClass:"text-right"},fecha:{title:"Fecha Emisión",listClass:"text-center",list:show_list_},select:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_u" data-code="'+e.record.id+'" data-doc="'+e.record.Documento+'" data-name="'+e.record.RazonSocial+'"><i class="fa fa-circle-o fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_u").click(function(e){var t=$(this).attr("data-code");c(t),e.preventDefault()})}}),generateSearchForm("frm-search-purchasebilling","LoadRecordsButtonPurchaseBilling",function(){t.jtable("load",{search:$("#search_purchasebilling").val()})},!1)}var u,p,m,f,v,h,_,g,b,y,C,x,k,w;$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(t){$(t.target).click(),e.chkState()}),e.saveBalanceControl=function(){$("#modalControlSaldo").modal("hide"),$("#modalPurchaseBilling").modal("hide")},e.openProvider=function(){$("#LoadRecordsButtonUser").click(),p.modal("show")},e.openPurchaseBilling=function(){x.modal("show")},e.savePurchasePayments=function(){var e=!0;if(e=e&&h.required(),e=e&&g.required(),e=e&&y.required(),e=e&&_.required()){var o=[];$.each($(".w_user"),function(e,t){o[e]=$(t).val()}),o=o.join(",");var r={id:v.val(),code_internal:_.val(),description:h.val(),type_id:g.val(),address:y.val(),state:C.prop("checked")?1:0,physical_location:b.prop("checked")?1:0,users:o},n=""==v.val()?0:v.val();console.log(n),a.updated("purchase_payments/savePurchasePayments",n,r,function(e){t.isUndefined(e.status)||1!=e.status?i.textType({title:"",message:"Hubo un error al guardar el Almacén. Intente nuevamente.",type:"error"}):(console.log(e),i.textType({title:"",message:"El Almacén se guardó correctamente.",type:"success"}),u.modal("hide"),LoadRecordsButtonPurchasePayments.click())})}};var A=getFormSearch("frm-search-PurchasePayments","search_PurchasePayments","LoadRecordsButtonPurchasePayments"),R=$("#table_container_purchase_payments");R.jtable({title:"Lista de Pagos de Compras y Gastos",paging:!0,sorting:!0,actions:{listAction:function(e,t){return{Result:"OK",Records:[{description:"ELECTROCENTRO SA",ruc:"10475835364",proyecto:"00123- PROYECTO PRUEBA",local:"LOCAL PRINCIPAL",Periodo_contable:"201701",saldo:"2,456.00",fecha_emision:"12/01/2017"},{description:"SYSTEM SA",ruc:"10475835362",proyecto:"00124- PROYECTO PRUEBA",local:"LOCAL PRINCIPAL",Periodo_contable:"201702",saldo:"1,756.00",fecha_emision:"12/02/2017"},{description:"CONSTRUCT SA",ruc:"10475835367",proyecto:"00125- PROYECTO PRUEBA",local:"LOCAL PRINCIPAL",Periodo_contable:"201703",saldo:"3,656.00",fecha_emision:"12/03/2017"},{description:"MALDONADO SA",ruc:"10475835366",proyecto:"00126- PROYECTO PRUEBA",local:"LOCAL PRINCIPAL",Periodo_contable:"201704",saldo:"4,256.00",fecha_emision:"12/04/2017"}],TotalRecordCount:4}},deleteAction:base_url+"/purchase_payments/delete"},toolbar:{items:[{cssClass:"buscador",text:A},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){window.open(base_url+"/purchase_payments/excel")}},{cssClass:"btn-success",text:'<i class="fa fa-plus"></i> Nuevo Pagos de Compras',click:function(){n()}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},description:{title:"Proveedor"},ruc:{title:"Ruc",width:"4%"},proyecto:{title:"Proyecto"},local:{title:"Local",width:"7%"},Periodo_contable:{title:"Periodo Contable",width:"3%"},saldo:{title:"Monto Total",listClass:"text-right",width:"3%"},fecha_emision:{title:"Fecha",listClass:"text-center",list:show_list_,width:"3%"},edit:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return'<a href="javascript:void(0)" title="Editar" class="edit_w" data-code="'+e.record.id+'"><i class="fa fa-pencil-square-o fa-1-5x fa-green"></i></a>'}}},recordsLoaded:function(e,t){$(".edit_w").click(function(e){var t=$(this).attr("data-code");s(t),e.preventDefault()})}}),generateSearchForm("frm-search-PurchasePayments","LoadRecordsButtonPurchasePayments",function(){R.jtable("load",{search:$("#search_PurchasePayments").val()})},!0);var S=!1}function t(e,t){e.state("purchase_payments",{url:"/purchase_payments",templateUrl:base_url+"/templates/purchase_payments/base.html",controller:"PurchasePaymentsCtrl"}),t.otherwise("/")}angular.module("sys.app.purchase_payments").config(t).controller("PurchasePaymentsCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.query_movements",[])}(),function(){"use strict";function e(e,t,a,i,o){function r(){n=$("#filtro_idAlm"),s=$("#filtro_idLoc"),d=$("#filtro_nat"),u=$("#filtro_oper"),c=$("#filtro_cate"),l=$("#filtro_art");var e=new Date,i=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate();$("#fecha_inicio").val(i),$("#fecha_fin").val(i),a.all("query_movements/getDataFiltro","",function(e){!t.isUndefined(e.status)&&e.status?(n.append('<option value="">Almacén</option>'),t.each(e.d_Almacen,function(e){n.append('<option value="'+e.description+'">'+e.description+"</option>")}),s.append('<option value="">Localización</option>'),c.append('<option value="">Categoría</option>'),t.each(e.d_categoria,function(e){c.append('<option value="'+e.descripcion+'">'+e.descripcion+"</option>")}),l.append('<option value="">Artículo</option>'),t.each(e.d_articulo,function(e){l.append('<option value="'+e.description+'">'+e.code_article+" "+e.description+"</option>")}),d.append('<option value="">Naturaleza</option>'),t.each(e.d_naturaleza,function(e){d.append('<option value="'+e.descripcion+'">'+e.descripcion+"</option>")}),u.append('<option value="">Operación</option>'),t.each(e.d_tipoOperacion,function(e){u.append('<option value="'+e.descripcion+'">'+e.descripcion+"</option>")})):r()},function(){r()})}$("#titlemodalQueryMovement"),$("#modalQueryMovement");e.chkState=function(){var e=w_state.prop("checked")?"Activo":"Inactivo";state_state.html(e)};var n='<select id="filtro_idAlm" class="form-control input-sm""><option value="">Almacen</option></select>',s='<select id="filtro_idLoc" class="form-control input-sm""><option value="">Localizacion</option></select>',c='<select id="filtro_cate" class="form-control input-sm""><option value="">Categoría</option></select>',l='<select id="filtro_art" class="form-control input-sm""><option value="">Árticulo</option></select>',d='<select id="filtro_nat" class="form-control input-sm""><option value="">Naturaleza</option></select>',u='<select id="filtro_oper" class="form-control input-sm""><option value="">Tipo Operación</option></select>',p=getFormSearch3("frm-search-Query_Movement","search_b","LoadRecordsButtonQuery_Movement"),m=$("#table_container_Query_Movement");m.jtable({title:"Lista de Movimientos por Articulo",paging:!0,sorting:!0,actions:{listAction:base_url+"/query_movements/list"},messages:{addNewRecord:"Nueva Categoría",editRecord:"Editar Categoría"},toolbar:{items:[{cssClass:"buscador",text:p}]},fields:{idTransaccion:{key:!0,create:!1,edit:!1,list:!1},id:{key:!1,create:!1,edit:!1,list:!1},fecha_registro:{key:!1,create:!1,edit:!1,list:!1},fecha_proceso_s:{title:"F. Proceso"},fecha_registro_s:{title:"F. Registro"},Articulo:{title:"Articulo"},Categoria:{title:"Categoria"},Unidad:{title:"Uni.",width:"3%"},Tipo_Operacion:{title:"Tip.Ope.",width:"3%"},Naturaleza:{title:"Nat.",width:"3%"},Origen:{title:"Ori.",width:"3%"},idOrigen:{title:"Id",width:"3%"},Almacen:{title:"Alm.",width:"6%"},Localizacion:{title:"Loc.",width:"6%"},Cantidad:{title:"Cant.",listClass:"text-right",width:"3%"},Costo_Unitario:{title:"C.Unitario",listClass:"text-right",width:"3%"},Precio_Unitario:{title:"P.Unitario",listClass:"text-right",width:"3%"},Costo_Total:{title:"C.Total",listClass:"text-right",width:"3%"},Precio_Total:{title:"P.Total",listClass:"text-right",width:"3%"},Lote:{title:"Lote"},Serie:{title:"Serie"}},formCreated:function(e,t){t.form.find('input[name="Categoria"]').attr("onkeypress","return soloLetras(event)"),$("#Edit-estado").parent().addClass("i-checks"),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"
}).on("ifChanged",function(e){$(e.target).click(),"A"==e.target.value?($("#Edit-estado").val("I"),$(".i-checks span").text("Inactivo")):($("#Edit-estado").val("A"),$(".i-checks span").text("Activo"))})},formSubmitting:function(e,t){var a=!0;return a=a&&t.form.find('input[name="Categoria"]').required()}}),$("#filtro_art").select2(),$("#filtro_idAlm").change(function(){var e=$("#filtro_idAlm").val();a.get("query_stocks/get_localizacion",e,function(e){s.html(""),s.append('<option value="">Localización</option>'),t.each(e.localizaciones,function(e){s.append('<option value="'+e.descripcion+'">'+e.descripcion+"</option>")})})}),r(),$("#btn_exportar_QM").click(function(t){var a={filtro_idAlm:$("#filtro_idAlm").val(),filtro_idLoc:$("#filtro_idLoc").val(),filtro_nat:$("#filtro_nat").val(),filtro_oper:$("#filtro_oper").val(),filtro_cate:$("#filtro_cate").val(),filtro_art:$("#filtro_art").val(),n_movimiento:$("#n_movimiento").val(),cod_lote:$("#cod_lote").val(),cod_serie:$("#cod_serie").val(),fecha_inicio:$("#fecha_inicio").val(),fecha_fin:$("#fecha_fin").val(),search:""};e.openDoc("query_movements/excel",a)}),generateSearchForm("frm-search-Query_Movement","LoadRecordsButtonQuery_Movement",function(){m.jtable("load",{search:$("#search_b").val(),filtro_idAlm:$("#filtro_idAlm").val(),filtro_idLoc:$("#filtro_idLoc").val(),filtro_nat:$("#filtro_nat").val(),filtro_oper:$("#filtro_oper").val(),filtro_cate:$("#filtro_cate").val(),filtro_art:$("#filtro_art").val(),n_movimiento:$("#n_movimiento").val(),cod_lote:$("#cod_lote").val(),cod_serie:$("#cod_serie").val(),fecha_inicio:$("#fecha_inicio").val(),fecha_fin:$("#fecha_fin").val()})},!0),$(".jtable-title-text").removeClass("col-md-4"),$(".jtable-title-text").addClass("col-md-3"),$(".jtable-toolbar").removeClass("col-md-8"),$(".jtable-toolbar").addClass("col-md-9")}function t(e,t){e.state("query_movements",{url:"/query_movements",templateUrl:base_url+"/templates/query_movements/base.html",controller:"Query_MovementCtrl"}),t.otherwise("/")}angular.module("sys.app.query_movements").config(t).controller("Query_MovementCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory","Notify"]}(),function(){"use strict";angular.module("sys.app.query_stocks",[])}(),function(){"use strict";function e(e,t,a,i,o){function r(){c=$("#filtro_idAlm"),l=$("#filtro_idLoc"),d=$("#filtro_cate"),u=$("#filtro_art"),a.all("query_stocks/getDataFiltro","",function(e){!t.isUndefined(e.status)&&e.status?(c.append('<option value="">Almacén</option>'),t.each(e.d_Almacen,function(e){c.append('<option value="'+e.description+'">'+e.description+"</option>")}),l.append('<option value="">Localización</option>'),d.append('<option value="">Categoría</option>'),t.each(e.d_categoria,function(e){d.append('<option value="'+e.descripcion+'">'+e.descripcion+"</option>")}),u.append('<option value="">Artículo</option>'),t.each(e.d_articulo,function(e){u.append('<option value="'+e.description+'">'+e.code_article+" "+e.description+"</option>")})):r()},function(){r()})}e.chkState=function(){var e=w_state.prop("checked")?"Activo":"Inactivo";state_state.html(e)};var n=getFormSearch2("frm-search-Query_Stock","search_b","LoadRecordsButtonQuery_Stock"),s=$("#table_container_Query_Stock"),c='<select id="filtro_idAlm" class="form-control input-sm""><option value="">Almacen</option></select>',l='<select id="filtro_idLoc" class="form-control input-sm""><option value="">Localizacion</option></select>',d='<select id="filtro_cate" class="form-control input-sm""><option value="">Categoría</option></select>',u='<select id="filtro_art"  style="width: 100%" class="form-control input-sm""><option value="">Árticulo</option></select>';$("#btn_exportar_QS");s.jtable({title:"Lista de Articulos con Stock",paging:!0,sorting:!0,actions:{listAction:base_url+"/query_stocks/list"},messages:{addNewRecord:"Nueva Categoría",editRecord:"Editar Categoría"},toolbar:{items:[{cssClass:"buscador",text:n}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},Articulo:{title:"Articulo"},Categoria:{title:"Categoria"},Unidad:{title:"Uni.",width:"3%"},Almacen:{title:"Alm.",width:"6%"},Localizacion:{title:"Loc.",width:"6%"},Lote:{title:"Lote"},Serie:{title:"Serie"},Disponible:{title:"Disponible",listClass:"text-right",width:"3%"},Remitido:{title:"Remitido",listClass:"text-right",width:"3%"},Total:{title:"S.Total",listClass:"text-right",width:"3%"},Transito:{title:"Tránsito",listClass:"text-right",width:"3%"},Costo_Promedio_Unitario:{title:"Costo",listClass:"text-right",width:"3%"},Costo_Total:{title:"C.Total",listClass:"text-right",width:"3%"}},formCreated:function(e,t){t.form.find('input[name="Categoria"]').attr("onkeypress","return soloLetras(event)"),$("#Edit-estado").parent().addClass("i-checks"),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click(),"A"==e.target.value?($("#Edit-estado").val("I"),$(".i-checks span").text("Inactivo")):($("#Edit-estado").val("A"),$(".i-checks span").text("Activo"))})},formSubmitting:function(e,t){var a=!0;return a=a&&t.form.find('input[name="Categoria"]').required()}}),generateSearchForm("frm-search-Query_Stock","LoadRecordsButtonQuery_Stock",function(){s.jtable("load",{search:"",filtro_art:$("#filtro_art").val(),filtro_idAlm:$("#filtro_idAlm").val(),filtro_idLoc:$("#filtro_idLoc").val(),filtro_cate:$("#filtro_cate").val()})},!0),r(),$("#filtro_art").select2(),$("#filtro_idAlm").change(function(){var e=$("#filtro_idAlm").val();a.get("query_stocks/get_localizacion",e,function(e){l.html(""),l.append('<option value="">Localización</option>'),t.each(e.localizaciones,function(e){l.append('<option value="'+e.descripcion+'">'+e.descripcion+"</option>")})})}),$("#btn_exportar_QS").click(function(t){var a={filtro_idAlm:$("#filtro_idAlm").val(),filtro_idLoc:$("#filtro_idLoc").val(),filtro_cate:$("#filtro_cate").val(),filtro_art:$("#filtro_art").val(),search:""};e.openDoc("query_stocks/excel",a)}),$(".jtable-title-text").removeClass("col-md-4"),$(".jtable-title-text").addClass("col-md-3"),$(".jtable-toolbar").removeClass("col-md-8"),$(".jtable-toolbar").addClass("col-md-9")}function t(e,t){e.state("query_stocks",{url:"/query_stocks",templateUrl:base_url+"/templates/query_stocks/base.html",controller:"Query_StockCtrl"}),t.otherwise("/")}angular.module("sys.app.query_stocks").config(t).controller("Query_StockCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory","Notify"]}(),function(){"use strict";angular.module("sys.app.quotations",[])}(),function(){"use strict";function e(e,t,a,i){function o(){cleanRequired(),z.empty(),Te=0,H.val(""),G.val(user_default),W.val(Ye),K.addClass("hide"),Q.empty(),Z.empty(),J.addClass("hide"),Qe=[],activeTab("tab1"),X.empty(),r(),De=!1}function r(){cleanBorderRequired(),Ne=0,me.val(""),fe.val(Oe),te.val(Ye),ee.val(""),ae.val(""),ie.val(""),oe.val(""),re="",ne.val(""),se.val(""),ce.val(""),le.val(""),de.val(""),ue.val(""),pe.val(""),Fe="",ve.val(user_default),he.val(Ye),_e.val(""),$e.val(""),be.prop("checked",!0).iCheck("update"),ye.val(""),Ce.val(""),xe.val(""),ke.val(""),we.val(""),Ae.val(""),Re.val(""),Se.empty(),activeTab("tab11"),Ze=[],Ke=1}function n(){Le.val(""),Pe.empty(),je.empty(),Ee.empty()}function s(){V=$("#quo_states"),V.empty().change(function(){$("#LoadRecordsButtonQ").click()}),a.all("contests/data_form","",function(e){!t.isUndefined(e.status)&&e.status&&(t.each(e.states,function(e){V.append('<option value="'+e.Value+'">'+e.DisplayText+"</option>")}),v(),Me=e.payment_conditions,Ue=e.currency,Ie=e.igv,Be=e.change,e.change_status||i.showWarning({title:"",message:"No se ha detectado un tipo de cambio con la fecha de hoy. Por favor dirigete al módulo de Tipo de Cambio para registrarlo, de lo contrario se usuará una con la fecha más reciente."}))},function(){s()})}function c(){We||(M=$("#modalQ"),U=$("#modalRequirementQuotation"),O=$("#modalProviderListContest"),I=$("#modalItemProviderListContest"),B=$("#modalProviders"),Y=$("#modalC"),z=$("#title-quo"),H=$("#q_description"),K=$("#q_show_req"),Q=$("#q_body_requirements"),Z=$("#q_body_requirements_consolidated"),J=$(".show_buttons_consolidated"),G=$("#q_user_request"),G.val(user_default),W=$("#q_date_request"),W.val(Ye),je=$("#c_c_requirement_detail"),Le=$("#c_c_contest_id"),Ee=$("#c_c_quotations_detail"),Pe=$("#c_c_quotations_head"),X=$("#q_body_quotations_providers"),ee=$("#q_p_number"),te=$("#q_p_date_emission"),te.val(Ye),ae=$("#q_p_delivery_days"),ie=$("#q_p_delivery_date"),oe=$("#q_p_file_add"),oe.fileinput({language:"es",uploadUrl:base_url+"/contests/uploadProvider",uploadAsync:!0,showUpload:!1}).on("filebatchselected",function(e,t){re="",oe.fileinput("upload")}).on("fileuploaded",function(e,a,i,o){if(!t.isUndefined(a.response.status)&&a.response.status){var r=a.response.uploaded;re=r,$(".file-caption-name").attr("title",r).html('<i class="glyphicon glyphicon-file kv-caption-icon"></i> '+r)}}).on("filecleared",function(e){re=""}).on("fileuploaderror",function(e,t,a){setTimeout(function(){$(".kv-upload-progress").find(".progress-bar").removeClass("progress-bar-success").addClass("progress-bar-danger").html(t.response.error)},200)}),ie.datepicker({changeMonth:!0,changeYear:!0,dateFormat:"dd/mm/yy",beforeShow:function(){setTimeout(function(){$(".ui-datepicker").css("z-index",2052)})}}),generateDatePicker(ie),ve=$("#q_p_user_request"),ve.val(user_default),he=$("#q_p_date_request"),he.val(Ye),me=$("#q_p_payment_condition"),me.empty(),fe=$("#q_p_currency"),fe.empty(),_e=$("#q_p_subtotal"),ge=$("#q_p_igv_percentage"),ge.val(Ie),$e=$("#q_p_igv"),be=$("#q_p_igv_checked"),be.click(function(){A()}),generateCheckBox("#q_p_igv_checked"),ye=$("#q_p_total"),Ce=$("#q_p_subtotal_local"),xe=$("#q_p_igv_local"),ke=$("#q_p_total_local"),we=$("#q_p_subtotal_dollar"),Ae=$("#q_p_igv_dollar"),Re=$("#q_p_total_dollar"),t.each(Me,function(e){me.append('<option value="'+e.Value+'">'+e.DisplayText+"</option>")}),t.each(Ue,function(e,t){0===t&&(Oe=e.Value),fe.append('<option value="'+e.Value+'">'+e.DisplayText+"</option>")}),fe.change(function(){C(0)}),ne=$("#q_p_ruc"),se=$("#q_p_business_name"),ce=$("#q_p_payment_advance"),le=$("#q_p_address_provider"),de=$("#q_p_date_send"),generateDatePicker(de),ue=$("#q_p_contact"),pe=$("#q_p_contact_phone"),Se=$("#q_p_table_items_provider"),M.on("hidden.bs.modal",function(e){o()}),U.on("hidden.bs.modal",function(e){M.attr("style","display:block;"),$("#search_rq").val(""),$("#LoadRecordsButtonRC").click()}),U.on("show.bs.modal",function(e){$("#LoadRecordsButtonRC").click(),M.attr("style","display:block; z-index:2030 !important")}),B.on("hidden.bs.modal",function(e){M.attr("style","display:block;"),r()}),B.on("show.bs.modal",function(e){A(),M.attr("style","display:block; z-index:2030 !important")}),O.on("hidden.bs.modal",function(e){B.attr("style","display:block;"),$("#search_pc").val(""),$("#LoadRecordsButtonPC").click()}),O.on("show.bs.modal",function(e){$("#LoadRecordsButtonPC").click(),B.attr("style","display:block; z-index:2031 !important")}),I.on("hidden.bs.modal",function(e){B.attr("style","display:block;"),$("#search_ipc").val(""),$("#LoadRecordsButtonIPC").click()}),I.on("show.bs.modal",function(e){$("#LoadRecordsButtonIPC").click(),B.attr("style","display:block; z-index:2031 !important")}),Y.on("hidden.bs.modal",function(e){n()}),h())}function l(){c(),M.modal("show"),z.html("Nuevo Concurso")}function d(e){c(),z.html("Editar Concurso"),a.get("contests/find",e,function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.data;Te=a.id,H.val(a.description),G.val(a.requested_by),W.val(a.date),t.each(a.requirements,function(e){_(e,!1)}),L(Te),De=!1,M.hasClass("in")||M.modal("show")}else i.textType({title:"",message:"Hubo un error al obtener el concurso. Intente nuevamente.",type:"error"})})}function u(e){c(),a.get("contests/find",e,function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.data;Le.val(a.id),t.each(a.requirements,function(e){p(e)}),m(a.id,function(){f(a.id)}),Y.modal("show")}else i.textType({title:"",message:"Hubo un error al obtener el concurso. Intente nuevamente.",type:"error"})})}function p(e){var t=$('<tr class="row_c_requirement" data-id="'+e.id+'"></tr>'),a=$('<td class="text-center">'+e.code+"</td>"),i=$('<td class="text-center">'+e.date_registration+"</td>"),o=$("<td>"+e.project_description+"</td>"),r=$("<td>"+e.requested_by+"</td>");t.append(a).append(i).append(o).append(r),je.append(t)}function m(e,i){a.get("contests/quotationsProviders",e,function(e){if(!t.isUndefined(e.status)&&e.status){Pe.empty();var a=4*e.data.length,o=$('<tr class="text-center"></tr>'),r=$('<th colspan="2" rowspan="2">CONSOLIDADO DE REQUERIMIENTOS</th>'),n=$('<th class="text-center" colspan="'+a+'">PROVEEDORES</th>'),s=$('<tr class="text-center"></tr>'),c=$("<tr></tr>"),l=$('<th class="text-center">ARTICULO</th>'),d=$('<th class="text-center">CANTIDAD TOTAL</th>');c.append(l).append(d),t.each(e.data,function(e){var t=$('<th  class="text-center c_contest_provider" data-id="'+e.id+'" colspan="4">'+e.description+"</th>"),a=$('<th class="text-right">CANTIDAD</th>'),i=$('<th class="text-right" style="">PRECIO</th>'),o=$('<th class="text-right" colspan="2">TOTAL</th>');s.append(t),c.append(a).append(i).append(o)}),o.append(r).append(n),Pe.append(o).append(s).append(c),t.isFunction(i)&&i()}})}function f(e){var i=[],o=[];t.each($(".row_c_requirement"),function(e){var t=$(e).attr("data-id");i.push(t)}),t.each($(".c_consolidated_article"),function(e){var t=$(e).attr("data-id");o.push(t)}),console.log(o);var r="params_all="+i.join("-")+","+e,n="";a.all("contests/consolidatedRequirementDetail",r,function(e){if(!t.isUndefined(e.status)&&e.status){Ee.empty();var a=e.data.product_consolidated;$.each(a,function(e,t){var a=t.detail;n+='<tr class="c_consolidated_article" data-id="'+t.id+'">',n+="<td>"+t.description+"</td>",n+="<td>"+parseFloat(t.quantity).toFixed(2)+"</td>",n+="<tr>",$.each(a,function(e,t){})}),Ee.append(n)}})}function v(){generateSearchForm("frm-search-q","LoadRecordsButtonQ",function(){Ge.jtable("load",{search:$("#search_q").val(),check:F.prop("checked"),from:T.format("YYYY-MM-DD"),to:N.format("YYYY-MM-DD"),state:V.val()})},!0)}function h(){We=!0;var e=getFormSearch("frm-search-rq","search_rq","LoadRecordsButtonRC"),a=$("#table_container_rc");a.jtable({title:"Lista de Requerimientos",paging:!0,sorting:!0,selecting:!0,multiselect:!0,selectingCheckboxes:!0,selectOnRowClick:!1,actions:{listAction:base_url+"/contests/requirementsList"},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},code:{title:"Requerimiento",listClass:"text-center"},date_registration:{title:"F.Registro",listClass:"text-center"},project_description:{title:"Proyecto",width:"30%",sorting:!1},requested_by:{title:"Solicitado por",list:show_list_}},recordsLoaded:function(e,t){$(".jtable-selecting-column input").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click()})}}),generateSearchForm("frm-search-rq","LoadRecordsButtonRC",function(){a.jtable("load",{search:$("#search_rq").val(),state:3,assignment_req:"1",is_assignment:"1",items:Qe})},!1);var i=getFormSearch("frm-search-pc","search_pc","LoadRecordsButtonPC"),o=$("#table_container_provider_contest");o.jtable({title:"Lista de Proveedores",paging:!0,sorting:!0,actions:{listAction:base_url+"/contests/providersList"},toolbar:{items:[{cssClass:"buscador",text:i}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},Documento:{title:"Documento",width:"2%",listClass:"text-center"},NombreEntidad:{title:"Razón Social"},DireccionLegal:{title:"Dirección Legal",list:show_list_},contact:{title:"Contacto",width:"3%"},contact_phone:{title:"Teléf. de Contacto",list:show_list_,width:"3%"},select:{width:"1%",listClass:"text-center",sorting:!1,edit:!1,create:!1,display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_prov" data-code="'+e.record.id+'"><i class="fa fa-'+icon_select+' fa-1-5x"></i></a>'}}},recordsLoaded:function(e,a){$(".select_prov").click(function(e){var i=$(this).attr("data-code"),o=t.find(a.records,function(e){return e.id===i});o&&(console.log("proveedor:"+o),q(o)),O.modal("hide"),e.preventDefault()})}}),generateSearchForm("frm-search-pc","LoadRecordsButtonPC",function(){o.jtable("load",{search:$("#search_pc").val()})},!1);var r=getFormSearch("frm-search-ipc","search_ipc","LoadRecordsButtonIPC"),n=$("#table_container_item_provider_contest");n.jtable({title:"Lista de Items",paging:!0,sorting:!0,selecting:!0,multiselect:!0,selectingCheckboxes:!0,selectOnRowClick:!1,actions:{listAction:base_url+"/contests/providersItemsList"},toolbar:{items:[{cssClass:"buscador",text:r}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},product:{title:"Artículo"},um:{title:"U.M.",list:show_list_,width:"3%",listClass:"text-center"},quantity:{title:"Cantidad",width:"3%",listClass:"text-right"}},recordsLoaded:function(e,t){$(".jtable-selecting-column input").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click()})}}),generateSearchForm("frm-search-ipc","LoadRecordsButtonIPC",function(){n.jtable("load",{search:$("#search_ipc").val(),contest:Te,items:Ze})},!1)}function _(e,a){t.contains(Qe,e.id)||(console.log(e.id),b(e,a),Qe.push(e.id))}function g(e){t.contains(Ze,e.article_id)||(y(e),Ze.push(e.article_id))}function b(e,a){var o=$('<tr class="rowReqContest" data-id="'+e.id+'"></tr>'),r=$('<td class="text-center">'+e.code+"</td>"),n=$('<td class="text-center">'+e.date_registration+"</td>"),s=$("<td>"+e.project_description+"</td>"),c=$("<td>"+e.requested_by+"</td>"),l=$('<a data-target="#" title="Eliminar" class="delReqCon"><i class="fa fa-trash fa-1-5x fa-red"></i></a>'),d=$('<td class="text-center"></td>');d.append(l),o.append(r).append(n).append(s).append(c).append(d),Q.append(o),S(),a&&(De=!0),$(".delReqCon").click(function(e){var a=$(this).closest("tr");i.confirm({title:"",message:"¿Está seguro que desea quitar este requerimiento?",confirm:"Si",cancel:"No"},function(){var e=a.attr("data-id");a.remove(),Qe=t.reject(Qe,function(t){return t===parseInt(e)}),S(),De=!0}),e.preventDefault()})}function y(e){var a=$('<a data-target="#" title="Eliminar" class="delItemQuo"><i class="fa fa-trash fa-1-5x fa-red"></i></a>'),o=$('<td class="text-center"></td>');o.append(a);var r=$('<tr class="rowItemQuotation" data-id="'+e.article_id+'"></tr>'),n=$('<td class="text-center td_item_numbers">'+Ke+"</td>"),s=$('<td><textarea id="item_q'+e.article_id+'" class="form-control input-sm" rows="1">'+e.product+"</textarea></td>"),c=$('<td class="text-center">'+e.um+"</td>"),l=$('<td class="text-center">'+e.model+"</td>"),d=$('<td class="text-right">'+e.average_price+"</td>"),u=$('<td><input id="quantity_q'+e.article_id+'" onclick="this.select()" data-max="'+e.quantity+'" onkeypress="return validDecimals(event, this, 3)" onblur="return roundDecimals(this, 2)" class="calculate_ text-right form-control input-sm input-quantity-q" value="'+e.quantity+'" /></td>');r.append(o).append(n).append(s).append(c).append(l).append(d).append(u);var p=t.isNull(e.price)?".00":t.isUndefined(e.price)?"0.00":e.price,m=$('<td><input id="price_q'+e.article_id+'" onclick="this.select()" onkeypress="return validDecimals(event, this, 3)" onblur="return roundDecimals(this, 2)" class="calculate_ text-right form-control input-sm" value="'+p+'" /></td>'),f=$('<td class="text-right"><span id="subtotal'+e.article_id+'"></span></td>'),v=t.isNull(e.discount_percentage)?".00":t.isUndefined(e.discount_percentage)?".00":e.discount_percentage,h=$('<td><input id="discount_p_q'+e.article_id+'" onclick="this.select()" onkeypress="return validDecimals(event, this, 3)" onkeypress="return roundDecimals(this, 2)" class="discount_p_ text-right form-control input-sm" value="'+v+'" " /></td>'),_=t.isNull(e.discount)?".00":t.isUndefined(e.discount)?".00":e.discount,g=$('<td><input id="discount_q'+e.article_id+'" onclick="this.select()" onkeypress="return validDecimals(event, this, 3)" onkeypress="return roundDecimals(this, 2)" class="discount_ text-right form-control input-sm" value="'+_+'" /></td>'),b=$('<td class="text-right"><span class="totals_" id="total'+e.article_id+'"></span></td>'),y=$('<td class="text-right"><span class="totals_l" id="total_l'+e.article_id+'"></span></td>'),C=$('<td class="text-right"><span class="totals_d" id="total_d'+e.article_id+'"></span></td>');r.append(o).append(n).append(s).append(c).append(l).append(d).append(u).append(m).append(f).append(h).append(g).append(b).append(y).append(C),Se.append(r),Ke++,$(".calculate_").keyup(function(){var e=$(this).closest("tr").attr("data-id");k(e)}),$(".discount_p_").keyup(function(){var e=$(this).closest("tr").attr("data-id");w(e,1)}),$(".discount_").keyup(function(){var e=$(this).closest("tr").attr("data-id");w(e,2)}),$(".input-quantity-q").blur(function(){var e=$(this),t=e.attr("data-max");(e.val()>parseFloat(t)||""===e.val())&&i.showWarning({title:"Debe ingresar una cantidad menor o igual a la cantidad requerida",message:""},function(){e.val(t),e.select()})}),$(".delItemQuo").click(function(e){var a=$(this).closest("tr");i.confirm({title:"",message:"¿Está seguro que desea quitar este item?",confirm:"Si",cancel:"No"},function(){var e=a.attr("data-id");a.remove(),Ze=t.reject(Ze,function(t){return t===e}),R(),A()}),e.preventDefault()}),k(e.article_id)}function C(e){0===e?t.each($(".rowItemQuotation"),function(e){var t=parseFloat($(e).attr("data-id"));x(t)}):x(e),A()}function x(e){var t,a,i=parseFloat($("#total"+e).html());1===parseInt(fe.val())?(t=i,a=0===i?0:i/Be):(t=i*Be,a=i),$("#total_l"+e).html(t.toFixed(2)),$("#total_d"+e).html(a.toFixed(2))}function k(e){var t=$("#quantity_q"+e).val();t=""===t?0:t;var a=$("#price_q"+e).val();a=""===a?0:a;var i=t*a;$("#subtotal"+e).html(i.toFixed(2)),w(e,1)}function w(e,t){var a=$("#subtotal"+e).html();a=parseFloat(a);var i=$("#discount_p_q"+e).val();i=""===i?0:parseFloat(i);var o=$("#discount_q"+e).val();o=""===o?0:parseFloat(o),1===t?(o=a*i/100,$("#discount_q"+e).val(o.toFixed(2))):(i=0===a?0:100*o/a,$("#discount_p_q"+e).val(i));var r=a-o;$("#total"+e).html(r.toFixed(2)),C(e)}function A(){var e=0;t.each($(".totals_"),function(t){e+=parseFloat($(t).html())}),_e.val(e.toFixed(2));var a=be.prop("checked")?Ie:0;a=0===e?0:a/100*e,$e.val(a.toFixed(2)),ye.val((e+a).toFixed(2));var i,o,r,n;1===parseInt(fe.val())?(i=e,r=0===e?0:e/Be,o=a,n=0===a?0:a/Be):(i=e*Be,r=e,o=a*Be,n=a),Ce.val(i.toFixed(2)),xe.val(o.toFixed(2)),ke.val((i+o).toFixed(2)),we.val(r.toFixed(2)),Ae.val(n.toFixed(2)),Re.val((r+n).toFixed(2))}function R(){Ke=1,t.each($(".td_item_numbers"),function(e){$(e).html(Ke),Ke++})}function S(){K.addClass("hide"),J.addClass("hide"),""!==Q.html()&&(K.removeClass("hide"),J.removeClass("hide")),j()}function j(){var e=[];t.each($(".rowReqContest"),function(t){var a=$(t).attr("data-id");e.push(a)});var i="requirements="+e.join("-");$("#show_loading").addClass("hide"),a.all("contests/consolidatedRequirement",i,function(e){!t.isUndefined(e.status)&&e.status&&(Z.empty(),Se.empty(),$.each(e.data,function(e,t){var a=$("<tr></tr>"),i=$('<td class="text-center">'+(e+1)+"</td>"),o=$("<td>"+t.description+"</td>"),r=$('<td class="text-center">'+t.um+"</td>"),n=$('<td class="text-right">'+parseFloat(t.quantity).toFixed(2)+"</td>");a.append(i).append(o).append(r).append(n),Z.append(a)})),$("#show_loading").removeClass("hide")},function(){j()})}function L(e){a.get("contests/quotationsProviders",e,function(e){!t.isUndefined(e.status)&&e.status&&(console.log(e),X.empty(),t.each(e.data,function(e){var a=$('<tr data-id="'+e.id+'"></tr>'),o=$('<td class="text-center">'+e.number+"</td>"),r=$("<td>"+e.document+"</td>"),n=$("<td>"+e.description+"</td>"),s=$('<td class="text-right">'+e.total+"</td>"),l=$('<button class="btn btn-success btn-xs provider_document" ng-click="showPDF()" title="Ver Documento"><span class="fa fa-file-pdf-o"></span></button>'),d=$('<button class="btn btn-primary btn-xs provider_edit" title="Editar"  type="button" data-id="'+e.id+'"><span class="fa fa-edit"></span></button>'),u=$('<button class="btn btn-danger btn-xs provider_delete" title="Eliminar" type="button"><span class="fa fa-trash-o"></span></button>'),p=$('<td class="text-center"></td>');p.append(l).append(d).append(u),a.append(o).append(r).append(n).append(s).append(p),X.append(a),$(".provider_edit").click(function(){var e=$(this).attr("data-id");P(e),c(),B.modal("show")}),$(".provider_delete").click(function(e){var a=$(this).closest("tr");i.confirm({title:"",message:"¿Está seguro que desea quitar este concurso de proveedor?",confirm:"Si",cancel:"No"},function(){var e=a.attr("data-id");a.remove(),Ze=t.reject(Ze,function(t){return t===parseInt(e)}),E(e)}),e.preventDefault()})}))})}function E(){}function P(e){a.get("contests/findContestProvider",e,function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.data;Ne=a.id,ee.val(a.number),te.val(a.date_emission),ae.val(a.delivery_days),ie.val(a.delivery_date),de.val(a.shipping_date),Fe=a.provider_id,console.log("ev:"+Fe),ne.val(a.ruc),se.val(a.bussiness_name),le.val(a.adrress_provider),ue.val(a.contact),pe.val(a.contact_phone),me.val(a.payment_condition_id),ce.val(a.payment_advance),fe.val(a.currency_id),t.each(a.item_product,function(e){g(e)}),_e.val(a.subtotal),Ce.val(a.subtotal_local),we.val(a.subtotal_dollar);var o="1"===a.is_igv;be.prop("checked",o).iCheck("update"),$e.val(a.igv),xe.val(a.igv_local),Ae.val(a.igv_dollar),ye.val(a.total),ke.val(a.total_local),Re.val(a.total_dollar)}else i.textType({title:"",message:"Hubo un error al obtener la cotización del proveedor. Intente nuevamente.",type:"error"})})}function q(e){Fe=e.id,ne.val(e.Documento),se.val(e.NombreEntidad),le.val(e.DireccionLegal),ue.val(e.contact),pe.val(e.contact_phone)}function D(){$(".jtable-column-header-selecting input").prop("checked",!1).iCheck("update"),$(".jtable-row-selected").removeClass("jtable-row-selected")}moment.locale("es");var T=moment().startOf("month"),N=moment().endOf("month"),F=$("#chk_date_range");F.click(function(){$("#LoadRecordsButtonQ").click()}),generateCheckBox("#chk_date_range");var M,U,O,I,B,Y,z,V,H,G,W,K,Q,Z,J,X,ee,te,ae,ie,oe,re,ne,se,ce,le,de,ue,pe,me,fe,ve,he,_e,ge,$e,be,ye,Ce,xe,ke,we,Ae,Re,Se,je,Le,Ee,Pe,qe=$("#reqDates"),De=!1,Te=0,Ne=0,Fe="",Me=[],Ue=[],Oe="",Ie=0,Be=0,Ye=moment.tz("America/Lima").format("DD/MM/YYYY");e.addDetailRequirement=function(){var e=$("#table_container_rc").jtable("selectedRows");return e.length>0?(e.each(function(){var e=$(this).data("record");_(e,!0)}),U.modal("hide"),void D()):(i.textType({title:"",message:"Debe seleccionar al menos un requerimiento a asignar.",type:"warning"}),!1)},e.addDetailItem=function(){var e=$("#table_container_item_provider_contest").jtable("selectedRows");return e.length>0?(e.each(function(){var e=$(this).data("record");g(e)}),I.modal("hide"),void D()):(i.textType({title:"",message:"Debe seleccionar al menos un requerimiento a asignar.",type:"warning"}),!1)};var ze=function(e,t){T=e,N=t,qe.find("span").html(e.format("MMM D, YYYY")+" - "+t.format("MMM D, YYYY")),F.prop("checked")&&$("#LoadRecordsButtonQ").click()};generateDateRangePicker(qe,T,N,ze),ze(T,N),e.saveQuotation=function(){var e=!0;if(e=e&&H.required(),e&&""===Q.html())return i.showWarning({title:"",message:"Debe seleccionar el(los) requerimiento(s) del concurso"}),!1;if(e){var o=[];t.each($(".rowReqContest"),function(e){var t=$(e).attr("data-id");o.push(t)});var r={description:H.val(),requirements:o.join("-")};a.updated("contests/save",Te,r,function(e){!t.isUndefined(e.status)&&e.status?(i.textType({title:"",message:"El concurso se guardó correctamente.",type:"success"}),z.html("Editar Concurso"),Te=e.id,$("#LoadRecordsButtonQ").click(),De=!1):i.textType({title:"",message:"Hubo un error al guardar el concurso. Intente nuevamente.",type:"error"})})}},e.saveQuotationProvider=function(){var e=!0;if(""===Fe)return activeTab("tab12"),ne.addClass("border-red").focus(),!1;cleanBorderRequired();var o=$(".rowItemQuotation");if(t.each(o,function(t){var a=$(t).attr("data-id");e=e&&$("#item_q"+a).required(),e=e&&$("#quantity_q"+a).required(),e=e&&$("#price_q"+a).required(),e=e&&$("#discount_p_q"+a).required(),e=e&&$("#discount_q"+a).required(),e||activeTab("tab13")}),e){var r=[],n=[],s=[],c=[],l=[],d=[];t.each(o,function(e){var t=$(e).attr("data-id");r.push(t),n.push($("#item_q"+t).val()),s.push($("#quantity_q"+t).val()),c.push($("#price_q"+t).val()),l.push($("#discount_p_q"+t).val()),d.push($("#discount_q"+t).val())});var u={contest_id:Te,number:ee.val(),delivery_days:ae.val(),file:re,provider_id:Fe,payment_condition_id:me.val(),payment_advance:ce.val(),delivery_date:ie.val(),shipping_date:de.val(),currency_id:fe.val(),is_igv:be.prop("checked")?1:0,item_code:r.join("-"),item_description:n.join("_/-/_"),item_quantity:s.join("-"),item_price:c.join("-"),item_percentage:l.join("-"),item_discount:d.join("-")};console.log("xx:"+Ne),a.updated("contests/saveProvider",Ne,u,function(e){!t.isUndefined(e.status)&&e.status?(i.textType({title:"",message:"La cotización del proveedor se guardó correctamente.",type:"success"}),L(Te),B.modal("hide")):i.textType({title:"",message:"Hubo un error al guardar la cotización del proveedor. Intente nuevamente.",type:"error"})})}},e.openRequirements=function(){$("#LoadRecordsButtonRC").click(),U.modal("show")},e.openProvider=function(){return 0===Te||De?(i.showWarning({title:"",message:"Debe guardar el concurso para poder agregar cotizaciones"}),!1):(c(),void B.modal("show"))},e.openListProvidersContest=function(){O.modal("show")};var Ve=getFormSearch("frm-search-q","search_q","LoadRecordsButtonQ"),He='<select id="quo_states" class="search_input"></select>',Ge=$("#table_container_q");Ge.jtable({title:"Lista de Concursos",paging:!0,sorting:!0,actions:{listAction:base_url+"/contests/list",deleteAction:base_url+"/contests/delete"},toolbar:{items:[{cssClass:"buscador",text:He},{cssClass:"buscador",text:Ve},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){var t={search:$("#search_q").val(),check:F.prop("checked"),from:T.format("YYYY-MM-DD"),to:N.format("YYYY-MM-DD"),state:V.val()};e.openDoc("contests/excel",t)}},{cssClass:"btn-success",text:'<i class="fa fa-plus"></i> Nuevo Concurso',click:function(){l()}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},code:{title:"Concurso",listClass:"text-center",width:"5%"},description:{title:"Descripción",width:"30%"},requested_by:{title:"Solicitado por",list:show_list_},date:{title:"Fecha de Emisión",list:show_list_,listClass:"text-center"},state_desc:{title:"Estado",list:show_list_},cuadro:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return'<a href="javascript:void(0)" title="Cuadro Comparativo" class="compare_contest" data-code="'+e.record.id+'"><i class="fa fa-list-alt fa-1-5x"></i></a>'}},edit:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return'<a data-target="#" title="Editar" class="edit_contest" data-code="'+e.record.id+'"><i class="fa fa-pencil-square-o fa-1-5x fa-green"></i></a>'}}},recordsLoaded:function(e,t){$(".compare_contest").click(function(e){var t=$(this).attr("data-code");u(t),e.preventDefault()}),$(".edit_contest").click(function(e){var t=$(this).attr("data-code");d(t),e.preventDefault()})}}),s();var We=!1,Ke=1,Qe=[],Ze=[];e.consolidatedRequirementExport=function(a){if(0===Te)return i.showWarning({title:"",message:"Debe guardar el concurso para poder exportar el Consolidado"}),!1;var o=[];t.each($(".rowReqContest"),function(e){var t=$(e).attr("data-id");o.push(t)});var r={requirements:o};1===a?e.openDoc("contests/consolidatedRequirementExcel",r):e.loadPDF("contests/consolidatedRequirementPDF",r)},e.addItemQuotationProvider=function(){I.modal("show")},e.showPDF=function(){var e=$("#modalView");e.on("hidden.bs.modal",function(e){M.attr("style","display:block;")}),e.on("show.bs.modal",function(e){M.attr("style","display:block; z-index:2030 !important");
}),e.modal("show")}}function t(e,t){e.state("contests",{url:"/contests",templateUrl:base_url+"/templates/quotations/base.html",controller:"QuotationCtrl"}),t.otherwise("/")}angular.module("sys.app.quotations").config(t).controller("QuotationCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.receptions",[])}(),function(){"use strict";function e(e){function t(){o=$("#modalROC"),r=$("#modalProject"),n=$("#modalOrdenCompra"),s=$("#title-req"),c=$("#btn_action_req"),r.on("hidden.bs.modal",function(e){o.attr("style","display:block;")}),r.on("show.bs.modal",function(e){o.attr("style","display:block; z-index:2030 !important")}),n.on("hidden.bs.modal",function(e){o.attr("style","display:block;")}),n.on("show.bs.modal",function(e){o.attr("style","display:block; z-index:2030 !important")}),i()}function a(){t(),o.modal("show"),s.html("Nueva Recepción"),c.addClass("hide")}function i(){var e='<form class="form-search" id="frm-search-p"><input type="text" id="search_p" class="input-sm search_input" name="search" autocomplete="off" placeholder="Buscar..." /><button type="submit" id="LoadRecordsButtonP" class="btn btn-success btn-sm btn-search"><i class="fa fa-search"></i></button></form>',t=$("#table_container_p");t.jtable({title:"Lista de Proyectos",paging:!0,sorting:!0,actions:{listAction:base_url+"/receptions/getProjects"},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{IdProyecto:{title:"ID Proyecto",width:"5%"},Proyecto:{title:"Proyecto"},select:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_p" data-code="'+e.record.IdProyecto+'"><i class="fa fa-check fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){}});var a=$("#LoadRecordsButtonP");a.click(function(e){e.preventDefault(),t.jtable("load",{search:$("#search_p").val()})}),$("#frm-search-p").submit(function(e){e.preventDefault(),a.click()});var i='<form class="form-search" id="frm-search-pr"><input type="text" id="search_pr" class="input-sm search_input" name="search" autocomplete="off" placeholder="Buscar..." /><button type="submit" id="LoadRecordsButtonPr" class="btn btn-success btn-sm btn-search"><i class="fa fa-search"></i></button></form>',o=$("#table_container_pr");o.jtable({title:"Lista de Orden de Compra",paging:!0,sorting:!0,actions:{listAction:function(e,t){return{Result:"OK",Records:[{IdProyecto:"00467",Proyecto:"001232"},{IdProyecto:"00468",Proyecto:"0012322017"},{IdProyecto:"00465",Proyecto:"01042017"},{IdProyecto:"00464",Proyecto:"012042017"},{IdProyecto:"00463",Proyecto:"13042017"}],TotalRecordCount:4}}},toolbar:{items:[{cssClass:"buscador",text:i}]},fields:{IdProyecto:{title:"ID OC",width:"5%"},Proyecto:{title:"Descripción"},select:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_pr" data-code="'+e.record.IdProyecto+'"><i class="fa fa-circle-o fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){}});var r=$("#LoadRecordsButtonPr");r.click(function(e){e.preventDefault(),o.jtable("load",{search:$("#search_pr").val()})}),$("#frm-search-pr").submit(function(e){e.preventDefault(),r.click()})}moment.locale("es");var o,r,n,s,c,l=moment().startOf("month"),d=moment().endOf("month"),u=$("#reqDates"),p=function(e,t){u.find("span").html(e.format("MMM D, YYYY")+" - "+t.format("MMM D, YYYY"))};u.daterangepicker({startDate:l,endDate:d,opens:"left",showDropdowns:!0,alwaysShowCalendars:!0,showCustomRangeLabel:!1,ranges:{Hoy:[moment(),moment()],Ayer:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Últimos 7 días":[moment().subtract(6,"days"),moment()],"Últimos 30 días":[moment().subtract(29,"days"),moment()],"Este mes":[moment().startOf("month"),moment().endOf("month")],"Mes pasado":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")],"Este año":[moment().startOf("year"),moment().endOf("year")],"Año pasado":[moment().subtract(1,"year").startOf("year"),moment().subtract(1,"year").endOf("year")]},locale:{cancelLabel:"Cancelar",applyLabel:"Aplicar",daysOfWeek:["Do","Lu","Ma","Mi","Ju","Vi","Sá"],monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"]}},p),p(l,d),e.openProject=function(){n.modal("show")},e.openProducts=function(){console.log(n),n.modal("show")};var m='<form class="form-search" id="frm-search-r"><input type="text" id="search" class="input-sm" name="search" autocomplete="off" placeholder="Buscar..." /><button type="button" id="LoadRecordsButtonR" class="btn btn-success btn-sm btn-search"><i class="fa fa-search"></i></button></form>',f='<select id="states" class="search_input" style="display:none;"><option value="">Todos</option><option value="">Registrado</option><option value="">Aprobado</option><option value="">Asignado</option><option value="">En proceso de compra</option><option value="">Comprado</option></select>',v=$("#table_container_reception");v.jtable({title:"Lista de Recepción",paging:!0,sorting:!0,actions:{listAction:function(e,t){return{Result:"OK",Records:[{fecha_recepcion:"01/04/2017",Almacen:"Tarapoto",Usuario:"AdminECR",Orden_compra:"00045"},{fecha_recepcion:"03/05/2017",Almacen:"Tarapoto",Usuario:"AdminECR",Orden_compra:"00245"},{fecha_recepcion:"02/04/2017",Almacen:"Tarapoto",Usuario:"AdminECR",Orden_compra:"00342"}],TotalRecordCount:4}},deleteAction:base_url+"/receptions/delete"},toolbar:{items:[{cssClass:"buscador",text:f},{cssClass:"buscador",text:m},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){window.open(base_url+"/receptions/excel")}},{cssClass:"btn-success",text:'<i class="fa fa-plus"></i> Nuevo Recepción OC',click:function(){a()}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},fecha_recepcion:{title:show_list_?"Fecha Recepción":"Fech Recepción",listClass:"text-center"},Almacen:{title:"Almacén"},Usuario:{title:"Usuario",list:show_list_},Orden_compra:{title:show_list_?"Orden de Compra":"OC"},edit:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return'<a href="javascript:void(0)" title="Editar" class="edit_r" data-code="'+e.record.id+'"><i class="fa fa-pencil-square-o fa-1-5x fa-green"></i></a>'}}},recordsLoaded:function(e,a){$(".edit_r").click(function(e){t(),o.modal("show"),s.html("Editar Recepción"),c.removeClass("hide"),e.preventDefault()})}});var h=$("#LoadRecordsButtonR");h.click(function(e){e.preventDefault(),v.jtable("load",{search:$("#search").val()})}),h.click(),$("#frm-search-r").submit(function(e){e.preventDefault(),h.click()})}function t(e,t){e.state("receptions",{url:"/receptions",templateUrl:base_url+"/templates/receptions/base.html",controller:"ReceptionCtrl"}),t.otherwise("/")}angular.module("sys.app.receptions").config(t).controller("ReceptionCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope"]}(),function(){"use strict";angular.module("sys.app.receptiontransfers",[])}(),function(){"use strict";function e(e,t,a,i){function o(){u=$("#modalRT"),p=$("#title-rt"),m=$("#modalView"),f=$("#rt_warehouse_origin_id"),v=$("#rt_warehouse_destination_id"),h=$("#rt_transfer_date"),_=$("#rt_name"),g=$("#detail_reception_transfer"),y=$("#rt_id"),C=$("#rt_transfer_id"),_.val(user_default),x=$("#rt_button_process"),k=$("#rt_button_save"),h.datepicker({changeMonth:!0,changeYear:!0,dateFormat:"dd/mm/yy",beforeShow:function(){setTimeout(function(){$(".ui-datepicker").css("z-index",2052)})}})}function r(){x.prop("disabled",!0),k.prop("disabled",!0),h.prop("disabled",!1)}function n(e){o(),r();var n=!1;a.get("reception_transfers/find",e,function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.data;y.val(a.id),C.val(a.transfer_id),h.val(a.transfer_date),f.val(a.warehouse_origin_id).trigger("change"),v.val(a.warehouse_destination_id).trigger("change"),C.val(a.transfer_id),p.html("Recepción de Transferencia"),u.modal("show"),t.each(a.product,function(e){c(e),0!==parseFloat(e.available)&&(n=!0)}),n===!0?(x.prop("disabled",!1),k.prop("disabled",!1)):h.prop("disabled",!0)}else i.textType({title:"",message:"Hubo un error al obtener  la transferencia. Intente nuevamente.",type:"error"})})}function s(){var e,o=!0,r=!1,n=!1;if(o){var s=[],c=[],l=[];if(t.each($(".p_product"),function(e){s.push($(e).val())}),t.each($(".p_toReceived"),function(e){c.push($(e).val())}),t.each($(".p_available"),function(e){l.push($(e).html())}),$.each(l,function(e,t){l[e]<c[e]&&(r=!0),l[e]===c[e]&&(n=!0)}),e=1===b?n?"PROCESADO":"EN PROCESO":"GUARDADO",console.log(e),r===!0)return i.textType({title:"",message:"La cantidad ingresada debe ser menor que la cantidad disponible"}),r=!1,!1;var d={id:y.val(),transfer_date:h.val(),transfer_id:C.val(),warehouse_destination_id:v.val(),product:s.join(","),p_toReceived:c.join(","),state_reception_transfer:b,state_description:e};i.confirm({title:"",message:"¿Está seguro?",confirm:"Si",cancel:"No"},function(){var e=""===y.val()?0:y.val();a.updated("reception_transfers/saveReceptionTransfer",e,d,function(e){var a=1===b?"procesó":"guardó";!t.isUndefined(e.status)&&e.status?(i.textType({title:"",message:"La Recepción de transferencia se "+a+" correctamente.",type:"success"}),u.modal("hide"),LoadRecordsButtonRT.click()):i.textType({title:"",message:"Hubo un error al "+a+" la recepción de transferencia. Intente nuevamente.",type:"error"})})})}}function c(e){l(e.id,e.code_article,e.description_detail,e.average_cost,e.available,e.received,e.toReceived)}function l(e,a,o,r,n,s,c){var l,d,p=$('<tr class="p_id"  data-id="'+e+'"></tr>'),m=$("<td>"+a+"</td>"),f=$("<td>"+o+"</td>"),v=t.isNull(r)?"0":t.isUndefined(r)?"0":r,h=$('<td class="text-right">'+v+"</td>"),_=t.isNull(n)?"0":t.isUndefined(n)?"0":n;"0"===_?(l="disabled",d=0):(l="",d=t.isNull(c)?"0":t.isUndefined(c)?"0":c);var b=$('<td class="text-right p_available">'+_+"</td>"),y=t.isNull(s)?"0":t.isUndefined(s)?"0":s,C=$('<td class="text-right">'+y+'<input type="hidden" class="p_received" value="'+y+'" /></td>'),x=$('<td class="text-right"><input  '+l+' type="text" value="'+d+'" data-max="'+_+'" onclick="this.select()"  class="form-control input-xs text-right p_toReceived" onkeypress="return soloNumeros(event)"></td>'),k=$('<input type="hidden" class="p_product" value="'+e+'" />');f.append(k),p.append(m).append(f).append(h).append(b).append(C).append(x),g.append(p),$(".p_toReceived").blur(function(){var e=$(this),t=e.attr("data-max");(e.val()>parseFloat(t)||""===e.val())&&i.showWarning({title:"Debe ingresar una cantidad menor o igual a la cantidad transferida",message:""},function(){e.select()})}),u.modal("show")}function d(){a.all("transfers/data_form","",function(e){!t.isUndefined(e.status)&&e.status&&(t.each(e.warehouse,function(e){""===w&&(w=e.Value),$("#rt_warehouse_origin_id").append('<option value="'+e.Value+'">'+e.DisplayText+"</option>")}),t.each(e.warehouse,function(e){""===w&&(w=e.Value),$("#rt_warehouse_destination_id").append('<option value="'+e.Value+'" >'+e.DisplayText+"</option>")}))},function(){d()})}moment.locale("es");var u,p,m,f,v,h,_,g,b,y,C,x,k,w=($("#reqDates"),"");e.saveReceptionTransferProcess=function(){b=1,s()},e.saveReceptionTransfer=function(){b=0,s()},d();var A=getFormSearch("frm-search-rt","search_rt","LoadRecordsButtonRT"),R=$("#table_container_rt");R.jtable({title:"Lista de Recepción de Transferencias",paging:!0,sorting:!0,actions:{listAction:base_url+"/reception_transfers/list"},toolbar:{items:[{cssClass:"buscador",text:A},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("reception_transfers/excel",{})}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},transfer_date:{title:"Fecha",listClass:"text-center"},name:{title:"Usuario",list:show_list_},warehouse_o:{title:show_list_?"Almacén Origen":"Alm. Origen"},warehouse_d:{title:show_list_?"Almacén Destino":"Alm. Destino"},state_description:{title:"Estado",width:"3%"},select:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return'<a href="javascript:void(0)" title="Archivo" class="show_pdf" data-code="'+e.record.id+'"><i class="fa fa-clipboard fa-1-5x"></i></a>'}},edit:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return"PROCESADO"===e.record.state_description?'<a href="javascript:void(0)" title="Ver" class="edit_r" data-code="'+e.record.id+'"><i class="fa fa-eye fa-1-5x fa-green"></i></a>':'<a href="javascript:void(0)" title="Recepcionar" class="edit_r" data-code="'+e.record.id+'"><i class="fa fa-pencil-square-o fa-1-5x fa-green"></i></a>'}}},recordsLoaded:function(e,t){$(".edit_r").click(function(e){var t=$(this).attr("data-code");$("#detail_reception_transfer").html(""),n(t),e.preventDefault()}),$(".show_pdf").click(function(e){$("#modalView").modal("show")})}}),generateSearchForm("frm-search-rt","LoadRecordsButtonRT",function(){R.jtable("load",{search:$("#search_rt").val()})},!0)}function t(e,t){e.state("reception_transfers",{url:"/reception_transfers",templateUrl:base_url+"/templates/receptiontransfers/base.html",controller:"ReceptionTransferCtrl"}),t.otherwise("/")}angular.module("sys.app.receptiontransfers").config(t).controller("ReceptionTransferCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.referral_guides",[])}(),function(){"use strict";function e(e,t,a,i){function o(){Re||(_=$("#modalRG"),g=$("#titleRW"),b=$("#modalEntity"),y=$("#rg_id"),C=$("#rg_entity_id"),x=$("#rg_document"),k=$("#rg_social_reason"),w=$("#rg_address"),A=$("#rg_type_entity"),R=$("#state_local"),S=$("#rg_warehouse_origin_id"),j=$("#rg_warehouse_destination_id"),E=$("#rg_date"),P=$("#rg_date_transfer"),q=$("#modalProject"),T=$("#rg_project_code"),N=$("#rg_project_description"),D=$("#rg_project_id"),F=$("#rg_total"),M=$("#modalTransportCompany"),U=$("#rg_transport_company_id"),O=$("#rg_transport_company_name"),V=$("#rg_document_type_id"),H=$("#rg_local"),G=$("#rg_address_arrival"),W=$("#referral_guide_detail"),K=$("#rg_code"),Q=$("#rg_description"),Z=$("#rg_unit_measure"),J=$("#rg_cost_transfer"),X=$("#rg_quantity"),I=$("#rg_transport_unit"),B=$("#rg_license_plate"),Y=$("#rg_license"),z=$("#rg_driver"),ee=$("#rg_motive_id"),te=$("#rg_observation"),ae=$("#modalSerial"),ie=$("#s_serial"),oe=$("#s_number"),re=$("#rg_oc_entity"),ne=$("#button_search_entity"),se=$("#button_search_company"),ce=$("#button_search_project"),le=$("#add_detail_button"),de=$("#button_save_referral_guide"),ue=$("#button_print_referral_guide"),pe=$("#modalState"),me=$("#condition_print_detail"),fe=$("#t_body_detail_serial"),E.datepicker({changeMonth:!0,changeYear:!0,dateFormat:"dd/mm/yy",beforeShow:function(){setTimeout(function(){$(".ui-datepicker").css("z-index",2052)})}}),P.datepicker({changeMonth:!0,changeYear:!0,dateFormat:"dd/mm/yy",beforeShow:function(){setTimeout(function(){$(".ui-datepicker").css("z-index",2052)})}}),e.chkState=function(){var e=A.prop("checked")?"Si":"No";R.html(e)},b.on("hidden.bs.modal",function(e){_.attr("style","display:block;")}),b.on("show.bs.modal",function(e){_.attr("style","display:block; z-index:2030 !important")}),q.on("hidden.bs.modal",function(e){_.attr("style","display:block;")}),q.on("show.bs.modal",function(e){_.attr("style","display:block; z-index:2030 !important")}),M.on("hidden.bs.modal",function(e){_.attr("style","display:block;")}),M.on("show.bs.modal",function(e){_.attr("style","display:block; z-index:2030 !important")}),ae.on("hidden.bs.modal",function(e){_.hasClass("in")&&_.attr("style","display:block;"),$("#show_loading").addClass("hide"),d(function(){$("#show_loading").removeClass("hide")})}),ae.on("show.bs.modal",function(e){_.hasClass("in")&&(_.attr("style","display:block; z-index:2030 !important"),$("#show_loading").addClass("hide"),d(function(){$("#show_loading").removeClass("hide")}))}),_.on("hidden.bs.modal",function(e){r()}),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(t){$(t.target).click(),e.chkState()}),v()),S.change(function(){L=S.val(),be===!0&&(ye=!0)}),j.change(function(){L===j.val()&&(i.textType({title:"",message:"El almacén destino no puede ser igual que el almacen origin.",type:"warning"}),j.val("")),G.val(j.find("option:selected").attr("data-address")),H.val(j.find("option:selected").attr("data-local")),be===!0&&(ye=!0)}),S.select2(),j.select2()}function r(){cleanRequired(),g.html(""),y.val(""),E.val("").prop("disabled",!1),C.val(""),x.val(""),k.val(""),w.val(""),re.val("").prop("disabled",!1),U.val(""),O.val(""),I.val("").prop("disabled",!1),B.val("").prop("disabled",!1),Y.val("").prop("disabled",!1),z.val("").prop("disabled",!1),S.val("").prop("disabled",!1),j.val("").prop("disabled",!1),G.val("").prop("disabled",!1),H.val(""),P.val("").prop("disabled",!1),te.val(""),D.val(""),T.val(""),N.val(""),W.html(""),F.val(""),activeTab("tb_general"),ie.val(""),oe.val(""),ne.prop("disabled",!1),se.prop("disabled",!1),ce.prop("disabled",!1),le.prop("disabled",!1),de.prop("disabled",!1),ue.prop("disabled",!0),xe=!1,$("#condition_print_detail").hide(),ke=[],Ce=[],fe.html("")}function n(){$("#show_loading").addClass("hide"),d(function(){$("#show_loading").removeClass("hide")});var e=!1,t=Ae.jtable("selectedRows");if($("#t_body_detail_serial").html(""),$("#s_serial").val(""),$("#s_number").val(""),!(t.length>0))return i.textType({title:"",message:"Debe seleccionar al menos una guía de remisión a imprimir.",type:"warning"}),!1;var a=[],o=[],r=0,n=[];t.each(function(){var t=$(this).data("record");"REGISTRADO"===t.state_description||"NO IMPRESO"===t.state_description?(a.push(t.id),Ce=a.join(","),s(t.id,t.code_guide,t.number_guide)):(o.push(t.id,t.number_guide),e=!0,n[r]=$(this).attr("data-record-key"),r++)}),e===!0&&r<t.length?i.confirm({title:"",message:r+" guia/s de remisión ya fueron impresa/s por lo tanto no serán seleccionadas. ¿Deseas continuar?",confirm:"Si",cancel:"No"},function(){$.each(n,function(e,t){$(".jtable").find('tr[data-record-key="'+t+'"]').find("input[type=checkbox]").prop("checked",!1).iCheck("update"),$(".jtable").find('tr[data-record-key="'+t+'"]').removeClass("jtable-row-selected"),$(".jtable-column-header-selecting input").prop("checked",!1).iCheck("update")}),$("#condition_print_detail").show(),$("#modalSerial").modal("show")}):r!==t.length?($("#condition_print_detail").show(),$("#modalSerial").modal("show")):i.textType({title:"",message:"Todas las guias de remisión ya fueron impresas",type:"warning"})}function s(e,t,a,i){xe=!0;var o=$('<tr class="rowSerial" id="'+e+'"></tr>'),r=$('<td class="text-center sd_code">'+t+"</td>"),n=$('<td class="text-center sd_number_guide">'+a+"</td>"),s=$('<td class="text-center number_guide" style="display: none;">'+i+"</td>"),c=$('<td class="text-center"></td>'),l=$('<label class="radio-inline i-checks_serial"><input name="guide_check" class="check_serial" value="'+e+'" type="checkbox"></label>');c.append(l),o.append(r).append(n).append(s).append(c),$("#t_body_detail_serial").append(o),generateCheckBox(".i-checks_serial")}function c(r){o(),g.html("Editar Guia de remisión"),a.get("referral_guides/find",r,function(a){if(!t.isUndefined(a.status)&&a.status){var o=a.data;y.val(o.id),E.val(o.date),C.val(o.entity_id),x.val(o.document),k.val(o.name_entity),ge=o.id,w.val(o.address),re.val(o.order_purchase);var r="1"===o.type_entity;A.prop("checked",r).iCheck("update"),e.chkState(),U.val(o.transport_company_id),O.val(o.transport_company_name),I.val(o.transport_unit),B.val(o.license_plate),Y.val(o.license),z.val(o.driver),S.val(o.warehouse_origin_id).trigger("change"),j.val(o.warehouse_destination_id).trigger("change"),P.val(o.date_transfer),te.val(o.observation),D.val(o.project_id),T.val(o.project_code),N.val(o.project_description),ie.val(o.serial),oe.val(o.number),ue.prop("disabled",!1),be=!0,ye=!1,"IMPRESO"!==o.state_description&&"ANULADO"!==o.state_description||(E.prop("disabled",!0),re.prop("disabled",!0),ne.prop("disabled",!0),se.prop("disabled",!0),I.prop("disabled",!0),B.prop("disabled",!0),Y.prop("disabled",!0),z.prop("disabled",!0),S.prop("disabled",!0),j.prop("disabled",!0),G.prop("disabled",!0),P.prop("disabled",!0),ce.prop("disabled",!0),le.prop("disabled",!0),de.prop("disabled",!0),ue.prop("disabled",!0)),_.modal("show"),t.each(o.product,function(e){m(e.id,e.code,e.description,e.unit,e.cost,e.quantity),console.log(e.id)})}else i.textType({title:"",message:"Hubo un error al obtener la guía de remisión. Intente nuevamente.",type:"error"})})}function l(){ye=!1,be=!1;var e=[],o=[],r=[],n=[],s=[];t.each($(".rg_code"),function(t){e.push($(t).html())}),t.each($(".rg_description"),function(e){o.push($(e).html())}),t.each($(".rg_unit"),function(e){r.push($(e).html())}),t.each($(".rg_cost"),function(e){n.push($(e).html())}),t.each($(".rg_quantity"),function(e){s.push($(e).html())});var c={id:y.val(),guide_date:E.val(),document_type_id:V.val(),entity_id:C.val(),transport_company_id:U.val(),transport_unit:I.val(),license_plate:B.val(),license:Y.val(),driver:z.val(),type_entity:A.prop("checked")?1:0,warehouse_origin_id:S.val(),warehouse_destination_id:j.val(),date_transfer:P.val(),motive_id:ee.val(),observation:te.val(),project_id:D.val(),code_article:e.join(","),description:o.join(","),unit_measure:r.join(","),average_cost:n.join(","),quantity:s.join(","),order_purchase:re.val(),state_ReferralGuide:$e,state_description:"REGISTRADO"},l=""===y.val()?0:y.val();a.updated("referral_guides/saveReferralGuide",l,c,function(e){!t.isUndefined(e.status)&&e.status?(i.textType({title:"",message:"La guía de remisión se guardó correctamente.",type:"success"}),ge=e.referral_id,LoadRecordsButtonRG.click(),1!==$e&&(ae.modal("hide"),_.modal("hide"))):i.textType({title:"",message:"Hubo un error al guardar la guia de remisión. Intente nuevamente.",type:"error"})})}function d(e){ke=[],a.all("referral_guides/data_search","",function(a){!t.isUndefined(a.status)&&a.status&&t.each(a.NumberSerial,function(e){ke.push(parseFloat(parseFloat(e.DisplayText)+""+parseFloat(e.DisplayNumber)))}),t.isFunction(e)&&e()},function(){d("")})}function u(){h(),o(),g.html("Nueva Guía de Remisión"),_.modal("show")}function p(){a.all("referral_guides/data_form","",function(e){!t.isUndefined(e.status)&&e.status&&($("#rg_warehouse_origin_id").append('<option value="" selected>SELECCIONAR</option>'),t.each(e.warehouse,function(e){""===ve&&(ve=e.Value),$("#rg_warehouse_origin_id").append('<option value="'+e.Value+'">'+e.DisplayText+"</option>")}),$("#rg_warehouse_destination_id").append('<option value="" selected>SELECCIONAR</option>'),t.each(e.warehouse,function(e){""===ve&&(ve=e.Value),$("#rg_warehouse_destination_id").append('<option value="'+e.Value+'" data-address="'+e.Address+'"  data-local="'+e.Local+'" >'+e.DisplayText+"</option>")}),t.each(e.DocumentType,function(e){""===_e&&(_e=e.Value),"09"===e.Value&&$("#rg_document_type_id").append('<option value="'+e.Value+'" selected>'+e.DisplayText+"</option>")}),t.each(e.MotiveTransfer,function(e){""===he&&(he=e.Value),8===e.Value&&$("#rg_motive_id").append('<option value="'+e.Value+'" selected>'+e.DisplayText+"</option>")}))},function(){p()})}function m(e,a,o,r,n,s){var c=""===e||null===e?a:e;if($("#tr_rg_"+c).length>0)return i.showWarning({title:"",message:"Ya se asigno este artículo"}),!1;var l=$('<tr id="tr_rg_'+c+'"></tr>'),d=$('<td class="rg_code">'+a+"</td>"),u=$('<td class="rg_description">'+o+"</td>"),p=$('<td class="rg_unit">'+r+"</td>"),m=t.isNull(n)?"0":t.isUndefined(n)?"0":n;m=parseFloat(m),isNaN(m)&&(m=0);var v=$('<td class="text-right rg_cost">'+m+"</td>"),h=t.isNull(s)?"0":t.isUndefined(s)?"0":s,_=$('<td class="text-right rg_quantity">'+h+"</td>"),g=m*h,b=$('<button class="btn btn-danger btn-xs delProduct" data-import="'+g+'" type="button"><span class="fa fa-trash"></span></button>'),y=$('<td class="text-right">'+g.toFixed(2)+"</td>"),C=$('<td class="text-center"></td>');C.append(b),l.append(d).append(u).append(p).append(v).append(_).append(_).append(y).append(C),W.append(l);var x=parseFloat(F.val());isNaN(x)&&(x=0);var k=parseFloat(m);(isNaN(k)||"NaN"===k)&&(k=0),x=parseFloat(x)+parseFloat(k*parseFloat(h)),F.val(x.toFixed(2)),$(".delProduct").click(function(e){var t=$(this).attr("data-import"),a=$(this).closest("tr");i.confirm({title:"",message:"¿Está seguro que desea quitar esta artículo?",confirm:"Si",cancel:"No"},function(){be===!0&&(ye=!0);var e=F.val();e=parseFloat(e),isNaN(e)&&(e=0),e=parseFloat(e)-parseFloat(t),e=parseFloat(e).toFixed(2),F.val(e),a.remove()}),e.preventDefault()}),f()}function f(){K.val("").focus(),Q.val(""),Z.val(""),J.val(""),X.val("")}function v(){Re=!0;var e=getFormSearch("frm-search-tc","search_tc","LoadRecordsButtonTC"),t=$("#table_container_transportCompany");t.jtable({title:"Empresas de Transporte",paging:!0,sorting:!0,actions:{listAction:base_url+"/referral_guides/listEntity"},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},nombre_entidad:{title:"Nombre"},Documento:{title:"Documento",width:"2%",listClass:"text-center"},direccion_legal:{title:"Dirección"},select:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_tc" data-id="'+e.record.id+'" data-name="'+e.record.nombre_entidad+'"><i class="fa fa-'+icon_select+' fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_tc").click(function(e){var t=$(this).attr("data-id");U.val(t),O.val($(this).attr("data-name")),M.modal("hide"),be===!0&&(ye=!0),e.preventDefault()})}}),generateSearchForm("frm-search-tc","LoadRecordsButtonTC",function(){t.jtable("load",{search:$("#search_tc").val()})},!1);var a=getFormSearch("frm-search-p","search_p","LoadRecordsButtonP"),i=$("#table_container_p");i.jtable({title:"Lista de Proyectos",paging:!0,sorting:!0,actions:{listAction:base_url+"/referral_guides/getProjects"},toolbar:{items:[{cssClass:"buscador",text:a}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},code:{title:"Código Proyecto",width:"5%",listClass:"text-center"},description:{title:"Proyecto"},select:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_p" data-id="'+e.record.id+'" data-code="'+e.record.code+'" data-description="'+e.record.description+'"><i class="fa fa-'+icon_select+' fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_p").click(function(e){var t=$(this).attr("data-id");D.val(t),T.val($(this).attr("data-code")),N.val($(this).attr("data-description")),q.modal("hide"),be===!0&&(ye=!0),e.preventDefault()})}}),generateSearchForm("frm-search-p","LoadRecordsButtonP",function(){i.jtable("load",{search:$("#search_p").val()})},!1);var o=getFormSearch("frm-search-entity","search_entity","LoadRecordsButtonEntity"),r=$("#table_container_entity");r.jtable({title:"Lista de Entidades",paging:!0,sorting:!0,actions:{listAction:base_url+"/referral_guides/listEntity"},toolbar:{items:[{cssClass:"buscador",text:o}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},nombre_entidad:{title:"Nombre"},Documento:{title:"Documento"},direccion_legal:{title:"Dirección"},select:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_e" data-code="'+e.record.id+'" data-name="'+e.record.nombre_entidad+'"data-document="'+e.record.Documento+'"data-address="'+e.record.direccion_legal+'" ><i class="fa fa-'+icon_select+' fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_e").click(function(e){var t=$(this).attr("data-code"),a=$(this).attr("data-name"),i=$(this).attr("data-document"),o=$(this).attr("data-address");C.val(t).removeClass("border-red"),k.val(a).removeClass("border-red"),x.val(i).removeClass("border-red"),w.val(o).removeClass("border-red"),b.modal("hide"),be===!0&&(ye=!0),e.preventDefault()})}}),generateSearchForm("frm-search-entity","LoadRecordsButtonEntity",function(){r.jtable("load",{search:$("#search_entity").val()})},!1)}function h(){$(".jtable-column-header-selecting input").prop("checked",!1).iCheck("update"),$(".jtable-row-selected").removeClass("jtable-row-selected")}var _,g,b,y,C,x,k,w,A,R,S,j,L,E,P,q,D,T,N,F,M,U,O,I,B,Y,z,V,H,G,W,K,Q,Z,J,X,ee,te,ae,ie,oe,re,ne,se,ce,le,de,ue,pe,me,fe,ve="",he="",_e="",ge=0,$e=0,be=!1,ye=!1,Ce=[],xe=!1,ke=[];e.openProject=function(){$("#LoadRecordsButtonP").click(),q.modal("show")},e.openTransportCompany=function(){$("#LoadRecordsButtonTC").click(),M.modal("show")},e.openEntity=function(){$("#LoadRecordsButtonEntity").click(),b.modal("show")},e.printReferralGuide=function(){return ye===!0&&be===!0?(i.showWarning({title:"",message:"Para imprimir es necesario guardar los datos actualizados"}),!1):(ae.modal("show"),void($e=2))},e.saveReferralGuide=function(){var e=!0;return e=e&&E.required(),e&&activeTab("tb_entity"),e=e&&x.required(),e&&activeTab("tb_company"),e=e&&O.required(),e&&activeTab("tb_detail"),e=e&&S.required(),e=e&&j.required(),e=e&&P.required(),e&&""===W.html()?(i.showWarning({title:"",message:"Debe agregar mínimo un producto  al detalle"}),!1):void(e&&i.confirm({title:"",message:"¿Está seguro que desea guardar esta guía de remisión?",confirm:"Si",cancel:"No"},function(){$e=1,l(),de.prop("disabled",!0),ue.prop("disabled",!1)}))},d(""),e.updateForm=function(){ye=!0},e.saveSerial=function(o){var r=!0,n=!1;console.log(ke);var c=parseFloat(parseFloat($("#s_serial").val())+""+parseFloat($("#s_number").val()));if(t.each(ke,function(e){parseFloat(e)===c&&(n=!0)}),n===!0)return i.textType({title:"",message:"Este numero de guía de remisión ya existe.",type:"warning"}),!1;var l,d,u=0;l=parseFloat(t.max(t.compact(ke))),d=t.isFinite(l),u=d===!0?1:0;var p=l+1;if(console.log(u),0!==u&&p!==c)return i.textType({title:"",message:"Los números de las guias de remisión deben ser continuas .",type:"warning"}),!1;var m={id:ge,serial:$("#s_serial").val(),number:$("#s_number").val(),state_description:"IMPRESO",raw_select:Ce};if(r){i.confirm({title:"",message:"¿Está seguro?",confirm:"Si",cancel:"No"},function(){var r=""===ge?0:ge;a.updated("referral_guides/saveSerial",r,m,function(a){if(!t.isUndefined(a.status)&&a.status){$("#modalSerial").modal("hide"),$("#modalRG").modal("hide"),h();var r={referral_guide_id:ge,array_guide:Ce};$("#LoadRecordsButtonRG").click(),1===o?e.openDoc("referral_guides/referralGuideExcel",r):(console.log("paso por impresión"),e.loadVouchersPDF("referral_guides/referralGuidePDF",r)),i.confirm({title:"",message:xe===!0?"¿ Todas las ruías  de remisión se imprimieron correctamente?":"¿La guía de  remisión se imprimió correctamente?",confirm:"No",cancel:"Si"},function(){$("#condition_print_detail").show(),$("#t_body_detail_serial").html(""),t.each(a.data_row,function(e){s(e.id,e.code,e.number_guide,e.number)}),$("#modalState").modal("show")})}else i.textType({title:"",message:"Hubo un error al generar la guia de remisión. Intente nuevamente.",type:"error"})})})}},e.notPrinted=function(){var e=!1,o=[];if(xe===!0&&(t.each($(".check_serial"),function(t){$(t).prop("checked")&&(o.push($(t).val()),e=!0)}),e===!0))return i.textType({title:"",message:"Para este caso no se puede seleccionar las  guias de remisión."}),!1;var r={id:ge,state_description:"REGISTRADO",serial:"",number:"",noPrinted:Ce};console.log(Ce),i.confirm({title:"",message:"¿Estas seguro?",confirm:"Si",cancel:"No"},function(){var e=""===ge?0:ge;a.updated("referral_guides/saveSerial",e,r,function(e){!t.isUndefined(e.status)&&e.status?(i.textType({title:"",message:"El proceso culminó satisfactoriamente",type:"success"}),$("#LoadRecordsButtonRG").click(),xe===!1&&(console.log(e.data_row),$("#t_body_detail_serial").html(""),t.each(e.data_row,function(e){s(e.id,e.code,e.number_guide)}),$("#modalState").modal("hide"))):i.textType({title:"",message:"Hubo un error al generar la guia de remisión. Intente nuevamente.",
type:"error"})}),$("#modalState").modal("hide")}),h()},e.IncorrectlyPrinted=function(){var e=[],o=[],r=!1,n=[],s=[],c=[],l=[],d=0,u=[];$.each($(".number_guide"),function(e,t){n[e]=parseFloat($(t).html())}),$.each($(".check_serial"),function(t,a){$(a).prop("checked")&&(e.push($(a).val()),s[d]=n[t],r=!0,d++),o.push($(a).val()),r===!0?l.push($(a).val()):c.push($(a).val())}),u=t.difference(l,e),console.log(o+" \n"+c+" \n"+e+"\n"+u.join(","));for(var d=0;d<s.length-1;d++)if(s[d+1]-s[d]!==1)return i.textType({title:"",message:"Solo se puede seleccionar guias de remisión consecutivos"}),!1;if(r===!1)return i.textType({title:"",message:"Debe seleccionar al menos una guía de remisión "}),!1;var p={id:ge,state_description:"ANULADO",incorrectlyPrinted:e.join(","),a_allPrinted:o.join(","),a_print:c.join(","),a_noPrint:u.join(",")};i.confirm({title:"",message:"¿Está seguro ejecutar esta operación?",confirm:"Si",cancel:"No"},function(){var e=""===ge?0:ge;a.updated("referral_guides/saveSerial",e,p,function(e){!t.isUndefined(e.status)&&e.status?(i.textType({title:"",message:"Datos Procesados correctamente.",type:"success"}),$("#modalState").modal("hide"),$("#LoadRecordsButtonRG").click()):i.textType({title:"",message:"Hubo un error al generar la guia de remisión. Intente nuevamente.",type:"error"})})})},p(),e.addDetail=function(){var e=!0;e=e&&K.required(),e=e&&Q.required(),e=e&&Z.required(),e=e&&X.required(),e&&(be===!0&&(ye=!0),m("",K.val(),Q.val(),Z.val(),J.val(),X.val()))};var we=getFormSearch("frm-search-rg","search_rg","LoadRecordsButtonRG"),Ae=$("#table_container_rg");Ae.jtable({title:"Lista Guía de Remisión",paging:!0,sorting:!0,selecting:!0,multiselect:!0,selectingCheckboxes:!0,selectOnRowClick:!1,actions:{listAction:base_url+"/referral_guides/list"},toolbar:{items:[{cssClass:"buscador",text:we},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("referral_guides/excel",{})}},{cssClass:"btn-info",text:'<i class="fa fa-print"></i> Imprimir',click:function(){n()}},{cssClass:"btn-success",text:'<i class="fa fa-plus"></i> Nueva Guía de Remisión',click:function(){u()}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},code_guide:{title:"Código",width:"2%"},number_guide:{title:show_list_?"Nro. Guía":"N° Guía",width:"2%"},description_motive:{title:"Motivo",width:"5%"},description_project:{title:show_list_?"Descrip, Proyecto":"Proyecto",width:"10%"},name_carrier:{title:"Transportista",width:"7%"},date:{title:"Fecha Emisión",list:show_list_,listClass:"text-center",width:"2%"},origin_guide:{title:"Origen",width:"2%"},state_description:{title:"Estado",width:"1%"},edit:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return"IMPRESO"===e.record.state_description||"ANULADO"===e.record.state_description?'<a href="javascript:void(0)" title="Ver"class="edit_rw" data-code="'+e.record.id+'"><i class="fa fa-eye fa-1-5x fa-green"></i></a>':'<a href="javascript:void(0)" title="Editar" class="edit_rw" data-code="'+e.record.id+'"><i class="fa fa-pencil-square-o fa-1-5x fa-green"></i></a><a href="javascript:void(0)" title="Eliminar" class="delete_rw" data-code="'+e.record.id+'" ><i class="fa fa-trash fa-1-5x fa-red"></i></a>'}}},recordsLoaded:function(e,t){$(".jtable-selecting-column input").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click()}),$(".edit_rw").click(function(e){var t=$(this).attr("data-code");Ce=[],c(t),e.preventDefault()})}}),generateSearchForm("frm-search-rg","LoadRecordsButtonRG",function(){Ae.jtable("load",{search:$("#search_rg").val()})},!0);var Re=!1}function t(e,t){e.state("referral_guides",{url:"/referral_guides",templateUrl:base_url+"/templates/referral_guides/base.html",controller:"ReferralGuideCtrl"}),t.otherwise("/")}angular.module("sys.app.referral_guides").config(t).controller("ReferralGuideCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.register_movements",[])}(),function(){"use strict";function e(e,t,a,i,o){function r(){X.val(""),vt.removeClass("show"),$("#msg_cont_ProcesarTransferencia p").html("")}function n(e){te.html("Editar Movimiento"),a.get("register_movements/find",e,function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.data;te.html("Editar Movimiento ["+a.idMovimiento+"]");var o=e.data_movimiento_lote,r=e.data_movimiento_serie;mt.prop("disabled",!1),mt.trigger("change"),je.val("A"),N=a.naturaleza,""!=o&&o.map(function(e){var t={identificador:e.consecutivo,idProducto:e.idArticulo,idLote:e.idLote,fecha_vencimiento:e.fechaVencimiento,codig_lote:e.Lote};z.push(t)}),""!=r&&r.map(function(e){var t={identificador:e.identificador,idProducto:e.idArticulo,serie:e.nombreSerie,idSerie:e.idSerie,cantidad:e.cantiTotal};H.push(t)}),oe.val(a.idTipoOperacion+"*"+a.naturaleza).trigger("change"),oe.prop("disabled",!0),oe.trigger("change"),ie.val(a.idMovimiento),ne.val(a.idMoneda).trigger("change"),le.val(a.fecha_registro),se.val(a.observaciones),0==a.estado&&ce.val("REGISTRADO"),1==a.estado&&ce.val("PROCESADO"),"PROCESADO"==ce.val()?(qe.prop("disabled",!0),qe.trigger("change"),ee.prop("disabled",!0),ee.trigger("change"),mt.prop("disabled",!0),mt.trigger("change")):(qe.prop("disabled",!1),qe.trigger("change"),ee.prop("disabled",!1),ee.trigger("change"),mt.prop("disabled",!1),mt.trigger("change"));var n=e.movimiento_Ar;console.log(n),console.log("ddd"),n.map(function(e){var t="A",a="NA",i="",o="";"1"==e.serie&&(t="N"),"1"==e.serie?a="SE":"1"==e.lote&&(a="LE",i=e.idLote),console.log(e.costo2),console.log("sss"),y(e.idArticulo,e.description,Math.trunc(e.cantidad),t,e.consecutivo,a,i,o,e.idAlmacen,e.idLocalizacion,e.costo2,e.costo_total,e.precio,e.precio_total)}),"REGISTRADO"==ce.val()?(qe.prop("disabled",!1),qe.trigger("change")):(qe.prop("disabled",!0),qe.trigger("change")),ae.modal("show")}else i.textType({title:"",message:"Hubo un error al obtener el Artículo. Intente nuevamente.",type:"error"})})}function s(){_e.val(""),Fe.val(""),ge.val(""),$e.val(""),be.val(""),ye.val(""),Ce.val(""),xe.val("")}function c(){Ie.val(""),Be.val(""),Ye.val("")}function l(){Ve.val(""),He.val(""),Ge.val(""),Ke.val(""),Qe.val(""),et.prop("disabled",!0),et.trigger("change"),Ke.prop("readonly",!1),Ke.trigger("change"),ct.val(""),lt.val("")}function d(){G.val(""),ze.removeClass("show"),$("#msg_cont_EliminarMovimiento p").html("")}function u(){Je.val(""),Xe.val(""),tt.val(""),ut.prop("disabled",!1),ut.trigger("change"),dt.val(""),"A"==ot&&(O.jtable("destroy"),ot="I"),at.html(""),Ne.html(""),rt.prop("disabled",!0),rt.trigger("change")}function p(){we.html(""),Ae.val(""),Re.val(""),Se.val("")}function m(){cleanRequired(),te.html(""),ie.val(""),oe.val(""),ne.val(""),je.val(""),I=[],B=[],Y=[],z=[],V=[],H=[],W=[],se.val(""),ke.val(""),le.val(""),oe.prop("disabled",!1),oe.trigger("change"),ce.val(""),ve.html(""),ee.prop("disabled",!1),ee.trigger("change"),mt.prop("disabled",!0),mt.trigger("change"),qe.prop("disabled",!0),qe.trigger("change")}function f(){Ne.html(""),Me.val(""),Ue.val(""),Oe.val("")}function v(){var e=Ke.val();a.get("register_movements/validateLote",e,function(e){!t.isUndefined(e.status)&&e.status?"N"==e.data?"S"==N?i.textType({title:"",message:"No existe Lote . Intente nuevamente.",type:"info"}):(ye.val(Ke.val()),ge.val(Ve.val()),$e.val(He.val()),pe.modal("show")):(Qe.val(e.fecha),ct.val(e.codigol),et.prop("disabled",!1),Ke.prop("readonly",!0),Ke.trigger("change"),et.trigger("change")):i.textType({title:"",message:"Hubo un error . Intente nuevamente.",type:"info"})})}function h(e,t,a,i,o,r){if("3"==a)me.modal("show"),$("#cantProductoMK").attr("onkeypress","return soloNumeros(event)"),Re.val(t),Se.val(e),K.val(r);else if("1"==i){Xe.val(t),Je.val(e);var n=oe.val(),s=n.split("*"),c=s[1];Z.val(r),"S"==c?(it.prop("disabled",!0),it.trigger("change")):(it.prop("disabled",!1),it.trigger("change")),Ze.modal("show")}else"1"==o?(We.modal("show"),Ve.val(e),He.val(t),J.val(r)):($("#cantProductoMN").attr("onkeypress","return soloNumeros(event)"),Ie.val(e),Be.val(t),fe.modal("show"),Q.val(r))}function _(e){var a=$("#"+e);a.append('<option value="" selected>Seleccionar</option>'),t.each(F,function(e){a.append('<option value="'+e.idLocalizacion+'" >'+e.descripcion+"</option>")})}function g(e){var a=$("#Al_"+e);a.append('<option value="" selected>Seleccionar</option>'),t.each(M,function(e){a.append('<option value="'+e.idAlmacen+'" >'+e.descripcion+"</option>")})}function b(e,o,r,n){var s=$("#"+o),c=e;a.get("register_movements/getLocaStock",c,function(e){!t.isUndefined(e.status)&&e.status?(s.html(""),s.append('<option value="" selected>Seleccionar</option>'),t.each(e.LocalizacionAlmacen,function(a){var i=0;t.each(e.data,function(e){r==e.idArticulo&&a.idLocalizacion==e.idLocalizacion&&(i=Math.trunc(e.total))}),"S"==N?i>0&&(a.idLocalizacion==n?s.append('<option selected value="'+a.idLocalizacion+'" >'+a.descripcion+" / "+i+"</option>"):s.append('<option value="'+a.idLocalizacion+'" >'+a.descripcion+" / "+i+"</option>")):a.idLocalizacion==n?s.append('<option selected value="'+a.idLocalizacion+'" >'+a.descripcion+" / "+i+"</option>"):s.append('<option value="'+a.idLocalizacion+'" >'+a.descripcion+" / "+i+"</option>")})):"C"!=N&&i.textType({title:"",message:"No se pudo obtener las Localizaciones. Intente nuevamente.",type:"info"})})}function y(e,t,a,o,r,n,s,c,l,d,u,p,m,f){B.push(r),console.log(d);var v=0,h=0;0==u&&""==u||(v=Number(u)),0==m&&""==m||(h=Number(m));var y=Number(a)*Number(v),x=Number(a)*Number(h);"C"==N&&(y=0);var k,A,R=$('<tr id="tr_idArticulo'+r+'"></tr>'),S=$("<td>"+t+"</td>");if("S"==N||"A"==N)var j=$("<td></td>"),L=$('<input type="number" id="preMs_'+r+'" min="1" class="m_articulo_precio form-control input-sm" value="'+h+'" />');else{h="";var j=$("<td><p>"+h+"</p></td>"),L=$('<input type="hidden" id="preMs_'+r+'" min="1" class="m_articulo_precio form-control input-sm" value="'+h+'" />')}if("E"==N||"C"==N)var E=$("<td></td>"),P=$('<input type="number" id="cosMs_'+r+'" min="1" class="m_articulo_costo form-control input-sm" value="'+v+'" />');else var E=$("<td><p>"+v+"</p></td>"),P=$('<input type="hidden" id="cosMs_'+r+'" min="1" class="m_articulo_costo form-control input-sm" value="'+v+'" />');if("C"==N)var q=$("<td></td>"),T=$("<td></td>"),F=$('<select  data-arts="'+e+'" id="Al_'+r+'" data-idAraAl="'+r+'" class="m_articulo_idAlm form-control input-sm" disabled></select>'),M=$('<select id="'+r+'" data-idArl="'+e+'" class="m_articulo_idLoc form-control input-sm" disabled ></select>'),k=$("<td><p></p></td>"),A=$('<input type="hidden" id="canMs_'+r+'" class="m_articulo_cantidad" value="0" />');else{if("A"==o)var k=$('<td class="text-center"></td>'),A=$('<input type="text" id="canMs_'+r+'" onkeypress="return soloNumeros(event)" class="m_articulo_cantidad form-control input-sm" value="'+a+'" />');else var k=$("<td><p>"+a+"</p></td>"),A=$('<input type="hidden" id="canMs_'+r+'" class="m_articulo_cantidad" value="'+a+'" />');var T=$("<td></td>"),q=$("<td></td>"),F=$('<select  data-arts="'+e+'" id="Al_'+r+'" data-idAraAl="'+r+'" class="m_articulo_idAlm form-control input-sm"></select>'),M=$('<select id="'+r+'" data-idArl="'+e+'" class="m_articulo_idLoc form-control input-sm"></select>')}var U=$("<td><p>"+y.toFixed(2)+"</p></td>"),G=$("<td><p>"+x.toFixed(2)+"</p></td>"),K=$('<input type="hidden" class="m_articulo_id" value="'+e+'" />'),Q=$('<input type="hidden" class="m_articulo_costoTotal" value="'+y.toFixed(2)+'" />'),Z=$('<input type="hidden" class="m_articulo_precioTotal" value="'+x.toFixed(2)+'" />'),J=($('<option value="" selected>Seleccione</option>'),$('<input type="hidden" class="m_codigo_lote" value="'+s+'" />')),X=$('<input type="hidden" class="m_dato_lote" value="'+c+'" />'),ee=$('<input type="hidden" class="identificador_serie_bd" value="'+r+'" />');S.append(K).append(J).append(X).append(ee),T.append(F),q.append(M),k.append(A),E.append(P),U.append(Q),j.append(L),G.append(Z);var te=$('<td class="text-center"></td>'),ae=$('<button class="btn btn-info btn-xs verUpdate" title="ver" data-cantiShow="'+a+'" data-descrip="'+t+'" data-idProducto="'+e+'" data-tShow="'+n+'" data-idv="'+r+'" type="button"><span class="fa fa-eye"></span></button>'),ie=$('<td class="text-center"></td>'),oe=$('<button class="btn btn-danger btn-xs delMovPro" data-tipo="'+n+'" title="Eliminar" data-id="'+r+'" type="button"><span class="fa fa-trash"></span></button>');if(te.append(ae),ie.append(oe),R.append(S).append(T).append(q).append(k).append(E).append(U).append(j).append(G).append(te).append(ie),ve.append(R),g(r),_(r),$(".verUpdate").click(function(e){var t=$(this).attr("data-tShow"),a=$(this).attr("data-idv"),i=$(this).attr("data-idProducto"),o=$(this).attr("data-descrip"),r=$(this).attr("data-cantiShow");"SE"==t?(tt.val($("#tr_idArticulo"+a).find("td:eq(3)").children("input").val()),Xe.val(o),Je.val(i),it.prop("disabled",!0),it.trigger("change"),rt.prop("disabled",!1),rt.trigger("change"),dt.val(a),"A"==ot&&O.jtable("destroy"),D(i,H),Ze.modal("show")):"SN"==t?(tt.val($("#tr_idArticulo"+a).find("td:eq(3)").children("input").val()),Xe.val(o),Je.val(i),ut.prop("disabled",!0),ut.trigger("change"),rt.prop("disabled",!1),rt.trigger("change"),C(),dt.val(a),w(Je.val(),Xe.val(),tt.val(),Le,Ee,Pe,De,Te),Ze.modal("show")):"LE"==t?(We.modal("show"),Ve.val(i),He.val(o),Ge.val(r),lt.val(i),Ke.prop("readonly",!0),Ke.trigger("change"),z.map(function(e){e.identificador==a&&(Ke.val(e.codig_lote),Qe.val(e.fecha_vencimiento),Ge.val($("#tr_idArticulo"+a).find("td:eq(3)").children("input").val()))})):"LN"==t&&(ge.val(i),$e.val(o),Fe.val(a),I.map(function(e){e.identificador==a&&(ye.val(e.lote),Ce.val(e.fecha_ingreso),be.val($("#tr_idArticulo"+a).find("td:eq(3)").children("input").val()),xe.val(e.fecha_vencimiento))}),pe.modal("show"))}),$(".delMovPro").click(function(e){var t=$(this).attr("data-id"),a=$(this).attr("data-tipo");i.confirm({title:"",message:"¿Está seguro que desea quitar este Artículo?",confirm:"Si",cancel:"No"},function(){if("NA"==a){var e=W.filter(function(e){return e.identificador!==t});W=e}else if("K"==a){var i=Y.filter(function(e){return e.identificador!==t});Y=i}else if("LE"==a){var o=z.filter(function(e){return e.identificador!==t});z=o}else if("LN"==a){var r=I.filter(function(e){return e.identificador!==t});I=r}else if("SN"==a){var n=V.filter(function(e){return e.identificador!==t});V=n}else if("SE"==a){var s=H.filter(function(e){return e.identificador!==t});H=s}$("#tr_idArticulo"+t).remove()}),e.preventDefault()}),$(".addMovPro").click(function(e){$(this).attr("data-ida");he.modal("show"),$("#search_cc3").val(""),$("#LoadRecordsButtonCC3").click(),e.preventDefault()}),$(".m_articulo_idAlm").change(function(e){var t=$(this).val(),a=$(this).attr("data-idAraAl"),i=$(this).attr("data-arts");b(t,a,i,d),e.preventDefault()}),$(".m_articulo_cantidad").keyup(function(e){var t=$(this).val(),a=$(this).closest("tr").find("td:eq(4)").children("input").val(),i=Number(t)*Number(a);if($(this).closest("tr").find("td:eq(5)").children("p").text(i.toFixed(2)),$(this).closest("tr").find("td:eq(5)").children("input").val(i.toFixed(2)),"S"==N||"A"==N){var o=$(this).closest("tr").find("td:eq(6)").children("input").val(),r=Number(t)*Number(o);$(this).closest("tr").find("td:eq(7)").children("p").text(r.toFixed(2)),$(this).closest("tr").find("td:eq(7)").children("input").val(r.toFixed(2))}}),$(".m_articulo_precio").keyup(function(e){var t=$(this).val(),a=$(this).closest("tr").find("td:eq(3)").children("input").val(),i=Number(a)*Number(t);$(this).closest("tr").find("td:eq(7)").children("p").text(i.toFixed(2)),$(this).closest("tr").find("td:eq(7)").children("input").val(i.toFixed(2))}),$(".m_articulo_precio").change(function(e){var t=$(this).val(),a=$(this).closest("tr").find("td:eq(3)").children("input").val(),i=Number(a)*Number(t);$(this).closest("tr").find("td:eq(7)").children("p").text(i.toFixed(2)),$(this).closest("tr").find("td:eq(7)").children("input").val(i.toFixed(2))}),$(".m_articulo_costo").keyup(function(e){var t=$(this).val(),a=$(this).closest("tr").find("td:eq(3)").children("input").val(),i=Number(a)*Number(t);$(this).closest("tr").find("td:eq(5)").children("p").text(i.toFixed(2)),$(this).closest("tr").find("td:eq(5)").children("input").val(i.toFixed(2))}),$("#cosMs_"+r).change(function(e){var t=$(this).val(),a=$(this).closest("tr").find("td:eq(3)").children("input").val(),i=Number(a)*Number(t);$(this).closest("tr").find("td:eq(5)").children("p").text(i.toFixed(2)),$(this).closest("tr").find("td:eq(5)").children("input").val(i.toFixed(2))}),""!=l){$("#Al_"+r).val(l).trigger("change"),$("#"+r).val(d).trigger("change"),$("#cosMs_"+r).val(Number(u));var re=Number(p);$("#tr_idArticulo"+r).find("td:eq(5)").children("p").text(re),$("#tr_idArticulo"+r).find("td:eq(5)").children("input").val(re)}}function C(){at.html(""),rt.prop("disabled",!1),rt.trigger("change");var e="<tr>";e+="<th width='250px'>Artículo</th>",e+="<th width='250px' height='20px'>Nr° Serie</th>",e+=" <th width='250px' height='20px'>Chasis</th>",e+="<th width='200px' height='20px'>Motor</th>",e+="<th width='100px' height='20px'>Color</th>",e+="<th width='100px' height='20px'>Año fabricación</th>",e+="<th width='100px' height='20px'>Año Modelo</th>",e+="<th width='200px' height='20px'>Tipo Compra</th>",e+="<th width='100px' height='20px'>N° Poliza</th>",e+="<th width='100px' height='20px'>N° Lote</th>",e+="</tr>",at.append(e)}function x(){var e=!0;if(e=e&&Ye.required()){var t=Math.random().toString(36).substr(2,18),a={identificador:t,idProducto:Ie.val()};W.push(a);var i="A",o="NA",r="",n="",s="",c="",l=Q.val(),d="",u="",p="";y(Ie.val(),Be.val(),Ye.val(),i,t,o,r,n,s,c,l,d,u,p),fe.modal("hide"),de.modal("hide")}}function k(){var e=!0;if(e=e&&Ae.required()){var t="A",a=Math.random().toString(36).substr(2,18),i="K",o={identificador:a,idProducto:Se.val()};Y.push(o);var r="",n="",s="",c="",l=K.val(),d="",u="",p="";y(Se.val(),Re.val(),Ae.val(),t,a,i,r,n,s,c,l,d,u,p),me.modal("hide"),de.modal("hide")}}function w(e,t,a,i,o,r,n,s){if(Ne.html(""),""!=dt.val()){st=0;var c=0;V.map(function(e){e.identificador==dt.val()&&(c+=1)}),tt.val()!=c?0!=tt.val()?A(a,e,t):R():a==c&&R()}else A(a,e,t)}function A(e,a,i){st=0;for(var o=0;o<e;o++){var r="<tr id='tr_idArticulo_"+a+"' ></tr>";r+="<td>"+i+"</td>",r+="<td><input type='text' id='s_serie"+o+"' class='s_serie form-control input-sm'/></td>",r+="<td><input type='text' id='s_chasis"+o+"' class='s_chasis form-control input-sm'/></td>",r+="<td><input type='text' id='s_motor"+o+"' class='s_motor form-control input-sm'/></td>",r+="<td><input type='text' id='s_color"+o+"' class='s_color form-control input-sm'/></td>",r+="<td><input type='text' id='s_aniof"+o+"' class='s_aniof form-control input-sm' onkeypress='return soloNumeros(event)' maxlength='4' /></td>",r+="<td><input type='text' id='s_aniom"+o+"' class='s_aniom form-control input-sm' onkeypress='return soloNumeros(event)' maxlength='4'/></td>",r+="<td><select id='s_tipoCompra"+o+"' class='form-control input-sm'></select></td>",r+="<td><input type='text' id='s_nroPoliza"+o+"' class='s_motor form-control input-sm'/></td>",r+="<td><input type='text' id='s_nroLote"+o+"' class='s_color form-control input-sm'/></td>",r+="</tr>",Ne.append(r),st+=1,$("#s_tipoCompra"+o).append('<option value="" selected>Seleccionar</option>'),t.each(T,function(e){$("#s_tipoCompra"+o).append('<option value="'+e.idTipoCompraVenta+'">'+e.descripcion+"</option>")})}}function R(){var e=0;V.map(function(a){if(a.identificador==dt.val()){var i="<tr id='tr_idArticulo_"+Je.val()+"' ></tr>";i+="<td>"+Xe.val()+"</td>",i+="<td><input type='text' id='s_serie"+e+"' class='s_serie form-control input-sm' value='"+a.serie+"'/></td>",i+="<td><input type='text' id='s_chasis"+e+"' class='s_chasis form-control input-sm' value='"+a.chasis+"'/></td>",i+="<td><input type='text' id='s_motor"+e+"' class='s_motor form-control input-sm' value='"+a.motor+"'/></td>",i+="<td><input type='text' id='s_color"+e+"' class='s_color form-control input-sm' value='"+a.color+"'/></td>",i+="<td><input type='text' id='s_aniof"+e+"' class='s_aniof form-control input-sm' value='"+a.anio_fabricacion+"' onkeypress='return soloNumeros(event)' maxlength='4' /></td>",i+="<td><input type='text' id='s_aniom"+e+"' class='s_aniom form-control input-sm' value='"+a.anio_modelo+"' onkeypress='return soloNumeros(event)' maxlength='4'/></td>",i+="<td><select id='s_tipoCompra"+e+"' class='form-control input-sm'></select></td>",i+="<td><input type='text' id='s_nroPoliza"+e+"' class='s_motor form-control input-sm' value='"+a.nPoliza+"'/></td>",i+="<td><input type='text' id='s_nroLote"+e+"' class='s_color form-control input-sm' value='"+a.nLoteCompra+"'/></td>",i+="</tr>",Ne.append(i),$("#s_tipoCompra"+e).append('<option value="" selected>Seleccionar</option>'),t.each(T,function(t){$("#s_tipoCompra"+e).append('<option value="'+t.idTipoCompraVenta+'">'+t.descripcion+"</option>")}),$("#s_tipoCompra"+e).val(a.idTipoCompraVenta).trigger("change"),st+=1,e+=1}})}function S(){var e=!0;if(e=e&&oe.required(),e=e&&le.required(),ne.prop("disabled")||(e=e&&ne.required()),e){var o=oe.val(),r=o.split("*"),n=r[0],s=r[1];N=s;var c={idMovimiento:ie.val(),estado:0,fecha_registro:le.val(),idMoneda:ne.val(),observaciones:se.val(),idTipoOperacion:n},l=""===ie.val()?0:ie.val();a.updated("register_movements/saveMovimiento",l,c,function(e){if(!t.isUndefined(e.status)&&e.status){te.html("Nuevo Movimiento ["+e.code+"]"),i.textType({title:"",message:"El registro se guardó correctamente",type:"success"});var a=oe.val(),o=a.split("*"),r=o[1];ke.val(r),ie.val(e.code),0==e.estado?ce.val("REGISTRADO"):ce.val("PROCESADO"),oe.prop("disabled",!0),oe.trigger("change"),mt.prop("disabled",!1),mt.trigger("change"),LoadRecordsButtonRegister_Movement.click()}else i.textType({title:"",message:"Hubo un error al guardar el artículo. Intente nuevamente.",type:"error"})})}}function j(){te.html("Nuevo Movimiento"),ae.modal("show")}function L(){a.all("register_movements/data_form","",function(e){!t.isUndefined(e.status)&&e.status&&(oe.append('<option value="" selected>Seleccionar</option>'),t.each(e.operaciones,function(e){oe.append('<option value="'+e.IdTipoOperacion+"*"+e.idNaturaleza+'">'+e.descripcion+"</option>")}),ne.append('<option value="" selected>Seleccionar</option>'),t.each(e.moneda,function(e){ne.append('<option  value="'+e.Value+'">'+e.DisplayText+"</option>")}),M=e.almacen_usuario)},function(){L()})}function E(){a.all("series/data_form","",function(e){!t.isUndefined(e.status)&&e.status&&(T=e.tipoCompra)},function(){E()})}function P(){var e=getFormSearch("frm-search-cc2","search_cc2","LoadRecordsButtonCC2");U=$("#table_container_Register_Articulo"),U.jtable({title:"Lista de Articulos",paging:!0,sorting:!0,cache:!1,actions:{listAction:base_url+"/register_movements/getArticulosSelect"},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},type_id:{create:!1,edit:!1,list:!1},serie:{create:!1,edit:!1,list:!1},lote:{create:!1,edit:!1,list:!1},code_article:{title:"Código"},description:{title:"Articulos"},costo:{title:"costo"},select:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_cc" data-costo="'+e.record.costo+'" data-name="'+e.record.description+'" data-type="'+e.record.type_id+'"  data-serie="'+e.record.serie+'" data-lote="'+e.record.lote+'" data-code="'+e.record.id+'"><i class="fa fa-'+icon_select+' fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_cc").click(function(e){var t=$(this).attr("data-code"),a=$(this).attr("data-name"),i=$(this).attr("data-type"),o=$(this).attr("data-serie"),r=$(this).attr("data-lote"),n=$(this).attr("data-costo");h(t,a,i,o,r,n),e.preventDefault()})}}),generateSearchForm("frm-search-cc2","LoadRecordsButtonCC2",function(){U.jtable("load",{search:$("#search_cc2").val()})},!1)}function q(){var e=getFormSearch("frm-search-cc22","search_cc22","LoadRecordsButtonCC22");U=$("#table_container_Register_Articulo"),U.jtable({title:"Lista de Articulos",paging:!0,sorting:!0,cache:!1,actions:{listAction:base_url+"/register_movements/getArticulosMinKit"},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},type_id:{create:!1,edit:!1,list:!1},serie:{create:!1,edit:!1,list:!1},lote:{create:!1,edit:!1,list:!1},code_article:{title:"Código"},description:{title:"Articulos"},costo:{title:"costo"},select:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_cc" data-costo="'+e.record.costo+'" data-name="'+e.record.description+'" data-type="'+e.record.type_id+'"  data-serie="'+e.record.serie+'" data-lote="'+e.record.lote+'" data-code="'+e.record.id+'"><i class="fa fa-'+icon_select+' fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_cc").click(function(e){var t=$(this).attr("data-code"),a=$(this).attr("data-name"),i=$(this).attr("data-type"),o=$(this).attr("data-serie"),r=$(this).attr("data-lote"),n=$(this).attr("data-costo");h(t,a,i,o,r,n),e.preventDefault()})}}),generateSearchForm("frm-search-cc22","LoadRecordsButtonCC22",function(){U.jtable("load",{search:$("#search_cc22").val()})},!1)}function D(e,t){nt=0,ot="A";var a=getFormSearch("frm-search-cc4","search_cc4","LoadRecordsButtonCC4");O=$("#table_container_Series_Articulo");var i="getProductoSerie";"S"==N&&(i="getProductoSerieStock"),O.jtable({title:"Lista de Series",paging:!0,sorting:!0,actions:{listAction:function(t,a){return $.Deferred(function(a){$.ajax({url:base_url+"/register_movements/"+i,type:"POST",dataType:"json",data:{postData:t,idProducto:e},success:function(e){a.resolve(e)},error:function(){a.reject()}})})}},toolbar:{items:[{cssClass:"buscador",text:a}]},fields:{idSerie:{key:!0,create:!1,edit:!1,list:!1},serie:{create:!1,edit:!1,title:"N° Serie"},chasis:{create:!1,edit:!1,title:"Chasis"},motor:{create:!1,edit:!1,title:"Motor"},anio_fabricacion:{title:"Año de Fabricación"},anio_modelo:{title:"Año de Modelo"},select:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){var t="N";return""!=dt.val()?(console.log("entro"),H.map(function(a){e.record.serie==a.serie&&dt.val()==a.identificador&&(t="A")}),"A"==t?(nt+=1,t="N",'<label class="checkbox-inline i-checks"> <input class="check valcheck" type="checkbox" id="p_state" data_idSerie="'+e.record.idSerie+'" data-code="'+e.record.serie+'" checked ></label>'):'<label class="checkbox-inline i-checks"> <input class="check valcheck" type="checkbox" id="p_state" data_idSerie="'+e.record.idSerie+'" data-code="'+e.record.serie+'"  ></label>'):'<label class="checkbox-inline i-checks"> <input class="check valcheck" type="checkbox" id="p_state" data_idSerie="'+e.record.idSerie+'" data-code="'+e.record.serie+'"  ></label>'}}},recordsLoaded:function(e,t){$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(this).prop("checked")?nt+=1:nt-=1;$(this).attr("data-code")})}}),generateSearchForm("frm-search-cc4","LoadRecordsButtonCC4",function(){O.jtable("load",{search:$("#search_cc4").val()})},!0)}var T,N,F,M,U,O,I=[],B=[],Y=[],z=[],V=[],H=[],G=$("#idMovimientoDelete"),W=[],K=$("#costoMK"),Q=$("#costoNa"),Z=$("#costoAS"),J=$("#costoAL"),X=$("#idTransferenciaProcesar"),ee=$("#btn-guardarMovimiento"),te=$("#titlemodalMovimieto"),ae=$("#modalMovimieto"),ie=$("#idMovimiento"),oe=$("#idTipoOperacion"),re=$("#modalDeleteMovimiento"),ne=$("#idMoneda"),se=($("#idAlmacen"),$("#observaciones")),ce=$("#p_state"),le=$("#fecha_registro"),de=$("#modalMovimietoArticulo"),ue=$("#titlemodalMovimietoArticulo"),pe=$("#modalLote"),me=($("#modalSerie"),$("#modalKit")),fe=$("#modalNada"),ve=$("#articulo_mov_det"),he=$("#modalAlmacenArticulo"),_e=$("#idLoteML"),ge=$("#idProductoML"),$e=$("#desProductoML"),be=$("#cantProductoML"),ye=$("#lotProductoML"),Ce=$("#fIngrePrML"),xe=$("#fVenPrML"),ke=$("#idNaturaleza"),we=$("#tablekitdetM"),Ae=$("#cantProductoMK"),Re=$("#desProductoMK"),Se=$("#idProductoMK"),je=$("#ident_detalle"),Le=($("#idSerieMS"),$("#idProductoMS"),$("#desProductoMS"),$("#cantProductoMS"),$("#colorMS")),Ee=$("#chasisMS"),Pe=$("#motorMS"),qe=$("#ProcesarTransferenciaBoton"),De=$("#anio_modeloMS"),Te=$("#anio_fabricacionMS"),Ne=$("#articulo_serie_det"),Fe=$("#idLoteML2"),Me=$("#idArtSerie"),Ue=$("#cantArtSerie"),Oe=$("#desArtSerie"),Ie=($(".s_serie"),$("#idProductoMN")),Be=$("#desProductoMN"),Ye=$("#cantProductoMN"),ze=$("#msg_cont_EliminarMovimiento"),Ve=($("#tabla_articulo_movi"),$("#idProductoMll")),He=$("#desProductoMll"),Ge=$("#cantProductoMll"),We=$("#modalLoteR"),Ke=$("#codigoLoteMll"),Qe=$("#fechaVl"),Ze=$("#modalSerieR"),Je=$("#idProductoMss"),Xe=$("#desProductoMss"),et=($("#codigoSerieMss"),$("#btn_Lotd")),tt=$("#cantProductoMss"),at=($("#table_container_Series_Articulo"),$("#table_serie_cabecera")),Ne=$("#articulo_serie_det"),it=$("#btnAgreSer"),ot="I",rt=$("#btn_serC"),nt=0,st=0,ct=$("#idLoteMll"),lt=$("#idLoteMll2"),dt=$("#identSerAr"),ut=$("#btnSeleSerie"),pt=$("#idenifcador_table_art"),mt=($("#idenifcador_table_art"),$("#btn_movimiento_detalle")),ft=$("#modalProcesarTransferencia"),vt=$("#msg_cont_ProcesarTransferencia"),ht=$("#btn_imprimirMovimiento");$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(t){$(t.target).click(),e.chkState()}),ht.click(function(t){var a=ie.val();if(""!=a){var i={id:a};e.loadMovimientoPDF("register_movements/pdf",i)}}),de.on("hidden.bs.modal",function(e){f()}),ae.on("hidden.bs.modal",function(e){m()}),pe.on("hidden.bs.modal",function(e){s()}),me.on("hidden.bs.modal",function(e){p()}),fe.on("hidden.bs.modal",function(e){c()}),Ze.on("hidden.bs.modal",function(e){u()}),We.on("hidden.bs.modal",function(e){l()}),re.on("hidden.bs.modal",function(e){d()}),ee.click(function(e){S()}),ft.on("hidden.bs.modal",function(e){r()}),Ke.keypress(function(e){var t=e.keyCode?e.keyCode:e.which;13==t&&""==lt.val()&&v()}),Ae.keypress(function(e){var t=e.keyCode?e.keyCode:e.which;13==t&&k()}),Ye.keypress(function(e){var t=e.keyCode?e.keyCode:e.which;13==t&&x()}),$("#ProcesarTransferenciaBoton").click(function(e){var o=ie.val();""!=ve.html()?a.get("register_movements/validaDetalle",o,function(a){if(!t.isUndefined(a.status)&&a.status){var o=ie.val();X.val(o),ft.modal("show"),e.preventDefault()}else{var r=t.isUndefined(a.message)?"No se pudo guardar el movimiento. Intente nuevamente.":a.message;i.textType({title:"",message:r,type:"info"})}}):i.textType({title:"",message:"Debe registrar Articulos en este movimiento. Intente nuevamente.",type:"info"})}),e.ProcesarTransferencia=function(){var e=X.val();a.get("register_movements/procesarTransferencia",e,function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.data;"OK"==a[0].Mensaje?(i.textType({title:"",message:"El registro se procesó con exitó",type:"success"}),ce.val("PROCESADO"),"PROCESADO"==ce.val()&&(qe.prop("disabled",!0),qe.trigger("change"),ee.prop("disabled",!0),ee.trigger("change"),mt.prop("disabled",!0),mt.trigger("change")),ft.modal("hide"),LoadRecordsButtonRegister_Movement.click()):(i.textType({title:"",message:a[0].Mensaje,type:"info"}),ft.modal("hide"))}})},e.guardarMovimientoDetalle=function(){var e=!0;if(e&&""===ve.html())return i.showWarning({title:"",message:"Debe agregar mínimo 1 Artículo"}),!1;"C"==N?B.forEach(function(t,a){var i=$("#cosMs_"+t);e=e&&i.required()}):B.forEach(function(t,a){var i=$("#Al_"+t),o=$("#"+t),r=$("#canMs_"+t),n=$("#cosMs_"+t);e=e&&i.required(),e=e&&o.required(),e=e&&r.required(),e=e&&n.required()});var o="A";if("S"!=N&&"A"!=N||(B.forEach(function(t,a){var i=$("#preMs_"+t);e=e&&i.required()}),B.forEach(function(e,t){var a=$("#preMs_"+e).val();a<1&&(o="I")})),"I"==o)return i.showWarning({title:"",message:"El precio de los artículos no puede ser cero"}),o="A",!1;var r="A";if(B.forEach(function(e,t){var a=$("#cosMs_"+e).val();
a<1&&(r="I")}),"I"==r)return i.showWarning({title:"",message:"El costo de los artículos no puede ser cero"}),r="A",!1;var n="A";if("C"!=N&&B.forEach(function(e,t){var a=$("#canMs_"+e).val();a<1&&(n="I")}),"I"==n)return i.showWarning({title:"",message:"La cantidad de los Articulos no puede ser cero"}),n="A",!1;if(e){var s=[];$.each($(".m_articulo_id"),function(e,t){s[e]=$(t).val()}),s=s.join(",");var c=[];$.each($(".m_articulo_idAlm "),function(e,t){c[e]=$(t).val()}),c=c.join(",");var l=[];$.each($(".m_articulo_idLoc"),function(e,t){l[e]=$(t).val()}),l=l.join(",");var d=[];$.each($(".m_articulo_cantidad"),function(e,t){d[e]=$(t).val()});var u=[];$.each($(".identificador_serie_bd"),function(e,t){u[e]=$(t).val()}),u=u.join(","),d=d.join(",");var p=[];$.each($(".m_articulo_costo"),function(e,t){p[e]=$(t).val()}),p=p.join(",");var m=[];$.each($(".m_articulo_costoTotal"),function(e,t){m[e]=$(t).val()}),m=m.join(",");var f=[];$.each($(".m_articulo_precio"),function(e,t){f[e]=$(t).val()}),f=f.join(",");var v=[];$.each($(".m_articulo_precioTotal"),function(e,t){v[e]=$(t).val()}),v=v.join(",");var h=[];$.each($(".m_codigo_lote"),function(e,t){h[e]=$(t).val()}),h=h.join(",");var _=[];$.each($(".m_dato_lote"),function(e,t){_[e]=$(t).val()}),_=_.join(",");var g=[],b=[],y=[],C=0,x=[];H.map(function(e){x[C]=e.identificador,g[C]=e.idProducto,b[C]=e.serie,y[C]=e.idSerie,C+=1}),x=x.join(","),g=g.join(","),b=b.join(","),y=y.join(",");var k=[],w=[],A=[],R=[],S=[],j=[],L=[],E=[],P=[],q=[],D=0,T=[];V.map(function(e){T[D]=e.identificador,k[D]=e.serie,w[D]=e.idProducto,A[D]=e.chasis,R[D]=e.motor,S[D]=e.anio_fabricacion,j[D]=e.anio_modelo,L[D]=e.color,E[D]=e.idTipoCompraVenta,P[D]=e.nPoliza,q[D]=e.nLoteCompra,D+=1}),k=k.join(","),w=w.join(","),A=A.join(","),R=R.join(","),S=S.join(","),j=j.join(","),L=L.join(","),E=E.join(","),P=P.join(","),q=q.join(","),T=T.join(",");var F="";""!=ve.html()&&(F="A");var M={art_nada:W,idArticulo:s,idAlmacen:c,idLocalizacion:l,cantidad:d,costo:p,costo_total:m,precio:f,precio_total:v,idLote:h,dataLote:_,idProductoSe:g,serieSe:b,idSerieSe:y,serieNenv:k,idProductoSeN:w,chasiNs:A,motorNs:R,anioNFs:S,anioNVs:j,colorNs:L,ident_detalle:F,idTipoCompraVenta:E,nPoliza:P,nLoteCompra:q,identificador_serie_bd:u,ident_serie_bd_serie2:T,ident_serie_bd_serie:x,naturaleza:N};console.log(M);var U=""===ie.val()?0:ie.val();a.updated("register_movements/saveMovimientArticulo",U,M,function(e){if(!t.isUndefined(e.status)&&e.status)i.textType({title:"",message:"El registro se guardó correctamente",type:"success"}),qe.prop("disabled",!1),qe.trigger("change"),LoadRecordsButtonRegister_Movement.click();else{var a=t.isUndefined(e.message)?"No se pudo guardar el movimiento. Intente nuevamente.":e.message;i.textType({title:"",message:a,type:"info"})}})}},e.addtableSerie=function(){"A"==ot&&O.jtable("destroy"),ot="I";var e=!0;e=e&&tt.required(),e&&(C(),w(Je.val(),Xe.val(),tt.val(),Le,Ee,Pe,De,Te))},e.addSerieCompleTab=function(){var e=!0,o=tt.val();if(e=e&&tt.required())if("A"==ot){var r=0;if($(".valcheck:checked").each(function(){r+=1}),o==r)if(""!=dt.val()){var n=H.filter(function(e){return e.identificador!==dt.val()});H=n,$(".check:checkbox:checked").each(function(){var e={identificador:dt.val(),idProducto:Je.val(),serie:$(this).attr("data-code"),idSerie:$(this).attr("data_idSerie"),cantidad:tt.val()};H.push(e)}),$("#tr_idArticulo"+dt.val()).find("td:eq(3)").children("p").text(tt.val()),$("#tr_idArticulo"+dt.val()).find("td:eq(3)").children("input").val(tt.val()),Ze.modal("hide"),de.modal("hide")}else{var s="N",c=Math.random().toString(36).substr(2,18),l="SE";$(".check:checkbox:checked").each(function(){var e={identificador:c,idProducto:Je.val(),serie:$(this).attr("data-code"),idSerie:$(this).attr("data_idSerie"),cantidad:tt.val()};H.push(e)});var d="",u="",p="",m="",f=Z.val(),v="",h="",_="";y(Je.val(),Xe.val(),tt.val(),s,c,l,d,u,p,m,f,v,h,_),Ze.modal("hide"),de.modal("hide")}else i.textType({title:"",message:"Las series seleccionadas debe ser igual a la cantidad",type:"info"})}else{for(var g=[],b="",C=0;C<o;C++){var x="#s_serie"+C,x=$(x);e=e&&x.required()}for(var C=0;C<o;C++){var x="#s_serie"+C,x=$(x).val();g.push(x)}for(var C=0;C<o;C++){var x="#s_serie"+C,x=$(x).val(),k=0;for(var w in g)if(g[w]==x&&(k+=1,2==k)){b=x;break}}if(""!=b)return i.textType({title:"",message:"La serie "+b+" ya existe en esta lista",type:"info"}),!1;for(var A="",R="",C=0;C<o;C++){var x="#s_serie"+C,x=$(x);A=V.map(function(e){""!=dt.val()?e.serie==x.val()&&e.identificador!=dt.val()&&""==R&&(R=e.serie):e.serie==x.val()&&""==R&&(R=e.serie)})}if(""!=R)return i.textType({title:"",message:"La serie "+R+" ya existe en este movimiento",type:"info"}),!1;e&&(g=g.join(","),a.get("register_movements/valida_series_serve",g,function(e){if(!t.isUndefined(e.status)&&e.status)if(o==st)if(""!=dt.val()){var a=V.filter(function(e){return e.identificador!==dt.val()});V=a;for(var r=0;r<o;r++){var n={identificador:dt.val(),idProducto:Je.val(),serie:$("#s_serie"+r).val(),chasis:$("#s_chasis"+r).val(),motor:$("#s_motor"+r).val(),anio_fabricacion:$("#s_aniof"+r).val(),anio_modelo:$("#s_aniom"+r).val(),color:$("#s_color"+r).val(),idTipoCompraVenta:$("#s_tipoCompra"+r).val(),nPoliza:$("#s_nroPoliza"+r).val(),nLoteCompra:$("#s_nroLote"+r).val()};V.push(n)}$("#tr_idArticulo"+dt.val()).find("td:eq(3)").children("p").text(tt.val()),$("#tr_idArticulo"+dt.val()).find("td:eq(3)").children("input").val(tt.val()),Ze.modal("hide"),de.modal("hide")}else{for(var s="N",c=Math.random().toString(36).substr(2,18),l="SN",r=0;r<o;r++){var n={identificador:c,idProducto:Je.val(),serie:$("#s_serie"+r).val(),chasis:$("#s_chasis"+r).val(),motor:$("#s_motor"+r).val(),anio_fabricacion:$("#s_aniof"+r).val(),anio_modelo:$("#s_aniom"+r).val(),color:$("#s_color"+r).val(),idTipoCompraVenta:$("#s_tipoCompra"+r).val(),nPoliza:$("#s_nroPoliza"+r).val(),nLoteCompra:$("#s_nroLote"+r).val()};V.push(n)}var d="",u="",d="",u="",p="",m="",f=Z.val(),v="",h="",_="";y(Je.val(),Xe.val(),tt.val(),s,c,l,d,u,p,m,f,v,h,_),Ze.modal("hide"),de.modal("hide")}else i.textType({title:"",message:"Las series  debe ser igual a la cantidad",type:"info"});else{var g=t.isUndefined(e.message)?"No se pudo guardar la Serie. Intente nuevamente.":e.message;i.textType({title:"",message:g,type:"info"})}}))}},e.addLoteExi=function(){var e=!0;if(e=e&&Ge.required(),e=e&&Ke.required()){var t="A",a=Math.random().toString(36).substr(2,18),i="LE",o={identificador:a,idProducto:Ve.val(),idLote:_e.val(),fecha_vencimiento:Qe.val(),codig_lote:Ke.val()};z.push(o);var r=ct.val(),n="",n="",s="",c="",l=J.val(),d="",u="",p="";y(Ve.val(),He.val(),Ge.val(),t,a,i,r,n,s,c,l,d,u,p),We.modal("hide"),de.modal("hide")}},e.EliminarMovimiento=function(){var e=G.val();a.get("register_movements/delete",e,function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.data;""!=a[0].Mensaje?(i.textType({title:"",message:a[0].Mensaje,type:"info"}),re.modal("hide")):(i.textType({title:"",message:"El registro se eliminó correctamente",type:"success"}),re.modal("hide"),LoadRecordsButtonRegister_Movement.click())}})},e.addSeleccSerie=function(){at.html(""),Ne.html("");var e=!0;if(e=e&&tt.required()){var o=Je.val()+"*"+tt.val();a.get("register_movements/validateCantSerie",o,function(e){!t.isUndefined(e.status)&&e.status?"N"==e.data?i.textType({title:"",message:"No hay series de este Artículo ",type:"info"}):"S"==e.data?i.textType({title:"",message:"Existen solo "+e.cantidad+" series de este Artículo . Ingrese Nueva cantidad.",type:"info"}):(ot="A",D(Je.val(),H),rt.prop("disabled",!1),rt.trigger("change")):i.textType({title:"",message:"Nose pudo obtener las Series . Intente nuevamente.",type:"info"})})}},e.addArtLote=function(){var e=!0;if(e=e&&be.required(),e=e&&ye.required(),e=e&&Ce.required(),e=e&&xe.required()){if(""==Fe.val()){var t=I.map(function(e){if(e.lote==ye.val())return e.lote});if(""!=t)return i.textType({title:"",message:"El lote "+t+" ya existe en este movimiento",type:"info"}),!1;var a=Math.random().toString(36).substr(2,18),o={identificador:a,idProducto:ge.val(),cantidad:be.val(),lote:ye.val(),fecha_ingreso:Ce.val(),fecha_vencimiento:xe.val()};I.push(o);var r="A",n="LN",s="",c="",l="",d=J.val(),u="",p=ge.val()+"*"+be.val()+"*"+ye.val()+"*"+Ce.val()+"*"+xe.val(),m="",f="";y(ge.val(),$e.val(),be.val(),r,a,n,s,p,c,l,d,u,m,f),pe.modal("hide"),We.modal("hide"),de.modal("hide")}else{var v=I.filter(function(e){return e.identificador!==Fe.val()});I=v;var o={identificador:Fe.val(),idProducto:ge.val(),cantidad:be.val(),lote:ye.val(),fecha_ingreso:Ce.val(),fecha_vencimiento:xe.val()};I.push(o);var p=ge.val()+"*"+be.val()+"*"+ye.val()+"*"+Ce.val()+"*"+xe.val();$("#tr_idArticulo"+Fe.val()).find("td:eq(0)").children(".m_dato_lote").val(p),$("#tr_idArticulo"+Fe.val()).find("td:eq(3)").children(".m_articulo_cantidad").val(be.val()),pe.modal("hide"),We.modal("hide"),de.modal("hide")}console.log(I)}},e.addArticulo=function(){var e=!0;if(e=e&&oe.required(),e=e&&le.required(),ne.prop("disabled")||(e=e&&ne.required()),e){""==ie.val()&&S(),ue.html("Nuevo Articulo");var t=oe.val(),a=t.split("*"),i=(a[0],a[1]);console.log(i),"E"==i||"A"==i||"C"==i?("I"!=pt.val()&&U.jtable("destroy"),q(),pt.val("A")):("I"!=pt.val()&&U.jtable("destroy"),P(),pt.val("A")),de.modal("show"),$("#search_cc2").val(""),$("#LoadRecordsButtonCC2").click(),$("#search_cc22").val(""),$("#LoadRecordsButtonCC22").click(),$("#table_container_Register_Articulo .jtable-main-container .jtable-bottom-panel .jtable-left-area .jtable-goto-page select ").val("1").trigger("change")}},oe.change(function(){var e=oe.val(),t=e.split("*"),a=t[1];"S"==a?(ne.prop("disabled",!0),ne.trigger("change"),ne.val("1").trigger("change")):(ne.prop("disabled",!1),ne.trigger("change"))}),L(),E();var _t=getFormSearch("frm-search-Register_Movement","search_b","LoadRecordsButtonRegister_Movement"),gt=$("#table_container_Register_Movement");gt.jtable({title:"Lista de Movimientos",paging:!0,sorting:!0,actions:{listAction:base_url+"/register_movements/list"},toolbar:{items:[{cssClass:"buscador",text:_t},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("register_movements/excel",{})}},{cssClass:"btn-danger-admin",text:'<i class="fa fa-plus"></i> Nuevo Movimiento',click:function(){j()}}]},fields:{idMovimiento:{title:"#",key:!0,create:!1},idTipoOperacion:{title:"Tipo Operación",options:base_url+"/operations/getAll"},idUsuario:{title:"Usuario",options:base_url+"/users/getAll"},estado:{title:"Estado",values:{0:"Registrado",1:"Procesado"},type:"checkbox",defaultValue:"A"},edit:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" class="edit-serie" data-id="'+e.record.idMovimiento+'" title="Editar"><i class="fa fa-edit fa-1-5x"></i></a>'}},Eliminar:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a data-target="#"  data-ide="'+e.record.idMovimiento+'"   title="Eliminar" class="jtable-command-button eliminar-movimiento"><i class="fa fa-trash fa-1-5x fa-red"><span>Eliminar</span></i></a>'}}},recordsLoaded:function(e,t){$(".edit-serie").click(function(e){var t=$(this).attr("data-id");n(t),e.preventDefault()}),$(".eliminar-movimiento").click(function(e){var t=$(this).attr("data-ide");G.val(t),re.modal("show"),e.preventDefault()})}}),generateSearchForm("frm-search-Register_Movement","LoadRecordsButtonRegister_Movement",function(){gt.jtable("load",{search:$("#search_b").val()})},!0);var $t=getFormSearch("frm-search-cc3","search_cc3","LoadRecordsButtonCC3"),bt=$("#table_container_Almacen_Articulo");bt.jtable({title:"Lista de Articulos",paging:!0,sorting:!0,actions:{listAction:function(e,t){return $.Deferred(function(a){$.ajax({url:base_url+"/lots/getArticulosSelect?jtStartIndex="+t.jtStartIndex+"&jtPageSize="+t.jtPageSize+"&jtSorting="+t.jtSorting,type:"POST",dataType:"json",data:e,success:function(e){a.resolve(e)},error:function(){a.reject()}})})}},toolbar:{items:[{cssClass:"buscador",text:$t}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},type_id:{create:!1,edit:!1,list:!1},serie:{create:!1,edit:!1,list:!1},lote:{create:!1,edit:!1,list:!1},description:{title:"Articulos"},select:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_cc" data-name="'+e.record.description+'" data-type="'+e.record.type_id+'"  data-serie="'+e.record.serie+'" data-lote="'+e.record.lote+'" data-code="'+e.record.id+'"><i class="fa fa-'+icon_select+' fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_cc").click(function(e){var t=$(this).attr("data-code"),a=$(this).attr("data-name"),o=$(this).attr("data-type"),r=$(this).attr("data-serie"),n=$(this).attr("data-lote"),s=$(this).attr("data-lote");""!=Me.val()?i.textType({title:"",message:"Ya seleccionó un artículo serie",type:"error"}):h(t,a,o,r,n,s),e.preventDefault()})}}),generateSearchForm("frm-search-cc3","LoadRecordsButtonCC3",function(){bt.jtable("load",{search:$("#search_cc3").val()})},!1)}function t(e,t){e.state("register_movements",{url:"/register_movements",templateUrl:base_url+"/templates/register_movements/base.html",controller:"Register_MovementCtrl"}),t.otherwise("/")}angular.module("sys.app.register_movements").config(t).controller("Register_MovementCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory","Notify"]}(),function(){"use strict";angular.module("sys.app.register_transfers",[])}(),function(){"use strict";function e(e,t,a,i,o){function r(e){a.get("register_transfers/find",e,function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.data,o=e.data_movimiento_lote,r=e.data_movimiento_serie;ae.html("Editar Transferencia ["+a.idTransferencia+"]"),_t.prop("disabled",!1),_t.trigger("change"),Ee.val("A"),""!=o&&o.map(function(e){var t={identificador:e.consecutivo,idProducto:e.idArticulo,idLote:e.idLote,fecha_vencimiento:e.fechaVencimiento,codig_lote:e.Lote};H.push(t)}),""!=r&&r.map(function(e){var t={identificador:e.identificador,idProducto:e.idArticulo,serie:e.nombreSerie,idSerie:e.idSerie,cantidad:e.cantiTotal};W.push(t)}),re.val(a.idTipoOperacion+"*"+a.tipoTransferencia).trigger("change"),re.prop("disabled",!0),re.trigger("change"),oe.val(a.idTransferencia),de.val(a.fecha_registro),ce.val(a.observaciones),0==a.estado&&le.val("REGISTRADO"),1==a.estado&&le.val("PROCESADO"),"PROCESADO"==le.val()?(ze.prop("disabled",!0),ze.trigger("change"),te.prop("disabled",!0),te.trigger("change"),_t.prop("disabled",!0),_t.trigger("change")):(ze.prop("disabled",!1),ze.trigger("change"),te.prop("disabled",!1),te.trigger("change"),_t.prop("disabled",!1),_t.trigger("change"));var n=e.movimiento_Ar;n.map(function(e){var t="A",a="NA",i="",o="";"1"==e.serie&&(t="N"),"1"==e.serie?a="SE":"1"==e.lote&&(a="LE",i=e.idlote),A(e.idArticulo,e.description,Math.trunc(e.cantidad),t,e.consecutivo,a,i,o,e.idAlmacenOrigen,e.idLocalizacionOrigen,e.costo2,e.costo_total,e.idAlmacenDestino,e.idLocalizacionDestino)}),ie.modal("show")}else i.textType({title:"",message:"Hubo un error al obtener el Artículo. Intente nuevamente.",type:"error"})})}function n(){ge.val(""),Oe.val(""),$e.val(""),be.val(""),ye.val(""),Ce.val(""),xe.val(""),we.val("")}function s(){Ve.val(""),He.val(""),Ge.val("")}function c(){Ke.val(""),Qe.val(""),Ze.val(""),Xe.val(""),et.val(""),ot.prop("disabled",!0),ot.trigger("change"),Xe.prop("readonly",!1),Xe.trigger("change"),pt.val(""),mt.val("")}function l(){K.val(""),We.removeClass("show"),$("#msg_cont_EliminarMovimiento p").html("")}function d(){ke.val(""),$t.removeClass("show"),$("#msg_cont_ProcesarTransferencia p").html("")}function u(){at.val(""),it.val(""),rt.val(""),vt.prop("disabled",!1),vt.trigger("change"),ft.val(""),"A"==ct&&(B.jtable("destroy"),ct="I"),nt.html(""),Ue.html(""),lt.prop("disabled",!0),lt.trigger("change")}function p(){Re.html(""),Se.val(""),je.val(""),Le.val("")}function m(){cleanRequired(),ae.html(""),oe.val(""),re.val(""),se.val(""),Ee.val(""),Y=[],z=[],V=[],H=[],G=[],W=[],Q=[],ce.val(""),Ae.val(""),de.val(""),re.prop("disabled",!1),re.trigger("change"),le.val(""),he.html(""),_t.prop("disabled",!0),_t.trigger("change"),te.prop("disabled",!1),te.trigger("change"),ze.prop("disabled",!0),ze.trigger("change")}function f(){Ue.html(""),Ie.val(""),Be.val(""),Ye.val("")}function v(){var e=Xe.val();a.get("register_transfers/validateLote",e,function(e){!t.isUndefined(e.status)&&e.status?"N"==e.data?i.textType({title:"",message:"El lote no existe . Intente nuevamente.",type:"info"}):(et.val(e.fecha),pt.val(e.codigol),ot.prop("disabled",!1),Xe.prop("readonly",!0),Xe.trigger("change"),ot.trigger("change")):i.textType({title:"",message:"Hubo un error . Intente nuevamente.",type:"info"})})}function h(e,t,a,i,o,r){"3"==a?(fe.modal("show"),$("#cantProductoMK").attr("onkeypress","return soloNumeros(event)"),je.val(t),Le.val(e),Z.val(r)):"1"==i?(it.val(t),at.val(e),X.val(r),S(),tt.modal("show")):"1"==o?(Je.modal("show"),Ke.val(e),Qe.val(t),ee.val(r)):($("#cantProductoMN").attr("onkeypress","return soloNumeros(event)"),Ve.val(e),He.val(t),ve.modal("show"),J.val(r))}function _(e){var a=$("#"+e);a.append('<option value="" selected>Seleccionar</option>'),t.each(U,function(e){a.append('<option value="'+e.idLocalizacion+'" >'+e.descripcion+"</option>")})}function g(e){var a=$("#Al_"+e);a.append('<option value="" selected>Seleccionar</option>'),t.each(O,function(e){a.append('<option value="'+e.idAlmacen+'" >'+e.descripcion+"</option>")})}function b(e){var a=$("#AlD_"+e);a.append('<option value="" selected>Seleccionar</option>'),t.each(O,function(e){a.append('<option value="'+e.idAlmacen+'" >'+e.descripcion+"</option>")})}function y(e){var a=$("#loD_"+e);a.append('<option value="" selected>Seleccionar</option>'),t.each(U,function(e){a.append('<option value="'+e.idLocalizacion+'" >'+e.descripcion+"</option>")})}function C(e,t,a,i){var o=$("#"+t),r=($("#loD_"+t),e),a=a;k(o,r,a,i)}function x(e,t,a,i){var o=$("#loD_"+t),a=a,r=e;w(o,r,a,i)}function k(e,o,r,n){a.get("register_transfers/getLocaStock",o,function(a){if(!t.isUndefined(a.status)&&a.status){e.html(""),e.append('<option value="" selected>Seleccionar</option>');var o=0;t.each(a.LocalizacionAlmacen,function(i){var s=0;t.each(a.data,function(e){r==e.idArticulo&&i.idLocalizacion==e.idLocalizacion&&(s=Math.trunc(e.total))}),(s>0||"PROCESADO"==le.val())&&(i.idLocalizacion==n?e.append('<option selected value="'+i.idLocalizacion+'" >'+i.descripcion+" / "+s+"</option>"):e.append('<option value="'+i.idLocalizacion+'" >'+i.descripcion+" / "+s+"</option>"),o+=1)}),o<1&&i.textType({title:"",message:"No existe stock de artículos en las localizaciones. Intente nuevamente.",type:"info"})}else i.textType({title:"",message:"No se pudo obtener las Localizaciones. Intente nuevamente.",type:"info"})})}function w(e,o,r,n){a.get("register_transfers/getLocaStock",o,function(a){if(!t.isUndefined(a.status)&&a.status){e.html(""),e.append('<option value="" selected>Seleccionar</option>');t.each(a.LocalizacionAlmacen,function(i){var o=0;t.each(a.data,function(e){r==e.idArticulo&&i.idLocalizacion==e.idLocalizacion&&(o=Math.trunc(e.total))}),i.idLocalizacion==n?e.append('<option selected value="'+i.idLocalizacion+'" >'+i.descripcion+" / "+o+"</option>"):e.append('<option value="'+i.idLocalizacion+'" >'+i.descripcion+" / "+o+"</option>")})}else i.textType({title:"",message:"No se pudo obtener las Localizaciones. Intente nuevamente.",type:"info"})})}function A(e,t,a,o,r,n,s,c,l,d,u,p,m,f){z.push(r);var v=1;0==u&&""==u&&null==u||(v=Number(u));var h,k,w=Number(a)*Number(u),A=$('<tr  id="tr_idArticulo'+r+'"></tr>'),S=$("<td>"+t+"</td>"),j=$("<td></td>"),L=$("<td></td>"),P=$("<td></td>"),q=$("<td></td>");if("A"==o)var h=$('<td class="text-center"></td>'),k=$('<input type="text" id="canMs_'+r+'" onkeypress="return soloNumeros(event)" class="m_articulo_cantidad form-control input-sm" value="'+a+'" />');else var h=$("<td><p>"+a+"</p></td>"),k=$('<input type="hidden" id="canMs_'+r+'" class="m_articulo_cantidad" value="'+a+'" />');var D=$("<td><p>"+v+"</p></td>"),T=$('<input type="hidden" id="cosMs_'+r+'" min="1" class="m_articulo_costo form-control input-sm" value="'+v+'" />'),N=$("<td><p>"+w.toFixed(2)+"</p></td>"),F=$('<input type="hidden" class="m_articulo_id" value="'+e+'" />'),U=$('<select id="'+r+'" data-idArl="'+e+'" class="m_articulo_idLoc form-control input-sm"></select>'),O=$('<select id="loD_'+r+'" data-idArlD="'+e+'" class="m_articulo_idLocD form-control input-sm"></select>'),I=$('<input type="hidden" class="m_articulo_costoTotal" value="'+w.toFixed(2)+'" />'),K=$('<select  data-arts="'+e+'" id="Al_'+r+'" data-idAraAl="'+r+'" class="m_articulo_idAlm form-control input-sm"></select>'),Z=$('<select  data-artsD="'+e+'" id="AlD_'+r+'" data-idAraAlD="'+r+'" class="m_articulo_idAlmD form-control input-sm"></select>'),J=($('<option value="" selected>Seleccione</option>'),$('<input type="hidden" class="m_codigo_lote" value="'+s+'" />')),X=$('<input type="hidden" class="m_dato_lote" value="'+c+'" />'),ee=$('<input type="hidden" class="identificador_serie_bd" value="'+r+'" />');S.append(F).append(J).append(X).append(ee),j.append(K),L.append(U),h.append(k),D.append(T),N.append(I),P.append(Z),q.append(O);var te=$('<td class="text-center"></td>'),ae=$('<button class="btn btn-info btn-xs verUpdate" title="ver" data-cantiShow="'+a+'" data-descrip="'+t+'" data-idProducto="'+e+'" data-tShow="'+n+'" data-idv="'+r+'" type="button"><span class="fa fa-eye"></span></button>'),ie=$('<td class="text-center"></td>'),oe=$('<button class="btn btn-danger btn-xs delMovPro" data-tipo="'+n+'" title="Eliminar" data-id="'+r+'" type="button"><span class="fa fa-trash"></span></button>');if(te.append(ae),ie.append(oe),A.append(S).append(j).append(L).append(P).append(q).append(h).append(D).append(N).append(te).append(ie),he.append(A),g(r),b(r),_(r),y(r),$(".verUpdate").click(function(e){var t=$(this).attr("data-tShow"),a=$(this).attr("data-idv"),i=$(this).attr("data-idProducto"),o=$(this).attr("data-descrip"),r=$(this).attr("data-cantiShow");"SE"==t?(rt.val($("#tr_idArticulo"+a).find("td:eq(5)").children("input").val()),it.val(o),at.val(i),st.prop("disabled",!0),st.trigger("change"),lt.prop("disabled",!1),lt.trigger("change"),ft.val(a),"A"==ct&&B.jtable("destroy"),M(i,W),tt.modal("show")):"SN"==t?(rt.val($("#tr_idArticulo"+a).find("td:eq(3)").children("input").val()),it.val(o),at.val(i),vt.prop("disabled",!0),vt.trigger("change"),lt.prop("disabled",!1),lt.trigger("change"),R(),ft.val(a),E(at.val(),it.val(),rt.val(),De,Te,Ne,Fe,Me),tt.modal("show")):"LE"==t?(Je.modal("show"),Ke.val(i),Qe.val(o),Ze.val(r),mt.val(i),Xe.prop("readonly",!0),Xe.trigger("change"),H.map(function(e){e.identificador==a&&(Xe.val(e.codig_lote),et.val(e.fecha_vencimiento),Ze.val($("#tr_idArticulo"+a).find("td:eq(5)").children("input").val()))})):"LN"==t&&($e.val(i),be.val(o),Oe.val(a),Y.map(function(e){e.identificador==a&&(Ce.val(e.lote),xe.val(e.fecha_ingreso),ye.val($("#tr_idArticulo"+a).find("td:eq(3)").children("input").val()),we.val(e.fecha_vencimiento))}),me.modal("show"))}),$(".delMovPro").click(function(e){var t=$(this).attr("data-id"),a=$(this).attr("data-tipo");i.confirm({title:"",message:"¿Está seguro que desea quitar este Artículo?",confirm:"Si",cancel:"No"},function(){if("NA"==a){var e=Q.filter(function(e){return e.identificador!==t});Q=e}else if("K"==a){var i=V.filter(function(e){return e.identificador!==t});V=i}else if("LE"==a){var o=H.filter(function(e){return e.identificador!==t});H=o}else if("LN"==a){var r=Y.filter(function(e){return e.identificador!==t});Y=r}else if("SN"==a){var n=G.filter(function(e){return e.identificador!==t});G=n}else if("SE"==a){var s=W.filter(function(e){return e.identificador!==t});W=s}$("#tr_idArticulo"+t).remove()}),e.preventDefault()}),$(".addMovPro").click(function(e){$(this).attr("data-ida");_e.modal("show"),$("#search_cc3").val(""),$("#LoadRecordsButtonCC3").click(),e.preventDefault()}),$(".m_articulo_idAlm").change(function(e){var t=$(this).val(),a=$(this).attr("data-idAraAl"),i=$(this).attr("data-arts");C(t,a,i,d),e.preventDefault()}),$(".m_articulo_idAlmD").change(function(e){var t=$(this).val(),a=$(this).attr("data-idAraAlD"),i=$(this).attr("data-artsD");x(t,a,i,f),e.preventDefault()}),$(".m_articulo_cantidad").keyup(function(e){var t=$(this).val(),a=$(this).closest("tr").find("td:eq(6)").children("input").val(),i=Number(t)*Number(a);$(this).closest("tr").find("td:eq(7)").children("p").text(i.toFixed(2)),$(this).closest("tr").find("td:eq(7)").children("input").val(i.toFixed(2))}),$(".m_articulo_costo").keyup(function(e){var t=$(this).val(),a=$(this).closest("tr").find("td:eq(5)").children("input").val(),i=Number(a)*Number(t);$(this).closest("tr").find("td:eq(7)").children("p").text(i.toFixed(2)),$(this).closest("tr").find("td:eq(7)").children("input").val(i.toFixed(2))}),$("#cosMs_"+r).change(function(e){var t=$(this).val(),a=$(this).closest("tr").find("td:eq(5)").children("input").val(),i=Number(a)*Number(t);$(this).closest("tr").find("td:eq(7)").children("p").text(i.toFixed(2)),$(this).closest("tr").find("td:eq(7)").children("input").val(i.toFixed(2))}),""!=l){$("#Al_"+r).val(l).trigger("change"),$("#AlD_"+r).val(m).trigger("change"),$("#"+r).val(d).trigger("change"),$("#loD_"+r).val(f).trigger("change"),$("#cosMs_"+r).val(Number(u));var re=Number(p);$("#tr_idArticulo"+r).find("td:eq(7)").children("p").text(re),$("#tr_idArticulo"+r).find("td:eq(7)").children("input").val(re)}}function R(){nt.html(""),lt.prop("disabled",!1),lt.trigger("change");var e="<tr>";e+="<th width='250px'>Artículo</th>",e+="<th width='250px' height='20px'>Nr° Serie</th>",e+=" <th width='250px' height='20px'>Chasis</th>",e+="<th width='250px' height='20px'>Motor</th>",e+="<th width='100px' height='20px'>Color</th>",e+="<th width='150px' height='20px'>Año fabricación</th>",e+="<th width='100px' height='20px'>Año Modelo</th>",e+="</tr>",nt.append(e)}function S(){nt.html(""),Ue.html("");var e=!0;if(e){var o=at.val()+"*1";a.get("register_transfers/validateCantSerie",o,function(e){!t.isUndefined(e.status)&&e.status?"N"==e.data?i.textType({title:"",message:"No hay series de este Artículo ",type:"info"}):"S"==e.data?i.textType({title:"",message:"Existen solo "+e.cantidad+" series de este Artículo . Ingrese Nueva cantidad.",type:"info"}):(ct="A",M(at.val(),W),lt.prop("disabled",!1),lt.trigger("change")):i.textType({title:"",message:"Nose pudo obtener las Series . Intente nuevamente.",type:"info"})})}}function j(){var e=!0;if(e=e&&Ge.required()){var t=Math.random().toString(36).substr(2,18),a={identificador:t,idProducto:Ve.val()};Q.push(a);var i="A",o="NA",r="",n="",s="",c="",l=J.val(),d="",u="",p="";A(Ve.val(),He.val(),Ge.val(),i,t,o,r,n,s,c,l,d,u,p),ve.modal("hide"),ue.modal("hide")}}function L(){var e=!0;if(e=e&&Se.required()){var t="A",a=Math.random().toString(36).substr(2,18),i="K",o={identificador:a,idProducto:Le.val()};V.push(o);var r="",n="",s="",c="",l=Z.val(),d="",u="",p="";A(Le.val(),je.val(),Se.val(),t,a,i,r,n,s,c,l,d,u,p),fe.modal("hide"),ue.modal("hide")}}function E(e,t,a,i,o,r,n,s){if(Ue.html(""),""!=ft.val()){ut=0;var c=0;if(G.map(function(e){e.identificador==ft.val()&&(c+=1)}),rt.val()!=c)if(0!=rt.val()){var l=G.filter(function(e){return e.identificador!==ft.val()});G=l,P(a,e,t)}else q();else a==c&&q()}else P(a,e,t)}function P(e,t,a){ut=0;for(var i=0;i<e;i++){var o="<tr id='tr_idArticulo_"+t+"' ></tr>";o+="<td>"+a+"</td>",o+="<td><input type='text' id='s_serie"+i+"' class='s_serie form-control input-sm'/></td>",o+="<td><input type='text' id='s_chasis"+i+"' class='s_chasis form-control input-sm'/></td>",o+="<td><input type='text' id='s_motor"+i+"' class='s_motor form-control input-sm'/></td>",o+="<td><input type='text' id='s_color"+i+"' class='s_color form-control input-sm'/></td>",o+="<td><input type='text' id='s_aniof"+i+"' class='s_aniof form-control input-sm' onkeypress='return soloNumeros(event)' maxlength='4' /></td>",o+="<td><input type='text' id='s_aniom"+i+"' class='s_aniom form-control input-sm' onkeypress='return soloNumeros(event)' maxlength='4'/></td>",o+="</tr>",Ue.append(o),ut+=1}}function q(){var e=0;G.map(function(t){if(t.identificador==ft.val()){var a="<tr id='tr_idArticulo_"+Pe+"' ></tr>";a+="<td>"+qe+"</td>",a+="<td><input type='text' id='s_serie"+e+"' class='s_serie form-control input-sm' value='"+t.serie+"'/></td>",a+="<td><input type='text' id='s_chasis"+e+"' class='s_chasis form-control input-sm' value='"+t.chasis+"'/></td>",a+="<td><input type='text' id='s_motor"+e+"' class='s_motor form-control input-sm' value='"+t.motor+"'/></td>",a+="<td><input type='text' id='s_color"+e+"' class='s_color form-control input-sm' value='"+t.color+"'/></td>",a+="<td><input type='text' id='s_aniof"+e+"' class='s_aniof form-control input-sm' value='"+t.anio_fabricacion+"' onkeypress='return soloNumeros(event)' maxlength='4' /></td>",a+="<td><input type='text' id='s_aniom"+e+"' class='s_aniom form-control input-sm' value='"+t.anio_modelo+"' onkeypress='return soloNumeros(event)' maxlength='4'/></td>",a+="</tr>",Ue.append(a),ut+=1,e+=1}})}function D(){var e=!0;if(e=e&&re.required(),e=e&&de.required()){var o=re.val(),r=o.split("*"),n=r[0],s=r[1],c={tipoTransferencia:s,idTransferencia:oe.val(),idTipoOperacion:n,estado:0,fecha_registro:de.val(),observaciones:ce.val()},l=""===oe.val()?0:oe.val();a.updated("register_transfers/saveMovimiento",l,c,function(e){!t.isUndefined(e.status)&&e.status?(ae.html("Nueva Transferencia ["+e.code+"]"),i.textType({title:"",message:"El registro se guardó correctamente",type:"success"}),oe.val(e.code),0==e.estado?le.val("REGISTRADO"):1==e.estado&&le.val("PROCESADO"),re.prop("disabled",!0),re.trigger("change"),_t.prop("disabled",!1),_t.trigger("change"),"PROCESADO"==le.val()&&(ze.prop("disabled",!0),ze.trigger("change"),te.prop("disabled",!0),te.trigger("change"),_t.prop("disabled",!0),_t.trigger("change")),LoadRecordsButtonRegister_Trasnfer.click()):i.textType({title:"",message:"Hubo un error al guardar la Transferencia. Intente nuevamente.",type:"error"})})}}function T(){ae.html("Nueva Transferencia"),ie.modal("show")}function N(){a.all("register_transfers/data_form","",function(e){!t.isUndefined(e.status)&&e.status&&(re.append('<option value="" selected>Seleccionar</option>'),t.each(e.operaciones,function(e){re.append('<option value="'+e.IdTipoOperacion+"*"+e.idNaturaleza+'">'+e.descripcion+"</option>")}),O=e.almacen_usuario)},function(){N()})}function F(){var e=getFormSearch("frm-search-cc2","search_cc2","LoadRecordsButtonCC2");I=$("#table_container_Register_Articulo"),I.jtable({title:"Lista de Articulos",paging:!0,sorting:!0,cache:!1,actions:{listAction:base_url+"/register_transfers/getArticulosSelectTrans"},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},type_id:{create:!1,edit:!1,list:!1},serie:{create:!1,edit:!1,list:!1},lote:{create:!1,edit:!1,list:!1},code_article:{title:"Código"},description:{title:"Articulos"},costo:{title:"costo"},select:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_cc" data-costo="'+e.record.costo+'" data-name="'+e.record.description+'" data-type="'+e.record.type_id+'"  data-serie="'+e.record.serie+'" data-lote="'+e.record.lote+'" data-code="'+e.record.id+'"><i class="fa fa-'+icon_select+' fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_cc").click(function(e){var t=$(this).attr("data-code"),a=$(this).attr("data-name"),i=$(this).attr("data-type"),o=$(this).attr("data-serie"),r=$(this).attr("data-lote"),n=$(this).attr("data-costo");h(t,a,i,o,r,n),e.preventDefault()})}}),generateSearchForm("frm-search-cc2","LoadRecordsButtonCC2",function(){I.jtable("load",{search:$("#search_cc2").val()})},!1)}function M(e,t){dt=0,ct="A";var a=getFormSearch("frm-search-cc4","search_cc4","LoadRecordsButtonCC4");
B=$("#table_container_Series_Articulo"),B.jtable({title:"Lista de Series",paging:!0,sorting:!0,actions:{listAction:function(t,a){return $.Deferred(function(a){$.ajax({url:base_url+"/register_transfers/getProductoSerie",type:"POST",dataType:"json",data:{postData:t,idProducto:e},success:function(e){a.resolve(e)},error:function(){a.reject()}})})}},toolbar:{items:[{cssClass:"buscador",text:a}]},fields:{idSerie:{key:!0,create:!1,edit:!1,list:!1},serie:{create:!1,edit:!1,title:"N° Serie"},chasis:{create:!1,edit:!1,title:"Chasis"},motor:{create:!1,edit:!1,title:"Motor"},anio_fabricacion:{title:"Año de Fabricación"},anio_modelo:{title:"Año de Modelo"},select:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){var t="N";return""!=ft.val()?(W.map(function(a){e.record.serie==a.serie&&ft.val()==a.identificador&&ft.val()==a.identificador&&(t="A")}),"A"==t?(dt+=1,t="N",'<label class="checkbox-inline i-checks"> <input class="check valcheck" type="checkbox" id="p_state" data_idSerie="'+e.record.idSerie+'" data-code="'+e.record.serie+'" checked ></label>'):'<label class="checkbox-inline i-checks"> <input class="check valcheck" type="checkbox" id="p_state" data_idSerie="'+e.record.idSerie+'" data-code="'+e.record.serie+'"  ></label>'):'<label class="checkbox-inline i-checks"> <input class="check valcheck" type="checkbox" id="p_state" data_idSerie="'+e.record.idSerie+'" data-code="'+e.record.serie+'"  ></label>'}}},recordsLoaded:function(e,t){$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(this).prop("checked")?dt+=1:dt-=1;$(this).attr("data-code")})}}),generateSearchForm("frm-search-cc4","LoadRecordsButtonCC4",function(){B.jtable("load",{search:$("#search_cc4").val()})},!0)}var U,O,I,B,Y=[],z=[],V=[],H=[],G=[],W=[],K=$("#idMovimientoDelete"),Q=[],Z=$("#costoMK"),J=$("#costoNa"),X=$("#costoAS"),ee=$("#costoAL"),te=$("#btn-guardarMovimiento"),ae=$("#titlemodalMovimieto"),ie=$("#modalMovimieto"),oe=$("#idMovimiento"),re=$("#idTipoOperacion"),ne=$("#modalDeleteMovimiento"),se=$("#idMoneda"),ce=($("#idAlmacen"),$("#observaciones")),le=$("#p_state"),de=$("#fecha_registro"),ue=$("#modalMovimietoArticulo"),pe=$("#titlemodalMovimietoArticulo"),me=$("#modalLote"),fe=($("#modalSerie"),$("#modalKit")),ve=$("#modalNada"),he=$("#articulo_mov_det"),_e=$("#modalAlmacenArticulo"),ge=$("#idLoteML"),$e=$("#idProductoML"),be=$("#desProductoML"),ye=$("#cantProductoML"),Ce=$("#lotProductoML"),xe=$("#fIngrePrML"),ke=$("#idTransferenciaProcesar"),we=$("#fVenPrML"),Ae=$("#idNaturaleza"),Re=$("#tablekitdetM"),Se=$("#cantProductoMK"),je=$("#desProductoMK"),Le=$("#idProductoMK"),Ee=$("#ident_detalle"),Pe=($("#idSerieMS"),$("#idProductoMS")),qe=$("#desProductoMS"),De=($("#cantProductoMS"),$("#colorMS")),Te=$("#chasisMS"),Ne=$("#motorMS"),Fe=$("#anio_modeloMS"),Me=$("#anio_fabricacionMS"),Ue=$("#articulo_serie_det"),Oe=$("#idLoteML2"),Ie=$("#idArtSerie"),Be=$("#cantArtSerie"),Ye=$("#desArtSerie"),ze=($(".s_serie"),$("#ProcesarTransferenciaBoton")),Ve=$("#idProductoMN"),He=$("#desProductoMN"),Ge=$("#cantProductoMN"),We=$("#msg_cont_EliminarMovimiento"),Ke=($("#tabla_articulo_movi"),$("#idProductoMll")),Qe=$("#desProductoMll"),Ze=$("#cantProductoMll"),Je=$("#modalLoteR"),Xe=$("#codigoLoteMll"),et=$("#fechaVl"),tt=$("#modalSerieR"),at=$("#idProductoMss"),it=$("#desProductoMss"),ot=($("#codigoSerieMss"),$("#btn_Lotd")),rt=$("#cantProductoMss"),nt=($("#table_container_Series_Articulo"),$("#table_serie_cabecera")),Ue=$("#articulo_serie_det"),st=$("#btnAgreSer"),ct="I",lt=$("#btn_serC"),dt=0,ut=0,pt=$("#idLoteMll"),mt=$("#idLoteMll2"),ft=$("#identSerAr"),vt=$("#btnSeleSerie"),ht=$("#idenifcador_table_art"),_t=($("#idenifcador_table_art"),$("#btn_movimiento_detalle")),gt=$("#modalProcesarTransferencia"),$t=$("#msg_cont_ProcesarTransferencia"),bt=$("#btn_imprimirTransferencia");$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(t){$(t.target).click(),e.chkState()}),bt.click(function(t){var a=oe.val();if(""!=a){var i={id:a};e.loadTransferPDF("register_transfers/pdf",i)}}),ue.on("hidden.bs.modal",function(e){f()}),ie.on("hidden.bs.modal",function(e){m()}),me.on("hidden.bs.modal",function(e){n()}),fe.on("hidden.bs.modal",function(e){p()}),ve.on("hidden.bs.modal",function(e){s()}),tt.on("hidden.bs.modal",function(e){u()}),Je.on("hidden.bs.modal",function(e){c()}),ne.on("hidden.bs.modal",function(e){l()}),gt.on("hidden.bs.modal",function(e){d()}),te.click(function(e){D()}),Xe.keypress(function(e){var t=e.keyCode?e.keyCode:e.which;13==t&&""==mt.val()&&v()}),Se.keypress(function(e){var t=e.keyCode?e.keyCode:e.which;13==t&&L()}),Ge.keypress(function(e){var t=e.keyCode?e.keyCode:e.which;13==t&&j()}),e.guardarMovimientoDetalle=function(){var e=!0;if(e&&""===he.html())return i.showWarning({title:"",message:"Debe agregar mínimo 1 Artículo"}),!1;z.forEach(function(t,a){var i=$("#Al_"+t),o=$("#"+t),r=$("#canMs_"+t),n=$("#cosMs_"+t),s=$("#AlD_"+t),c=$("#loD_"+t);e=e&&i.required(),e=e&&o.required(),e=e&&s.required(),e=e&&c.required(),e=e&&r.required(),e=e&&n.required()});var o="A";if(z.forEach(function(e,t){var a=$("#cosMs_"+e).val();a<1&&(o="I")}),"I"==o)return i.showWarning({title:"",message:"El costo de los Articulos no puede ser cero"}),o="A",!1;var r="A";if(z.forEach(function(e,t){var a=$("#canMs_"+e).val();a<1&&(r="I")}),"I"==r)return i.showWarning({title:"",message:"La cantidad de los Articulos no puede ser cero"}),r="A",!1;if(e){var n=[];$.each($(".m_articulo_id"),function(e,t){n[e]=$(t).val()}),n=n.join(",");var s=[];$.each($(".m_articulo_idAlm "),function(e,t){s[e]=$(t).val()}),s=s.join(",");var c=[];$.each($(".m_articulo_idLoc"),function(e,t){c[e]=$(t).val()}),c=c.join(",");var l=[];$.each($(".identificador_serie_bd"),function(e,t){l[e]=$(t).val()}),l=l.join(",");var d=[];$.each($(".m_articulo_idAlmD"),function(e,t){d[e]=$(t).val()}),d=d.join(",");var u=[];$.each($(".m_articulo_idLocD"),function(e,t){u[e]=$(t).val()}),u=u.join(",");var p=[];$.each($(".m_articulo_cantidad"),function(e,t){p[e]=$(t).val()}),p=p.join(",");var m=[];$.each($(".m_articulo_costo"),function(e,t){m[e]=$(t).val()}),m=m.join(",");var f=[];$.each($(".m_articulo_costoTotal"),function(e,t){f[e]=$(t).val()}),f=f.join(",");var v=[];$.each($(".m_codigo_lote"),function(e,t){v[e]=$(t).val()}),v=v.join(",");var h=[];$.each($(".m_dato_lote"),function(e,t){h[e]=$(t).val()}),h=h.join(",");var _=[],g=[],b=[],y=[],C=[],x=0;W.map(function(e){C[x]=e.identificador,_[x]=e.idProducto,g[x]=e.serie,b[x]=e.idSerie,y[x]=e.cantidad,x+=1}),_=_.join(","),g=g.join(","),b=b.join(","),y=y.join(","),C=C.join(",");var k=[],w=[],A=[],R=[],S=[],j=[],L=[],E=0;G.map(function(e){k[E]=e.serie,w[E]=e.idProducto,A[E]=e.chasis,R[E]=e.motor,S[E]=e.anio_fabricacion,j[E]=e.anio_modelo,L[E]=e.color,E+=1}),k=k.join(","),w=w.join(","),A=A.join(","),R=R.join(","),S=S.join(","),j=j.join(","),L=L.join(",");var P="";""!=he.html()&&(P="A");var q={art_nada:Q,idArticulo:n,idAlmacen:s,idLocalizacion:c,idalmacenDestino:d,idLocalizacionDestino:u,cantidad:p,costo:m,costo_total:f,idLote:v,dataLote:h,idProductoSe:_,serieSe:g,idSerieSe:b,cantSe:y,serieNenv:k,idProductoSeN:w,chasiNs:A,motorNs:R,anioNFs:S,anioNVs:j,colorNs:L,ident_detalle:P,identificador_serie_bd:l,ident_serie_bd_serie:C},D=""===oe.val()?0:oe.val();a.updated("register_transfers/saveMovimientArticulo",D,q,function(e){if(!t.isUndefined(e.status)&&e.status)console.log(e.data),i.textType({title:"",message:"El registro se guardó correctamente",type:"success"}),ze.prop("disabled",!1),ze.trigger("change"),LoadRecordsButtonRegister_Trasnfer.click();else{var a=t.isUndefined(e.message)?"No se pudo guardar La transferencia. Intente nuevamente.":e.message;i.textType({title:"",message:a,type:"info"})}})}},e.addtableSerie=function(){"A"==ct&&B.jtable("destroy"),ct="I";var e=!0;e=e&&rt.required(),e&&(R(),E(at.val(),it.val(),rt.val(),De,Te,Ne,Fe,Me))},e.addSerieCompleTab=function(){var e=!0,t=rt.val();if(e=e&&rt.required()){var a=0;if($(".valcheck:checked").each(function(){a+=1}),t==a)if(""!=ft.val()){var o=W.filter(function(e){return e.identificador!==ft.val()});W=o,$(".check:checkbox:checked").each(function(){var e={identificador:ft.val(),idProducto:at.val(),serie:$(this).attr("data-code"),idSerie:$(this).attr("data_idSerie"),cantidad:rt.val()};W.push(e)}),$("#tr_idArticulo"+ft.val()).find("td:eq(5)").children("p").text(rt.val()),$("#tr_idArticulo"+ft.val()).find("td:eq(5)").children("input").val(rt.val());var r=$("#tr_idArticulo"+ft.val()).find("td:eq(6)").children("input").val(),n=Number(rt.val())*Number(r);$("#tr_idArticulo"+ft.val()).find("td:eq(7)").children("p").text(n.toFixed(2)),$("#tr_idArticulo"+ft.val()).find("td:eq(7)").children("input").val(n.toFixed(2)),tt.modal("hide"),ue.modal("hide")}else{var s="N",c=Math.random().toString(36).substr(2,18),l="SE";$(".check:checkbox:checked").each(function(){var e={identificador:c,idProducto:at.val(),serie:$(this).attr("data-code"),idSerie:$(this).attr("data_idSerie"),cantidad:rt.val()};W.push(e)});var d="",u="",p="",m="",f=X.val(),v="",h="",_="";A(at.val(),it.val(),rt.val(),s,c,l,d,u,p,m,f,v,h,_),tt.modal("hide"),ue.modal("hide")}else i.textType({title:"",message:"Las series seleccionadas debe ser igual a la cantidad",type:"info"})}},e.addLoteExi=function(){var e=!0;if(e=e&&Ze.required(),e=e&&Xe.required()){var t="A",a=Math.random().toString(36).substr(2,18),i="LE",o={identificador:a,idProducto:Ke.val(),idLote:ge.val(),fecha_vencimiento:et.val(),codig_lote:Xe.val()};H.push(o);var r=pt.val(),n="",n="",s="",c="",l=ee.val(),d="",u="",p="";A(Ke.val(),Qe.val(),Ze.val(),t,a,i,r,n,s,c,l,d,u,p),Je.modal("hide"),ue.modal("hide")}},e.EliminarMovimiento=function(){var e=K.val();a.get("register_transfers/delete",e,function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.data;""!=a[0].Mensaje?(i.textType({title:"",message:a[0].Mensaje,type:"info"}),ne.modal("hide")):(i.textType({title:"",message:"El registro se eliminó correctamente",type:"success"}),ne.modal("hide"),LoadRecordsButtonRegister_Trasnfer.click())}})},e.ProcesarTransferencia=function(){var e=ke.val();a.get("register_transfers/procesarTransferencia",e,function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.data;"OK"==a[0].Mensaje?(i.textType({title:"",message:"El registro se procesó con exitó",type:"success"}),ze.prop("disabled",!0),ze.trigger("change"),te.prop("disabled",!0),te.trigger("change"),_t.prop("disabled",!0),_t.trigger("change"),gt.modal("hide"),LoadRecordsButtonRegister_Trasnfer.click()):(i.textType({title:"",message:a[0].Mensaje,type:"info"}),gt.modal("hide"))}})},e.addArtLote=function(){var e=!0;if(e=e&&ye.required(),e=e&&Ce.required(),e=e&&xe.required(),e=e&&we.required())if(""==Oe.val()){var t=Y.map(function(e){if(e.lote==Ce.val())return e.lote});if(""!=t)return i.textType({title:"",message:"El lote "+t+" ya existe en este movimiento",type:"info"}),!1;var a=Math.random().toString(36).substr(2,18),o={identificador:a,idProducto:$e.val(),cantidad:ye.val(),lote:Ce.val(),fecha_ingreso:xe.val(),fecha_vencimiento:we.val()};Y.push(o);var r="A",n="LN",s="",c="",l="",d="",u="",p="",m="",f=$e.val()+"*"+ye.val()+"*"+Ce.val()+"*"+xe.val()+"*"+we.val();A($e.val(),be.val(),ye.val(),r,a,n,s,f,c,l,d,u,p,m),me.modal("hide"),Je.modal("hide"),ue.modal("hide")}else{var v=Y.filter(function(e){return e.identificador!==Oe.val()});Y=v;var o={identificador:Oe.val(),idProducto:$e.val(),cantidad:ye.val(),lote:Ce.val(),fecha_ingreso:xe.val(),fecha_vencimiento:we.val()};Y.push(o);var f=$e.val()+"*"+ye.val()+"*"+Ce.val()+"*"+xe.val()+"*"+we.val();$("#tr_idArticulo"+Oe.val()).find("td:eq(0)").children(".m_dato_lote").val(f),$("#tr_idArticulo"+Oe.val()).find("td:eq(3)").children(".m_articulo_cantidad").val(ye.val()),me.modal("hide"),Je.modal("hide"),ue.modal("hide")}},e.addArticulo=function(){var e=!0;e=e&&re.required(),e=e&&de.required(),e&&(""==oe.val()&&D(),pe.html("Nuevo Articulo"),"I"!=ht.val()&&I.jtable("destroy"),F(),ht.val("A"),ue.modal("show"),$("#search_cc22").val(""),$("#LoadRecordsButtonCC22").click(),$("#table_container_Register_Articulo .jtable-main-container .jtable-bottom-panel .jtable-left-area .jtable-goto-page select ").val("1").trigger("change"))},re.change(function(){var e=re.val(),t=e.split("*"),a=t[1];"S"==a?(se.prop("disabled",!0),se.trigger("change"),se.val("1").trigger("change")):(se.prop("disabled",!1),se.trigger("change"))}),N();var yt=getFormSearch("frm-search-Register_Trasnfer","search_b","LoadRecordsButtonRegister_Trasnfer"),Ct=$("#table_container_Register_Trasnfer");Ct.jtable({title:"Lista de Transferencias",paging:!0,sorting:!0,actions:{listAction:base_url+"/register_transfers/list"},toolbar:{items:[{cssClass:"buscador",text:yt},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("register_transfers/excel",{})}},{cssClass:"btn-danger-admin",text:'<i class="fa fa-plus"></i> Nueva Transferencia',click:function(){T()}}]},fields:{idTransferencia:{title:"#",key:!0,create:!1},tipoTransferencia:{title:"Tipo Transferencia",values:{N:"Sin recepción",R:"Con recepción"},type:"checkbox"},estado:{title:"Estado",values:{0:"Registrado",1:"Procesado"},type:"checkbox"},edit:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" class="edit-serie" data-id="'+e.record.idTransferencia+'" title="Editar"><i class="fa fa-edit fa-1-5x"></i></a>'}},Eliminar:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a data-target="#"  data-ide="'+e.record.idTransferencia+'"   title="Eliminar" class="jtable-command-button eliminar-movimiento"><i class="fa fa-trash fa-1-5x fa-red"><span>Eliminar</span></i></a>'}}},recordsLoaded:function(e,t){$(".edit-serie").click(function(e){var t=$(this).attr("data-id");r(t),e.preventDefault()}),$(".eliminar-movimiento").click(function(e){var t=$(this).attr("data-ide");K.val(t),ne.modal("show"),e.preventDefault()})}}),generateSearchForm("frm-search-Register_Trasnfer","LoadRecordsButtonRegister_Trasnfer",function(){Ct.jtable("load",{search:$("#search_b").val()})},!0),$("#ProcesarTransferenciaBoton").click(function(e){if(""!=he.html()){var o=oe.val();a.get("register_transfers/validaDetalle",o,function(a){if(!t.isUndefined(a.status)&&a.status){var o=oe.val();ke.val(o),gt.modal("show"),e.preventDefault()}else{var r=t.isUndefined(a.message)?"No se pudo procesar la transferencia. Intente nuevamente.":a.message;i.textType({title:"",message:r,type:"info"})}})}else i.textType({title:"",message:"Debe registrar Articulos en esta transferencia. Intente nuevamente.",type:"info"})})}function t(e,t){e.state("register_transfers",{url:"/register_transfers",templateUrl:base_url+"/templates/register_transfers/base.html",controller:"Register_TrasnferCtrl"}),t.otherwise("/")}angular.module("sys.app.register_transfers").config(t).controller("Register_TrasnferCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory","Notify"]}(),function(){"use strict";angular.module("sys.app.replenishment_cashs",[])}(),function(){"use strict";function e(e,t,a,i,o,r){function n(){p=$("#modalRC"),f=$("#title-rc"),m=$("#modalDocument"),k=$("#modalCash"),w=$("#modalProyect"),A=$("#modalProvider"),v=$("#w_user_body"),h=$("#Replenishmentcash_id"),_=$("#w_description"),g=$("#w_code_internal"),b=$("#w_type_id"),y=$("#w_physical_location"),C=$("#w_address"),x=$("#w_state"),m.on("hidden.bs.modal",function(e){p.attr("style","display:block;")}),m.on("show.bs.modal",function(e){p.attr("style","display:block; z-index:2030 !important")}),k.on("hidden.bs.modal",function(e){p.attr("style","display:block;")}),k.on("show.bs.modal",function(e){p.attr("style","display:block; z-index:2030 !important")}),A.on("hidden.bs.modal",function(e){p.attr("style","display:block;")}),A.on("show.bs.modal",function(e){p.attr("style","display:block; z-index:2030 !important")}),p.on("hidden.bs.modal",function(e){s()}),j||u()}function s(){f.html(""),h.val(""),_.val(""),C.val(""),g.val(""),x.prop("checked",!1),y.prop("checked",!1),v.html(""),activeTab("almacen")}function c(){n(),p.modal("show"),f.html("Nueva Reposición de Caja Chica")}function l(e){n(),p.modal("show"),f.html("Editar Reposición de Caja Chica")}function d(e,t,a){if($("#tr_b_"+e).length>0)return o.showWarning({title:"",message:"Ya se asignó este Usuario"}),!1;var i=$('<tr id="tr_b_'+e+'"></tr>'),r=$("<td>"+t+"</td>"),n=$("<td>"+a+"</td>"),s=$('<input type="hidden" class="w_user" value="'+e+'" />');r.append(s);var c=$('<td class="text-center"></td>'),l=$('<button class="btn btn-danger btn-xs delReplenishmentcash" data-id="'+e+'" type="button"><span class="fa fa-trash"></span></button>');c.append(l),i.append(r).append(n).append(c),$("#w_user_body").append(i),$("#modalUsuario").modal("hide"),$(".delReplenishmentcash").click(function(e){var t=$(this).attr("data-id");o.confirm({title:"",message:"¿Está seguro que desea quitar este Almacén?",confirm:"Si",cancel:"No"},function(){$("#tr_b_"+t).remove()}),e.preventDefault()})}function u(){j=!0;var e=getFormSearch("frm-search-cash","search_cash","LoadRecordsButtonCash"),t=$("#table_container_cash");t.jtable({title:"Lista de Cajas Chicas",paging:!0,sorting:!0,actions:{listAction:function(e,t){return{Result:"OK",Records:[{description:"Caja chica morales"},{description:"Caja chica Tarapoto"},{description:"Caja chica Lima"},{description:"Caja chica Chiclayo"}],TotalRecordCount:4}}},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},description:{title:"Caja"},select:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_u" data-code="'+e.record.id+'" data-title="'+e.record.username+'"data-name="'+e.record.name+'" ><i class="fa fa-circle-o fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_u").click(function(e){var t=$(this).attr("data-code"),a=$(this).attr("data-title"),i=$(this).attr("data-name");d(t,a,i),e.preventDefault()})}}),generateSearchForm("frm-search-cash","LoadRecordsButtonCash",function(){t.jtable("load",{search:$("#search_cash").val()})},!1);var t=(getFormSearch("frm-search-proyect","search_proyect","LoadRecordsButtonProyect"),$("#table_container_provider"));t.jtable({title:"Lista de Proyectos",paging:!0,sorting:!0,actions:{listAction:function(e,t){return{Result:"OK",Records:[{description:"Construción SA",code:"9875443"},{description:"Construccion de un puente",code:"6375471"},{description:"Enchapado de piso",code:"6375458"},{description:"Planos de puentes",code:"8375443"}],TotalRecordCount:4}}},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},description:{title:"Proyecto"},code:{title:"Código"},select:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_u" data-code="'+e.record.id+'" data-title="'+e.record.username+'"data-name="'+e.record.name+'" ><i class="fa fa-circle-o fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_u").click(function(e){var t=$(this).attr("data-code"),a=$(this).attr("data-title"),i=$(this).attr("data-name");d(t,a,i),e.preventDefault()})}}),generateSearchForm("frm-search-cash","LoadRecordsButtonCash",function(){t.jtable("load",{search:$("#search_cash").val()})},!1);var a=(getFormSearch("frm-search-provider","search_provider","LoadRecordsButtonProvider"),$("#table_container_providerd"));a.jtable({title:"Lista de Proveedor",paging:!0,sorting:!0,actions:{listAction:function(e,t){return{Result:"OK",Records:[{razon_social:"Construción SA",ruc:"35946576892"},{razon_social:"Solución SA",ruc:"45946576891"},{razon_social:"Peralta S.R.L",ruc:"64946576865"}],TotalRecordCount:4}}},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},razon_social:{title:"Razón Social"},ruc:{title:"Ruc"},select:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_u" data-code="'+e.record.id+'" data-title="'+e.record.username+'"data-name="'+e.record.name+'" ><i class="fa fa-check-circle-o fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_u").click(function(e){var t=$(this).attr("data-code"),a=$(this).attr("data-title"),i=$(this).attr("data-name");d(t,a,i),e.preventDefault()})}}),generateSearchForm("frm-search-provider","LoadRecordsButtonProvider",function(){a.jtable("load",{search:$("#search_provider").val()})},!1)}var p,m,f,v,h,_,g,b,y,C,x,k,w,A;e.openDocument=function(){m.modal("show")},e.openCash=function(){k.modal("show")},e.openProyect=function(){w.modal("show")},e.openProvider=function(){A.modal("show")},e.saveReplenishmentcash=function(){var e=!0;if(e=e&&_.required(),e=e&&b.required(),e=e&&C.required(),e=e&&g.required()){var i=[];$.each($(".w_user"),function(e,t){i[e]=$(t).val()}),i=i.join(",");var r={id:h.val(),code_internal:g.val(),description:_.val(),type_id:b.val(),address:C.val(),state:x.prop("checked")?1:0,physical_location:y.prop("checked")?1:0,users:i},n=""==h.val()?0:h.val();console.log(n),a.updated("Replenishmentcashs/saveReplenishmentcash",n,r,function(e){t.isUndefined(e.status)||1!=e.status?o.textType({title:"",message:"Hubo un error al guardar el Almacén. Intente nuevamente.",type:"error"}):(console.log(e),o.textType({title:"",message:"El Almacén se guardó correctamente.",type:"success"}),p.modal("hide"),LoadRecordsButtonReplenishmentcash.click())})}};var R=getFormSearch("frm-search-replenishmentcash","search_replenishmentcash","LoadRecordsButtonReplenishmentcash"),S=$("#table_container_rc");S.jtable({title:"Lista de reposición de Caja",paging:!0,sorting:!0,actions:{listAction:function(e,t){return{Result:"OK",Records:[{description:"Caja chica morales",Responsable:"JUAN MESTANZA",proyecto:"6375471-PROYECTO PRUEBA",glosa:"POR \tALAMBRADO ELECTRICO",cheque:"0000352",saldo:"456.00",fecha:"12/01/2017"},{description:"Caja chica Tarapoto",Responsable:"PEDRO DE LA CRUZ",proyecto:"7375473-PROYECTO PRUEBA",glosa:"POR \tALUMBRADO ELECTRICO",cheque:"0000354",saldo:"756.00",fecha:"12/02/2017"},{description:"Caja chica Lima",Responsable:"FAUSTINO SANCHEXZ",proyecto:"8775473-PROYECTO PRUEBA",glosa:"POR CONSTRUCCION DE DUCTOS",cheque:"0000358",saldo:"656.00",fecha:"12/03/2017"},{description:"Caja chica Chiclayo",Responsable:"FIORELA GARCIA",proyecto:"5475472-PROYECTO PRUEBA",glosa:"POR \tTRANSPORTE DE MATERIALES",cheque:"0000356",saldo:"256.00",fecha:"12/04/2017"}],TotalRecordCount:4}},deleteAction:base_url+"/receptions/delete"},toolbar:{items:[{cssClass:"buscador",text:R},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){window.open(base_url+"/chexpensegirls/excel")}},{cssClass:"btn-success",text:'<i class="fa fa-plus"></i> Nuevo Reposición de Caja Chica',click:function(){c()}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},description:{title:"Caja",width:"7%"},Responsable:{title:"Responsable",width:"7%"},proyecto:{title:"Proyecto"},glosa:{title:"Glosa"},cheque:{title:"Cheque",width:"4%"},saldo:{title:"Saldo",listClass:"text-right",width:"4%"},fecha:{title:"Fecha",listClass:"text-center",width:"4%"},edit:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return'<a href="javascript:void(0)" title="Editar" class="edit_w" data-code="'+e.record.id+'"><i class="fa fa-pencil-square-o fa-1-5x fa-green"></i></a>'}}},recordsLoaded:function(e,t){$(".edit_w").click(function(e){var t=$(this).attr("data-code");l(t),e.preventDefault()})}}),generateSearchForm("frm-search-replenishmentcash","LoadRecordsButtonReplenishmentcash",function(){S.jtable("load",{search:$("#search_replenishmentcash").val()})},!0);var j=!1}function t(e,t){e.state("replenishment_cashs",{url:"/replenishment_cashs",templateUrl:base_url+"/templates/replenishment_cashs/base.html",controller:"ReplenishmentcashCtrl"}),t.otherwise("/")}angular.module("sys.app.replenishment_cashs").config(t).controller("ReplenishmentcashCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","$rootScope","AlertFactory","Notify"]}(),function(){"use strict";angular.module("sys.app.report_movements",[])}(),function(){"use strict";function e(e){function t(){a.html("Nueva Report Movement"),i.modal("show")}var a=$("#titlemodalReportMovement"),i=$("#modalReportMovement");e.chkState=function(){var e=w_state.prop("checked")?"Activo":"Inactivo";state_state.html(e)};var o=getFormSearch("frm-search-Report_movement","search_b","LoadRecordsButtonReport_movement"),r=$("#table_container_Report_movement");r.jtable({title:"Lista de Categorías",paging:!0,sorting:!0,actions:{listAction:base_url+"/categories/list"},messages:{addNewRecord:"Nueva Categoría",editRecord:"Editar Categoría"},toolbar:{items:[{cssClass:"buscador",text:o},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("report_movements/excel",{})}},{cssClass:"btn-danger-admin",text:'<i class="fa fa-plus"></i> Nueva Reporte Movimiento',click:function(){t()}}]},fields:{idCategoria:{key:!0,create:!1,edit:!1,list:!1},Categoria:{title:"Categoría"},estado:{title:"Estado",values:{I:"Inactivo",A:"Activo"},type:"checkbox",defaultValue:"A"}},formCreated:function(e,t){t.form.find('input[name="Categoria"]').attr("onkeypress","return soloLetras(event)"),$("#Edit-estado").parent().addClass("i-checks"),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click(),"A"==e.target.value?($("#Edit-estado").val("I"),$(".i-checks span").text("Inactivo")):($("#Edit-estado").val("A"),$(".i-checks span").text("Activo"))})},formSubmitting:function(e,t){var a=!0;return a=a&&t.form.find('input[name="Categoria"]').required()}}),generateSearchForm("frm-search-Report_movement","LoadRecordsButtonReport_movement",function(){r.jtable("load",{search:$("#search_b").val()})},!0)}function t(e,t){e.state("report_movements",{url:"/report_movements",templateUrl:base_url+"/templates/report_movements/base.html",controller:"Report_movementCtrl"}),t.otherwise("/")}angular.module("sys.app.report_movements").config(t).controller("Report_movementCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope"]}(),function(){"use strict";angular.module("sys.app.report_stocks",[])}(),function(){"use strict";function e(e){function t(){a.html("Nueva Reporte Stock"),i.modal("show")}var a=$("#titlemodalReporteStock"),i=$("#modalReporteStock");e.chkState=function(){var e=w_state.prop("checked")?"Activo":"Inactivo";state_state.html(e)};var o=getFormSearch("frm-search-Report_Stock","search_b","LoadRecordsButtonReport_Stock"),r=$("#table_container_Report_Stock");r.jtable({title:"Lista de Categorías",paging:!0,sorting:!0,actions:{listAction:base_url+"/categories/list"},messages:{addNewRecord:"Nueva Categoría",editRecord:"Editar Categoría"},toolbar:{items:[{cssClass:"buscador",text:o},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("report_stocks/excel",{})}},{cssClass:"btn-danger-admin",text:'<i class="fa fa-plus"></i> Nuevo Reporte Stock',click:function(){t()}}]},fields:{idCategoria:{key:!0,create:!1,edit:!1,list:!1},Categoria:{title:"Categoría"},estado:{title:"Estado",values:{I:"Inactivo",A:"Activo"},type:"checkbox",defaultValue:"A"}},formCreated:function(e,t){t.form.find('input[name="Categoria"]').attr("onkeypress","return soloLetras(event)"),$("#Edit-estado").parent().addClass("i-checks"),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click(),"A"==e.target.value?($("#Edit-estado").val("I"),$(".i-checks span").text("Inactivo")):($("#Edit-estado").val("A"),$(".i-checks span").text("Activo"))})},formSubmitting:function(e,t){var a=!0;return a=a&&t.form.find('input[name="Categoria"]').required()}}),generateSearchForm("frm-search-Report_Stock","LoadRecordsButtonReport_Stock",function(){r.jtable("load",{search:$("#search_b").val()})},!0)}function t(e,t){e.state("report_stocks",{url:"/report_stocks",templateUrl:base_url+"/templates/report_stocks/base.html",controller:"Report_StockCtrl"}),t.otherwise("/")}angular.module("sys.app.report_stocks").config(t).controller("Report_StockCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope"]}(),function(){"use strict";angular.module("sys.app.requirements",[])}(),function(){"use strict";function e(e,t,a,i){function o(){cleanRequired(),x.html(""),j.val(""),L.val(""),E.val(H),P.val(""),q.val(""),D.val(""),T.val(""),N.val("Registrado"),F.val(S),M.val(""),U.val(""),I.prop("disabled",!0),B.prop("disabled",!0),V="",X=1,ee=[],O.empty(),v(),k.addClass("hide"),w.addClass("hide"),$(".showReq").removeClass("hide"),$(".formReq").prop("disabled",!1)}function r(){A=$("#req_states"),A.html("").change(function(){$("#LoadRecordsButtonR").click()}),R=$("#req_states_line"),R.html("").change(function(){$("#LoadRecordsButtonR").click()}),a.all("requirements/data_form","",function(e){!t.isUndefined(e.status)&&e.status&&(t.each(e.states,function(e){A.append('<option value="'+e.Value+'">'+e.DisplayText+"</option>")}),t.each(e.states_line,function(e){R.append('<option value="'+e.Value+'">'+e.DisplayText+"</option>")}),S=e.user,l())},function(){r()})}function n(){J||(b=$("#modalR"),y=$("#modalProject"),C=$("#modalProducts"),x=$("#title-req"),k=$("#btn_approval_req"),w=$("#btn_cancel_req"),j=$("#r_id"),L=$("#r_code"),E=$("#r_date_register"),E.val(H),P=$("#r_date_required"),q=$("#r_project_id"),D=$("#r_project_code"),T=$("#r_project_description"),N=$("#r_state"),N.val("Registrado"),F=$("#r_requested_by"),F.val(S),M=$("#r_approved_by"),U=$("#r_observation"),I=$("#load_matrix"),B=$("#load_articles"),O=$("#t_body_requirement"),Y=$("#show_table"),generateDatePicker(P),b.on("hidden.bs.modal",function(e){o()}),y.on("hidden.bs.modal",function(e){$("#search_p").val(""),$("#LoadRecordsButtonP").click(),b.attr("style","display:block;")}),y.on("show.bs.modal",function(e){$("#LoadRecordsButtonP").click(),b.attr("style","display:block; z-index:2030 !important")}),C.on("hidden.bs.modal",function(e){$("#search_pr").val(""),$("#LoadRecordsButtonPr").click(),b.attr("style","display:block;")}),C.on("show.bs.modal",function(e){$("#LoadRecordsButtonPr").click(),b.attr("style","display:block; z-index:2030 !important")}),d())}function s(){n(),b.modal("show"),x.html("Nuevo Requerimiento")}function c(e){n(),x.html("Editar Requerimiento"),a.get("requirements/find",e,function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.data;j.val(a.id),L.val(a.code),E.val(a.date_register),P.val(a.date_required),q.val(a.project_id),D.val(a.project_code),T.val(a.project_description),N.val(a.state),F.val(a.requested_by),M.val(a.approved_by),U.val(a.observation);var o=parseInt(a.requirement_state_id);1===o?k.removeClass("hide"):(2!==o&&3!==o||w.removeClass("hide"),$(".showReq").addClass("hide"),$(".formReq").prop("disabled",!0)),t.each(a.detail,function(e){p(e)}),V=a.project_id,I.prop("disabled",!1),B.prop("disabled",!1),b.modal("show")}else i.textType({title:"",message:"Hubo un error al obtener el requerimiento. Intente nuevamente.",type:"error"})})}function l(){generateSearchForm("frm-search-r","LoadRecordsButtonR",function(){Z.jtable("load",{search:$("#search_r").val(),check:g.prop("checked"),from:h.format("YYYY-MM-DD"),to:_.format("YYYY-MM-DD"),state:A.val(),state_line:R.val()})},!0)}function d(){J=!0;var e=getFormSearch("frm-search-p","search_p","LoadRecordsButtonP"),a=$("#table_container_p");a.jtable({title:"Lista de Proyectos",paging:!0,sorting:!0,actions:{listAction:base_url+"/requirements/getProjects"},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},code:{title:"Código Proyecto",width:"5%",listClass:"text-center"},description:{title:"Proyecto"},select:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){
return'<a href="javascript:void(0)" title="Seleccionar" class="select_p" data-id="'+e.record.id+'" data-code="'+e.record.code+'" data-description="'+e.record.description+'"><i class="fa fa-'+icon_select+' fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_p").click(function(e){var t=$(this).attr("data-id");q.val(t),D.val($(this).attr("data-code")),T.val($(this).attr("data-description")),y.modal("hide"),$("#search_p").val(""),I.prop("disabled",!1),B.prop("disabled",!1),V!==t&&(X=1,ee=[],O.html(""),v()),V=t,e.preventDefault()})}}),generateSearchForm("frm-search-p","LoadRecordsButtonP",function(){a.jtable("load",{search:$("#search_p").val(),consolidated:!0})},!1);var i=getFormSearch("frm-search-pr","search_pr","LoadRecordsButtonPr"),o=$("#table_container_pr");o.jtable({title:"Lista de Artículos",paging:!0,sorting:!1,actions:{listAction:base_url+"/requirements/getArticlesProject"},toolbar:{items:[{cssClass:"buscador",text:i}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},code:{title:"Código Artículo",width:"2%",listClass:"text-center"},matrix:{title:"Matriz",width:"2%",listClass:"text-center"},product:{title:"Artículo"},um:{title:"U.M.",width:"2%"},select:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_pr" data-id="'+e.record.id+'"><i class="fa fa-'+icon_select+' fa-1-5x"></i></a>'}}},recordsLoaded:function(e,a){$(".select_pr").click(function(e){var i=$(this).attr("data-id"),o=t.find(a.records,function(e){return e.id===parseInt(i)});o&&p(o),C.modal("hide"),$("#search_pr").val(""),e.preventDefault()})}}),generateSearchForm("frm-search-pr","LoadRecordsButtonPr",function(){o.jtable("load",{search:$("#search_pr").val(),project_id:V,items:ee})},!1)}function u(e){a.get("requirements/getMatrix",e,function(e){!t.isUndefined(e.status)&&e.status?t.each(e.data,function(e){p(e)}):i.textType({title:"",message:"Hubo un error al obtener la matriz. Intente nuevamente.",type:"error"})})}function p(e){t.contains(ee,e.id)||(m(e),ee.push(e.id))}function m(e){var a=$('<tr class="rowCon" data-id="'+e.id+'"></tr>'),o=$('<td class="text-center td_numbers">'+X+"</td>"),r=$('<td class="text-center">'+e.matrix+"</td>"),n=$("<td>"+e.product+"</td>"),s=$("<td>"+e.um+"</td>"),c=$('<td class="text-right">'+parseFloat(e.quantity_requested).toFixed(2)+"</td>"),l=$("<span>"+e.quantity_served+"<span/>");U.prop("disabled")||(l=$('<input style="width:75px" type="text" class="text-right inpRow" id="inpRow'+e.id+'" data-max="'+e.quantity_requested+'" onclick="this.select()" onkeypress="return validDecimals(event, this, 3)" onblur="return roundDecimals(this, 2)" value="'+e.quantity_served+'" />'));var d=$('<td class="text-right"></td>');d.append(l);var u=t.isNull(e.price)?".00":e.price,p=$('<td class="text-right">'+u+"</td>"),m=t.isNull(e.project_balance)?"":e.project_balance,h=$('<td class="text-right">'+m+"</td>"),_=$('<td class="text-center showReq"><a data-target="#" title="Eliminar" class="deleteRow"><i class="fa fa-trash fa-1-5x fa-red"></i></a></td>');a.append(o).append(r).append(n).append(s).append(c).append(d).append(p).append(h),U.prop("disabled")||a.append(_),O.append(a),v(),X++,$(".inpRow").blur(function(){var e=$(this),t=e.attr("data-max");(e.val()>parseFloat(t)||""===e.val())&&i.showWarning({title:"Debe ingresar una cantidad menor o igual a la cantidad pedida",message:""},function(){e.select()})}),$(".deleteRow").click(function(e){var a=$(this).closest("tr");i.confirm({title:"",message:"¿Está seguro que desea quitar esta artículo?",confirm:"Si",cancel:"No"},function(){var e=a.attr("data-id");a.remove(),ee=t.reject(ee,function(t){return t===parseInt(e)}),f(),v()}),e.preventDefault()})}function f(){X=1,t.each($(".td_numbers"),function(e){$(e).html(X),X++})}function v(){Y.addClass("hide"),""!==O.html()&&Y.removeClass("hide")}moment.locale("es");var h=moment().startOf("month"),_=moment().endOf("month"),g=$("#chk_date_range");g.click(function(){$("#LoadRecordsButtonR").click()});var b,y,C,x,k,w,A,R,S,j,L,E,P,q,D,T,N,F,M,U,O,I,B,Y,z=$("#reqDates"),V="";generateCheckBox(".i-checks");var H=moment.tz("America/Lima").format("DD/MM/YYYY"),G=function(e,t){h=e,_=t,z.find("span").html(e.format("MMM D, YYYY")+" - "+t.format("MMM D, YYYY")),g.prop("checked")&&$("#LoadRecordsButtonR").click()};generateDateRangePicker(z,h,_,G),G(h,_),e.saveRequirement=function(){var o=!0;if(o=o&&F.required(),o&&""===q.val())return i.showWarning({title:"",message:"Debe seleccionar el proyecto del requerimiento"}),!1;if(o&&""===O.html())return i.showWarning({title:"",message:"Debe seleccionar los articulos del requerimiento o cargar la matriz del proyecto"}),!1;if(o){var r=[],n=[];t.each($(".rowCon"),function(e){var t=$(e).attr("data-id");r.push(t),n.push($("#inpRow"+t).val())});var s={requested_by:F.val(),date_required:P.val(),project_id:q.val(),observation:U.val(),articles_id:r.join("-"),articles_val:n.join("-")},c=""===j.val()?0:j.val();a.updated("requirements/saveRequirement",c,s,function(a){!t.isUndefined(a.status)&&a.status?(e.showAlert("","El requerimiento se guardó correctamente.","success"),b.modal("hide"),$("#LoadRecordsButtonR").click()):e.showAlert("","Hubo un error al guardar el requerimiento. Intente nuevamente.","error")})}},e.loadMatrix=function(){""!==V&&u(V)},e.openProject=function(){y.modal("show")},e.openProducts=function(){C.modal("show")},e.sendApproval=function(){i.confirm({title:"",message:"¿Está seguro que desea enviar el requerimiento a aprobación?",confirm:"Si",cancel:"No"},function(){a.updated("requirements/sendApproval",j.val(),{},function(e){!t.isUndefined(e.status)&&e.status?(i.textType({title:"",message:"El requerimiento se envió correctamente.",type:"success"}),b.modal("hide"),$("#LoadRecordsButtonR").click()):i.textType({title:"",message:"Hubo un error al enviar el requerimiento a aprobación. Intente nuevamente.",type:"error"})})})},e.cancelRequirement=function(){i.confirm({title:"",message:"¿Está seguro que desea cancelar el requerimiento?",confirm:"Si",cancel:"No"},function(){a.updated("requirements/cancelRequirement",j.val(),{},function(e){!t.isUndefined(e.status)&&e.status?(i.textType({title:"",message:"El requerimiento se canceló correctamente.",type:"success"}),b.modal("hide"),$("#LoadRecordsButtonR").click()):i.textType({title:"Hubo un error al cancelar el requerimiento",message:e.message,type:"error"})})})};var W=getFormSearch("frm-search-r","search_r","LoadRecordsButtonR"),K='<select id="req_states" class="search_input"></select>',Q='<select id="req_states_line" class="search_input"></select>',Z=$("#table_container_r");Z.jtable({title:"Lista de Requerimientos",paging:!0,sorting:!0,actions:{listAction:base_url+"/requirements/list",deleteAction:base_url+"/requirements/delete"},toolbar:{items:[{cssClass:"buscador",text:K},{cssClass:"buscador",text:Q},{cssClass:"buscador",text:W},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar',click:function(){var t={search:$("#search_r").val(),check:g.prop("checked"),from:h.format("YYYY-MM-DD"),to:_.format("YYYY-MM-DD"),state:A.val(),state_line:R.val()};e.openDoc("requirements/excel",t)}},{cssClass:"btn-success",text:'<i class="fa fa-plus"></i> Nuevo',click:function(){s()}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},code:{title:"Requerimiento",listClass:"text-center",width:"5%"},date_registration:{title:"F.Registro",listClass:"text-center",width:"5%"},date_required:{title:"F.Requerida",list:show_list_,listClass:"text-center",width:"5%"},project_description:{title:"Proyecto",width:"30%",sorting:!1},requested_by:{title:"Solicitado por",list:show_list_},requirement_state_desc:{title:"Estado",list:show_list_,sorting:!1,width:"5%"},requirement_state_line_desc:{title:"Estado por Linea",sorting:!1,list:show_list_},edit:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return'<a data-target="#" title="Editar" class="edit_r" data-code="'+e.record.id+'"><i class="fa fa-pencil-square-o fa-1-5x fa-green"></i></a>'}}},recordsLoaded:function(e,t){$(".edit_r").click(function(e){var t=$(this).attr("data-code");c(t),e.preventDefault()})}}),r();var J=!1,X=1,ee=[]}function t(e,t){e.state("requirements",{url:"/requirements",templateUrl:base_url+"/templates/requirements/base.html",controller:"RequirementCtrl"}),t.otherwise("/")}angular.module("sys.app.requirements").config(t).controller("RequirementCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.requirements_contests",[])}(),function(){"use strict";function e(e,t,a,i){function o(){d=$("#req_states_c"),d.empty().change(function(){$("#LoadRecordsButtonRC").click()}),u=$("#req_states_c_line"),u.empty().change(function(){$("#LoadRecordsButtonRC").click()}),a.all("requirements_contests/data_form","",function(e){!t.isUndefined(e.status)&&e.status&&(t.each(e.states,function(e){d.append('<option value="'+e.Value+'">'+e.DisplayText+"</option>")}),t.each(e.states_line,function(e){u.append('<option value="'+e.Value+'">'+e.DisplayText+"</option>")}))},function(){o()})}function r(e){n(),a.get("requirements_contests/getContests",e,function(e){!t.isUndefined(e.status)&&e.status?e.data.length>0?(t.each(e.data,function(e){var t=$("<tr></tr>"),a=$('<td class="text-center">'+e.code+"</td>"),i=$("<td>"+e.document+"</td>"),o=$("<td>"+e.business_name+"</td>"),r=$("<td>"+e.state+"</td>");t.append(a).append(i).append(o).append(r),h.append(t)}),f.removeClass("hide")):v.removeClass("hide"):i.textType({title:"",message:"Hubo un error al obtener los concursos. Intente nuevamente.",type:"error"})})}function n(){f.addClass("hide"),v.addClass("hide"),h.empty()}moment.locale("es");var s=moment().startOf("month"),c=moment().endOf("month"),l=$("#chk_date_range");l.click(function(){$("#LoadRecordsButtonRC").click()});var d,u,p=$("#reqDates");generateCheckBox(".i-checks");var m=function(e,t){s=e,c=t,p.find("span").html(e.format("MMM D, YYYY")+" - "+t.format("MMM D, YYYY")),l.prop("checked")&&$("#LoadRecordsButtonRC").click()};generateDateRangePicker(p,s,c,m),m(s,c);var f=$("#show_table_req_con"),v=$("#show_no_req_con"),h=$("#t_body_table_req_con"),_=getFormSearch("frm-search-rc","search_rc","LoadRecordsButtonRC"),g='<select id="req_states_c" class="search_input"></select>',b='<select id="req_states_c_line" class="search_input"></select>',y=$("#table_container_requirements_vs_contests");y.jtable({title:"Lista de Requerimientos",paging:!0,sorting:!0,actions:{listAction:base_url+"/requirements_contests/list"},toolbar:{items:[{cssClass:"buscador",text:g},{cssClass:"buscador",text:b},{cssClass:"buscador",text:_}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},view:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Ver Cotizaciones" class="select_rc" data-code="'+e.record.id+'"><i class="fa fa-database fa-1-5x"></i></a>'}},code:{title:"Requerimiento",listClass:"text-center",width:"5%"},date_registration:{title:"F.Registro",listClass:"text-center",width:"5%"},date_required:{title:"F.Requerida",list:show_list_,listClass:"text-center",width:"5%"},project_description:{title:"Proyecto",width:"30%",sorting:!1},requested_by:{title:"Solicitado por",list:show_list_},requirement_state_desc:{title:"Estado",list:show_list_,sorting:!1,width:"5%"},requirement_state_line_desc:{title:"Estado por Linea",sorting:!1,list:show_list_}},recordsLoaded:function(e,t){$(".select_rc").click(function(e){console.log(this.closest("tr"));var t=$(this).attr("data-code");$(".jtable-row-selected").removeClass("jtable-row-selected"),$(this).closest("tr").addClass("jtable-row-selected"),r(t),e.preventDefault()})}}),o(),generateSearchForm("frm-search-rc","LoadRecordsButtonRC",function(){n(),y.jtable("load",{search:$("#search_rc").val(),check:l.prop("checked"),from:s.format("YYYY-MM-DD"),to:c.format("YYYY-MM-DD"),state:d.val(),state_line:u.val()})},!0)}function t(e,t){e.state("requirements_contests",{url:"/requirements_contests",templateUrl:base_url+"/templates/requirements_quotations/base.html",controller:"RequirementQuotationCtrl"}),t.otherwise("/")}angular.module("sys.app.requirements_contests").config(t).controller("RequirementQuotationCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.resources",[])}(),function(){"use strict";function e(e,t,a,i,o,r){function n(){a.all("resources/getLevels","",function(e){!t.isUndefined(e.status)&&e.status?createTree(e.Data,"tree_view","treeViewResource",function(){$("#treeViewResource").treed({openedClass:"glyphicon-folder-open",closedClass:"glyphicon-folder-close"}),$(".level-tree").click(function(e){var t=$(this).parent().find("i").hasClass("glyphicon-folder-open");if(t){var a=$(this).attr("id");a=a.substr(5),s(a)}e.preventDefault()}),$(".add-lp").click(function(e){var t=$(this).attr("data-id"),a=$(this).attr("data-title");$("#modal-title-product").html("Seleccionar artículos para Nivel: "+a),E=t,P=a,p.modal("show"),$("#search_p").val(""),LoadRecordsButtonP.click(),$(this).closest("li").click(),e.preventDefault()})}):n()})}function s(e){var i=$(".ul_level"+e);i.addClass("hide"),a.get("resources/getProductsLevel",e,function(e){!t.isUndefined(e.status)&&e.status&&(i.html(""),t.each(e.Data,function(e){i.append('<li><a class="product_tree"  style="color:#555" id="product'+e.id+'" href="javascript:void(0)">'+e.text+"</a></li");var t=$("#product"+e.id);t.addClass("text-cut")}),i.removeClass("hide"),$(".product_tree").click(function(e){$(".tree_element_select").removeClass("tree_element_select");var t=$(this).attr("id");t=t.substr(7),c(t),l(t),e.preventDefault()}),""!==q&&c(q))})}function c(e){var t=$("#product"+e);t.addClass("tree_element_select")}function l(e){d(),a.get("resources/getProduct",e,function(a){if(!t.isUndefined(a.status)&&a.status){m.removeClass("hide"),q=e;var i=a.data;f.val(i.matrix),v.val(i.code),h.val(i.description_detail),_.val(i.unity),g.val(i.type),b.val(i.retention),y.val(i.level1),C.val(i.level2),x.val(i.level3),k.val(i.level4),w.val(i.cc_debe),A.val(i.cc_haber),R.val(i.created_d),S.val(i.created_u),j.val(i.updated_d),L.val(i.updated_u)}else o.textType({title:"",message:"Hubo un error al obtener el artículo. Intente nuevamente.",type:"error"})})}function d(){q="",m.addClass("hide"),m.find("input").val(""),m.find("textarea").val("")}function u(e){o.prompt({title:"Asociar el artículo al nivel "+P,message:"",confirm:"Si",cancel:"No",closeOnConfirm:!1,placeholder:"Ingrese el código de matriz",showLoaderOnConfirm:!0,error_message:"Debe ingresar el código de matriz"},function(i){var r={level_id:E,product_id:e,code:i};a.updated("resources/associate",0,r,function(a){!t.isUndefined(a.status)&&a.status?(o.textType({title:"",message:"El artículo se asoció correctamente.",type:"success"}),s(E),l(e),p.modal("hide")):o.textType({title:"",message:"Hubo un error al asociar el artículo. Intente nuevamente.",type:"error"})})})}var p=($("#treeViewResource"),$("#modalP")),m=$("#show_product"),f=$("#pr_code_matriz"),v=$("#pr_code_article"),h=$("#pr_description_detail"),_=$("#pr_unity"),g=$("#pr_type"),b=$("#pr_retention"),y=$("#pr_level1"),C=$("#pr_level2"),x=$("#pr_level3"),k=$("#pr_level4"),w=$("#pr_debe"),A=$("#pr_haber"),R=$("#pr_d_created"),S=$("#pr_u_created"),j=$("#pr_d_updated"),L=$("#pr_u_updated"),E="",P="";n();var q="",D=getFormSearch("frm-search-p","search_p","LoadRecordsButtonP"),T=$("#table_container_p");T.jtable({title:"Lista de Artículos",paging:!0,sorting:!0,actions:{listAction:base_url+"/resources/getProductsSM"},toolbar:{items:[{cssClass:"buscador",text:D}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},description_detail:{title:"Descripción"},select:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" class="join-prod" data-id="'+e.record.id+'" title="Asociar"><i class="fa fa-'+icon_select+' fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".join-prod").click(function(e){var t=$(this).attr("data-id");u(t),e.preventDefault()})}}),generateSearchForm("frm-search-p","LoadRecordsButtonP",function(){T.jtable("load",{search:$("#search_p").val()})},!1),e.disassociate=function(){o.confirm({title:"",message:"¿Está seguro que desea desasociar este artículo?",confirm:"Si",cancel:"No"},function(){a.updated("resources/disassociate",q,{},function(e){!t.isUndefined(e.status)&&e.status?(o.textType({title:"",message:"El artículo se desasoció correctamente.",type:"success"}),$("#product"+q).parent().remove(),d()):o.textType({title:"",message:"Hubo un error al desasociar el artículo. Intente nuevamente.",type:"error"})})})}}function t(e,t){e.state("resources",{url:"/resources",templateUrl:base_url+"/templates/resources/base.html",controller:"ResourceCtrl"}),t.otherwise("/")}angular.module("sys.app.resources").config(t).controller("ResourceCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","$rootScope","AlertFactory","Notify"]}(),function(){"use strict";angular.module("sys.app.revision_cas",[])}(),function(){"use strict";function e(e){e.chkState=function(){var e=w_state.prop("checked")?"Activo":"Inactivo";state_state.html(e)};var t=getFormSearch("frm-search-Revision_ca","search_b","LoadRecordsButtonRevision_ca"),a=$("#table_container_Revision_ca");a.jtable({title:"Lista de Revisiones",paging:!0,sorting:!0,actions:{listAction:base_url+"/revision_cas/list",createAction:base_url+"/revision_cas/create",updateAction:base_url+"/revision_cas/update",deleteAction:base_url+"/revision_cas/delete"},messages:{addNewRecord:"Nueva Revisión",editRecord:"Editar Revisión"},toolbar:{items:[{cssClass:"buscador",text:t},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("revision_cas/excel",{})}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},nombre:{title:"Revisión"},idgrupo:{title:"Grupo",options:base_url+"/revision_cas/getGrupo"},estado:{title:"Estado",values:{I:"Inactivo",A:"Activo"},type:"checkbox",defaultValue:"A"}},formCreated:function(e,t){t.form.find('input[name="Categoria"]').attr("onkeypress","return soloLetras(event)"),$("#Edit-estado").parent().addClass("i-checks"),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click(),"A"==e.target.value?($("#Edit-estado").val("I"),$(".i-checks span").text("Inactivo")):($("#Edit-estado").val("A"),$(".i-checks span").text("Activo"))})},formSubmitting:function(e,t){var a=!0;return a=a&&t.form.find('input[name="nombre"]').required()}}),generateSearchForm("frm-search-Revision_ca","LoadRecordsButtonRevision_ca",function(){a.jtable("load",{search:$("#search_b").val()})},!0)}function t(e,t){e.state("revision_cas",{url:"/revision_cas",templateUrl:base_url+"/templates/revision_cas/base.html",controller:"Revision_caCtrl"}),t.otherwise("/")}angular.module("sys.app.revision_cas").config(t).controller("Revision_caCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope"]}(),function(){"use strict";angular.module("sys.app.sales_charges",[])}(),function(){"use strict";function e(e,t,a,i){function o(){d=$("#modalSC"),p=$("#title-sc"),u=$("#modalClient"),f=$("#modalDirectBilling"),m=$("#sc_document_body"),v=$("#modalControlSaldo"),h=$("#titleControlSaldo"),_=$("#sc_charges_id"),g=$("#sc_client_id"),b=$("#sc_client"),y=$("#sc_local_id"),C=$("#sc_way_payment_id"),x=$("#sc_number_way_payment"),k=$("#sc_amount"),w=$("#sc_registration_date"),A=$("#sc_payment_date"),R=$("#sc_money_id"),S=$("#sc_bank_id"),j=$("#sc_current_account_number"),L=$("#sc_ruc"),u.on("hidden.bs.modal",function(e){d.attr("style","display:block;")}),u.on("show.bs.modal",function(e){d.attr("style","display:block; z-index:2030 !important")}),f.on("hidden.bs.modal",function(e){d.attr("style","display:block;")}),f.on("show.bs.modal",function(e){d.attr("style","display:block; z-index:2030 !important")}),v.on("hidden.bs.modal",function(e){f.attr("style","display:block;")}),v.on("show.bs.modal",function(e){f.attr("style","display:block; z-index:2030 !important")}),d.on("hidden.bs.modal",function(e){r()}),q||l()}function r(){}function n(){o(),d.modal("show"),p.html("Nuevo Cobro de Ventas")}function s(e){o(),p.html("Editar Cobros de Ventas"),d.modal("show")}function c(){o(),$("#modalControlSaldo").modal("show"),h.html("Monto a Cobrar")}function l(){q=!0;var e=getFormSearch("frm-search-client","search_client","LoadRecordsButtonClient"),t=$("#table_container_client");t.jtable({title:"Lista de Clientes",paging:!0,sorting:!0,actions:{listAction:base_url+"/fronts/listClient"},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},Documento:{title:"Ruc"},RazonSocial:{title:"Razón Social"},select:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_c" data-code="'+e.record.id+'" data-doc="'+e.record.Documento+'" data-name="'+e.record.RazonSocial+'"><i class="fa fa-circle-o fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_c").click(function(e){var t=$(this).attr("data-code"),a=$(this).attr("data-doc"),i=$(this).attr("data-name");g.val(t),L.val(a),b.val(i),u.modal("hide"),e.preventDefault()})}}),generateSearchForm("frm-search-client","LoadRecordsButtonClient",function(){t.jtable("load",{search:$("#search_client").val()})},!1);var a=getFormSearch("frm-search-directbilling","search_directbilling","LoadRecordsButtonDirectbilling"),i=$("#table_container_directbilling");i.jtable({title:"Lista de Documentos",paging:!0,sorting:!0,actions:{listAction:function(e,t){return{Result:"OK",Records:[{Comprobante:"FACTURA",numero:"001-0002",monto:"5000.00",fecha:"12/01/2017"},{Comprobante:"FACTURA",numero:"001-0003",monto:"4000.00",fecha:"13/01/2017"},{Comprobante:"FACTURA",numero:"001-0004",monto:"3000.00",fecha:"12/10/2017"}],TotalRecordCount:4}}},toolbar:{items:[{cssClass:"buscador",text:a}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},Comprobante:{title:show_list_?"Tipo Comprobante":"Tipo Comp."},numero:{title:show_list_?"N° Comprobante":"N° Comp."},monto:{title:show_list_?"Monto Total":"Total",listClass:"text-right"},fecha:{title:"Fecha Emisión",listClass:"text-center",list:show_list_},select:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_db" data-code="'+e.record.id+'" data-doc="'+e.record.numero+'" data-name="'+e.record.RazonSocial+'"><i class="checks'+e.record.id+' fa fa-circle-o fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_db").click(function(e){var t=$(this).attr("data-code");c(t),e.preventDefault()})}}),generateSearchForm("frm-search-directbilling","LoadRecordsButtonDirectbilling",function(){i.jtable("load",{search:$("#search_directbilling").val()})},!1)}var d,u,p,m,f,v,h,_,g,b,y,C,x,k,w,A,R,S,j,L;e.openClient=function(){$("#LoadRecordsButtonClient").click(),u.modal("show")},e.openDirectBilling=function(){$("#LoadRecordsButtonDirectbilling").click(),f.modal("show")},e.saveBalanceControl=function(){$("#modalControlSaldo").modal("hide"),$("#modalDirectBilling").modal("hide")},e.saveSalesCharges=function(){var e=!0;if(e=e&&_.required(),e=e&&g.required(),e=e&&b.required(),e=e&&y.required(),e=e&&C.required(),e=e&&x.required(),e=e&&k.required(),e=e&&w.required(),e=e&&A.required(),e=e&&R.required(),e=e&&S.required(),e=e&&j.required()){var o=[];$.each($(".sc_document"),function(e,t){o[e]=$(t).val()}),o=o.join(",");var r={id:_.val(),client_id:g.val(),local_id:y.val(),address:C.val(),state:k.prop("checked")?1:0,physical_location:C.prop("checked")?1:0,users:o},n=""==_.val()?0:_.val();console.log(n),a.updated("sales_charges/saveSalesCharges",n,r,function(e){t.isUndefined(e.status)||1!=e.status?i.textType({title:"",message:"Hubo un error al guardar el  Cobro de Ventas. Intente nuevamente.",type:"error"}):(console.log(e),i.textType({title:"",message:"El Cobro de Ventas se guardó correctamente.",type:"success"}),d.modal("hide"),LoadRecordsButtonSalesCharges.click())})}};var E=getFormSearch("frm-search-SalesCharges","search_SalesCharges","LoadRecordsButtonSalesCharges"),P=$("#table_container_sales_charges");P.jtable({title:"Lista de Cobros de Ventas",paging:!0,sorting:!0,actions:{listAction:function(e,t){return{Result:"OK",Records:[{description:"ELECTROCENTRO SA",ruc:"10475835361",proyecto:"11231-PROYECTO PRUEBA",local:"LOCAL PRINCIPAL",Periodo_contable:"201703",saldo:"4,456.00",fecha_emision:"12/01/2017"},{description:"SYSTEM SA",ruc:"10475835364",proyecto:"11234-PROYECTO PRUEBA",local:"LOCAL PRINCIPAL",Periodo_contable:"201702",saldo:"4,756.00",fecha_emision:"12/02/2017"},{description:"CONSTRUCT SA",ruc:"10475835362",proyecto:"11232-PROYECTO PRUEBA",local:"LOCAL PRINCIPAL",Periodo_contable:"201701",saldo:"3,656.00",fecha_emision:"12/03/2017"},{description:"MALDONADO SA",ruc:"10475835365",proyecto:"11233-PROYECTO PRUEBA",local:"LOCAL PRINCIPAL",Periodo_contable:"201702",saldo:"2,256.00",fecha_emision:"12/04/2017"}],TotalRecordCount:4}},deleteAction:base_url+"/sales_charges/delete"},toolbar:{items:[{cssClass:"buscador",text:E},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){window.open(base_url+"/sales_charges/excel")}},{cssClass:"btn-success",text:'<i class="fa fa-plus"></i> Nuevo Cobros de Ventas',click:function(){n()}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},description:{title:"Cliente"},ruc:{title:"Ruc",width:"4%"},proyecto:{title:"Proyecto"},local:{title:"Local",width:"8%"},Periodo_contable:{title:"Periodo Contable",width:"3%"},saldo:{title:show_list_?"Monto Total":"Total",listClass:"text-right",width:"3%"},fecha_emision:{title:"Fecha",listClass:"text-center",width:"3%"},edit:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return'<a href="javascript:void(0)" title="Editar" class="edit_w" data-code="'+e.record.id+'"><i class="fa fa-pencil-square-o fa-1-5x fa-green"></i></a>'}}},recordsLoaded:function(e,t){$(".edit_w").click(function(e){var t=$(this).attr("data-code");s(t),e.preventDefault()})}}),generateSearchForm("frm-search-SalesCharges","LoadRecordsButtonSalesCharges",function(){P.jtable("load",{search:$("#search_SalesCharges").val()})},!0);var q=!1}function t(e,t){e.state("sales_charges",{url:"/sales_charges",templateUrl:base_url+"/templates/sales_charges/base.html",controller:"SalesChargesCtrl"}),t.otherwise("/")}angular.module("sys.app.sales_charges").config(t).controller("SalesChargesCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.series",[])}(),function(){"use strict";function e(e,t,a,i){function o(){cleanRequired(),m.html(""),C.val(""),l.val(""),p.val(""),d.val(""),u.addClass("hide"),g.val(""),b.val(""),y.val(""),f.val(""),v.val(""),h.val(""),_.val(""),x.val(""),k.val("")}function r(){m.html("Nueva Serie"),$("#anio_fabricacion").attr("onkeypress","return soloNumeros(event)"),$("#anio_modelo").attr("onkeypress","return soloNumeros(event)"),c.modal("show")}function n(e){m.html("Editar serie"),a.get("series/find",e,function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.data;console.log(a),l.val(a[0].idArticulo),d.val(a[0].Articulo),p.val(a[0].idSerie),f.val(a[0].nombreSerie),v.val(a[0].chasis),h.val(a[0].motor),_.val(a[0].color),x.val(a[0].anio_fabricacion),k.val(a[0].anio_modelo),g.val(a[0].idTipoCompraVenta).trigger("change"),b.val(a[0].nPoliza),y.val(a[0].nLoteCompra),C.val(a[0].cPlacaVeh),c.modal("show")}else i.textType({title:"",message:"Hubo un error al obtener el serie. Intente nuevamente.",type:"error"})})}function s(){a.all("series/data_form","",function(e){console.log("ddd"),!t.isUndefined(e.status)&&e.status&&(g.append('<option value="" selected>Seleccionar</option>'),console.log(e.tipoCompra),console.log("eee"),t.each(e.tipoCompra,function(e){g.append('<option value="'+e.idTipoCompraVenta+'">'+e.descripcion+"</option>")}))},function(){s()})}var c=$("#modalSerie"),l=$("#p_product_id"),d=$("#p_product_name"),u=$("#msg_cont"),p=$("#serie_id"),m=$("#titleModalSerie"),f=$("#serie"),v=$("#chasis"),h=$("#motor"),_=$("#color"),g=$("#tipoCompra"),b=$("#nrPoliza"),y=$("#nrLote"),C=$("#cPlacaVeh"),x=$("#anio_fabricacion"),k=$("#anio_modelo"),w=$("#modalArticulo");c.on("hidden.bs.modal",function(e){o()}),e.type_cc="",e.openCC=function(t){e.type_cc=t,w.modal("show"),$("#search_cc2").val(""),$("#LoadRecordsButtonCC2").click()},e.clearCC=function(e){l.val(""),d.val("")},e.saveserie=function(){u.addClass("hide");var e=!0;if(e=e&&l.required(),!e)return u.removeClass("hide"),!1;if(e=e&&f.required()){var o={idArticulo:l.val(),nombreSerie:f.val(),chasis:v.val(),motor:h.val(),color:_.val(),anio_modelo:k.val(),anio_fabricacion:x.val(),idTipoCompraVenta:g.val(),nPoliza:b.val(),nLoteCompra:y.val(),cPlacaVeh:C.val()},r=""===p.val()?0:p.val();a.updated("series/createserie",r,o,function(e){if(!t.isUndefined(e.status)&&e.status)c.modal("hide"),LoadRecordsButtonSerie.click();else{var a=t.isUndefined(e.message)?"No se pudo guardar la Serie. Intente nuevamente.":e.message;i.textType({title:"",message:a,type:"info"})}})}};var A=getFormSearch("frm-search-Serie","search_Serie","LoadRecordsButtonSerie"),R=$("#table_container_Serie");s(),R.jtable({title:"Lista de Series",paging:!0,sorting:!0,actions:{listAction:base_url+"/series/list",deleteAction:base_url+"/series/delete"},toolbar:{items:[{cssClass:"buscador",text:A},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("series/excel",{})}},{cssClass:"btn-danger-admin",text:'<i class="fa fa-plus"></i> Nueva Serie',click:function(){r()}}]},fields:{idSerie:{key:!0,create:!1,edit:!1,list:!1},cPlacaVeh:{title:"Placa"},serie:{title:"Serie"},idArticulo:{title:"Artículo",options:base_url+"/series/getArticulos"},chasis:{title:"Chasis"},motor:{title:"Motor"},anio_fabricacion:{title:"Año de Fabricación"},anio_modelo:{title:"Año del Modelo"},edit:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" class="edit-serie" data-id="'+e.record.idSerie+'" title="Editar"><i class="fa fa-edit fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".edit-serie").click(function(e){var t=$(this).attr("data-id");n(t),e.preventDefault()})}}),generateSearchForm("frm-search-Serie","LoadRecordsButtonSerie",function(){R.jtable("load",{search:$("#search_Serie").val()})},!0),w.on("hidden.bs.modal",function(e){c.attr("style","display:block;")}),w.on("show.bs.modal",function(e){c.attr("style","display:block; z-index:2030 !important")});var S=getFormSearch("frm-search-cc2","search_cc2","LoadRecordsButtonCC2"),j=$("#table_container_cc2");j.jtable({title:"Lista de Articulos",paging:!0,sorting:!0,actions:{listAction:base_url+"/series/getArticulosSerie"},toolbar:{items:[{cssClass:"buscador",text:S}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},description:{title:"Articulos"},select:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_cc" data-name="'+e.record.description+'" data-code="'+e.record.id+'"><i class="fa fa-'+icon_select+' fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_cc").click(function(e){var t=$(this).attr("data-code"),a=$(this).attr("data-name");l.val(t),d.val(a),w.modal("hide"),e.preventDefault()})}}),generateSearchForm("frm-search-cc2","LoadRecordsButtonCC2",function(){j.jtable("load",{search:$("#search_cc2").val()})},!1)}function t(e,t){e.state("series",{url:"/series",templateUrl:base_url+"/templates/series/base.html",controller:"SerieCtrl"}),t.otherwise("/")}angular.module("sys.app.series").config(t).controller("SerieCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],
e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.shops",[])}(),function(){"use strict";function e(e,t,a,i){function o(){cleanRequired(),d.html(""),f.val(""),v.val(""),h.val(""),_.val(""),m.val(""),g.val(""),b.prop("checked",!0).iCheck("update"),p.html("Activo"),_.html(""),_.html(""),g.html("")}function r(e){var o="0";a.get("shops/TraerDepartamentos",o,function(a){if(!t.isUndefined(a.status)&&a.status){a.data;h.html(""),h.append('<option value="" selected>Seleccione</option>'),t.each(a.data,function(t){t.cDepartamento==e?h.append('<option value="'+t.cDepartamento+'" selected >'+t.cDepartamento+"</option>"):h.append('<option value="'+t.cDepartamento+'" >'+t.cDepartamento+"</option>")})}else i.textType({title:"",message:"Hubo un error al obtener el Artículo. Intente nuevamente.",type:"error"})})}function n(e,o){a.get("shops/TraerProvincias",o,function(a){if(!t.isUndefined(a.status)&&a.status){var o=a.data;console.log(o),_.html(""),_.append('<option value="" selected>Seleccione</option>'),t.each(a.data,function(t){t.cProvincia==e?_.append('<option value="'+t.cProvincia+'" selected>'+t.cProvincia+"</option>"):_.append('<option value="'+t.cProvincia+'">'+t.cProvincia+"</option>")})}else i.textType({title:"",message:"Hubo un error . Intente nuevamente.",type:"error"})})}function s(e,o){a.get("shops/TraerDistritos",o,function(a){if(!t.isUndefined(a.status)&&a.status){var o=a.data;console.log(o),g.html(""),g.append('<option value="" selected>Seleccione</option>'),t.each(a.data,function(t){t.cCodUbigeo==e?g.append('<option value="'+t.cCodUbigeo+'" selected>'+t.cDistrito+"</option>"):g.append('<option value="'+t.cCodUbigeo+'">'+t.cDistrito+"</option>")})}else i.textType({title:"",message:"Hubo un error al obtener el Artículo. Intente nuevamente.",type:"error"})})}function c(){d.html("Nueva Tienda"),u.modal("show");var e="xxxxx";r(e)}function l(o){d.html("Editar Tienda"),a.get("shops/find",o,function(a){if(!t.isUndefined(a.status)&&a.status){var o=a.data;m.val(o[0].idTienda),f.val(o[0].descripcion),v.val(o[0].direccion);var c="A"==o[0].estado;console.log(o[0].estado),b.prop("checked",c).iCheck("update"),e.chkState(),r(o[0].cDepartamento),n(o[0].cProvincia,o[0].cDepartamento),s(o[0].cCodUbigeo,o[0].cProvincia),u.modal("show")}else i.textType({title:"",message:"Hubo un error al obtener el Lote. Intente nuevamente.",type:"error"})})}var d=$("#titleModalTienda"),u=$("#modaTiendas"),p=$("#state_text"),m=$("#tienda_id"),f=$("#descripcion"),v=$("#direccion"),h=$("#departamento"),_=$("#provincia"),g=$("#distrito"),b=$("#p_state");e.ShopGetProvincia=function(){console.log("cambio2")},h.change(function(){var e="xxxxxx",t=h.val();n(e,t)}),_.change(function(){var e="xxxxxx",t=_.val();s(e,t)}),u.on("hidden.bs.modal",function(e){o()}),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(t){$(t.target).click(),e.chkState()}),e.chkState=function(){var e=b.prop("checked")?"Activo":"Inactivo";p.html(e)},e.saveTienda=function(){var e=!0;if(e=e&&f.required(),e=e&&v.required(),e=e&&h.required(),e=e&&_.required(),e=e&&g.required()){var o={descripcion:f.val(),direccion:v.val(),distrito:g.val(),estado:b.prop("checked")?"A":"I"},r=""===m.val()?0:m.val();a.updated("shops/createTienda",r,o,function(e){!t.isUndefined(e.status)&&e.status?(u.modal("hide"),LoadRecordsButtonShop.click()):i.textType({title:"",message:"Hubo un error al guardar el Lote. Intente nuevamente.",type:"error"})})}};var y=getFormSearch("frm-search-Shop","search_b","LoadRecordsButtonShop"),C=$("#table_container_Shop");C.jtable({title:"Lista de Tiendas",paging:!0,sorting:!0,actions:{listAction:base_url+"/shops/list",deleteAction:base_url+"/shops/delete"},toolbar:{items:[{cssClass:"buscador",text:y},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("shops/excel",{})}},{cssClass:"btn-danger-admin",text:'<i class="fa fa-plus"></i> Nueva Tienda',click:function(){c()}}]},fields:{idTienda:{key:!0,create:!1,edit:!1,list:!1},Tienda:{title:"Tienda"},direccion:{title:"Direccion"},Departamento:{title:"Departamento",options:base_url+"/shops/getDepartamento"},Provincia:{title:"Provincia",options:base_url+"/shops/getProvincia"},Distrito:{title:"Distrito",options:base_url+"/shops/getDistrito"},estado:{title:"Estado",values:{I:"Inactivo",A:"Activo"},type:"checkbox"},edit:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" class="edit-Tienda" data-id="'+e.record.idTienda+'" title="Editar"><i class="fa fa-edit fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".edit-Tienda").click(function(e){var t=$(this).attr("data-id");l(t),e.preventDefault()})}}),generateSearchForm("frm-search-Shop","LoadRecordsButtonShop",function(){C.jtable("load",{search:$("#search_b").val()})},!0)}function t(e,t){e.state("shops",{url:"/shops",templateUrl:base_url+"/templates/shops/base.html",controller:"ShopCtrl"}),t.otherwise("/")}angular.module("sys.app.shops").config(t).controller("ShopCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.stocks",[])}(),function(){"use strict";function e(e,t,a,i){function o(){g||(d=$("#modalWarehouse"),d.on("hidden.bs.modal",function(e){r()}),d.on("show.bs.modal",function(e){r()}),c())}function r(){cleanRequired(),m=[],l()}function n(){u=$("#s_warehouse_id"),u.html("").change(function(){m=[],m.push(u.val()),$(".select2-results__option").css({"overflow-y":"visible"}),$("#LoadRecordsButtonStock").click()}),a.all("departures/data_form","",function(e){!t.isUndefined(e.status)&&e.status&&(u.append('<option value="0">Todos los almacenes</option>'),t.each(e.warehouse,function(e){u.append('<option value="'+e.Value+'">'+e.DisplayText+"</option>")}),s())},function(){n()})}function s(){generateSearchForm("frm-search-stock","LoadRecordsButtonStock",function(){_.jtable("load",{search:$("#search_stock").val(),warehouse_list:m})},!0)}function c(){g=!0;var e=getFormSearch("frm-search-warehouse","search_warehouse","LoadRecordsButtonWarehouse"),t=$("#table_container_warehouse");t.jtable({title:"Lista de Almacenes",paging:!0,sorting:!0,selecting:!0,multiselect:!0,selectingCheckboxes:!0,selectOnRowClick:!1,actions:{listAction:base_url+"/stocks/listWarehouse"},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{id:{key:!0,edit:!1,create:!1,list:!1},code_internal:{title:"Código",width:"4%"},description:{title:"Descripción"}},recordsLoaded:function(e,t){$(".jtable-selecting-column input").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click()})}}),generateSearchForm("frm-search-warehouse","LoadRecordsButtonWarehouse",function(){t.jtable("load",{search:$("#search_warehouse").val()})},!1)}function l(){$(".jtable-column-header-selecting input").prop("checked",!1).iCheck("update"),$(".jtable-row-selected").removeClass("jtable-row-selected")}var d,u,p=!1;e.seeStock=function(){var e=$("#table_container_warehouse").jtable("selectedRows");return e.length>0?(e.each(function(){var e=$(this).data("record");m.push(e.id)}),s(),p=!0,console.log(p),$("#s_warehouse_id").html('<option value="">Varios</option>').prop("disabled",!0),$("#modalWarehouse").modal("hide"),void 0):(i.textType({title:"",message:"Debe seleccionar al menos un almacén a asignar.",type:"warning"}),!1)};var m=[],f=getFormSearch("frm-search-stock","search_stock","LoadRecordsButtonStock"),v='<div class="form-inline" style="margin-bottom:-3px"><span><label class="control-label" style="font-size: 13px; margin-top:-12px">Almacén:</label></span></div>',h='<div class="form-inline" style="margin-bottom:-3px;"><div class="input-group input-group-sm select_all"><select id="s_warehouse_id" class="form-control search_input hide"  style="width: 180px;"></select><span class="input-group-btn"><button type="button" id="s_button_openStock" class="btn btn-primary" title="Varios"><i class="fa fa-bars"></i></button><button type="button" id="load_warehouse" class="btn btn-success" title="Actualizar"><i class="fa fa-refresh"></i></button></span></div></div>',_=$("#table_container_stock");_.jtable({title:"Lista de Stock por Almacén",paging:!0,sorting:!0,actions:{listAction:base_url+"/stocks/list"},toolbar:{items:[{cssClass:"buscador",text:v},{cssClass:"buscador",text:h},{cssClass:"buscador",text:f},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("stocks/excel",{})}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},code_article:{title:"Código Artículo",width:"2%"},description_article:{title:"Artículo"},code_internal:{title:"Código Almacén",width:"4%"},warehouse_o:{title:"Almacén",width:"6%"},stock:{title:"Disponible",width:"2%",listClass:"text-right"}},recordsLoaded:function(e,t){}}),n(),$("#s_warehouse_id").select2(),$(".select_all span .selection").addClass("text-left"),$("#s_button_openStock").click(function(){o(),$("#LoadRecordsButtonWarehouse").click(),$("#modalWarehouse").modal("show")}),$("#load_warehouse").click(function(){u.html("").prop("disabled",!1),n()});var g=!1}function t(e,t){e.state("stocks",{url:"/stocks",templateUrl:base_url+"/templates/stocks/base.html",controller:"StockCtrl"}),t.otherwise("/")}angular.module("sys.app.stocks").config(t).controller("StockCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.subfamilies",[])}(),function(){"use strict";function e(e){e.chkState=function(){var e=w_state.prop("checked")?"Activo":"Inactivo";state_state.html(e)};var t=getFormSearch("frm-search-SubFamily","search_b","LoadRecordsButtonSubFamily"),a=$("#table_container_SubFamily");a.jtable({title:"Lista de Sub Familias",paging:!0,sorting:!0,actions:{listAction:base_url+"/subfamilies/list",createAction:base_url+"/subfamilies/create",updateAction:base_url+"/subfamilies/update",deleteAction:base_url+"/subfamilies/delete"},messages:{addNewRecord:"Nueva Sub Familia",editRecord:"Editar Sub Familia"},toolbar:{items:[{cssClass:"buscador",text:t},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("subfamilies/excel",{})}}]},fields:{idSubFamilia:{key:!0,create:!1,edit:!1,list:!1},idFamilia:{title:"Familia",options:base_url+"/subfamilies/getFamilies"},SubFamilia:{title:"Sub Familia"},estado:{title:"Estado",values:{I:"Inactivo",A:"Activo"},type:"checkbox",defaultValue:"A"}},formCreated:function(e,t){t.form.find('input[name="Familia"]').attr("onkeypress","return soloLetras(event)"),$("#Edit-estado").parent().addClass("i-checks"),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click(),"A"==e.target.value?($("#Edit-estado").val("I"),$(".i-checks span").text("Inactivo")):($("#Edit-estado").val("A"),$(".i-checks span").text("Activo"))})},formSubmitting:function(e,t){var a=!0;return a=a&&t.form.find('input[name="Familia"]').required()}}),generateSearchForm("frm-search-SubFamily","LoadRecordsButtonSubFamily",function(){a.jtable("load",{search:$("#search_b").val()})},!0)}function t(e,t){e.state("subfamilies",{url:"/subfamilies",templateUrl:base_url+"/templates/subfamilies/base.html",controller:"SubFamilyCtrl"}),t.otherwise("/")}angular.module("sys.app.subfamilies").config(t).controller("SubFamilyCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope"]}(),function(){"use strict";angular.module("sys.app.technicians",[])}(),function(){"use strict";function e(e){e.chkState=function(){var e=w_state.prop("checked")?"Activo":"Inactivo";state_state.html(e)};var t=getFormSearch("frm-search-Technician","search_b","LoadRecordsButtonTechnician"),a=$("#table_container_Technician");a.jtable({title:"Lista de Técnicos",paging:!0,sorting:!0,actions:{listAction:base_url+"/technicians/list",createAction:base_url+"/technicians/create",updateAction:base_url+"/technicians/update",deleteAction:base_url+"/technicians/delete"},messages:{addNewRecord:"Nuevo Técnico",editRecord:"Editar Técnico"},toolbar:{items:[{cssClass:"buscador",text:t},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("technicians/excel",{})}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},descripcion:{title:"Técnico"},estado:{title:"Estado",values:{I:"Inactivo",A:"Activo"},type:"checkbox",defaultValue:"A"}},formCreated:function(e,t){t.form.find('input[name="Categoria"]').attr("onkeypress","return soloLetras(event)"),t.form.find('input[name="meta_cantidad"]').attr("onkeypress","return soloNumeros(event)"),t.form.find('input[name="meta_monto"]').attr("onkeypress","return validDecimals(event, this, 4)").attr("onblur","return roundDecimals(this, 2)"),$("#Edit-estado").parent().addClass("i-checks"),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click(),"A"==e.target.value?($("#Edit-estado").val("I"),$(".i-checks span").text("Inactivo")):($("#Edit-estado").val("A"),$(".i-checks span").text("Activo"))})},formSubmitting:function(e,t){var a=!0;return a=a&&t.form.find('input[name="Técnico"]').required(),a=a&&t.form.find('input[name="meta_cantidad"]').required(),a=a&&t.form.find('input[name="meta_monto"]').required()}}),generateSearchForm("frm-search-Technician","LoadRecordsButtonTechnician",function(){a.jtable("load",{search:$("#search_b").val()})},!0)}function t(e,t){e.state("technicians",{url:"/technicians",templateUrl:base_url+"/templates/technicians/base.html",controller:"TechnicianCtrl"}),t.otherwise("/")}angular.module("sys.app.technicians").config(t).controller("TechnicianCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope"]}(),function(){"use strict";angular.module("sys.app.transfers",[])}(),function(){"use strict";function e(e,t,a,i){function o(){et||(b=$("#modalTR"),Y=$("#modalTransportCompany"),x=$("#title-tr"),M=$("#rg_id"),U=$("#rg_entity_id"),O=$("#rg_document"),I=$("#rg_social_reason"),B=$("#rg_address"),F=$("#modalEntity"),k=$("#btn_action_req"),C=$("#modalRG"),w=$("#t_state"),A=$("#state_state"),R=$("#t_transfer_date"),S=$("#transfer_detail"),L=$("#t_warehouse_origin_id"),E=$("#t_warehouse_destination_id"),P=$("#rg_warehouse_origin_id"),q=$("#rg_warehouse_destination_id"),D=$("#t_name"),T=$("#t_type_id"),N=$("#t_transfer_id"),z=$("#rg_transport_company_id"),V=$("#rg_transport_company_name"),H=$("#rg_date"),K=$("#rg_date_transfer"),Z=$("#rg_address_destination"),X=$("#rg_local"),ee=$("#t_file_add"),ae=$("#rg_motive_transfer_id"),ie=$("#modalProject"),oe=$("#t_project_id"),ne=$("#t_project_code"),re=$("#t_project_description"),y=$("#modalProduct"),se=$("#rg_total"),ce=$("#rg_project_code"),le=$("#rg_project_description"),ue=$("#t_button_clear_id"),pe=$("#t_button_project_id"),ge=$("#rg_oc_entity"),$e=$("#rg_type_entity"),be=$("#state_entity"),Ce=$("#t_search_article_id"),xe=$("#t_save_button_transferProcess"),ke=$("#t_save_button_transfer"),we=$("#rg_observation"),Ae=$("#s_serial"),Re=$("#s_number"),Se=$("#modalSerial"),me=$("#rg_document_type_id"),fe=$("#rg_transport_unit"),ve=$("#rg_license_plate"),he=$("#rg_license"),_e=$("#rg_driver"),je=$("#rg_body_referral_guides"),Ee=$("#button_print_referral_guide"),Pe=$("#button_save_referral_guide"),Te=$("#modalState"),ee.fileinput({language:"es",uploadUrl:base_url+"/transfers/uploadTransfer",uploadAsync:!0,showUpload:!1}).on("filebatchselected",function(e,t){te="",ee.fileinput("upload")}).on("fileuploaded",function(e,a,i,o){if(!t.isUndefined(a.response.status)&&a.response.status){var r=a.response.uploaded;de=r,te=r,$(".file-caption-name").attr("title",r).html('<i class="glyphicon glyphicon-file kv-caption-icon"></i> '+r)}}).on("filecleared",function(e){te=""}).on("fileuploaderror",function(e,t,a){setTimeout(function(){$(".kv-upload-progress").find(".progress-bar").removeClass("progress-bar-success").addClass("progress-bar-danger").html(t.response.error)},200)}),R.datepicker({changeMonth:!0,changeYear:!0,dateFormat:"dd/mm/yy",beforeShow:function(){setTimeout(function(){$(".ui-datepicker").css("z-index",2052)})}}),K.datepicker({changeMonth:!0,changeYear:!0,dateFormat:"dd/mm/yy",beforeShow:function(){setTimeout(function(){$(".ui-datepicker").css("z-index",2052)})}}),C.on("hidden.bs.modal",function(e){b.attr("style","display:block;")}),C.on("show.bs.modal",function(e){b.attr("style","display:block; z-index:2030 !important")}),ie.on("hidden.bs.modal",function(e){b.attr("style","display:block;")}),ie.on("show.bs.modal",function(e){b.attr("style","display:block; z-index:2030 !important")}),y.on("hidden.bs.modal",function(e){b.attr("style","display:block;")}),y.on("show.bs.modal",function(e){b.attr("style","display:block; z-index:2030 !important")}),Se.on("hidden.bs.modal",function(e){C.attr("style","display:block;")}),Se.on("show.bs.modal",function(e){C.attr("style","display:block; z-index:2030 !important"),$("#show_loading").addClass("hide"),u(function(){$("#show_loading").removeClass("hide")})}),b.on("hidden.bs.modal",function(e){r()}),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(t){$(t.target).click(),e.chkState()}),_()),D.val(user_default),L.change(function(){j=L.val(),G=j}),E.change(function(){j===E.val()&&(i.textType({title:"",message:"El almacén destino no puede ser igual que el almacen origin.",type:"warning"}),E.val("")),W=E.val(),Q=E.find("option:selected").attr("data-address"),J=E.find("option:selected").attr("data-local")}),L.select2(),E.select2()}function r(){cleanRequired(),x.html(""),N.val(""),R.val("").prop("disabled",!1),oe.val(""),ne.val(""),re.val(""),L.val(Ue).prop("disabled",!1),E.val(Ue).prop("disabled",!1),S.html(""),T.val(1).prop("disabled",!1),w.prop("checked",!0).iCheck("update"),ze=[],ue.prop("disabled",!1),pe.prop("disabled",!1),ee.prop("disabled",!1),Ce.prop("disabled",!1),ke.prop("disabled",!1),xe.prop("disabled",!1),we.val(""),Ae.val(""),Re.val(""),ge.val(""),Pe.prop("disabled",!1),Ee.prop("disabled",!0),$("#condition_print_detail").hide(),Ye=[]}function n(){a.all("transfers/data_form","",function(e){!t.isUndefined(e.status)&&e.status&&($("#t_warehouse_origin_id").append('<option value="" selected>SELECCIONAR</option>'),t.each(e.warehouse,function(e){""===Ne&&(Ne=e.Value),$("#t_warehouse_origin_id").append('<option value="'+e.Value+'">'+e.DisplayText+"</option>"),$("#rg_warehouse_origin_id").append('<option value="'+e.Value+'">'+e.DisplayText+"</option>")}),$("#t_warehouse_destination_id").append('<option value="" selected>SELECCIONAR</option>'),t.each(e.warehouse,function(e){""===Ne&&(Ne=e.Value),$("#t_warehouse_destination_id").append('<option value="'+e.Value+'" data-address="'+e.Address+'"  data-local="'+e.Local+'" >'+e.DisplayText+"</option>"),$("#rg_warehouse_destination_id").append('<option value="'+e.Value+'" >'+e.DisplayText+"</option>")}),t.each(e.DocumentType,function(e){""===Fe&&(Fe=e.Value),"09"===e.Value&&$("#rg_document_type_id").append('<option value="'+e.Value+'" selected>'+e.DisplayText+"</option>")}),t.each(e.MotiveTransfer,function(e){""===Me&&(Me=e.Value),8===e.Value&&$("#rg_motive_transfer_id").append('<option value="'+e.Value+'" selected>'+e.DisplayText+"</option>")}),t.each(e.NumberSerial,function(e){Ye.push(e.DisplayText)}))},function(){n()})}function s(){o(),b.modal("show"),x.html("Nueva Transferencia"),k.addClass("hide")}function c(e){return e.stock_p<0||""===e.stock_p||null===e.stock_p?(i.showWarning({title:"",message:"El stock debe ser mayor que 0"}),!1):void(t.contains(ze,e.id)||(h(e.id,e.code_article,e.description_detail,e.um_id,e.average_cost,e.stock_p,e.transferred,e.state_transfer,e.toTransfer),ze.push(e.id)))}function l(e){o(),x.html("Editar Transferencia"),a.get("transfers/find",e,function(e){if(!t.isUndefined(e.status)&&e.status){var a=e.data;N.val(a.id),R.val(a.transfer_date),oe.val(a.project_id),ne.val(a.project_code),T.val(a.type_id),re.val(a.project_description),L.val(a.warehouse_origin_id).trigger("change"),E.val(a.warehouse_destination_id).trigger("change"),we.val(a.observation),Ae.val(""),Re.val(""),b.modal("show"),t.each(a.product,function(e){c(e)}),"1"===a.state_transfer&&(T.prop("disabled",!0),R.prop("disabled",!0),ue.prop("disabled",!0),L.prop("disabled",!0),E.prop("disabled",!0),pe.prop("disabled",!0),ee.prop("disabled",!0),Ce.prop("disabled",!0),ke.prop("disabled",!0),xe.prop("disabled",!0))}else i.textType({title:"",message:"Hubo un error al obtener  la transferencia. Intente nuevamente.",type:"error"})})}function d(){se.html(0);for(var e=0;e<He.length;e++){var t=$('<tr class="rowCon"></tr>'),a=$('<td class="text-center td_numbers">'+He[e]+"</td>"),i=$('<td class="text-center">'+Ge[e]+"</td>"),o=$("<td>"+Qe[e]+"</td>"),r=$('<td class="text-right">'+We[e]+"</td>"),n=$('<td class="text-right">'+Ke[e]+"</td>"),s=We[e]*Ke[e],c=$('<td class="text-right">'+s.toFixed(2)+"</td>");t.append(a).append(i).append(o).append(r).append(n).append(c),je.append(t);var l=parseFloat(se.html());isNaN(l)&&(l=0),l=parseFloat(l)+parseFloat(parseFloat(We[e])*parseFloat(Ke[e])),se.html(l.toFixed(2))}Ve=[],He=[],Ge=[],We=[],Qe=[]}function u(e){Ye=[],a.all("referral_guides/data_search","",function(a){!t.isUndefined(a.status)&&a.status&&t.each(a.NumberSerial,function(e){Ye.push(parseFloat(parseFloat(e.DisplayText)+""+parseFloat(e.DisplayNumber)))}),t.isFunction(e)&&e()},function(){u("")})}function p(){var e=!0;return e=e&&R.required(),e=e&&L.required(),e=e&&E.required(),e&&""===S.html()?(i.showWarning({title:"",message:"Debe agregar mínimo 1 artículo"}),!1):void(e&&("1"===T.val()?v():(P.val(G),q.val(W),K.val(R.val()),H.val(R.val()),Z.val(Q),X.val(J),ce.val(ne.val()),le.val(re.val()),t.each($(".p_productCode"),function(e,t){He[t]=$(e).html()}),t.each($(".p_productDescription"),function(e,t){Ge[t]=$(e).html()}),t.each($(".p_unit"),function(e,t){Qe[t]=$(e).html()}),t.each($(".p_productCost"),function(e,t){We[t]=$(e).html()}),t.each($(".p_toTransfer"),function(e,t){Ke[t]=$(e).val()}),v())))}function m(o){console.log("paso");var r=[],n=[],s=[],c=[];t.each($(".p_product"),function(e){var a=$(e).val();t.contains(r,a)||r.push(a)}),t.each($(".p_available"),function(e){n.push($(e).val())}),t.each($(".p_transferred"),function(e){s.push($(e).val())}),t.each($(".p_toTransfer"),function(e){c.push($(e).val())}),console.log(c);var l={id:Oe,warehouse_origin_id:L.val(),warehouse_destination_id:E.val(),product:r.join(","),available:n.join(","),transferred:s.join(","),toTransferred:c.join(","),project_id:oe.val(),transfer_id:Le,guide_date:H.val(),document_type_id:me.val(),entity_id:U.val(),transport_company_id:z.val(),transport_unit:fe.val(),license_plate:ve.val(),license:he.val(),driver:_e.val(),type_entity:$e.prop("checked")?1:0,date_transfer:K.val(),motive_id:ae.val(),observation:we.val(),serial:Ae.val(),number:Re.val(),order_purchase:ge.val(),state_description:De};i.confirm({title:"",message:"¿Está seguro?",confirm:"Si",cancel:"No"},function(){var r=""===Oe||0===Oe?0:Oe;Ie=r,a.updated("transfers/saveTransferReferral",r,l,function(a){if(!t.isUndefined(a.status)&&a.status){if(Oe=a.referral_id,console.log(Oe),i.textType({title:"",message:"La guía de remisión se guardó correctamente.",type:"success"}),"IMPRESO"===De){Se.modal("hide"),C.modal("hide"),b.modal("hide");var n={referral_guide_id:r};1===o?e.openDoc("referral_guides/referralGuideExcel",n):e.loadVouchersPDF("referral_guides/referralGuidePDF",n),i.confirm({title:"",message:"¿La guía de  remisión se imprimió correctamente?",confirm:"No",cancel:"Si"},function(){$("#condition_print_detail").show(),$("#t_body_detail_serial").html(""),t.each(a.data_row,function(e){f(e.id,e.code,e.number_guide)}),$("#modalState").modal("show")})}}else i.textType({title:"",message:"Hubo un error al guardar la guía de remisión. Intente nuevamente.",type:"error"})})})}function f(e,t,a){Be=!0;var i=$('<tr class="rowSerial" id="'+e+'"></tr>'),o=$('<td class="text-center sd_code">'+t+"</td>"),r=$('<td class="text-center sd_number_guide">'+a+"</td>"),n=($('<td class="text-center"></td>'),$('<td class="text-center"></td>')),s=$('<label class="checkbox-inline i-checks_serial"><input class="check_serial" value="'+e+'" type="checkbox"></label>');n.append(s),i.append(o).append(r).append(n),$("#t_body_detail_serial").append(i),generateCheckBox(".i-checks_serial")}function v(){var e=[],o=[],r=[],n=[];t.each($(".p_product"),function(a){var i=$(a).val();t.contains(e,i)||e.push(i)}),t.each($(".p_available"),function(e){o.push($(e).val())}),t.each($(".p_transferred"),function(e){r.push($(e).val())}),t.each($(".p_toTransfer"),function(e){n.push($(e).val())});var s=t.contains(n,"0");if(console.log(s),s===!0)return i.textType({title:"",message:"Ingrese una cantidad a transferir mayor que cero"}),!1;var c={id:N.val(),transfer_date:R.val(),warehouse_origin_id:L.val(),warehouse_destination_id:E.val(),type_id:T.val(),product:e.join(","),available:o.join(","),transferred:r.join(","),toTransferred:n.join(","),project_id:oe.val(),archive:de,state_transfer:ye};i.confirm({title:"",message:"¿Estas seguro?",confirm:"Si",cancel:"No"},function(){var e=""===N.val()?0:N.val();a.updated("transfers/saveTransfer",e,c,function(e){!t.isUndefined(e.status)&&e.status?(i.textType({title:"",message:"La transferencia  se guardó correctamente.",type:"success"}),Le=e.transfer_id,1!==ye&&(Se.modal("hide"),C.modal("hide"),b.modal("hide")),"1"===T.val()?(Se.modal("hide"),C.modal("hide"),b.modal("hide")):(xe.prop("disabled",!0),ke.prop("disabled",!0),je.html(""),d(),C.modal("show")),LoadRecordsButtonTransfer.click()):i.textType({title:"",message:"Hubo un error al guardar la transferencia. Intente nuevamente.",type:"error"})})})}function h(e,a,o,r,n,s,c,l,d){if($("#tr_p_"+e).length>0)return i.showWarning({title:"",message:"Ya se asigno este artículo"}),!1;var u=$('<tr class="Aggregated_products"  data-id="'+e+'"></tr>'),p=$('<td class="p_productCode">'+a+"</td>"),m=$('<td class="p_productDescription">'+o+"</td>"),f=t.isNull(r)?"":t.isUndefined(r)?"":r,v=$('<td class="p_unit">'+f+"</td>"),h=t.isNull(n)?"0":t.isUndefined(n)?"0":n,_=$('<td class="text-right p_productCost">'+h+"</td>"),g=t.isNull(s)?"0":t.isUndefined(s)?"0":s,b=$('<td class="text-right">'+g+'<input type="hidden" class="p_available" value="'+g+'" /></td>'),C=t.isNull(c)?"0":t.isUndefined(c)?"0":c,x=$('<td class="text-right">'+C+'<input type="hidden" class="p_transferred" value="'+C+'" /></td>');if("1"!==l)var k=t.isNull(d)?"0":t.isUndefined(d)?"0":d,w=$('<td class="text-right"><input type="text" value="'+k+'" id="inpRow'+e+'"  data-max="'+s+'" onclick="this.select()"   class="form-control input-xs text-right p_toTransfer" onkeypress="return soloNumeros(event)"></td>');else var w=$('<td class="text-right"><input type="text" value="0"   readonly class="form-control input-xs text-right p_toTransfer" onkeypress="return soloNumeros(event)"></td>');var A=$('<input type="hidden" class="p_product" value="'+e+'" />'),R=$('<input type="hidden" class="p_warehouse" value="'+L.val()+'" >');m.append(A).append(R);var j=$('<td class="text-center"></td>');if("1"!==l)var E=$('<button class="btn btn-danger btn-xs delProduct" data-id="'+e+'" type="button"><span class="fa fa-trash"></span></button>');else var E=$('<button class="btn btn-danger btn-xs" data-count="'+Ze+'" data-id="'+e+'" readonly type="button"><span class="fa fa-trash"></span></button>');j.append(E),u.append(p).append(m).append(v).append(_).append(b).append(x).append(w).append(j),S.append(u),$(".p_toTransfer").blur(function(){var e=$(this),t=e.attr("data-max");(e.val()>parseFloat(t)||""===e.val())&&i.showWarning({title:"Debe ingresar una cantidad menor o igual a la cantidad pedida",message:""},function(){e.select()})}),$(".delProduct").click(function(e){var a=$(this).closest("tr");i.confirm({title:"",message:"¿Está seguro que desea quitar esta artículo?",confirm:"Si",cancel:"No"},function(){var e=a.attr("data-id");a.remove(),ze=t.reject(ze,function(t){return t===parseInt(e)}),$("#LoadRecordsButtonProduct").click()}),e.preventDefault()}),y.modal("hide"),Ze++}function _(){et=!0;var e=getFormSearch("frm-search-project","search_project","LoadRecordsButtonProject"),t=$("#table_container_project");t.jtable({title:"Lista de Proyectos",paging:!0,sorting:!0,actions:{listAction:base_url+"/referral_guides/getProjects"},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},code:{title:"Código Proyecto",width:"5%",listClass:"text-center"},description:{title:"Proyecto"},select:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_p" data-id="'+e.record.id+'" data-code="'+e.record.code+'" data-description="'+e.record.description+'"><i class="fa fa-'+icon_select+' fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_p").click(function(e){var t=$(this).attr("data-id");oe.val(t),ne.val($(this).attr("data-code")),re.val($(this).attr("data-description")),ie.modal("hide"),S.empty(),e.preventDefault()})}}),generateSearchForm("frm-search-project","LoadRecordsButtonProject",function(){t.jtable("load",{search:$("#search_project").val()})},!1);var a=getFormSearch("frm-search-tc","search_tc","LoadRecordsButtonTC"),i=$("#table_container_transportCompany");i.jtable({title:"Empresas de Transporte",paging:!0,sorting:!0,actions:{listAction:base_url+"/referral_guides/listEntity"},toolbar:{items:[{cssClass:"buscador",text:a}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},nombre_entidad:{title:"Nombre"},Documento:{title:"Documento",width:"2%",listClass:"text-center"},direccion_legal:{title:"Dirección"},select:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_tc" data-id="'+e.record.id+'" data-name="'+e.record.nombre_entidad+'"><i class="fa fa-'+icon_select+' fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_tc").click(function(e){var t=$(this).attr("data-id");z.val(t),V.val($(this).attr("data-name")),Y.modal("hide"),e.preventDefault()})}}),generateSearchForm("frm-search-tc","LoadRecordsButtonTC",function(){i.jtable("load",{search:$("#search_tc").val()})},!1);var o=getFormSearch("frm-search-entity","search_entity","LoadRecordsButtonEntity"),r=$("#table_container_entity");r.jtable({title:"Lista de Entidades",paging:!0,sorting:!0,actions:{listAction:base_url+"/referral_guides/listEntity"},toolbar:{items:[{cssClass:"buscador",text:o}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},nombre_entidad:{title:"Nombre"},Documento:{title:"Documento",width:"2%",listClass:"text-center"},direccion_legal:{title:"Dirección"},select:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_e" data-code="'+e.record.id+'" data-name="'+e.record.nombre_entidad+'"data-document="'+e.record.Documento+'"data-address="'+e.record.direccion_legal+'" ><i class="fa fa-'+icon_select+' fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_e").click(function(e){var t=$(this).attr("data-code"),a=$(this).attr("data-name"),i=$(this).attr("data-document"),o=$(this).attr("data-address");U.val(t).removeClass("border-red"),I.val(a).removeClass("border-red"),O.val(i).removeClass("border-red"),B.val(o).removeClass("border-red"),F.modal("hide"),e.preventDefault()})}}),generateSearchForm("frm-search-entity","LoadRecordsButtonEntity",function(){r.jtable("load",{search:$("#search_entity").val()})},!1);var n=getFormSearch("frm-search-product","search_product","LoadRecordsButtonProduct"),s=$("#table_container_pr");s.jtable({title:"Lista de Artículos ",paging:!0,sorting:!0,selecting:!0,multiselect:!0,selectingCheckboxes:!0,selectOnRowClick:!1,actions:{listAction:base_url+"/transfers/getArticlesWithWithoutProject"},toolbar:{
items:[{cssClass:"buscador",text:n}]},fields:{id:{key:!0,edit:!1,create:!1,list:!1},code_article:{title:"Código",width:"2%",listClass:"text-center"},description_detail:{title:"Descripción"},average_cost:{title:"Costo",width:"2%",listClass:"text-right"},stock_p:{title:"Stock",width:"2%",listClass:"text-right"},um_id:{title:"Unidad Medida",edit:!1,create:!1,list:!1}},recordsLoaded:function(e,t){$(".jtable-selecting-column input").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click()})}}),generateSearchForm("frm-search-product","LoadRecordsButtonProduct",function(){s.jtable("load",{search:$("#search_product").val(),warehouse_id:L.val(),items:ze,project_id:oe.val()})},!1)}function g(){$(".jtable-column-header-selecting input").prop("checked",!1).iCheck("update"),$(".jtable-row-selected").removeClass("jtable-row-selected")}moment.locale("es");var b,y,C,x,k,w,A,R,S,j,L,E,P,q,D,T,N,F,M,U,O,I,B,Y,z,V,H,G,W,K,Q,Z,J,X,ee,te,ae,ie,oe,re,ne,se,ce,le,de,ue,pe,me,fe,ve,he,_e,ge,$e,be,ye,Ce,xe,ke,we,Ae,Re,Se,je,Le,Ee,Pe,qe,De,Te,Ne=($("#reqDates"),""),Fe="",Me="",Ue="",Oe=0,Ie=0,Be=!1,Ye=[];e.chkState=function(){var e=w.prop("checked")?"Activo":"Inactivo";A.html(e);var t=$e.prop("checked")?"Si":"No";be.html(t)},e.printReferralGuideTransfer=function(){Se.modal("show")},e.addDetail=function(){var e=$("#table_container_pr").jtable("selectedRows");return e.length>0?(e.each(function(){var e=$(this).data("record");return 0===parseFloat(e.stock_p)?(i.showWarning({title:"",message:"El stock debe ser mayor que 0"}),!1):void c(e)}),void g()):(i.textType({title:"",message:"Debe seleccionar al menos un artículo a asignar.",type:"warning"}),!1)},n();var ze=[];u(""),e.saveTransferProcess=function(){ye=1,p()},e.saveTransfer=function(){ye=0,p()},e.saveReferralGuideTransfer=function(){ye=2,De="REGISTRADO";var e=!0;e=e&&H.required(),e&&activeTab("tb_entity"),e=e&&O.required(),e&&activeTab("tb_company"),e=e&&V.required(),e&&activeTab("tb_detail"),e=e&&K.required(),e&&(qe=1,m(""),Pe.prop("disabled",!0),Ee.prop("disabled",!1))},e.saveSerial=function(e){var a=!0;if(a=a&&Ae.required(),a=a&&Re.required()){qe=0,De="IMPRESO";var o=!1,r=parseFloat(parseFloat($("#s_serial").val())+""+parseFloat($("#s_number").val()));if(t.each(Ye,function(e){parseFloat(e)===r&&(o=!0)}),o===!0)return i.textType({title:"",message:"Este numero de guía de remisión ya existe.",type:"warning"}),!1;var n,s,c=0;n=parseFloat(t.max(t.compact(Ye))),s=t.isFinite(n),c=s===!0?1:0;var l=n+1;if(console.log(c),0!==c&&l!==r)return i.textType({title:"",message:"Los números de las guias de remisión deben ser continuas .",type:"warning"}),!1;m(e)}},e.clearProject=function(){oe.val(""),ne.val(""),re.val(""),S.html("")},e.openEntity=function(){$("#LoadRecordsButtonEntity").click(),F.modal("show")},e.openTransportCompany=function(){$("#LoadRecordsButtonTC").click(),Y.modal("show")},e.openProject=function(){ze=[],$("#LoadRecordsButtonProject").click(),ie.modal("show")},e.conditionPrint=function(){Te.modal("hide"),LoadRecordsButtonTransfer.click()},e.IncorrectlyPrinted=function(){var e=[],o=[],r=!1;if(t.each($(".check_serial"),function(t){$(t).prop("checked")&&(e.push($(t).val()),r=!0),o.push($(t).val())}),r===!1)return i.textType({title:"",message:"Debe Seleccionar Al menos una Guía de remisión "}),!1;var n={id:Ie,state_description:"ANULADO",incorrectlyPrinted:e.join(","),a_allPrinted:o.join(",")};i.confirm({title:"",message:"¿Está seguro ejecutar esta operación?",confirm:"Si",cancel:"No"},function(){var e=""===Ie?0:Ie;a.updated("referral_guides/saveSerial",e,n,function(e){!t.isUndefined(e.status)&&e.status?(i.textType({title:"",message:"Datos procesados correctamente.",type:"success"}),Te.modal("hide"),LoadRecordsButtonTransfer.click()):i.textType({title:"",message:"Hubo un error al generar la guia de gemisión. Intente nuevamente.",type:"error"})})})},e.notPrinted=function(){var e=[],o=!1;if(t.each($(".check_serial"),function(t){e.push($(t).val()),$(t).prop("checked")&&(o=!0)}),o===!0)return i.textType({title:"",message:"No se puede seleccionar una guía de remisión "}),!1;var r={id:Ie,state_description:"NO IMPRESO",serial:"",number:"",noPrinted:e.join(",")};i.confirm({title:"",message:"¿Está seguro ejecutar esta operación?",confirm:"Si",cancel:"No"},function(){var e=""===Ie?0:Ie;a.updated("referral_guides/saveSerial",e,r,function(e){!t.isUndefined(e.status)&&e.status?(i.textType({title:"",message:"Datos procesados correctamente.",type:"success"}),Te.modal("hide"),LoadRecordsButtonTransfer.click()):i.textType({title:"",message:"Hubo un error al generar la guia de remisión. Intente nuevamente.",type:"error"})})})},e.openProducts=function(){return""===L.val()?(i.showWarning({title:"",message:"Debe seleccionar un almacén de origen"}),!1):void($(".p_warehouse").val()!==L.val()&&""!==S.html()?i.confirm({title:"",message:"¿Está seguro que desea cambiar de almacen origen?",confirm:"Si",cancel:"No"},function(){S.html(""),ze=[]}):($("#LoadRecordsButtonProduct").click(),y.modal("show")))};var Ve=[],He=[],Ge=[],We=[],Ke=[],Qe=[],Ze=0,Je=getFormSearch("frm-search-transfer","search_transfer","LoadRecordsButtonTransfer"),Xe=$("#table_container_transfer");Xe.jtable({title:"Lista de Transferencia",paging:!0,sorting:!0,actions:{listAction:base_url+"/transfers/list"},toolbar:{items:[{cssClass:"buscador",text:Je},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("transfers/excel",{})}},{cssClass:"btn-success",text:'<i class="fa fa-plus"></i> Nueva Transferencia',click:function(){s()}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},transfer_date:{title:"Fecha",listClass:"text-center",width:"3%"},name:{title:"Usuario",list:show_list_,width:"5%"},warehouse_o:{title:show_list_?"Almacén Origen":"Alm. Origen"},warehouse_d:{title:show_list_?"Almacén Destino":"Alm. Destino"},type_description:{title:"Tipo",width:"3%"},state_description:{title:"Estado",width:"2%"},edit:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return"0"===e.record.state_transfer?'<a href="javascript:void(0)" title="Editar" class="edit_r" data-code="'+e.record.id+'"><i class="fa fa-pencil-square-o fa-1-5x fa-green"></i></a><a href="javascript:void(0)" title="Eliminar" class="delete_r" data-code="'+e.record.id+'"><i class="fa fa-trash fa-1-5x fa-red"></i></a>':'<a href="javascript:void(0)" title="Ver" class="edit_r" data-code="'+e.record.id+'"><i class="fa fa-eye fa-1-5x fa-green"></i></a>'}}},recordsLoaded:function(e,t){$(".edit_r").click(function(e){var t=$(this).attr("data-code");l(t),e.preventDefault()})}}),generateSearchForm("frm-search-transfer","LoadRecordsButtonTransfer",function(){Xe.jtable("load",{search:$("#search_transfer").val()})},!0);var et=!1}function t(e,t){e.state("transfers",{url:"/transfers",templateUrl:base_url+"/templates/transfers/base.html",controller:"TransferCtrl"}),t.otherwise("/")}angular.module("sys.app.transfers").config(t).controller("TransferCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.typechanges",[])}(),function(){"use strict";function e(e){var t=getFormSearch("frm-search-typechange","search_tc","LoadRecordsButtonTypeChange"),a=$("#table_container_typechange");a.jtable({title:"Lista de Tipos de Cambios",paging:!0,sorting:!0,actions:{listAction:base_url+"/type_change/list",createAction:base_url+"/type_change/create",updateAction:base_url+"/type_change/update",deleteAction:base_url+"/type_change/delete"},messages:{addNewRecord:"Nuevo Tipo de Cambio",editRecord:"Editar Tipo de Cambio"},toolbar:{items:[{cssClass:"buscador",text:t},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("type_change/excel",{})}}]},fields:{id:{title:"Fecha-id",type:"date",key:!0,create:!1,edit:!1,list:!1},Fecha:{title:"Fecha",type:"date",listClass:"text-center",displayFormat:"dd/mm/yy"},IdMoneda:{title:"Moneda",listClass:"text-right",options:base_url+"/type_change/getMonedas",defaultValue:2},Compra:{title:"Sunat Compra",listClass:"text-right"},Venta:{title:"Sunat Venta",listClass:"text-right"},cambioComercialCompra:{title:"Comercial Compra",listClass:"text-right"},cambioComercialVenta:{title:"Comercial Venta",listClass:"text-right"}},formCreated:function(e,t){t.form.find('input[name="Compra"]').attr("onkeypress","return validDecimals(event, this, 4)").attr("onblur","return roundDecimals(this, 3)"),t.form.find('input[name="Venta"]').attr("onkeypress","return validDecimals(event, this, 4)").attr("onblur","return roundDecimals(this, 3)"),t.form.find('input[name="cambioComercialCompra"]').attr("onkeypress","return validDecimals(event, this, 4)").attr("onblur","return roundDecimals(this, 3)"),t.form.find('input[name="cambioComercialVenta"]').attr("onkeypress","return validDecimals(event, this, 4)").attr("onblur","return roundDecimals(this, 3)");var a=t.form.find('input[name="Fecha"]'),i=t.form.find('select[name="IdMoneda"]');""!==a.val()&&(a.prop("disabled",!0),i.prop("disabled",!0))},formSubmitting:function(e,t){var a=!0;return a=a&&t.form.find('input[name="Fecha"]').required(),a=a&&t.form.find('input[name="Compra"]').required(),a=a&&t.form.find('input[name="Venta"]').required(),a=a&&t.form.find('input[name="cambioComercialCompra"]').required(),a=a&&t.form.find('input[name="cambioComercialVenta"]').required()}}),generateSearchForm("frm-search-typechange","LoadRecordsButtonTypeChange",function(){a.jtable("load",{search:$("#search_tc").val()})},!0)}function t(e,t){e.state("type_change",{url:"/type_change",templateUrl:base_url+"/templates/typechanges/base.html",controller:"TypeChangeCtrl"}),t.otherwise("/")}angular.module("sys.app.typechanges").config(t).controller("TypeChangeCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope"]}(),function(){"use strict";angular.module("sys.app.typeCustomers",[])}(),function(){"use strict";function e(e){e.chkState=function(){var e=w_state.prop("checked")?"Activo":"Inactivo";state_state.html(e)};var t=getFormSearch("frm-search-TypeCustomer","search_b","LoadRecordsButtonTypeCustomer"),a=$("#table_container_TypeCustomer");a.jtable({title:"Lista de Tipos de Clientes",paging:!0,sorting:!0,actions:{listAction:base_url+"/typeCustomers/list",createAction:base_url+"/typeCustomers/create",updateAction:base_url+"/typeCustomers/update",deleteAction:base_url+"/typeCustomers/delete"},messages:{addNewRecord:"Nuevo Tipo Cliente",editRecord:"Editar Tipo Cliente"},toolbar:{items:[{cssClass:"buscador",text:t},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("typeCustomers/excel",{})}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},descripcion:{title:"Tipo Cliente"},estado:{title:"Estado",values:{I:"Inactivo",A:"Activo"},type:"checkbox",defaultValue:"A"}},formCreated:function(e,t){t.form.find('input[name="Categoria"]').attr("onkeypress","return soloLetras(event)"),$("#Edit-estado").parent().addClass("i-checks"),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click(),"A"==e.target.value?($("#Edit-estado").val("I"),$(".i-checks span").text("Inactivo")):($("#Edit-estado").val("A"),$(".i-checks span").text("Activo"))})},formSubmitting:function(e,t){var a=!0;return a=a&&t.form.find('input[name="Categoria"]').required()}}),generateSearchForm("frm-search-TypeCustomer","LoadRecordsButtonTypeCustomer",function(){a.jtable("load",{search:$("#search_b").val()})},!0)}function t(e,t){e.state("typeCustomers",{url:"/typeCustomers",templateUrl:base_url+"/templates/typeCustomers/base.html",controller:"TypeCustomerCtrl"}),t.otherwise("/")}angular.module("sys.app.typeCustomers").config(t).controller("TypeCustomerCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope"]}(),function(){"use strict";angular.module("sys.app.typeObjets",[])}(),function(){"use strict";function e(e){e.chkState=function(){var e=w_state.prop("checked")?"Activo":"Inactivo";state_state.html(e)};var t=getFormSearch("frm-search-TypeObjet","search_b","LoadRecordsButtonTypeObjet"),a=$("#table_container_TypeObjet");a.jtable({title:"Lista de Tipos de Objetivos",paging:!0,sorting:!0,actions:{listAction:base_url+"/typeObjets/list",createAction:base_url+"/typeObjets/create",updateAction:base_url+"/typeObjets/update",deleteAction:base_url+"/typeObjets/delete"},messages:{addNewRecord:"Nuevo Tipo de Objetivo",editRecord:"Editar Tipo de Objetivo"},toolbar:{items:[{cssClass:"buscador",text:t},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("typeObjets/excel",{})}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},descripcion:{title:"Tipo de Objetivo"},estado:{title:"Estado",values:{I:"Inactivo",A:"Activo"},type:"checkbox",defaultValue:"A"}},formCreated:function(e,t){t.form.find('input[name="Categoria"]').attr("onkeypress","return soloLetras(event)"),$("#Edit-estado").parent().addClass("i-checks"),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click(),"A"==e.target.value?($("#Edit-estado").val("I"),$(".i-checks span").text("Inactivo")):($("#Edit-estado").val("A"),$(".i-checks span").text("Activo"))})},formSubmitting:function(e,t){var a=!0;return a=a&&t.form.find('input[name="Categoria"]').required()}}),generateSearchForm("frm-search-TypeObjet","LoadRecordsButtonTypeObjet",function(){a.jtable("load",{search:$("#search_b").val()})},!0)}function t(e,t){e.state("typeObjets",{url:"/typeObjets",templateUrl:base_url+"/templates/typeObjets/base.html",controller:"TypeObjetCtrl"}),t.otherwise("/")}angular.module("sys.app.typeObjets").config(t).controller("TypeObjetCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope"]}(),function(){"use strict";angular.module("sys.app.typeServicioMants",[])}(),function(){"use strict";function e(e){e.chkState=function(){var e=w_state.prop("checked")?"Activo":"Inactivo";state_state.html(e)};var t=getFormSearch("frm-search-TypeServicioMant","search_b","LoadRecordsButtonTypeServicioMant"),a=$("#table_container_TypeServicioMant");a.jtable({title:"Lista de Servicio de Mantenimiento",paging:!0,sorting:!0,actions:{listAction:base_url+"/typeServicioMants/list",createAction:base_url+"/typeServicioMants/create",updateAction:base_url+"/typeServicioMants/update",deleteAction:base_url+"/typeServicioMants/delete"},messages:{addNewRecord:"Nuevo Servicio de Mantenimiento",editRecord:"Editar Servicio de Mantenimiento"},toolbar:{items:[{cssClass:"buscador",text:t},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("typeServicioMants/excel",{})}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},descripcion:{title:"Tip. de Servicio"},estado:{title:"Estado",values:{I:"Inactivo",A:"Activo"},type:"checkbox",defaultValue:"A"}},formCreated:function(e,t){t.form.find('input[name="Categoria"]').attr("onkeypress","return soloLetras(event)"),$("#Edit-estado").parent().addClass("i-checks"),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click(),"A"==e.target.value?($("#Edit-estado").val("I"),$(".i-checks span").text("Inactivo")):($("#Edit-estado").val("A"),$(".i-checks span").text("Activo"))})},formSubmitting:function(e,t){var a=!0;return a=a&&t.form.find('input[name="Categoria"]').required()}}),generateSearchForm("frm-search-TypeServicioMant","LoadRecordsButtonTypeServicioMant",function(){a.jtable("load",{search:$("#search_b").val()})},!0)}function t(e,t){e.state("typeServicioMants",{url:"/typeServicioMants",templateUrl:base_url+"/templates/typeServicioMants/base.html",controller:"TypeServicioMantCtrl"}),t.otherwise("/")}angular.module("sys.app.typeServicioMants").config(t).controller("TypeServicioMantCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope"]}(),function(){"use strict";angular.module("sys.app.users",[])}(),function(){"use strict";function e(e,t,a){var i=getFormSearch("frm-search-u","search_u","LoadRecordsButtonU"),o=$("#table_container_user");o.jtable({title:"Lista de Usuarios",paging:!0,sorting:!0,actions:{listAction:base_url+"/users/list",createAction:base_url+"/users/create",updateAction:base_url+"/users/update",deleteAction:base_url+"/users/delete"},messages:{addNewRecord:"Nuevo usuario",editRecord:"Editar usuario"},toolbar:{items:[{cssClass:"buscador",text:i}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},name:{title:"Nombres"},username:{title:"Usuario"},password:{title:"Contraseña",type:"password",edit:!1,list:!1},profile_id:{title:"Perfil",options:base_url+"/users/getProfiles"},expiration_password:{title:"Expiración de Contraseña",type:"checkbox",values:{0:"",1:""},defaultValue:1,list:!1},edit:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a data-target="#" class="reset-user" data-id="'+e.record.id+'" title="Resetear Contraseña"><i class="fa fa-refresh fa-1-5x"></i></a>'}}},formCreated:function(e,t){t.form.find('input[name="name"]').attr("onkeypress","return soloLetras(event)"),t.form.find('select[name="supervisor"]').select2(),$("#Edit-expiration_password").parent().addClass("i-checks"),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click()})},formSubmitting:function(e,t){var a=!0;return a=a&&t.form.find('input[name="name"]').required(),a=a&&t.form.find('input[name="username"]').required(),a=a&&t.form.find('input[name="password"]').required()},recordsLoaded:function(i,o){$(".reset-user").click(function(i){var o=$(this).attr("data-id");e.prompt({title:"Resetear Contraseña",message:"Ingrese la nueva contraseña que usara el usuario para ingresar el sistema",inputType:"password",placeholder:"Ingrese contraseña",showLoaderOnConfirm:!0,error_message:"Ingrese correctamente la contraseña"},function(i){t.updated("users/reset",o,{pass:i},function(t){!a.isUndefined(t.status)&&t.status?e.textType({title:"",message:"La contraseña del usuario se reseteó correctamente.",type:"success"}):e.textType({title:"",message:"Hubo un error al resetear la contraseña. Intente nuevamente.",type:"error"})})}),i.preventDefault()})}}),generateSearchForm("frm-search-u","LoadRecordsButtonU",function(){o.jtable("load",{search:$("#search_u").val()})},!0)}function t(e,t){e.state("users",{url:"/users",templateUrl:base_url+"/templates/users/base.html",controller:"UserCtrl"}),t.otherwise("/")}angular.module("sys.app.users").config(t).controller("UserCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["AlertFactory","RESTService","_"]}(),function(){"use strict";angular.module("sys.app.valorizations",[])}(),function(){"use strict";function e(e,t){function a(){r=$("#modalV"),n=$("#modalSP"),s=$("#titleV"),p=$("#btn_return"),m=$(".show_pv1"),f=$(".show_expense"),r.on("hidden.bs.modal",function(e){p.prop("disabled",!1),m.removeClass("hide"),f.removeClass("hide"),activeTab("tab1")}),n.on("hidden.bs.modal",function(e){activeTab("levels"),r.attr("style","display:block; overflow-y: auto;")}),n.on("show.bs.modal",function(e){r.attr("style","display:block; z-index:2030 !important")}),$(".select_front").select2({language:"es",placeholder:"Buscar frente..."}),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click()})}function i(){p.prop("disabled",!0),m.addClass("hide")}function o(){activeTab("tab3"),f.addClass("hide")}moment.locale("es");var r,n,s,c=moment().startOf("month"),l=moment().endOf("month"),d=$("#reqDates"),u=function(e,t){d.find("span").html(e.format("MMM D, YYYY")+" - "+t.format("MMM D, YYYY"))};generateDateRangePicker(d,c,l,u),u(c,l);var p,m,f;e.editSP=function(){a(),$("#titleModalSP").html("Editar Subproyecto"),$("#input_sp").val("LINEA PRIMARIA"),n.modal("show"),$(".chk_sp").prop("checked",!0).iCheck("update")},e.addSubProjects=function(){a(),$("#titleModalSP").html("Agregar Subproyecto"),$("#input_sp").val(""),n.modal("show"),$(".chk_sp").prop("checked",!1).iCheck("update")},$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click()});var v=getFormSearch("frm-search-p","search_p","LoadRecordsButtonP"),h='<select id="states" class="search_input"><option value="">Todos los Estados</option><option value="">Registrado</option><option value="">Aprobado</option><option value="">Facturado</option></select>',_=$("#table_container_v");_.jtable({title:"Lista de Valorizaciones",paging:!0,sorting:!0,actions:{listAction:function(e,t){return{Result:"OK",Records:[{code:"00047",descripcion:"VALORIZACIÓN N° 016 - FEBRERO DEL 2017",proyecto:"CONEXIONES MASIVAS",total:"12,000.00",estado:"REGISTRADO"},{code:"00048",descripcion:"VALORIZACIÓN N° 017 - FEBRERO DEL 2017",proyecto:"ENOSA_CONSORCIO SANTA CRUZ",total:"9,000.00",estado:"APROBADO"},{code:"00020",descripcion:"VALORIZACIÓN N° 018 - FEBRERO DEL 2017",proyecto:"OI - EECOL-CERCADO",total:"8,000.00",estado:"FACTURADO"},{code:"00023",descripcion:"VALORIZACIÓN N° 019 - FEBRERO DEL 2017",proyecto:"ENSA_CONSORCIO SAN JUDAS TADEO-SELVA CENTRAL",total:"7,000.00",estado:"REGISTRADO"}],TotalRecordCount:4}},deleteAction:base_url+"/projects/delete"},toolbar:{items:[{cssClass:"buscador",text:h},{cssClass:"buscador",text:v},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){window.open(base_url+"/purchase_orders/excel")}},{cssClass:"btn-success",text:'<i class="fa fa-plus"></i> Nueva Valorización',click:function(){a(),s.html("VALORIZACIÓN N° 016 - FEBRERO DEL 2017"),r.modal("show")}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},code:{title:"Código",width:"2%"},descripcion:{title:"Descripción"},proyecto:{title:"Proyecto",list:show_list_},total:{title:"Total",listClass:"text-right",width:"3%"},estado:{title:"Estado",width:"3%"},edit:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return'<a href="javascript:void(0)" title="Editar" class="edit_p" data-code="'+e.record.id+'"><i class="fa fa-edit fa-1-5x fa-green"></i></a>'}}},recordsLoaded:function(e,t){$(".edit_p").click(function(e){a(),s.html("Editar Proyecto"),r.modal("show"),e.preventDefault()}),$(".activity_p").click(function(e){a(),s.html("Recursos por Actividad - Proyecto"),i(),r.modal("show"),e.preventDefault()}),$(".expense_p").click(function(e){a(),s.html("Gastos - Proyecto"),o(),r.modal("show"),e.preventDefault()})}}),generateSearchForm("frm-search-p","LoadRecordsButtonP",function(){_.jtable("load",{search:$("#search_p").val()})},!0),e.showMat=function(e){console.log(e),$(".mat").prop("checked",!1).iCheck("update"),$("#mat"+e).prop("checked",!0).iCheck("update"),$(".show_list_mat").addClass("hide"),$(".show_list"+e).removeClass("hide"),1==e||2==e?($(".show_1").addClass("hide"),$(".show_2").removeClass("hide")):($(".show_1").removeClass("hide"),$(".show_2").addClass("hide"))},setTimeout(function(){e.showMat(3)},2e3)}function t(e,t){e.state("valorizations",{url:"/valorizations",templateUrl:base_url+"/templates/valorizations/base.html",controller:"ValorizationCtrl"}),t.otherwise("/")}angular.module("sys.app.valorizations").config(t).controller("ValorizationCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.vehiculos_terceros",[])}(),function(){"use strict";function e(e){e.chkState=function(){var e=w_state.prop("checked")?"Activo":"Inactivo";state_state.html(e)};var t=getFormSearch("frm-search-Vehiculos_tercero","search_b","LoadRecordsButtonVehiculos_tercero"),a=$("#table_container_Vehiculos_tercero");a.jtable({title:"Lista de Vehículos Terceros",paging:!0,sorting:!0,actions:{listAction:base_url+"/vehiculos_terceros/list",createAction:base_url+"/vehiculos_terceros/create",updateAction:base_url+"/vehiculos_terceros/update",deleteAction:base_url+"/vehiculos_terceros/delete"},messages:{addNewRecord:"Nuevo Vehículo",editRecord:"Editar Vehículo"},toolbar:{items:[{cssClass:"buscador",text:t},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("vehiculos_terceros/excel",{})}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},idMarca:{title:"Marca",options:base_url+"/vehiculos_terceros/getMarca"},idModelo:{title:"Modelo",dependsOn:"idMarca",options:function(e){if("list"==e.source){var t=base_url+"/vehiculos_terceros/getModelo/"+e.dependedValues.idMarca;return t}var t=base_url+"/vehiculos_terceros/getModelo/"+e.dependedValues.idMarca;return t}},motor:{title:"Motor"},n_chasis:{title:"Chasis"},anio_fabricacion:{title:"Año Fabricación"},color:{title:"Color"},placa:{title:"Placa"}},formCreated:function(e,t){t.form.find('input[name="Categoria"]').attr("onkeypress","return soloLetras(event)"),$("#Edit-estado").parent().addClass("i-checks"),t.form.find('input[name="anio_fabricacion"]').attr("onkeypress","return soloNumeros(event)"),$('input[name="anio_fabricacion"]').attr("maxlength",4),$('input[name="placa"]').attr("maxlength",10),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(e){$(e.target).click(),"A"==e.target.value?($("#Edit-estado").val("I"),$(".i-checks span").text("Inactivo")):($("#Edit-estado").val("A"),$(".i-checks span").text("Activo"))})},formSubmitting:function(e,t){var a=!0;return a=a&&t.form.find('input[name="Categoria"]').required()}}),generateSearchForm("frm-search-Vehiculos_tercero","LoadRecordsButtonVehiculos_tercero",function(){a.jtable("load",{search:$("#search_b").val()})},!0)}function t(e,t){e.state("vehiculos_terceros",{url:"/vehiculos_terceros",templateUrl:base_url+"/templates/vehiculos_terceros/base.html",controller:"Vehiculos_terceroCtrl"}),t.otherwise("/")}angular.module("sys.app.vehiculos_terceros").config(t).controller("Vehiculos_terceroCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope"]}(),function(){"use strict";angular.module("sys.app.warehouses",[])}(),function(){"use strict";function e(e,t,a,i){function o(){U||(p=$("#modalWA"),f=$("#title-war"),m=$("#modalUsuario"),v=$("#w_user_body"),h=$("#warehouse_id"),_=$("#w_description"),g=$("#w_code_internal"),b=$("#w_type_id"),y=$("#w_physical_location"),C=$("#w_address"),x=$("#w_state"),R=$("#w_local"),k=$("#w_project_id"),w=$("#w_project_code"),A=$("#w_project_description"),L=$("#modalProject"),E=$("#w_description_localizacion"),P=$("#w_code_localizacion"),q=$("#p_state_localizacion"),D=$("#p_loc_text"),T=$("#w_tienda_body"),S=$("#state_local"),j=$("#state_state"),m.on("hidden.bs.modal",function(e){p.attr("style","display:block;")}),m.on("show.bs.modal",function(e){p.attr("style","display:block; z-index:2030 !important")}),L.on("hidden.bs.modal",function(e){p.attr("style","display:block;")}),L.on("show.bs.modal",function(e){p.attr("style","display:block; z-index:2030 !important")}),p.on("hidden.bs.modal",function(e){n()}),u(),$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green"}).on("ifChanged",function(t){$(t.target).click(),e.chkState()}))}function r(){E=$("#w_description_localizacion"),P=$("#w_code_localizacion"),q=$("#p_state_localizacion"),D=$("#p_loc_text"),E.val(""),P.val(""),q.prop("checked",!0).iCheck("update"),e.chkState()}function n(){cleanRequired(),f.html(""),h.val(""),_.val(""),C.val(""),w.val(""),A.val(""),R.val(""),g.val(""),x.prop("checked",!0).iCheck("update"),y.prop("checked",!0).iCheck("update"),q.prop("checked",!0).iCheck("update"),e.chkState(),v.html(""),E.val(""),P.val(""),T.html(""),N=[],activeTab("almacen")}function s(){o(),p.modal("show"),f.html("Nuevo Almacén")}function c(e,t,a,o,n){console.log(t);var s="";s="I"==o?"Inactivo":"Activo";var c=$('<tr id="tr_loca_'+e+'"></tr>'),l=$("<td>"+t+"</td>"),d=$("<td>"+a+"</td>"),u=$("<td>"+s+"</td>"),p=$('<input type="hidden" class="idLocalizacion_v" value="'+n+'" />'),m=$('<input type="hidden" class="w_locali_co" value="'+t+'" />'),f=$('<input type="hidden" class="w_locali_des" value="'+a+'" />'),v=$('<input type="hidden" class="w_locali_est" value="'+o+'" />');l.append(m).append(p),d.append(f),u.append(v);var h=$('<td class="text-center"></td>'),_=$('<button class="btn btn-danger btn-xs delWarehouseLoca" data-id="'+e+'" type="button"><span class="fa fa-trash"></span></button>');h.append(_),c.append(l).append(d).append(u).append(h),T.append(c),r(),$(".delWarehouseLoca").click(function(e){var t=$(this).attr("data-id");i.confirm({title:"",message:"¿Está seguro que desea quitar esta localización?",confirm:"Si",cancel:"No"},function(){$("#tr_loca_"+t).remove(),N.push(t),console.log(N)}),e.preventDefault()})}function l(r){o(),f.html("Editar Almacén"),a.get("warehouses/find",r,function(a){if(!t.isUndefined(a.status)&&a.status){var o=a.data;h.val(o.id),b.val(o.type_id);var r="1"==o.state;x.prop("checked",r).iCheck("update");var n="1"==o.physical_location;y.prop("checked",n).iCheck("update"),e.chkState(),_.val(o.description),C.val(o.address),R.val(o.local),g.val(o.code_internal),w.val(o.idTienda),A.val(o.Tienda),p.modal("show"),t.each(o.users,function(e){d(e.id,e.username,e.name)}),t.each(o.localizacion,function(e){c(e.idLocalizacion,e.codigo,e.descripcion,e.estado,e.idLocalizacion)})}else i.textType({title:"",message:"Hubo un error al obtener el almacén. Intente nuevamente.",type:"error"})})}function d(e,t,a){if($("#tr_b_"+e).length>0)return i.showWarning({title:"",message:"Ya se asignó este Usuario"}),!1;var o=$('<tr id="tr_b_'+e+'"></tr>'),r=$("<td>"+t+"</td>"),n=$("<td>"+a+"</td>"),s=$('<input type="hidden" class="w_user" value="'+e+'" />');r.append(s);var c=$('<td class="text-center"></td>'),l=$('<button class="btn btn-danger btn-xs delWarehouse" data-id="'+e+'" type="button"><span class="fa fa-trash"></span></button>');c.append(l),o.append(r).append(n).append(c),v.append(o),m.modal("hide"),$(".delWarehouse").click(function(e){var t=$(this).attr("data-id");i.confirm({title:"",message:"¿Está seguro que desea quitar este usuario?",confirm:"Si",cancel:"No"},function(){$("#tr_b_"+t).remove()}),e.preventDefault()})}function u(){U=!0;var e=getFormSearch("frm-search-user","search_user","LoadRecordsButtonUser"),t=$("#table_container_usuario");t.jtable({title:"Lista de Usuarios",paging:!0,sorting:!0,actions:{listAction:base_url+"/warehouses/listUser"},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},username:{title:"Usuario"},name:{title:"Nombre"},select:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_u" data-code="'+e.record.id+'" data-title="'+e.record.username+'"data-name="'+e.record.name+'" ><i class="fa fa-'+icon_select+' fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_u").click(function(e){var t=$(this).attr("data-code"),a=$(this).attr("data-title"),i=$(this).attr("data-name");d(t,a,i),e.preventDefault()})}}),generateSearchForm("frm-search-user","LoadRecordsButtonUser",function(){t.jtable("load",{search:$("#search_user").val()})},!1);var a=getFormSearch("frm-search-project","search_tienda","LoadRecordsButtonProject"),i=$("#table_container_p");i.jtable({title:"Lista de Tiendas",paging:!0,sorting:!0,actions:{listAction:base_url+"/warehouses/getTiendasSelec"},toolbar:{items:[{cssClass:"buscador",text:a}]},fields:{idTienda:{title:"Código",width:"5%",key:!0,create:!1,edit:!1,list:!1},Tienda:{title:"Tienda"},select:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_p"  data-name="'+e.record.Tienda+'" data-code="'+e.record.idTienda+'" ><i class="fa fa-'+icon_select+' fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_p").click(function(e){var t=$(this).attr("data-code"),a=$(this).attr("data-name");w.val(t),A.val(a),L.modal("hide"),e.preventDefault()})}}),generateSearchForm("frm-search-project","LoadRecordsButtonProject",function(){
i.jtable("load",{search:$("#search_tienda").val()})},!1)}var p,m,f,v,h,_,g,b,y,C,x,k,w,A,R,S,j,L,E,P,q,D,T,N=[];e.chkState=function(){var e=y.prop("checked")?"Si":"No";S.html(e);var t=x.prop("checked")?"Activo":"Inactivo";j.html(t);var a=q.prop("checked")?"Activo":"Inactivo";D.html(a)},e.openUser=function(){$("#LoadRecordsButtonUser").click(),m.modal("show")},e.AgregarLocaliza=function(){var e=!0;if(e=e&&P.required(),e=e&&E.required()){P=$("#w_code_localizacion").val(),E=$("#w_description_localizacion").val(),q=q.prop("checked")?"A":"I";var t=Math.random().toString(36).substr(2,18),a="N";c(t,P,E,q,a)}},e.openProject=function(){$("#LoadRecordsButtonProject").click(),L.modal("show")},e.saveWarehouse=function(){var e=!0;if(e=e&&_.required(),e=e&&g.required(),e=e&&C.required(),e=e&&R.required(),activeTab("almacen"),e&&""===A.val())return i.showWarning({title:"",message:"Debe agregar una Tienda  para el almacén"}),activeTab("almacen"),!1;if(e&&""===v.html())return i.showWarning({title:"",message:"Debe agregar mínimo 1 usuario para el almacén"}),activeTab("usuario"),!1;if(e&&""===T.html())return i.showWarning({title:"",message:"Debe agregar mínimo 1 localización para el almacén"}),activeTab("localizacion"),!1;if(e){var o=[];$.each($(".w_user"),function(e,t){o[e]=$(t).val()}),o=o.join(",");var r=[];$.each($(".w_locali_co"),function(e,t){r[e]=$(t).val()}),r=r.join(",");var n=[];$.each($(".idLocalizacion_v"),function(e,t){n[e]=$(t).val()}),n=n.join(",");var s=[];$.each($(".w_locali_des"),function(e,t){s[e]=$(t).val()}),s=s.join(",");var c=[];$.each($(".w_locali_est"),function(e,t){c[e]=$(t).val()}),c=c.join(","),console.log(o),console.log(r),console.log(s),console.log(c);var l={id:h.val(),code_internal:g.val(),description:_.val(),type_id:b.val(),project_id:k.val(),address:C.val(),state:x.prop("checked")?1:0,physical_location:y.prop("checked")?1:0,idTienda:w.val(),users:o,local_codigo:r,local_descripcion:s,local_estado:c,idLocalizacion_v:n,id_delete:N},d=""===h.val()?0:h.val();a.updated("warehouses/saveWarehouse",d,l,function(e){if(!t.isUndefined(e.status)&&e.status)i.textType({title:"",message:"El Almacén se guardó correctamente.",type:"success"}),p.modal("hide"),console.log(e.cont),LoadRecordsButtonWarehouse.click();else{var a=t.isUndefined(e.message)?"No se pudo guardar el Almacén. Intente nuevamente.":e.message;i.textType({title:"",message:a,type:"error"})}})}};var F=getFormSearch("frm-search-warehouse","search_warehouse","LoadRecordsButtonWarehouse"),M=$("#table_container_warehouse");M.jtable({title:"Lista de Almacenes",paging:!0,sorting:!0,actions:{listAction:base_url+"/warehouses/list",deleteAction:base_url+"/warehouses/delete"},toolbar:{items:[{cssClass:"buscador",text:F},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){e.openDoc("warehouses/excel",{})}},{cssClass:"btn-danger-admin",text:'<i class="fa fa-plus"></i> Nuevo Almacén',click:function(){s()}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},description:{title:"Almacén"},code_internal:{title:"Código Interno"},type_id:{title:"Tipo",options:{1:"CONSUMO",2:"VENTA"},list:show_list_},address:{title:"Dirección",list:show_list_},state:{title:"Estado",options:{1:"Activo",0:"Inactivo"},list:show_list_},edit:{width:"1%",sorting:!1,edit:!1,create:!1,listClass:"text-center",display:function(e){return'<a href="javascript:void(0)" title="Editar" class="edit_w" data-code="'+e.record.id+'"><i class="fa fa-pencil-square-o fa-1-5x fa-green"></i></a>'}}},recordsLoaded:function(e,t){$(".edit_w").click(function(e){var t=$(this).attr("data-code");l(t),e.preventDefault()})}}),generateSearchForm("frm-search-warehouse","LoadRecordsButtonWarehouse",function(){M.jtable("load",{search:$("#search_warehouse").val()})},!0);var U=!1}function t(e,t){e.state("warehouses",{url:"/warehouses",templateUrl:base_url+"/templates/warehouses/base.html",controller:"WarehouseCtrl"}),t.otherwise("/")}angular.module("sys.app.warehouses").config(t).controller("WarehouseCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.app.writing_checks",[])}(),function(){"use strict";function e(e,t,a,i){function o(){d=$("#modalWC"),p=$("#title-wc"),u=$("#modalProyect"),m=$("#w_user_body"),f=$("#WritingChecks_id"),v=$("#w_description"),h=$("#w_code_internal"),_=$("#w_type_id"),g=$("#w_physical_location"),b=$("#w_address"),y=$("#w_state"),u.on("hidden.bs.modal",function(e){d.attr("style","display:block;")}),u.on("show.bs.modal",function(e){d.attr("style","display:block; z-index:2030 !important")}),d.on("hidden.bs.modal",function(e){r()}),k||l()}function r(){p.html(""),f.val(""),v.val(""),b.val(""),h.val(""),y.prop("checked",!1),g.prop("checked",!1),m.html(""),activeTab("almacen")}function n(){o(),d.modal("show"),p.html("Nuevo Emisión de Cheque")}function s(e){o(),p.html("Editar Emisión de Cheque"),d.modal("show")}function c(e,t,a){if($("#tr_b_"+e).length>0)return i.showWarning({title:"",message:"Ya se asignó este Usuario"}),!1;var o=$('<tr id="tr_b_'+e+'"></tr>'),r=$("<td>"+t+"</td>"),n=$("<td>"+a+"</td>"),s=$('<input type="hidden" class="w_user" value="'+e+'" />');r.append(s);var c=$('<td class="text-center"></td>'),l=$('<button class="btn btn-danger btn-xs delWritingChecks" data-id="'+e+'" type="button"><span class="fa fa-trash"></span></button>');c.append(l),o.append(r).append(n).append(c),$("#w_user_body").append(o),$("#modalUsuario").modal("hide"),$(".delWritingChecks").click(function(e){var t=$(this).attr("data-id");i.confirm({title:"",message:"¿Está seguro que desea quitar este Almacén?",confirm:"Si",cancel:"No"},function(){$("#tr_b_"+t).remove()}),e.preventDefault()})}function l(){k=!0;var e=getFormSearch("frm-search-proyect","search_proyect","LoadRecordsButtonProyect"),t=$("#table_container_proyect");t.jtable({title:"Lista de Proyectos",paging:!0,sorting:!0,actions:{listAction:base_url+"/buyers/listUser"},toolbar:{items:[{cssClass:"buscador",text:e}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},username:{title:"Código"},name:{title:"Descripción"},select:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return'<a href="javascript:void(0)" title="Seleccionar" class="select_u" data-code="'+e.record.id+'" data-title="'+e.record.username+'"data-name="'+e.record.name+'" ><i class="fa fa-check-circle-o fa-1-5x"></i></a>'}}},recordsLoaded:function(e,t){$(".select_u").click(function(e){var t=$(this).attr("data-code"),a=$(this).attr("data-title"),i=$(this).attr("data-name");c(t,a,i),e.preventDefault()})}}),generateSearchForm("frm-search-proyect","LoadRecordsButtonProyect",function(){t.jtable("load",{search:$("#search_proyect").val()})},!1)}var d,u,p,m,f,v,h,_,g,b,y;e.openProyect=function(){$("#LoadRecordsButtonUser").click(),u.modal("show")},e.saveWritingChecks=function(){var e=!0;if(e=e&&v.required(),e=e&&_.required(),e=e&&b.required(),e=e&&h.required()){var o=[];$.each($(".w_user"),function(e,t){o[e]=$(t).val()}),o=o.join(",");var r={id:f.val(),code_internal:h.val(),description:v.val(),type_id:_.val(),address:b.val(),state:y.prop("checked")?1:0,physical_location:g.prop("checked")?1:0,users:o},n=""==f.val()?0:f.val();console.log(n),a.updated("writing_checks/saveWritingChecks",n,r,function(e){t.isUndefined(e.status)||1!=e.status?i.textType({title:"",message:"Hubo un error al guardar el Almacén. Intente nuevamente.",type:"error"}):(console.log(e),i.textType({title:"",message:"El Almacén se guardó correctamente.",type:"success"}),d.modal("hide"),LoadRecordsButtonWritingChecks.click())})}};var C=getFormSearch("frm-search-WritingChecks","search_WritingChecks","LoadRecordsButtonWritingChecks"),x=$("#table_container_writing_checks");x.jtable({title:"Lista de Gestión de Emisión de Cheques",paging:!0,sorting:!0,actions:{listAction:function(e,t){return{Result:"OK",Records:[{description:"CHEQUES  NEGOCIABLE",responsable:"LOPEZ GARCIA",proyecto:"CONEXIONES MASIVAS",cheque:"009299",banco:"CONTINENTAL",periodo:"201701",saldo:"8,456.00",fecha_emision:"12/01/2017"},{description:"CHEQUES  NEGOCIABLE",responsable:"LOPEZ GARCIA",proyecto:"ENOSA_CONSORCIO SANTA CRUZ",cheque:"009299",banco:"BCP",periodo:"201702",saldo:"9,756.00",fecha_emision:"12/02/2017"},{description:"CHEQUES  NEGOCIABLE",responsable:"LOPEZ GARCIA",proyecto:"OI - EECOL-CERCADO",cheque:"009299",banco:"MI BANCO",periodo:"201703",saldo:"12,656.00",fecha_emision:"12/03/2017"},{description:"CHEQUES  NEGOCIABLE",responsable:"LOPEZ GARCIA",proyecto:" ENSA_CONSORCIO SAN JUDAS TADEO-SELVA",cheque:"009299",periodo:"201704",banco:"BCP",saldo:"8,256.00",fecha_emision:"12/04/2017"}],TotalRecordCount:4}},deleteAction:base_url+"/writing_checks/delete"},toolbar:{items:[{cssClass:"buscador",text:C},{cssClass:"btn-primary",text:'<i class="fa fa-file-excel-o"></i> Exportar a Excel',click:function(){window.open(base_url+"/writing_checks/excel")}},{cssClass:"btn-success",text:'<i class="fa fa-plus"></i> Nuevo Emisión de Cheque',click:function(){n()}}]},fields:{id:{key:!0,create:!1,edit:!1,list:!1},description:{title:show_list_?"Forma de Ingreso":"Frm. Ingreso",width:"8%"},proyecto:{title:"Proyecto"},responsable:{title:"Responsable",width:"6%"},cheque:{title:"Cheque",width:"3%"},banco:{title:"Banco",width:"4%"},periodo:{title:"Periodo Contable",list:show_list_,width:"3%"},fecha_emision:{title:"Fecha",listClass:"text-center",list:show_list_,width:"3%"},saldo:{title:show_list_?"Monto Total":"Total",listClass:"text-right",width:"3%"},edit:{width:"1%",sorting:!1,edit:!1,create:!1,display:function(e){return'<a href="javascript:void(0)" title="Editar" class="edit_w" data-code="'+e.record.id+'"><i class="fa fa-pencil-square-o fa-1-5x fa-green"></i></a>'}}},recordsLoaded:function(e,t){$(".edit_w").click(function(e){var t=$(this).attr("data-code");s(t),e.preventDefault()})}}),generateSearchForm("frm-search-WritingChecks","LoadRecordsButtonWritingChecks",function(){x.jtable("load",{search:$("#search_WritingChecks").val()})},!0);var k=!1}function t(e,t){e.state("writing_checks",{url:"/writing_checks",templateUrl:base_url+"/templates/writing_checks/base.html",controller:"WritingChecksCtrl"}),t.otherwise("/")}angular.module("sys.app.writing_checks").config(t).controller("WritingChecksCtrl",e),t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$scope","_","RESTService","AlertFactory"]}(),function(){"use strict";angular.module("sys.utils.filters",[])}(),function(){"use strict";function e(){return function(e){if(angular.isDefined(e)){for(var t=[/[\300-\306]/g,/[\340-\346]/g,/[\310-\313]/g,/[\350-\353]/g,/[\314-\317]/g,/[\354-\357]/g,/[\322-\330]/g,/[\362-\370]/g,/[\331-\334]/g,/[\371-\374]/g,/[\321]/g,/[\361]/g,/[\307]/g,/[\347]/g],a=["A","a","E","e","I","i","O","o","U","u","N","n","C","c"],i=0;i<t.length;i++)e=e.replace(t[i],a[i]);return e}}}function t(e,t){return function(e,a){var i="<div>Pagado</div>";return a.append(t(i)(a))}}function a(e){return function(t){return e.isNull(t)||e.isUndefined(t)||e.isNaN(t)?"sin fecha":moment(t).format("h:m a")}}function i(e){return function(t){return e.isNull(t)||e.isUndefined(t)||e.isNaN(t)?"sin fecha":moment(t).format("DD MMM YYYY h:m a")}}function o(){return function(e){return _.isNull(e)||_.isUndefined(e)||_.isNaN(e)?"sin fecha":moment(e).format("DD MMM YYYY")}}function r(e){return function(t){return e.isNull(t)||e.isUndefined(t)||e.isNaN(t)?"sin fecha":moment(t).format("dddd MMM YYYY,  hA")}}function n(e){return function(t){var a=e.roundToTwo(t);return"S/. "+a.toFixed(2)}}angular.module("sys.utils.filters").filter("dateFormatGrid",r).filter("dateFormatShort",o).filter("dateFormatHour",a).filter("dateFormatMedium",i).filter("showStatusSale",t).filter("removeAcentos",e).filter("moneyFormatSolesGrid",n),n.$inject=["HelperFactory"],r.$inject=["_"],a.$inject=["_"],t.$inject=["_","$compile"],i.$inject=["_"],o.$inject=["_"],e.$inject=["_"]}(),function(){"use strict";angular.module("sys.utils.libraries",["oitozero.ngSweetAlert","ngAnimate","angular-growl"])}(),function(){"use strict";function e(e,t,a){function i(a,i){e.swal({title:a.title,text:a.message,html:!0,type:"warning",closeOnConfirm:!0,customClass:t.isUndefined(a.customClass)?"":a.customClass},function(e){"function"==typeof i&&i(e)})}function o(t,a){e.swal({title:t.title,text:t.message,html:!0,type:"error",closeOnConfirm:!0},function(e){"function"==typeof a&&a(e)})}function r(t,a,i){var o=!0;t.title=t.title||"Está seguro?",e.swal({title:t.title,text:t.message,type:"warning",showCancelButton:!1,confirmButtonColor:"#DD6B55",confirmButtonText:t.confirm,cancelButtonText:t.cancel,closeOnConfirm:!0,closeOnCancel:!0,status:o},function(e){e&&"function"==typeof a&&a(t)})}function n(a,i,o){e.swal({title:a.title,text:a.message,type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:a.confirm,cancelButtonText:a.cancel,closeOnConfirm:!!t.isUndefined(a.closeOnConfirm)||a.closeOnConfirm,showLoaderOnConfirm:!t.isUndefined(a.showLoaderOnConfirm)&&a.showLoaderOnConfirm,closeOnCancel:!0},function(e){e?"function"==typeof i&&i(a):"function"==typeof o&&o()})}function s(a,i,o){e.swal({title:a.title,text:a.message,type:t.isUndefined(a.type)?"input":a.type,inputType:t.isUndefined(a.inputType)?"text":a.inputType,showCancelButton:!0,closeOnConfirm:!!t.isUndefined(a.closeOnConfirm)||a.closeOnConfirm,animation:"slide-from-top",inputPlaceholder:t.isUndefined(a.placeholder)?"":a.placeholder,inputValue:t.isUndefined(a.inputValue)?"":a.inputValue,confirmButtonText:t.isUndefined(a.confirmButtonText)?"Ok":a.confirmButtonText,cancelButtonText:t.isUndefined(a.cancelButtonText)?"Cancelar":a.cancelButtonText,showLoaderOnConfirm:!t.isUndefined(a.showLoaderOnConfirm)&&a.showLoaderOnConfirm},function(r){return r===!1?("function"==typeof o&&o(),!1):""==r||t.isNull(r)||t.isUndefined(r)||t.isNaN(r)?(swal.showInputError(a.error_message),!1):(t.isUndefined(a.success_message)||e.swal(a.success_message,"success"),void("function"==typeof i&&i(r)))})}function c(a,i,o){e.swal({title:a.title,text:a.message,type:"input",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top",inputPlaceholder:a.placeholder,inputValue:a.inputValue},function(e){return e===!1?("function"==typeof o&&o(),!1):""==e||t.isNull(e)||t.isUndefined(e)||t.isNaN(e)?(swal.showInputError(a.error_message),!1):void("function"==typeof i&&i(e))})}function l(t){e.swal(t.title,t.message)}function d(t){e.swal(t.title,t.message,t.type)}var u={confirm:n,confirmImg:r,prompt:s,prompt2:c,text:l,textType:d,showWarning:i,showErrors:o};return u}angular.module("sys.utils.libraries").factory("AlertFactory",e),e.$inject=["SweetAlert","_","HelperFactory"]}(),function(){"use strict";function e(){function e(e,t){$('input[name="'+e+'"]').daterangepicker({showDropdowns:!0,showWeekNumbers:!0,autoApply:!0,ranges:{Hoy:[moment(),moment()],Ayer:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Esta semana":[moment().startOf("isoWeek"),moment().endOf("isoWeek")+1],"Semana pasada":[moment().subtract(1,"weeks").startOf("isoWeek"),moment().subtract(1,"weeks").endOf("isoWeek")+1],"Este mes":[moment().startOf("month"),moment().endOf("month")],"Mes pasado":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")],"Este año":[moment().startOf("years"),moment().endOf("years")]},locale:{format:"MM/DD/YYYY",separator:" - ",applyLabel:"Apply",cancelLabel:"Cancel",fromLabel:"From",toLabel:"To",customRangeLabel:"Custom",daysOfWeek:["Do","Lu","Mar","Mie","Jue","Vie","Sa"],monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],firstDay:1},linkedCalendars:!1,startDate:moment().subtract(5,"days"),endDate:moment()},function(e,a,i){"function"==typeof t&&t(e,a,i)})}var t={make:e};return t}angular.module("sys.utils.libraries").factory("DateRangePicker",e)}(),function(){"use strict";function e(e){a=e}function t(){function e(e,t){a.$broadcast(e,t)}function t(e,t){a.$emit(e,t)}var i={pushBroadcast:e,pushEmit:t};return i}var a=null;angular.module("sys.utils.libraries").run(e).factory("EventsFactory",t),e.$inject=["$rootScope"],t.$inject=[]}(),function(){"use strict";function e(e){e.onlyUniqueMessages(!0),e.globalTimeToLive({success:3e3,error:2e3,warning:4e3,info:4e3}),e.globalPosition("bottom-right")}function t(e){function t(t,a){e.warning(t,a)}function a(t,a){e.info(t,a)}function i(t,a){e.error(t,a)}function o(t,a){e.success(t,a)}var r={warning:t,info:a,error:i,success:o};return r}angular.module("sys.utils.libraries").config(e).factory("Notify",t),e.$inject=["growlProvider"],t.$inject=["growl"]}(),function(){"use strict";function e(e){return e._}angular.module("sys.utils.libraries").factory("_",e),e.$inject=["$window"]}(),function(){"use strict";angular.module("sys.utils.services",[])}(),function(){"use strict";function e(e,t,a){function i(i,o){var r=e.query(a.WEB_SERVICE_URL);r.save(i).$promise.then(function(e){"function"==typeof o&&o(e)},function(e){return t.showErrors({title:"Algo salio mal!",message:e.data.message}),!1})}var o={valid_ruc:i};return o}angular.module("sys.utils.services").constant("URL",{WEB_SERVICE_URL:"http://webservice.miasoftware.net/service/sunat/ruc.php?wsdl",TEST:"http://ws.insite.pe/sunat/trial.php?wsdl"}).factory("QueryRUC",e),e.$inject=["ApiService","AlertFactory","URL"]}(),function(){"use strict";angular.module("sys.utils.utils",["ngAnimate"])}(),function(){"use strict";function e(e,t){function a(e){return e.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}function i(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var a=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?a:3&a|8).toString(16)});return t}function o(e){return t.isNull(e)||t.isUndefined(e)?null:moment(e).format("YYYY-MM-DD")}function r(){var e=new Date,t=e.getDate(),a=e.getMonth()+1,i=e.getFullYear(),o=e.getHours(),r=e.getMinutes(),n=e.getSeconds(),s=i+"-"+a+"-"+t+"T"+o+":"+r+":"+n;return s}function n(e){t.isArray(e)&&console.log(!0)}function s(e,t){for(var a in e){var i=t.indexOf(a);i==-1&&delete e[a]}return e}function c(e){return+(Math.round(e+"e+2")+"e-2")}function l(e,t){return e=e.toString(),e.length<t?l("0"+e,t):e}function d(e){return e.charAt(0).toUpperCase()+e.slice(1)}function u(e){return moment(e).format("YYYY-MM-DD")}function p(){var t=e.host();return t.indexOf(".")<0?null:t.split(".")[0]}function m(e,t){return this.roundToTwo(parseFloat(e)*parseFloat(t)/100)}var f={roundToTwo:c,addZerosLeft:l,capitalizeFirstLetter:d,getDateShort:u,getSubDomain:p,calculateIGV:m,cleanObject:s,arrayToHtml:n,getCurrentDateHora:r,getParseDate:o,getUniqueId:i,slugify:a};return f}angular.module("sys.utils.utils").factory("HelperFactory",e),e.$inject=["$location","_"]}(),function(){"use strict";function e(e,t){var a={},i={type:"keydown",propagate:!1,inputDisabled:!1,target:e.document,keyCode:!1};return a.keyboardEvent={},a.bind=function(o,r,n){var s,c,l,d;n=angular.extend({},i,n),o=o.toLowerCase(),c=n.target,"string"==typeof n.target&&(c=document.getElementById(n.target)),s=function(a){if(a=a||e.event,n.inputDisabled){var i;if(a.target?i=a.target:a.srcElement&&(i=a.srcElement),3==i.nodeType&&(i=i.parentNode),"INPUT"==i.tagName||"TEXTAREA"==i.tagName)return}a.keyCode?l=a.keyCode:a.which&&(l=a.which);var s=String.fromCharCode(l).toLowerCase();188==l&&(s=","),190==l&&(s=".");for(var c=o.split("+"),u=0,p={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"},m={esc:27,escape:27,tab:9,space:32,"return":13,enter:13,backspace:8,scrolllock:145,scroll_lock:145,scroll:145,capslock:20,caps_lock:20,caps:20,numlock:144,num_lock:144,num:144,pause:19,"break":19,insert:45,home:36,"delete":46,end:35,pageup:33,page_up:33,pu:33,pagedown:34,page_down:34,pd:34,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123},f={shift:{wanted:!1,pressed:!!a.shiftKey},ctrl:{wanted:!1,pressed:!!a.ctrlKey},alt:{wanted:!1,pressed:!!a.altKey},meta:{wanted:!1,pressed:!!a.metaKey}},v=0,h=c.length;d=c[v],v<h;v++){switch(d){case"ctrl":case"control":u++,f.ctrl.wanted=!0;break;case"shift":case"alt":case"meta":u++,f[d].wanted=!0}d.length>1?m[d]==l&&u++:n.keyCode?n.keyCode==l&&u++:s==d?u++:p[s]&&a.shiftKey&&(s=p[s],s==d&&u++)}if(u==c.length&&f.ctrl.pressed==f.ctrl.wanted&&f.shift.pressed==f.shift.wanted&&f.alt.pressed==f.alt.wanted&&f.meta.pressed==f.meta.wanted&&(t(function(){r(a)},1),!n.propagate))return a.cancelBubble=!0,a.returnValue=!1,a.stopPropagation&&(a.stopPropagation(),a.preventDefault()),!1},a.keyboardEvent[o]={callback:s,target:c,event:n.type},c.addEventListener?c.addEventListener(n.type,s,!1):c.attachEvent?c.attachEvent("on"+n.type,s):c["on"+n.type]=s},a.unbind=function(e){e=e.toLowerCase();var t=a.keyboardEvent[e];if(delete a.keyboardEvent[e],t){var i=t.event,o=t.target,r=t.callback;o.detachEvent?o.detachEvent("on"+i,r):o.removeEventListener?o.removeEventListener(i,r,!1):o["on"+i]=!1}},a}angular.module("sys.utils.utils").factory("keyboardManager",e),e.$inject=["$window","$timeout"]}(),function(){"use strict";function e(){this.start=function(){$(document).ready(function(){function e(){var e=$("body > #wrapper").height()-61;$(".sidebard-panel").css("min-height",e+"px");var t=$("nav.navbar-default").height(),a=$("#page-wrapper").height();t>a&&$("#page-wrapper").css("min-height",t+"px"),t<a&&$("#page-wrapper").css("min-height",$(window).height()+"px"),$("body").hasClass("fixed-nav")&&$("#page-wrapper").css("min-height",$(window).height()-60+"px")}$(this).width()<769?$("body").addClass("body-small"):$("body").removeClass("body-small"),$(".collapse-link").click(function(){var e=$(this).closest("div.ibox"),t=$(this).find("i"),a=e.find("div.ibox-content");a.slideToggle(200),t.toggleClass("fa-chevron-up").toggleClass("fa-chevron-down"),e.toggleClass("").toggleClass("border-bottom"),setTimeout(function(){e.resize(),e.find("[id^=map-]").resize()},50)}),$(".close-link").click(function(){var e=$(this).closest("div.ibox");e.remove()}),$(".fullscreen-link").click(function(){var e=$(this).closest("div.ibox"),t=$(this).find("i");$("body").toggleClass("fullscreen-ibox-mode"),t.toggleClass("fa-expand").toggleClass("fa-compress"),e.toggleClass("fullscreen"),setTimeout(function(){$(window).trigger("resize")},100)}),$(".close-canvas-menu").click(function(){$("body").toggleClass("mini-navbar"),SmoothlyMenu()}),$(".right-sidebar-toggle").click(function(){$("#right-sidebar").toggleClass("sidebar-open")}),$(".open-small-chat").click(function(){$(this).children().toggleClass("fa-comments").toggleClass("fa-remove"),$(".small-chat-box").toggleClass("active")}),$(".check-link").click(function(){var e=$(this).find("i"),t=$(this).next("span");return e.toggleClass("fa-check-square").toggleClass("fa-square-o"),t.toggleClass("todo-completed"),!1}),$(".navbar-minimalize").click(function(){$("body").toggleClass("mini-navbar"),SmoothlyMenu()}),$(".tooltip-demo").tooltip({selector:"[data-toggle=tooltip]",container:"body"}),$(".modal").appendTo("body"),e(),$(window).bind("load",function(){$("body").hasClass("fixed-sidebar")&&$(".sidebar-collapse").slimScroll({height:"100%",railOpacity:.9})}),$(window).scroll(function(){$(window).scrollTop()>0&&!$("body").hasClass("fixed-nav")?$("#right-sidebar").addClass("sidebar-top"):$("#right-sidebar").removeClass("sidebar-top")}),$(window).bind("load resize scroll",function(){$("body").hasClass("body-small")||e()}),$("[data-toggle=popover]").popover()})}}angular.module("sys.utils.utils").service("MenuLeftStart",e)}(),function(){"use strict";angular.module("sys.utils.widgets",["angucomplete-alt"])}(),function(){"use strict";function e(){return{restrict:"A",link:function(e,t,a){var i=a.charLimit;t.bind("keyup",function(e){var a=t.parent().parent();a.toggleClass("warning",i-t.val().length<=10),a.toggleClass("error",t.val().length>i)}),t.bind("keypress",function(e){t.val().length>=i&&8!=e.keyCode&&e.preventDefault()})}}}angular.module("sys.utils.widgets").directive("charLimit",e)}(),function(){"use strict";function e(e,t){return{restrict:"A",scope:{focusValue:"=syncFocusWith"},link:function(e,t,a){e.$watch("focusValue",function(e,a){e!==!0||a?e===!1&&a&&t[0].blur():t[0].focus()})}}}function t(e){return{scope:{trigger:"@focusMe"},link:function(t,a){t.$watch("trigger",function(t){"true"===t&&e(function(){a[0].focus()})})}}}function a(e){return{restrict:"A",link:function(t,a,i){a.on(i.selectAll,function(){e.getSelection().toString()||this.setSelectionRange(0,this.value.length)})}}}angular.module("sys.utils.widgets").directive("focusMe",t).directive("syncFocusWith",e).directive("selectAll",a),t.$inject=["$timeout","$parse"],e.$inject=["$timeout","$rootScope"],a.$inject=["$window"]}(),function(){"use strict";function e(){return{require:"ngModel",scope:{passwordVerify:"="},link:function(e,t,a,i){e.$watch(function(){var t;return(e.passwordVerify||i.$viewValue)&&(t=e.passwordVerify+"_"+i.$viewValue),t},function(t){t&&i.$parsers.unshift(function(t){var a=e.passwordVerify;return a!==t?void i.$setValidity("noMatch",!1):(i.$setValidity("noMatch",!0),t)})})}}}function t(){return{require:"ngModel",link:function(e,t,a,i){var o=function(e){void 0==e&&(e="");var t=e.toUpperCase();return t!==e&&(i.$setViewValue(t),i.$render()),t};i.$parsers.push(o),o(e[a.ngModel])}}}function a(){return{require:"ngModel",scope:{regex:"@replace","with":"@with"},link:function(e,t,a,i){i.$parsers.push(function(t){if(t){var a=new RegExp(e.regex),o=t.replace(a,e["with"]);return o!==t&&(i.$setViewValue(o),i.$render()),o}})}}}function i(){return{restrict:"A",link:function(e,t,a,i){t.on("keydown keyup",function(e){if(9!==e.keyCode&&"keyup"===e.type){var t=$(this),a=t.val();return a=a.replace(/[^0-9]{1,8}/g,""),t.val(a),64!=e.which&&16!=e.which&&(e.which>=48&&e.which<=57||(e.which>=96&&e.which<=105||([8,13,27,37,38,39,40].indexOf(e.which)>-1||(e.preventDefault(),!1))))}})}}}function o(){return{replace:!0,template:'<input replace="[^a-zA-Z0-9@._-]" with="">'}}angular.module("sys.utils.widgets").directive("allowOnlyNumbers",i).directive("allowOnlyEmails",o).directive("capitalize",t).directive("passwordVerify",e).directive("replace",a)}(),function(){"use strict";function e(e,t,a){return{restrict:"E",scope:{ngModel:"=",urlData:"@"},require:"ngModel",template:'<input type="text" class="stv_inputAlt" allow-only-emails name="email" id="email" ng-class="{\'input-error\': error_email }"\n\n ng-model="ngModel"><i ng-show="validate" class="fa fa-spinner fa-pulse input-spinner"></i><span ng-show="error_email_exist">El email ya existe</span>',link:function(i,o,r,n){i.$watch("ngModel",function(o,s){if(i.error_email_exist=!1,!e.isUndefined(o))if(t.EMAIL1.test(o)){if(e.isUndefined(i.urlData))return!1;a.findByEmail(o,i.urlData).then(function(e){e?(n.$setValidity(r.ngModel,!0),i.error_email=!1):(n.$setValidity(r.ngModel,!1),i.error_email=!0,i.error_email_exist=!0)})}else n.$setValidity(r.ngModel,!1),i.error_email=!0})}}}function t(e,t,a){return{restrict:"E",scope:{ngModel:"=ngModel",urlData:"@",maxDigits:"="},require:"ngModel",template:'<input type="text" allow-only-numbers  char-limit="8" name="document" ng-class="{\'input-error\': error_document }"\n\n class="stv_inputAlt" ng-model="ngModel"><i ng-show="validate"  class="fa fa-spinner fa-pulse input-spinner"></i><span ng-show="error_document">El documento ya existe</span>',link:function(i,o,r,n){function s(){n.$setValidity(r.ngModel,!1),i.error_document=!0}function c(){n.$setValidity(r.ngModel,!0),i.error_document=!1}i.$watch("ngModel",function(o,r){e.isUndefined(o)||t.DNI_DIGITS!=o.length&&t.RUC_DIGITS!=o.length||(i.validate=!0,a.findByDocument(o,i.urlData).then(function(e){i.validate=!1,e?c():s()}))})}}}angular.module("sys.utils.widgets").constant("DOCUMENTS",{DNI_DIGITS:8,RUC_DIGITS:11}).directive("inputDocumentDni",t).directive("inputEmail",e),t.$inject=["_","DOCUMENTS","ValidateFactory"],e.$inject=["_","REGEX","ValidateFactory"]}(),function(){"use strict";function e(){return{restrict:"E",scope:!1,templateUrl:"../static/templates/layouts/partials/loading.html",controller:"LoadingCtrl"}}function t(e,t,a,i){var o=$(a);o.parent().addClass("position-relative"),e.$on("showSysLoading",function(t,a){e.showMessage=a.message,o.children("div").removeClass("display-none")}),e.$on("hideSysLoading",function(e,t){o.children("div").addClass("display-none")})}angular.module("sys.utils.widgets").directive("sysLoading",e).controller("LoadingCtrl",t),t.$inject=["$scope","$state","$element","$attrs"]}(),function(){"use strict";function e(){return{scope:{status:"="},link:function(e,t,a){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(a.ngEnter)}),t.preventDefault())})}}}function t(){return{link:function(e,t,a){t.bind("keydown keypress",function(t){console.log("enter"),13!==t.which||t.ctrlKey||(e.$apply(function(){e.$eval(a.ngEnter)}),t.preventDefault())})}}}angular.module("sys.utils.widgets").directive("ngEnter",t).directive("ngEnterSales",e)}(),function(){"use strict";function e(e,t,a,i,o,r){var n=function(e){var t=o.defer(),a=$('<iframe style="display: none"></iframe>').appendTo("body")[0];a.contentWindow.printAndRemove=function(){a.contentWindow.print(),r.pushBroadcast("onCloseWindowPrint"),$(a).remove()};var i='<!doctype html><html><body onload="printAndRemove();">'+e+"</body></html>",n=a.contentWindow.document.open("text/html","replace");return n.write(i),t.resolve(),n.close(),t.promise},s=function(o,r){a.get(o).success(function(o){var s=e.$new();angular.extend(s,r);var c=t($("<div>"+o+"</div>"))(s),l=function(){s.$$phase||a.pendingRequests.length?i(l):(n(c.html()),s.$destroy())};l()})},c=function(o,r,s){e.isBeingPrinted=!0,a.get(o).success(function(o){var c=r,l=t($("<div>"+o+"</div>"))(c),d=function(){c.$$phase||a.pendingRequests.length?i(d):n(l.html()).then(function(){e.isBeingPrinted=!1,_.isFunction(s)&&setTimeout(function(){s()},500)})};d()})};return{print:s,printFromScope:c}}angular.module("sys.utils.widgets").factory("Printer",e),e.$inject=["$rootScope","$compile","$http","$timeout","$q","EventsFactory"]}(),function(){"use strict";function e(){return{restrict:"EA",replace:!0,scope:{ngTutorial:"="},link:{pre:function(e,t,a){}},templateUrl:"../static/templates/layouts/partials/tutorial.html"}}function t(e,t,a,i,o){function r(){e.stepTwoShow=!0,e.stepThreeShow=!1,e.stepFourShow=!1}function n(){t.all("my_shop",null,function(t){e.my_shop=t.my_shop,e.tutorial=t.my_shop.tutorial,e.is_tutorial=t.my_shop.tutorial,e.vouchers=t.vouchers,e.taxes=t.taxes,e.payment_methods=t.payments_methods,e.roles=t.roles,e.roleSelected=t.roles[0]})}e.validate_document=!0,e.voucherSelection={},e.methodsSelection={},e.taxesSelection={},e.user={},n(),r(),e.nextStepTwo=function(){e.stepTwoShow=!1,e.stepThreeShow=!0},e.nextStepThree=function(){e.user.role_id=e.roleSelected.id;var a={my_shop_id:e.my_shop.id,company_id:e.my_shop.company_id,vouchers:e.voucherSelection.vouchers,taxes:e.taxesSelection.taxes,methods:e.methodsSelection.methods,user:e.user};t.save("tutorial",a,function(e){o.location.reload(!0)})},e.user.validate_username=!1,e.backStepTwo=function(){e.stepOneShow=!0,e.stepTwoShow=!1},e.backStepTree=function(){e.stepThreeShow=!1,e.stepTwoShow=!0},e.$watch("my_shop.ruc",function(t,o){i.isEmpty(t)||a.findByDocument(t,"company_by_document","ruc="+t).then(function(a){i.isNull(a)||(e.my_shop.ruc==t&&(a=!a),e.validate_document=a)})}),e.$watch("user.username",function(a,o){if(!i.isUndefined(a)){var r="username="+a;t.all("unique_username",r,function(t){e.user.validate_username=t.status})}})}angular.module("sys.utils.widgets").controller("TutorialCtrl",t).directive("ngTutorial",e),t.$inject=["$scope","RESTService","ValidateFactory","_","$window"]}(),function(){"use strict";function e(){var e=function(e,t,a){var i=a.chosen;e.$watch(i,function(){t.trigger("chosen:updated")}),e.$watch(a.ngModel,function(){
t.trigger("chosen:updated")}),t.chosen({width:"100%"})};return{restrict:"A",link:e}}angular.module("sys.utils.widgets").directive("chosen",e)}();